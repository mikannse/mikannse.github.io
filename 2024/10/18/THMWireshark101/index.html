<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>THMWireshark101THM | MikannseのSekai</title><meta name="author" content="Mikannse"><meta name="copyright" content="Mikannse"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="IntroductionWireshark 是一种用于创建和分析 PCAP（网络数据包捕获文件）的工具，通常被用作最佳数据包分析工具之一。在本课程中，我们将介绍安装 Wireshark 的基础知识以及使用它进行基本数据包分析，并深入了解每种常见的网络协议。  InstallationWireshark 的安装非常简单，通常附带一个打包的 GUI 向导。幸运的是，如果您使用的是 Kali Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="THMWireshark101THM">
<meta property="og:url" content="https://blog.mikannse.cn/2024/10/18/THMWireshark101/index.html">
<meta property="og:site_name" content="MikannseのSekai">
<meta property="og:description" content="IntroductionWireshark 是一种用于创建和分析 PCAP（网络数据包捕获文件）的工具，通常被用作最佳数据包分析工具之一。在本课程中，我们将介绍安装 Wireshark 的基础知识以及使用它进行基本数据包分析，并深入了解每种常见的网络协议。  InstallationWireshark 的安装非常简单，通常附带一个打包的 GUI 向导。幸运的是，如果您使用的是 Kali Linux">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg">
<meta property="article:published_time" content="2024-10-18T06:32:17.000Z">
<meta property="article:modified_time" content="2024-10-21T13:03:07.846Z">
<meta property="article:author" content="Mikannse">
<meta property="article:tag" content="溯源取证">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="工具">
<meta property="article:tag" content="流量分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg"><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="https://blog.mikannse.cn/2024/10/18/THMWireshark101/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Mikannse","link":"链接: ","source":"来源: MikannseのSekai","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'THMWireshark101THM',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-10-21 21:03:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">346</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="MikannseのSekai"><span class="site-name">MikannseのSekai</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">THMWireshark101THM</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-18T06:32:17.000Z" title="发表于 2024-10-18 14:32:17">2024-10-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-21T13:03:07.846Z" title="更新于 2024-10-21 21:03:07">2024-10-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E5%AE%89/">网安</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="THMWireshark101THM"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Wireshark 是一种用于创建和分析 PCAP（网络数据包捕获文件）的工具，通常被用作最佳数据包分析工具之一。在本课程中，我们将介绍安装 Wireshark 的基础知识以及使用它进行基本数据包分析，并深入了解每种常见的网络协议。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/1.png" alt="img"></p>
<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>Wireshark 的安装非常简单，通常附带一个打包的 GUI 向导。幸运的是，如果您使用的是 Kali Linux（或 TryHackMe AttackBox），那么它已经安装在您的机器上。Wireshark 可以在 Windows、macOS 和 Linux 上运行。要开始在 Windows 或 macOS 设备上安装 Wireshark，您需要先从 <a target="_blank" rel="noopener" href="https://www.wireshark.org/download.html">Wireshark 网站</a> 获取安装程序。下载安装程序后，只需运行它并按照 GUI 向导操作即可。</p>
<p>如果您使用的是 Linux，则可以使用 <em>apt install wireshark</em> 或类似的包管理器安装 Wireshark。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/2.png" alt="img"></p>
<p><em>注意：Wireshark 可能附带其他软件包和工具；您可以决定是否要与 Wireshark 一起安装它们。</em></p>
<p>有关 Wireshark 的更多信息，请查看 <a target="_blank" rel="noopener" href="https://www.wireshark.org/docs/">Wireshark 文档</a>。</p>
<h1 id="Wireshark-Overview"><a href="#Wireshark-Overview" class="headerlink" title="Wireshark Overview"></a>Wireshark Overview</h1><p>打开 Wireshark 时我们看到的第一个屏幕是主页，它允许我们指定我们的接口以及应用过滤器来缩小我们捕获的流量范围。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/3.png" alt="img"></p>
<p>在这里您可以看到我有多个接口需要过滤，但您的接口可能比我拥有的多或少。从这里我们可以选择是否要对我们的接口执行实时捕获或加载 PCAP 进行分析。</p>
<p>值得注意的是，接口名称旁边的图表显示了接口上的活动，如果接口的条形图平坦，则尝试捕获该接口可能毫无用处（<em>因为 Wireshark 客户端没有拾取该接口上的任何数据）</em>。</p>
<h2 id="Live-Packet-Captures"><a href="#Live-Packet-Captures" class="headerlink" title="Live Packet Captures"></a>Live Packet Captures</h2><p>如果我们首先导航到 Wireshark 中的绿色功能区并选择管理捕获过滤器，我们就可以查看可用过滤器的列表。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/4.png" alt="img"></p>
<p>您不必选择过滤器，它只会帮助减少传入的数据包数量并组织捕获。这只是对过滤器的简要介绍，有关过滤器的更多信息，请转到任务 12 或转到 <a target="_blank" rel="noopener" href="https://wiki.wireshark.org/CaptureFilters">Wireshark 网站</a>。</p>
<p>选择任何要选择的捕获过滤器后，您可以通过双击接口或右键单击并导航到“开始捕获”来开始捕获接口。</p>
<p>根据网络活动，您可能看不到传入的数据包，也可能会看到数据包非常快速地流入。</p>
<p>收集完所需或想要的数据包后，您可以单击红色方块停止捕获，然后开始分析。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/5.png" alt="img"></p>
<p>查看上面的屏幕截图，我们可以看到一个示例捕获。在此屏幕上，您将对数据包进行大部分分析和剖析。要打开数据包捕获，请转到文件 &gt; 打开 &gt;，然后选择要分析的 PCAP。</p>
<p>在此屏幕上，Wireshark 为我们提供了有关每个数据包的一些重要信息，包括：</p>
<ul>
<li>数据包编号</li>
<li>时间</li>
<li>来源</li>
<li>目的地</li>
<li>协议</li>
<li>长度</li>
<li>数据包信息</li>
</ul>
<p>除了快速数据包信息外，Wireshark 还按危险级别和协议对数据包进行颜色编码，以便能够快速发现捕获中的异常和协议。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/6.png" alt="img"></p>
<p>快速浏览数据包信息有助于在分析过程中准确找到您要查找的内容。</p>
<p>尝试使用 Wireshark 的菜单和各种功能来感受它，我们将在后面的任务中进一步详细介绍其中一些功能。</p>
<h1 id="Collection-Methods"><a href="#Collection-Methods" class="headerlink" title="Collection Methods"></a>Collection Methods</h1><p>在详细介绍如何分析 PCAP 中的每个协议之前，我们需要了解收集 PCAP 文件的方法。在 Wireshark 中收集 PCAP 的基本步骤可能很简单，但引入流量既是困难的部分，也是有趣的部分，这可能包括：窃听、端口镜像、MAC 泛洪、ARP 中毒。本房间将不介绍如何设置这些实时数据包捕获的各种策略，而只会介绍每种策略的基本理论。</p>
<h2 id="Collection-Methods-Overview"><a href="#Collection-Methods-Overview" class="headerlink" title="Collection Methods Overview"></a>Collection Methods Overview</h2><p>在开始尝试收集和监控实时数据包捕获之前，需要考虑一些事项。</p>
<ul>
<li>首先从样本捕获开始，以确保所有设置都正确，并且您成功捕获了流量。</li>
<li>确保您有足够的计算能力来处理基于网络规模的数据包数量，这显然会因网络而异。</li>
<li>确保有足够的磁盘空间来存储所有数据包捕获。</li>
</ul>
<p>满足所有这些条件并选择了收集方法后，您就可以开始主动监控和收集网络上的数据包了。</p>
<h2 id="Network-Taps"><a href="#Network-Taps" class="headerlink" title="Network Taps"></a>Network Taps</h2><p>网络窃听器是一种物理植入物，可在电缆之间进行物理窃听，威胁搜寻/DFIR 团队和红队通常使用这些技术来嗅探和捕获数据包。</p>
<p>窃听线路有两种主要方法。第一种是使用硬件窃听线路并拦截通过的流量，例如下图所示的吸血鬼窃听器。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/7.gif" alt="img"></p>
<p>另一种安装网络分接头的方法是使用内联网络分接头，您可以将其安装在两个网络设备之间或“内联”两个网络设备。分接头将在数据包通过分接头时复制数据包。这种分接头的一个例子是非常常见的 Throwing Star LAN 分接头</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/8.jpg" alt="img"></p>
<h2 id="MAC-Floods"><a href="#MAC-Floods" class="headerlink" title="MAC Floods"></a>MAC Floods</h2><p>MAC 泛洪是红队常用的一种主动嗅探数据包的策略。MAC 泛洪旨在给交换机施加压力并填充 CAM 表。一旦 CAM 表被填满，交换机将不再接受新的 MAC 地址，因此为了保持网络正常运行，交换机将向交换机的所有端口发送数据包。</p>
<p><em>注意：使用此技术时应极其谨慎，并事先征得明确同意。</em></p>
<h2 id="ARP-Poisoning"><a href="#ARP-Poisoning" class="headerlink" title="ARP Poisoning"></a>ARP Poisoning</h2><p>ARP 中毒是红队用来主动嗅探数据包的另一种技术。通过 ARP 中毒，您可以将流量从主机重定向到您正在监控的机器。这种技术不会像 MAC 泛洪那样给网络设备带来压力，但仍应谨慎使用，并且仅在其他技术（如网络分路器）不可用时使用。</p>
<p>将这些方法与您之前从上一个任务中捕获流量的知识相结合，将使您能够主动监控并从头开始收集实时数据包捕获。</p>
<h1 id="Filtering-Captures"><a href="#Filtering-Captures" class="headerlink" title="Filtering Captures"></a>Filtering Captures</h1><p>Packet Filtering is a very important part of packet analysis especially when you have a very large number of packet sometimes even 100,000 plus. In task 3 capture filters were briefly covered however there is a second type of filter that is often thought of as more powerful and easier to use. This second method is known as display filters, you can apply display filters in two ways: through the analyze tab and at the filter bar at the top of the packet capture.</p>
<h2 id="Filtering-Operators"><a href="#Filtering-Operators" class="headerlink" title="Filtering Operators"></a>Filtering Operators</h2><p>Wireshark 的过滤器语法简单易懂，因此很容易快速掌握。要充分利用这些过滤器，您需要对布尔和逻辑运算符有基本的了解。</p>
<p>Wireshark 仅有几个您需要熟悉的运算符：</p>
<ul>
<li>与 - 运算符：and / &amp;&amp;</li>
<li>或 - 运算符：or / ||</li>
<li>等于 - 运算符：eq / ==</li>
<li>不等于 - 运算符：ne / !=</li>
<li>大于 - 运算符：gt / &gt;</li>
<li>小于 - 运算符：lt / &lt;</li>
</ul>
<p>Wireshark 还有一些其他运算符，它们的功能超出了普通逻辑运算符的范围。这些运算符是包含、匹配和 bitwise_and 运算符。当您有大量捕获并需要精确定位单个数据包时，这些运算符非常有用。它们超出了这个房间的范围，但是我建议你自己做研究，<a target="_blank" rel="noopener" href="https://www.wireshark.org/docs/wsug_html_chunked/ChWorkBuildDisplayFilterSection.html">Wireshark 过滤文档</a>可以是一个很好的起点。</p>
<h2 id="Basic-Filtering"><a href="#Basic-Filtering" class="headerlink" title="Basic Filtering"></a>Basic Filtering</h2><p>过滤为我们提供了对数据包进行操作的非常广泛的范围，因此可以有很多不同的过滤语法选项。我们将只介绍这个房间中最基本的内容，例如按 IP、协议等进行过滤。有关过滤的更多信息，请查看 <a target="_blank" rel="noopener" href="https://wiki.wireshark.org/DisplayFilters">Wireshark 过滤文档</a>。</p>
<p>过滤命令有通用语法，但有时它们可能有点愚蠢。Wireshark 过滤器的基本语法是某种服务或协议，如 ip 或 tcp，后跟一个点，然后是要过滤的内容，例如地址、MAC、SRC、协议等。</p>
<p>按 IP 过滤：我们将要查看的第一个过滤器是 ip.addr，此过滤器将允许您梳理流量并仅查看这些数据包中包含特定 IP 地址的数据包，无论这些数据包来自源还是目标。</p>
<p>Syntax: <code>ip.addr == &lt;IP Address&gt;</code></p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/9.png" alt="img"></p>
<p>此过滤器在实际应用中非常方便，例如当您在寻找威胁并使用其他工具识别出潜在可疑主机时，您可以使用 Wireshark 进一步分析来自该设备的数据包。</p>
<p>按 SRC 和 DST 过滤：第二个过滤器将查看二合一过滤器以及过滤器运算符：ip.src 和 ip.dst。这些过滤器允许我们根据流量的来源和目的地来过滤流量。</p>
<p>Syntax: <code>ip.src == &lt;SRC IP Address&gt; and ip.dst == &lt;DST IP Address&gt;</code> </p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/10.png" alt="img"></p>
<p>与第一个过滤器类似，我们可以看到 Wireshark 正在梳理数据包并根据我们设置的源和目标进行过滤。</p>
<p>按 TCP 协议过滤：我们将介绍的最后一个过滤器是协议过滤器，它允许您设置要过滤的端口或协议，并且在尝试跟踪正在使用的不寻常协议或端口时非常方便。</p>
<p>值得一提的是，Wireshark 可以按端口号和协议名称进行过滤。</p>
<p>Syntax: <code>tcp.port eq &lt;Port #&gt; or &lt;Protocol Name&gt;</code></p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/11.png" alt="img"></p>
<p>按 UDP 协议过滤：您还可以通过将前缀从 tcp 更改为 udp 来按 UDP 端口进行过滤</p>
<p>Syntax: <code>udp.port eq &lt;Port #&gt; or &lt;Protocol Name&gt;</code></p>
<p>此任务的过滤到此结束，但我建议您自行尝试其他过滤器和运算符。准备好后，继续执行任务 5。</p>
<h1 id="Packet-Dissection"><a href="#Packet-Dissection" class="headerlink" title="Packet Dissection"></a>Packet Dissection</h1><p>本节介绍 Wireshark 如何使用 OSI 层分解数据包以及如何使用这些层进行分析。希望您已经了解 OSI 模型是什么以及它如何工作。<br><img src="https://assets.tryhackme.com/additional/wireshark101/12.png" alt="img"></p>
<h2 id="Packet-Details"><a href="#Packet-Details" class="headerlink" title="Packet Details"></a>Packet Details</h2><p>您可以双击捕获的数据包以打开其详细信息。根据 OSI 模型，数据包由 5 到 7 层组成。我们将在示例捕获的 HTTP 数据包中介绍所有这些层。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/13.png" alt="img"></p>
<p>从上图我们可以看到数据包有 7 个不同的层：帧/数据包、源 [MAC]、源 [IP]、协议、协议错误、应用协议和应用数据。下面我们将更详细地介绍这些层。</p>
<ul>
<li>帧（第 1 层）——这将显示您正在查看的帧/数据包以及特定于 OSI 模型物理层的详细信息。</li>
</ul>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/14.png" alt="img"></p>
<ul>
<li>源 [MAC]（第 2 层）——这将向您显示来自 OSI 模型数据链路层的源和目标 MAC 地址。</li>
</ul>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/15.png" alt="img"></p>
<ul>
<li>源 [IP]（第 3 层）——这将向您显示来自 OSI 模型网络层的源和目标 IPv4 地址。</li>
</ul>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/16.png" alt="img"></p>
<ul>
<li>协议（第 4 层）——这将向您显示所使用的协议（UDP/TCP）的详细信息以及源端口和目标端口；来自 OSI 模型的传输层。</li>
</ul>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/17.png" alt="img"></p>
<ul>
<li>协议错误——这是第 4 层的延续，显示需要重新组装的 TCP 特定段。</li>
</ul>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/18.png" alt="img"></p>
<ul>
<li>应用程序协议（第 5 层）——这将显示正在使用的协议（如 HTTP、FTP、SMB 等）的特定详细信息。来自 OSI 模型的应用程序层。</li>
</ul>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/19.png" alt="img"></p>
<ul>
<li>应用程序数据——这是第 5 层的扩展，可以显示特定于应用程序的数据。</li>
</ul>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/20.png" alt="img"></p>
<p>现在我们了解了一般数据包的组成，接下来看看各种应用协议及其具体细节。</p>
<h1 id="ARP-Traffic"><a href="#ARP-Traffic" class="headerlink" title="ARP Traffic"></a>ARP Traffic</h1><h2 id="ARP-概述"><a href="#ARP-概述" class="headerlink" title="ARP 概述"></a>ARP 概述</h2><p>ARP 或地址解析协议是用于将 IP 地址与 MAC 地址连接起来的第 2 层协议。它们将包含请求消息和响应消息。为了识别数据包，消息头将包含两个操作代码之一：</p>
<ul>
<li>请求 (1)</li>
<li>回复 (2)</li>
</ul>
<p>下面您可以看到多个 ARP 请求和回复的数据包捕获。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/21.png" alt="img"></p>
<p>值得注意的是，大多数设备都会识别自己或 Wireshark 会识别它，例如 Intel_78，可疑流量的一个例子是来自无法识别的来源的大量请求。但是，您需要在 Wireshark 中启用设置来解析物理地址。要启用此功能，请导航至“查看”&gt;“名称解析”&gt;“确保已选中解析物理地址”。</p>
<p>查看下面的屏幕截图，我们可以看到 Cisco 设备正在发送 ARP 请求，这意味着我们应该能够信任此设备，但是，在分析数据包时，您应该始终保持谨慎。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/22.png" alt="img"></p>
<h2 id="ARP-Traffic-Overview"><a href="#ARP-Traffic-Overview" class="headerlink" title="ARP Traffic Overview"></a>ARP Traffic Overview</h2><p>ARP 请求数据包：</p>
<p>我们可以通过查看第一个 ARP 请求数据包并查看数据包详细信息来开始分析数据包。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/23.png" alt="img"></p>
<p>查看上面的数据包详细信息，数据包中最重要的细节以红色标出。Opcode 是操作代码的缩写，它会告诉您它是 ARP 请求还是回复。第二个标出的细节是数据包的目标，在本例中是向所有人发出的广播请求。</p>
<p>ARP 回复数据包：</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/24.png" alt="img"></p>
<p>查看上面的数据包详细信息，我们可以从操作码中看到它是一个 ARP 回复数据包。我们还可以获得其他有用的信息，例如与回复一起发送的 MAC 和 IP 地址，因为这是一个回复数据包，我们知道这是与消息一起发送的信息。</p>
<p>ARP 是分析起来比较简单的协议之一，您需要记住的只是确定它是请求数据包还是回复数据包以及它是由谁发送的。</p>
<h1 id="ICMP-Traffic"><a href="#ICMP-Traffic" class="headerlink" title="ICMP Traffic"></a>ICMP Traffic</h1><h2 id="ICMP-概述"><a href="#ICMP-概述" class="headerlink" title="ICMP 概述"></a>ICMP 概述</h2><p>ICMP 或 Internet 控制消息协议用于分析网络上的各种节点。它最常用于 ping 和 traceroute 等实用程序。您应该已经熟悉 ICMP 的工作原理；但是，如果您需要复习一下，请阅读 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc792">IETF 文档</a>。</p>
<p>下面您可以看到 ping 的示例，我们可以看到 ICMP 向服务器发出的请求，然后是服务器的回复。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/icmp/1.png" alt="img"></p>
<h2 id="ICMP-流量概览"><a href="#ICMP-流量概览" class="headerlink" title="ICMP 流量概览"></a>ICMP 流量概览</h2><p>ICMP 请求：</p>
<p>下面我们可以看到 ping 请求数据包的详细信息。数据包详细信息中有几个重要信息，我们首先要注意，即数据包的类型和代码。类型等于 8 表示它是一个请求数据包，如果等于 0，则表示它是一个回复数据包。当这些代码被更改或看起来不正确时，这通常是可疑活动的迹象。</p>
<p>数据包中还有两个其他详细信息可用于分析：时间戳和数据。时间戳可用于识别请求 ping 的时间，在某些情况下也可用于识别可疑活动。我们还可以查看数据字符串，它通常只是一个随机数据字符串。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/icmp/2.png" alt="img"></p>
<p>ICMP 回复：</p>
<p>下面您可以看到回复数据包与请求数据包非常相似。区分回复数据包的主要区别之一是代码，在本例中，您可以看到代码为 0，确认它是一个回复数据包。</p>
<p>请求数据包的相同分析技术也适用于此，同样，主要区别在于数据包类型。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/icmp/3.png" alt="img"></p>
<h1 id="TCP-Traffic"><a href="#TCP-Traffic" class="headerlink" title="TCP Traffic"></a>TCP Traffic</h1><h2 id="TCP-概述"><a href="#TCP-概述" class="headerlink" title="TCP 概述"></a>TCP 概述</h2><p>TCP 或传输控制协议处理数据包的传送，包括排序和错误。您应该已经了解 TCP 的工作原理，如果您需要复习一下，请查看 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc793">IETF TCP 文档</a>。</p>
<p>下面您可以看到 Nmap 扫描的示例，扫描端口 80 和 443。我们可以通过红色的 RST、ACK 数据包判断端口已关闭。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/25.png" alt="img"></p>
<p>在分析 TCP 数据包时，Wireshark 非常有用，它按危险等级对数据包进行颜色编码。如果您记不住颜色代码，请返回任务 3 并重新了解 Wireshark 如何使用颜色匹配数据包。</p>
<p>TCP 可以在分析时提供对网络的有用见解，但由于它发送的数据包数量，分析起来也很困难。这时您可能需要使用其他工具（如 RSA NetWitness 和 NetworkMiner）来筛选并进一步分析捕获的内容。</p>
<h2 id="TCP-Traffic-Overview"><a href="#TCP-Traffic-Overview" class="headerlink" title="TCP Traffic Overview"></a>TCP Traffic Overview</h2><p>分析 TCP 数据包时，您会看到一个常见的东西，即 TCP 握手，您应该已经很熟悉它了。它包括一系列数据包：syn、synack、ack；这允许设备建立连接。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/26.png" alt="img"></p>
<p>通常，当此握手出现问题或包含其他数据包（如 RST 数据包）时，网络中就会出现可疑或错误的情况。上一节中的 Nmap 扫描就是一个很好的例子。</p>
<h2 id="TCP-Packet-Analysis"><a href="#TCP-Packet-Analysis" class="headerlink" title="TCP Packet Analysis"></a>TCP Packet Analysis</h2><p>为了分析 TCP 数据包，我们不会深入研究数据包的每个细节；但是，请看一下数据包的一些行为和结构。</p>
<p>下面我们可以看到 SYN 数据包的详细信息。查看 TCP 数据包时，我们主要要查找的是序列号和确认号。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/27.png" alt="img"></p>
<p>TCP <strong>SYN</strong> 数据包中未设置确认号，因为客户端未确认来自服务器的任何数据。在初始 <strong>SYN</strong> 数据包中，确认号通常为 <strong>0</strong>。</p>
<p>在 Wireshark 中，我们还可以通过导航至编辑 &gt; 首选项 &gt; 协议 &gt; TCP &gt; 相对序列号（取消选中复选框）来查看原始序列号。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/28.png" alt="img"></p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/29.png" alt="img"></p>
<p>通常，需要将 TCP 数据包作为一个整体来查看以了解一个故事，而不是逐一查看细节。</p>
<h1 id="DNS-Traffic"><a href="#DNS-Traffic" class="headerlink" title="DNS Traffic"></a>DNS Traffic</h1><h2 id="DNS-Overview"><a href="#DNS-Overview" class="headerlink" title="DNS Overview"></a>DNS Overview</h2><p>DNS 或域名服务协议用于通过 IP 地址解析名称。与其他协议一样，您应该熟悉 DNS；但是，如果您不熟悉，可以使用 <a target="_blank" rel="noopener" href="https://www.ietf.org/rfc/rfc1035.txt">IETF DNS 文档</a> 复习一下。</p>
<p>在分析 DNS 数据包时，您应该牢记以下几点。</p>
<ul>
<li>查询响应</li>
<li>仅 DNS 服务器</li>
<li>UDP</li>
</ul>
<p>如果其中任何一个出现问题，则应进一步检查数据包，并将其视为可疑数据包。</p>
<p>下面我们可以看到包含多个 DNS 查询和响应的数据包捕获。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/30.png" alt="img"></p>
<p>通过查看数据包，我们可以立即看到它们正在查询的内容，当您有许多数据包并且需要快速识别可疑或异常流量时，这非常有用。</p>
<h2 id="DNS-流量概述"><a href="#DNS-流量概述" class="headerlink" title="DNS 流量概述"></a>DNS 流量概述</h2><p>DNS 查询：</p>
<p>查看下面的查询，我们实际上有两条信息可用于分析数据包。我们可以查看的第一条信息是查询的来源，在本例中，它是 UDP 53，这意味着该数据包通过了检查，如果是 TCP 53，则应将其视为可疑流量并需要进一步分析。我们还可以查看它正在查询的内容，这可以与其他信息一起构建发生的事情的故事。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/31.png" alt="img"></p>
<p>在分析 DNS 数据包时，您确实需要了解您的环境以及流量在您的环境中是否被视为正常。</p>
<p>DNS 响应：</p>
<p>下面我们看到一个响应数据包，它类似于查询数据包，但它也包含一个可用于验证查询的答案。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/32.png" alt="img"></p>
<h1 id="HTTP-Traffic"><a href="#HTTP-Traffic" class="headerlink" title="HTTP Traffic"></a>HTTP Traffic</h1><p>HTTP 或超文本传输协议是万维网常用的端口，一些网站也使用它，但是，它的加密对应物：HTTPS 更常见，我们将在下一篇文章中讨论。HTTP 用于向 Web 服务器发送 GET 和 POST 请求，以接收网页等内容。了解如何分析 HTTP 有助于快速发现 SQLi、Web Shell 和其他与 Web 相关的攻击媒介。</p>
<h2 id="HTTP-流量概述"><a href="#HTTP-流量概述" class="headerlink" title="HTTP 流量概述"></a>HTTP 流量概述</h2><p>在完成本房间之前，您应该已经对 HTTP 的工作原理有了大致的了解；但是，如果您需要复习，可以阅读 <a target="_blank" rel="noopener" href="https://www.ietf.org/rfc/rfc2616.txt">IETF 关于 HTTP 方法</a> 的官方论文。</p>
<p>HTTP 是最直接的数据包分析协议之一，该协议直截了当，在通信之前不包含任何握手或先决条件。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/33.png" alt="img"></p>
<p>上面我们可以看到一个示例 HTTP 数据包，查看 HTTP 数据包我们可以轻松收集信息，因为数据流不像 HTTP 对应的 HTTPS 那样加密。我们可以从数据包中收集到的一些重要信息是请求 URI、文件数据、服务器。</p>
<p>现在我们了解了 HTTP 数据包的基本结构，我们可以继续查看示例 HTTP 数据包捕获以亲手处理数据包。</p>
<h2 id="实用-HTTP-数据包分析"><a href="#实用-HTTP-数据包分析" class="headerlink" title="实用 HTTP 数据包分析"></a>实用 HTTP 数据包分析</h2><p>为了了解 HTTP 数据包的流程并亲手处理数据包，我们可以分析 http.cap 文件。转到 AttackBox 上的文件夹 /root/Rooms/Wireshark101，双击 task11.pcap 文件以在 Wireshark 中打开它；您也可以下载此任务的 pcap。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/34.png" alt="img"></p>
<p>打开 PCAP 后，我们可以看到这只是一个简单的 HTTP 数据包捕获，其中包含几个请求。</p>
<p>深入到数据包捕获中，我们可以查看其中一个 HTTP 请求的详细信息，例如数据包 4。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/35.png" alt="img"></p>
<p>从这个数据包中，我们可以识别出一些非常重要的信息，如主机、用户代理、请求的 URI 和响应。</p>
<p>我们可以使用 Wireshark 的一些内置功能来帮助消化所有这些数据并将其组织起来以供将来进一步分析。我们可以先看看 Wireshark 中一个非常有用的功能，它可以用来组织捕获协议层次结构中存在的协议。导航到“统计信息”&gt;“协议层次结构”。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/36.png" alt="img"></p>
<p>这些信息在实际应用中非常有用，例如威胁搜寻，可用于识别数据包捕获中的差异。</p>
<p>我们将要介绍的 Wireshark 中的下一个功能是导出 HTTP 对象。此功能将允许我们在捕获中组织所有请求的 URI。要使用导出 HTTP 对象，请导航至文件 &gt; 导出对象 &gt; HTTP。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/37.png" alt="img"></p>
<p>与协议层次结构类似，它有助于快速识别捕获中可能存在的差异。</p>
<p>我们将在本房间的这一部分介绍的最后一个功能是端点。此功能允许用户组织在特定捕获中找到的所有端点和 IP。与其他功能一样，它有助于识别差异的来源。要使用端点功能，请导航至统计信息 &gt; 端点。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/38.png" alt="img"></p>
<p>HTTP 并不是常见的协议，因为 HTTPS 现在更为常用；然而，HTTP 仍然经常使用，并且如果有机会，可以很容易地进行分析。</p>
<h1 id="HTTPS-Traffic"><a href="#HTTPS-Traffic" class="headerlink" title="HTTPS Traffic"></a>HTTPS Traffic</h1><p>从数据包分析的角度来看，HTTPS 或超文本传输协议安全可能是最令人讨厌的协议之一，并且理解分析 HTTPS 数据包所需采取的步骤可能会令人困惑。</p>
<h2 id="HTTPS-流量概述"><a href="#HTTPS-流量概述" class="headerlink" title="HTTPS 流量概述"></a>HTTPS 流量概述</h2><p>在发送加密信息之前，客户端和服务器需要就各种步骤达成一致，以建立安全隧道。</p>
<ol>
<li>客户端和服务器就协议版本达成一致</li>
<li>客户端和服务器选择加密算法</li>
<li>客户端和服务器可以相互验证；此步骤是可选的</li>
<li>使用公钥创建安全隧道</li>
</ol>
<p>我们可以通过查看客户端和服务器之间的握手数据包来开始分析 HTTPS 流量。下面是一个客户端 Hello 数据包，显示了 SSLv2 记录层、握手类型和 SSL 版本。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/39.png" alt="img"></p>
<p>下面是服务器 Hello 数据包，发送与客户端 Hello 数据包类似的信息，但这次它包含会话详细信息和 SSL 证书信息</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/40.png" alt="img"></p>
<p>下面是客户端密钥交换包，握手的这一部分将确定用于加密客户端和服务器之间的进一步消息的公钥。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/41.png" alt="img"></p>
<p>在下一个数据包中，服务器将确认公钥并创建安全隧道，此后的所有流量都将根据上面列出的约定规范进行加密。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/41.png" alt="img"></p>
<p>客户端和服务器之间的通信现在已经加密，您将需要密钥来解密两个主机之间发送的数据流。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/42.png" alt="img"></p>
<h2 id="实用-HTTPS-数据包分析"><a href="#实用-HTTPS-数据包分析" class="headerlink" title="实用 HTTPS 数据包分析"></a>实用 HTTPS 数据包分析</h2><p>我们首先需要将 PCAP 加载到 Wireshark 中。导航到文件 &gt; 打开并选择 snakeoil2 PCAP。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/43.png" alt="img"></p>
<p>从上面的数据包捕获中我们可以看到所有请求都是加密的。仔细查看数据包，我们可以看到 HTTPS 握手以及加密请求本身。让我们仔细看看其中一个加密请求：数据包 36。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/44.png" alt="img"></p>
<p>我们可以从数据包详细信息中确认应用程序数据已加密。您可以在 Wireshark 中使用 RSA 密钥来查看未加密的数据。要加载 RSA 密钥，请导航至编辑 &gt; 首选项 &gt; 协议 &gt; TLS &gt; [+]。如果您使用的是旧版本的 Wireshark，则这将是 SSL 而不是 TLS。您需要在菜单上的各个部分填写以下首选项：</p>
<p>IP 地址：127.0.0.1</p>
<p>端口：start_tls</p>
<p>协议：http</p>
<p>密钥文件：RSA 密钥位置</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/45.png" alt="img"></p>
<p>现在我们已将 RSA 密钥导入 Wireshark，如果我们返回到数据包捕获，我们可以看到数据流现在未加密。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/46.png" alt="img"></p>
<p>现在，我们可以看到未加密数据流中的 HTTP 请求。进一步查看数据包的一个细节，我们可以更清楚地看到未加密的数据流。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/47.png" alt="img"></p>
<p>查看数据包详细信息，我们可以看到一些非常重要的信息，例如请求 URI 和用户代理，这些信息在 Wireshark 的实际应用中非常有用，例如威胁搜寻和网络管理。</p>
<p>我们现在可以使用其他功能来组织数据流，例如使用导出 HTTP 对象功能，要访问此功能，请导航至文件 &gt; 导出对象 &gt; HTTP</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/48.png" alt="img"></p>
<h1 id="Analyzing-Exploit-PCAPs"><a href="#Analyzing-Exploit-PCAPs" class="headerlink" title="Analyzing Exploit PCAPs"></a>Analyzing Exploit PCAPs</h1><h2 id="Zerologon-PCAP-Overview"><a href="#Zerologon-PCAP-Overview" class="headerlink" title="Zerologon PCAP Overview"></a>Zerologon PCAP Overview</h2><p>我们从最近的 Windows Active Directory 漏洞 Zerologon 或 CVE-2020-1472 中收集了 PCAP 文件。PCAP 文件中的场景包含一个私有 IP 为 192.168.100.6 的 Windows 域控制器和一个私有 IP 为 192.168.100.128 的攻击者。让我们逐步分析 PCAP 并对发生的事件做出假设。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/49.png" alt="img"></p>
<h2 id="Identifying-the-Attacker"><a href="#Identifying-the-Attacker" class="headerlink" title="Identifying the Attacker"></a>Identifying the Attacker</h2><p>打开 PCAP 文件后，我们立即看到一些可能不寻常的东西。首先，我们看到一些来自 OpenVPN、ARP 等的正常流量。然后我们开始识别在本例中称为未知协议的协议 DCERPC 和 EPM。</p>
<p>查看数据包，我们发现 192.168.100.128 正在发送所有请求，因此我们可以假设该设备是攻击者。我们可以继续查看来自此 IP 的数据包，以缩小搜索范围。</p>
<h2 id="Zerologon-POC-Connection-Analysis"><a href="#Zerologon-POC-Connection-Analysis" class="headerlink" title="Zerologon POC Connection Analysis"></a>Zerologon POC Connection Analysis</h2><p><img src="https://assets.tryhackme.com/additional/wireshark101/50.png" alt="img"></p>
<p>我们可以为我们认为可疑的 IP 的源设置过滤器。在分析 PCAPS 时，我们需要注意特定漏洞可能具有的 IOC 或危害指标。这称为威胁情报，超出了本房间的范围；我建议，如果您对这个房间更感兴趣，那么在完成本房间后，您可以自己研究这个主题。在这种情况下，如果我们有 Zerologon 漏洞的背景知识，我们就会知道该漏洞使用多个 RPC 连接和 DCERPC 请求来更改机器帐户密码，这可以通过 PCAP 进行验证。</p>
<h2 id="Secretsdump-SMB-分析"><a href="#Secretsdump-SMB-分析" class="headerlink" title="Secretsdump SMB 分析"></a>Secretsdump SMB 分析</h2><p>进一步查看 PCAP，我们可以看到 SMB2/3 流量和 DRSUAPI 流量，同样，根据对攻击的先前了解，我们知道它使用 secretsdump 来转储哈希。Secretsdump 滥用 SMB2/3 和 DRSUAPI 来执行此操作，因此我们可以假设此流量是 secretsdump。</p>
<p><img src="https://assets.tryhackme.com/additional/wireshark101/51.png" alt="img"></p>
<p>每次漏洞利用和攻击都会有其独特的痕迹，在这种情况下，发生的事情和事件发生的顺序是一目了然的。一旦我们确定了攻击者，我们就需要采取其他步骤来识别和隔离，如果我们是威胁搜寻或 DFIR 团队的一员，我们还需要报告事件。</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>想要了解更多？有多个课程和认证可以深入研究 Wireshark。我推荐的第一个免费资源是 Wireshark 在线文档。它非常详细，可以帮助您了解学习 Wireshark 的所有细微差别。除了书面文档外，他们还提供了一些视频来帮助您。</p>
<p>您可以在 <a target="_blank" rel="noopener" href="https://www.wireshark.org/docs/">此处</a> 找到 Wireshark 文档。</p>
<p>如果您想更多地练习使用 Wireshark，您可以查看他们的 <a target="_blank" rel="noopener" href="https://wiki.wireshark.org/SampleCaptures">Wireshark 示例捕获</a>。或者，如果您正在寻找真正的威胁搜寻挑战，您可以查看 DFIR Madness 的 <a target="_blank" rel="noopener" href="https://dfirmadness.com/case-001-pcap-analysis/">案例：001 PCAP 分析</a>。</p>
<p>如果你想继续在 Tryhackme 上磨练你的分析技能，请查看 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/overpass2hacked">Overpass 2 - Hacked</a>。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://blog.mikannse.cn">Mikannse</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.mikannse.cn/2024/10/18/THMWireshark101/">https://blog.mikannse.cn/2024/10/18/THMWireshark101/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.mikannse.cn" target="_blank">MikannseのSekai</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%BA%AF%E6%BA%90%E5%8F%96%E8%AF%81/">溯源取证</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7/">工具</a><a class="post-meta__tags" href="/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/">流量分析</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/18/WiresharkTheBasicsTHM/" title="WiresharkTheBasicsTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">WiresharkTheBasicsTHM</div></div></a></div><div class="next-post pull-right"><a href="/2024/10/18/THMWindowsFundamentals3/" title="THMWindowsFundamentals3"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">THMWindowsFundamentals3</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/10/18/WiresharkPacketOperationsTHM/" title="WiresharkPacketOperationsTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-18</div><div class="title">WiresharkPacketOperationsTHM</div></div></a></div><div><a href="/2024/10/18/WiresharkTheBasicsTHM/" title="WiresharkTheBasicsTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-18</div><div class="title">WiresharkTheBasicsTHM</div></div></a></div><div><a href="/2024/10/19/WiresharkTrafficAnalysisTHM/" title="WiresharkTrafficAnalysisTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-19</div><div class="title">WiresharkTrafficAnalysisTHM</div></div></a></div><div><a href="/2024/10/17/THMAutopsy/" title="THMAutopsy"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-17</div><div class="title">THMAutopsy</div></div></a></div><div><a href="/2024/06/18/TSharkTheBasicsTHM/" title="TSharkTheBasicsTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-18</div><div class="title">TSharkTheBasicsTHM</div></div></a></div><div><a href="/2024/06/15/AdvancedSQLInjectionTHM/" title="AdvancedSQLInjectionTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-15</div><div class="title">AdvancedSQLInjectionTHM</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mikannse</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">346</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mikannse/mikannse.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">暂时没有公告QAQ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Installation"><span class="toc-number">2.</span> <span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Wireshark-Overview"><span class="toc-number">3.</span> <span class="toc-text">Wireshark Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Live-Packet-Captures"><span class="toc-number">3.1.</span> <span class="toc-text">Live Packet Captures</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Collection-Methods"><span class="toc-number">4.</span> <span class="toc-text">Collection Methods</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Collection-Methods-Overview"><span class="toc-number">4.1.</span> <span class="toc-text">Collection Methods Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Taps"><span class="toc-number">4.2.</span> <span class="toc-text">Network Taps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MAC-Floods"><span class="toc-number">4.3.</span> <span class="toc-text">MAC Floods</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARP-Poisoning"><span class="toc-number">4.4.</span> <span class="toc-text">ARP Poisoning</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Filtering-Captures"><span class="toc-number">5.</span> <span class="toc-text">Filtering Captures</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Filtering-Operators"><span class="toc-number">5.1.</span> <span class="toc-text">Filtering Operators</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic-Filtering"><span class="toc-number">5.2.</span> <span class="toc-text">Basic Filtering</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Packet-Dissection"><span class="toc-number">6.</span> <span class="toc-text">Packet Dissection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Packet-Details"><span class="toc-number">6.1.</span> <span class="toc-text">Packet Details</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ARP-Traffic"><span class="toc-number">7.</span> <span class="toc-text">ARP Traffic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ARP-%E6%A6%82%E8%BF%B0"><span class="toc-number">7.1.</span> <span class="toc-text">ARP 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARP-Traffic-Overview"><span class="toc-number">7.2.</span> <span class="toc-text">ARP Traffic Overview</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ICMP-Traffic"><span class="toc-number">8.</span> <span class="toc-text">ICMP Traffic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP-%E6%A6%82%E8%BF%B0"><span class="toc-number">8.1.</span> <span class="toc-text">ICMP 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP-%E6%B5%81%E9%87%8F%E6%A6%82%E8%A7%88"><span class="toc-number">8.2.</span> <span class="toc-text">ICMP 流量概览</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP-Traffic"><span class="toc-number">9.</span> <span class="toc-text">TCP Traffic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-%E6%A6%82%E8%BF%B0"><span class="toc-number">9.1.</span> <span class="toc-text">TCP 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-Traffic-Overview"><span class="toc-number">9.2.</span> <span class="toc-text">TCP Traffic Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-Packet-Analysis"><span class="toc-number">9.3.</span> <span class="toc-text">TCP Packet Analysis</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DNS-Traffic"><span class="toc-number">10.</span> <span class="toc-text">DNS Traffic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS-Overview"><span class="toc-number">10.1.</span> <span class="toc-text">DNS Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS-%E6%B5%81%E9%87%8F%E6%A6%82%E8%BF%B0"><span class="toc-number">10.2.</span> <span class="toc-text">DNS 流量概述</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP-Traffic"><span class="toc-number">11.</span> <span class="toc-text">HTTP Traffic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-%E6%B5%81%E9%87%8F%E6%A6%82%E8%BF%B0"><span class="toc-number">11.1.</span> <span class="toc-text">HTTP 流量概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%94%A8-HTTP-%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">11.2.</span> <span class="toc-text">实用 HTTP 数据包分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTPS-Traffic"><span class="toc-number">12.</span> <span class="toc-text">HTTPS Traffic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPS-%E6%B5%81%E9%87%8F%E6%A6%82%E8%BF%B0"><span class="toc-number">12.1.</span> <span class="toc-text">HTTPS 流量概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%94%A8-HTTPS-%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">12.2.</span> <span class="toc-text">实用 HTTPS 数据包分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Analyzing-Exploit-PCAPs"><span class="toc-number">13.</span> <span class="toc-text">Analyzing Exploit PCAPs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Zerologon-PCAP-Overview"><span class="toc-number">13.1.</span> <span class="toc-text">Zerologon PCAP Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Identifying-the-Attacker"><span class="toc-number">13.2.</span> <span class="toc-text">Identifying the Attacker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zerologon-POC-Connection-Analysis"><span class="toc-number">13.3.</span> <span class="toc-text">Zerologon POC Connection Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Secretsdump-SMB-%E5%88%86%E6%9E%90"><span class="toc-number">13.4.</span> <span class="toc-text">Secretsdump SMB 分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Conclusion"><span class="toc-number">14.</span> <span class="toc-text">Conclusion</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/15/25-6%E6%9D%82%E8%B0%88/" title="25-6杂谈">25-6杂谈</a><time datetime="2025-07-15T06:10:16.000Z" title="发表于 2025-07-15 14:10:16">2025-07-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/01/kaggleIntermediateMachineLearning%E7%BC%BA%E5%A4%B1%E5%80%BC/" title="kaggleIntermediateMachineLearning缺失值">kaggleIntermediateMachineLearning缺失值</a><time datetime="2025-07-01T11:31:19.000Z" title="发表于 2025-07-01 19:31:19">2025-07-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/01/kaggleIntermediateMachineLearningIntroduction/" title="kaggleIntermediateMachineLearningIntroduction">kaggleIntermediateMachineLearningIntroduction</a><time datetime="2025-07-01T11:28:32.000Z" title="发表于 2025-07-01 19:28:32">2025-07-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/13/THMTheLayoftheLand/" title="THMTheLayoftheLand">THMTheLayoftheLand</a><time datetime="2025-06-13T08:52:38.000Z" title="发表于 2025-06-13 16:52:38">2025-06-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/13/THMEnumeration/" title="THMEnumeration">THMEnumeration</a><time datetime="2025-06-13T08:51:27.000Z" title="发表于 2025-06-13 16:51:27">2025-06-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By Mikannse</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  const disqus_config = function () {
    this.page.url = 'https://blog.mikannse.cn/2024/10/18/THMWireshark101/'
    this.page.identifier = '/2024/10/18/THMWireshark101/'
    this.page.title = 'THMWireshark101THM'
  }

  const disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addModeChange('disqus', disqusReset)

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>