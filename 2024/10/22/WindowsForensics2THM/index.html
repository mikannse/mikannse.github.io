<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>WindowsForensics2THM | MikannseのSekai</title><meta name="author" content="Mikannse"><meta name="copyright" content="Mikannse"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Introduction介绍我们在 上一个房间 中学习了 Windows 取证，并练习了从 Windows 注册表中提取取证工件。我们学习了如何从 Windows 注册表中收集系统信息、用户信息、访问的文件和文件夹、运行的程序以及连接到系统的外部设备。 但是，注册表并不是取证工件存在的唯一地方。在这个房间里，我们将了解其他地方的取证工件。我们将了解 Windows 常用的不同文件系统，以及在查找工">
<meta property="og:type" content="article">
<meta property="og:title" content="WindowsForensics2THM">
<meta property="og:url" content="http://mikannse.space/2024/10/22/WindowsForensics2THM/index.html">
<meta property="og:site_name" content="MikannseのSekai">
<meta property="og:description" content="Introduction介绍我们在 上一个房间 中学习了 Windows 取证，并练习了从 Windows 注册表中提取取证工件。我们学习了如何从 Windows 注册表中收集系统信息、用户信息、访问的文件和文件夹、运行的程序以及连接到系统的外部设备。 但是，注册表并不是取证工件存在的唯一地方。在这个房间里，我们将了解其他地方的取证工件。我们将了解 Windows 常用的不同文件系统，以及在查找工">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg">
<meta property="article:published_time" content="2024-10-22T14:02:55.000Z">
<meta property="article:modified_time" content="2024-10-22T14:05:11.562Z">
<meta property="article:author" content="Mikannse">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="溯源取证">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg"><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="http://mikannse.space/2024/10/22/WindowsForensics2THM/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Mikannse","link":"链接: ","source":"来源: MikannseのSekai","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'WindowsForensics2THM',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-10-22 22:05:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">309</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="MikannseのSekai"><span class="site-name">MikannseのSekai</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">WindowsForensics2THM</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-22T14:02:55.000Z" title="发表于 2024-10-22 22:02:55">2024-10-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-22T14:05:11.562Z" title="更新于 2024-10-22 22:05:11">2024-10-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E5%AE%89/">网安</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="WindowsForensics2THM"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a><strong>介绍</strong></h2><p>我们在 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/windowsforensics1">上一个房间</a> 中学习了 Windows 取证，并练习了从 Windows 注册表中提取取证工件。我们学习了如何从 Windows 注册表中收集系统信息、用户信息、访问的文件和文件夹、运行的程序以及连接到系统的外部设备。</p>
<p>但是，注册表并不是取证工件存在的唯一地方。在这个房间里，我们将了解其他地方的取证工件。我们将了解 Windows 常用的不同文件系统，以及在查找工件时在这些文件系统中查找的位置。我们将确定位置和工件以证明执行、文件/文件夹使用或知识以及外部设备使用的证据。我们还将介绍恢复已删除文件的基础知识。对于这个房间的大部分内容，我们将使用 <a target="_blank" rel="noopener" href="https://ericzimmerman.github.io/#!index.md">Eric Zimmerman 的工具</a> 来解析工件中存在的信息。我们已经在上一个房间里使用了 Registry Explorer 和 ShellBags Explorer。对于某些任务，我们将使用 Autopsy。</p>
<h1 id="The-FAT-file-systems"><a href="#The-FAT-file-systems" class="headerlink" title="The FAT file systems"></a>The FAT file systems</h1><p>计算机系统中的存储设备（例如硬盘驱动器或 USB 设备）只是一组位。要将这些位转换为有意义的信息，需要对它们进行组织。为此，计算机科学家和工程师创建了不同的文件系统，按照标准组织硬盘中的位，以便可以轻松解释存储在这些位中的信息。</p>
<p>文件分配表 (FAT)：<br>文件分配表 (FAT) 是这些文件系统之一。自 20 世纪 70 年代末以来，它一直是 Microsoft 操作系统的默认文件系统，并且仍在使用，尽管不再是默认文件系统。顾名思义，文件分配表会创建一个表，索引分配给不同文件的位的位置。如果您对 FAT 文件系统的历史感兴趣，可以前往 Wikipedia 页面。</p>
<p>FAT 文件系统的数据结构：<br>FAT 文件系统支持以下数据结构：</p>
<p>簇：<br>簇是 FAT 文件系统的基本存储单元。存储在存储设备上的每个文件都可以看作是一组包含信息位的簇。</p>
<p>目录：<br>目录包含有关文件标识的信息，如文件名、起始簇和文件名长度。</p>
<p>文件分配表：<br>文件分配表是所有簇的链接列表。它包含簇的状态和指向链中下一个簇的指针。</p>
<p>总之，组成文件的位存储在簇中。文件系统上的所有文件名、它们的起始簇和它们的长度都存储在目录中。磁盘上每个簇的位置存储在文件分配表中。我们可以看到，我们从由位组成的原始磁盘开始，并对其进行组织以定义哪组位指的是磁盘上存储的哪个文件。</p>
<p>FAT12、FAT16 和 FAT32：<br>FAT 文件格式将可用磁盘空间划分为簇，以便更直接地寻址。这些簇的数量取决于用于寻址簇的位数。因此，FAT 文件系统有不同的变体。 FAT 最初采用 8 位簇寻址，被称为 FAT 结构。后来，随着存储需求的增加，引入了 FAT12、FAT16 和 FAT32。最后一个是在 1996 年推出的。</p>
<p>理论上，FAT12 使用 12 位簇寻址，最多可容纳 4096 个簇（2^12）。FAT16 使用 16 位簇寻址，最多可容纳 65,536 个簇（2^16）。对于 FAT32，用于寻址簇的实际位是 28，因此簇的最大数量实际上是 268,435,456 或 2^28。但是，并非所有这些簇都用于文件存储。有些用于管理目的，例如，存储簇链的末尾、磁盘的不可用部分或其他此类目的。</p>
<p>下表总结了前面提到的信息以及它如何影响最大卷和文件大小：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>FAT12</th>
<th>FAT16</th>
<th>FAT32</th>
</tr>
</thead>
<tbody><tr>
<td>可寻址位</td>
<td>12</td>
<td>16</td>
<td>28</td>
</tr>
<tr>
<td>最大簇数</td>
<td>4,096</td>
<td>65,536</td>
<td>268,435,456</td>
</tr>
<tr>
<td>支持的簇大小</td>
<td>512B - 8KB</td>
<td>2KB - 32KB</td>
<td>4KB - 32KB</td>
</tr>
<tr>
<td>最大卷大小</td>
<td>32MB</td>
<td>2GB</td>
<td>2TB</td>
</tr>
</tbody></table>
<p>尽管 FAT32 的最大卷大小为 2TB，但 Windows 将格式化限制为仅 32GB。但是，Windows 支持在其他具有更大卷大小的操作系统上格式化的卷大小。</p>
<p>如今，遇到 FAT12 文件系统的机会非常少。 FAT16 和 FAT32 仍在某些地方使用，例如 USB 驱动器、SD 卡或数码相机。但是，最大卷大小和最大文件大小（FAT16 和 FAT32 均为 4GB - 1 个文件大小）是限制其使用率的因素。</p>
<p>exFAT 文件系统：<br>随着文件大小的增加，尤其是较新的数码相机支持更高分辨率的图像和视频，FAT32 的最大文件大小限制成为相机制造商的一个重要限制因素。尽管微软已经转向 NTFS 文件系统，但它并不适合数字媒体设备，因为它们不需要额外的安全功能和随之而来的开销。因此，这些制造商游说微软创建 exFAT 文件系统。</p>
<p>exFAT 文件系统现在是大于 32GB 的 SD 卡的默认文件系统。它也被大多数数字设备制造商广泛采用。exFAT 文件系统支持 4KB 到 32MB 的簇大小。它的最大文件大小和最大卷大小为 128PB（PB）。它还减少了 FAT 文件系统的一些开销，使其更轻便、更高效。每个目录最多可以有 2,796,202 个文件。</p>
<h1 id="The-NTFS-File-System"><a href="#The-NTFS-File-System" class="headerlink" title="The NTFS File System"></a>The NTFS File System</h1><h2 id="The-NTFS-file-system"><a href="#The-NTFS-file-system" class="headerlink" title="The NTFS file system"></a>The NTFS file system</h2><p>正如在上一个任务中观察到的那样，FAT 文件系统是一种非常基本的文件系统。它在组织数据方面做得很好，但在安全性、可靠性和恢复功能方面却没有提供更多功能。它在文件和卷大小方面也有一定的限制。因此，微软开发了一种称为新技术文件系统 (NTFS) 的较新的文件系统来添加这些功能。该文件系统于 1993 年随 Windows NT 3.1 推出。但是，自 Windows XP 以来，它已成为主流。NTFS 文件系统解决了 FAT 文件系统中存在的许多问题，并引入了许多新功能。我们将在下面讨论其中的一些功能。</p>
<h2 id="日志记录"><a href="#日志记录" class="headerlink" title="日志记录"></a>日志记录</h2><p>NTFS 文件系统会记录卷中元数据的更改。此功能可帮助系统从碎片整理导致的崩溃或数据移动中恢复。此日志存储在卷根目录中的 $LOGFILE 中。因此，NTFS 文件系统被称为日志文件系统。</p>
<h2 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h2><p>FAT 文件系统没有基于用户的访问控制。NTFS 文件系统具有访问控制，可定义文件/目录的所有者以及每个用户的权限。</p>
<h2 id="卷影复制"><a href="#卷影复制" class="headerlink" title="卷影复制"></a>卷影复制</h2><p>NTFS 文件系统使用名为卷影复制的功能跟踪对文件所做的更改。使用此功能，用户可以恢复以前的文件版本以进行恢复或系统还原。在最近的勒索软件攻击中，勒索软件参与者已注意到删除受害者文件系统上的卷影副本，以阻止他们恢复数据。</p>
<h2 id="备用数据流"><a href="#备用数据流" class="headerlink" title="备用数据流"></a>备用数据流</h2><p>文件是文件系统中组织的数据流。备用数据流 (ADS) 是 NTFS 中的一项功能，允许文件将多个数据流存储在单个文件中。Internet Explorer 和其他浏览器使用备用数据流来识别从互联网下载的文件（使用 ADS 区域标识符）。还观察到恶意软件将其代码隐藏在 ADS 中。</p>
<h2 id="主文件表"><a href="#主文件表" class="headerlink" title="主文件表"></a>主文件表</h2><p>与文件分配表一样，NTFS 中也有一个主文件表。但是，主文件表 (MFT) 比文件分配表要广泛得多。它是一个结构化的数据库，用于跟踪存储在卷中的对象。因此，我们可以说 NTFS 文件系统数据是在主文件表中组织的。从取证的角度来看，以下是 MFT 中的一些关键文件：</p>
<h2 id="MFT"><a href="#MFT" class="headerlink" title="$MFT"></a>$MFT</h2><p>$MFT 是卷中的第一个记录。卷引导记录 (VBR) 指向它所在的群集。$MFT 存储有关卷上所有其他对象所在群集的信息。此文件包含卷上所有文件的目录。</p>
<h2 id="LOGFILE"><a href="#LOGFILE" class="headerlink" title="$LOGFILE"></a>$LOGFILE</h2><p>$LOGFILE 存储文件系统的事务日志。它有助于在发生崩溃时维护文件系统的完整性。</p>
<h2 id="UsnJrnl"><a href="#UsnJrnl" class="headerlink" title="$UsnJrnl"></a>$UsnJrnl</h2><p>它代表更新序列号 (USN) 日志。它存在于 $Extend 记录中。它包含有关文件系统中已更改的所有文件以及更改原因的信息。它也被称为更改日志。</p>
<h2 id="MFT-Explorer"><a href="#MFT-Explorer" class="headerlink" title="MFT Explorer"></a>MFT Explorer</h2><p>MFT Explorer 是 Eric Zimmerman 用来探索 MFT 文件的工具之一。它有命令行和 GUI 版本。我们将使用 CLI 版本来完成此任务。</p>
<pre><code>  MFTECmd version 0.5.0.1

Author: Eric Zimmerman (saericzimmerman@gmail.com)
https://github.com/EricZimmerman/MFTECmd
    f               File to process ($MFT | $J | $LogFile | $Boot | $SDS). Required
    m               $MFT file to use when -f points to a $J file (Use this to resolve parent path in $J CSV output).

    json            Directory to save JSON formatted results to. This or --csv required unless --de or --body is specified
    jsonf           File name to save JSON formatted results to. When present, overrides default name
    csv             Directory to save CSV formatted results to. This or --json required unless --de or --body is specified
    csvf            File name to save CSV formatted results to. When present, overrides default name

    body            Directory to save bodyfile formatted results to. --bdl is also required when using this option
    bodyf           File name to save body formatted results to. When present, overrides default name
    bdl             Drive letter (C, D, etc.) to use with bodyfile. Only the drive letter itself should be provided
    blf             When true, use LF vs CRLF for newlines. Default is FALSE

    dd              Directory to save exported FILE record. --do is also required when using this option
    do              Offset of the FILE record to dump as decimal or hex. Ex: 5120 or 0x1400 Use --de or --vl 1 to see offsets

    de              Dump full details for entry/sequence #. Format is 'Entry' or 'Entry-Seq' as decimal or hex. Example: 5, 624-5 or 0x270-0x5.
    fls             When true, displays contents of directory specified by --de. Ignored when --de points to a file.
    ds              Dump full details for Security Id as decimal or hex. Example: 624 or 0x270

    dt              The custom date/time format to use when displaying time stamps. Default is: yyyy-MM-dd HH:mm:ss.fffffff
    sn              Include DOS file name types. Default is FALSE
    fl              Generate condensed file listing. Requires --csv. Default is FALSE
    at              When true, include all timestamps from 0x30 attribute vs only when they differ from 0x10. Default is FALSE

    vss             Process all Volume Shadow Copies that exist on drive specified by -f . Default is FALSE
    dedupe          Deduplicate -f &amp; VSCs based on SHA-1. First file found wins. Default is FALSE

    debug           Show debug information during processing
    trace           Show trace information during processing
    
    
 Examples: MFTECmd.exe -f "C:\Temp\SomeMFT" --csv "c:\temp\out" --csvf MyOutputFile.csv
          MFTECmd.exe -f "C:\Temp\SomeMFT" --csv "c:\temp\out"
          MFTECmd.exe -f "C:\Temp\SomeMFT" --json "c:\temp\jsonout"
          MFTECmd.exe -f "C:\Temp\SomeMFT" --body "c:\temp\bout" --bdl c
          MFTECmd.exe -f "C:\Temp\SomeMFT" --de 5-5
          Short options (single letter) are prefixed with a single dash. Long commands are prefixed with two dashes
</code></pre>
<p>MFTECmd 解析 NTFS 文件系统创建的不同文件（如 $MFT、$Boot 等）中的数据。上面的屏幕截图显示了解析 MFT 文件的可用选项。要解析 $MFT 文件，我们可以使用以下命令：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">MFTECmd.exe -f &lt;path-to-$MFT-file&gt; --csv &lt;path-to-save-results-in-csv&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>然后，您可以使用 EZtools 文件夹中的 EZviewer 工具查看 MFTECmd 的输出，或者在下一个任务中查看 CSV 文件。您将看到它列出了有关卷上存在的所有文件的信息。您可以类似地解析 $Boot 文件，它将提供有关卷的引导扇区的信息。MFTECmd 目前不支持 $LOGFILE。</p>
<h1 id="Recovering-deleted-files"><a href="#Recovering-deleted-files" class="headerlink" title="Recovering deleted files"></a>Recovering deleted files</h1><h2 id="已删除文件和数据恢复："><a href="#已删除文件和数据恢复：" class="headerlink" title="已删除文件和数据恢复："></a><strong>已删除文件和数据恢复：</strong></h2><p>了解文件系统可以更轻松地了解文件是如何被删除、恢复和擦除的。正如我们在前两个任务中了解到的，文件系统将文件在磁盘上的位置存储在表或数据库中。当我们从文件系统中删除文件时，文件系统会删除存储文件在磁盘上位置的条目。对于文件系统，文件存在的位置现在可供写入或未分配。但是，只要在复制另一个文件时文件系统没有覆盖它们，或者在对磁盘执行维护时磁盘固件没有覆盖它们，磁盘上的文件内容仍然存在。</p>
<p>同样，磁盘上不同未分配的群集中也有数据，这些数据可能被恢复。要恢复这些数据，我们必须了解不同文件类型的文件结构，以便通过我们在十六进制编辑器中看到的数据来识别特定文件。但是，我们不会在本课中讨论这一点。我们要做的是使用一个工具来为我们完成这项工作，并识别磁盘映像文件中已删除的文件。但是什么是磁盘映像文件？</p>
<h3 id="磁盘映像："><a href="#磁盘映像：" class="headerlink" title="磁盘映像："></a>磁盘映像：</h3><p>磁盘映像文件是一个包含磁盘驱动器逐位副本的文件。逐位副本将磁盘映像文件中的所有数据（包括元数据）保存在一个文件中。因此，在进行取证时，可以制作物理证据（即磁盘）的多个副本，并将其用于调查。这有两种帮助。1) 原始证据在进行取证时不会受到污染，2) 可以将磁盘映像文件复制到另一个磁盘并进行分析，而无需使用专用硬件。</p>
<h3 id="使用-Autopsy-恢复文件"><a href="#使用-Autopsy-恢复文件" class="headerlink" title="使用 Autopsy 恢复文件"></a>使用 Autopsy 恢复文件</h3><p>说完这些，让我们看看如何从磁盘恢复已删除的文件。我们将使用 Autopsy 恢复已删除的文件。对于 Autopsy 专用房间，您可以前往 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/btautopsye0">此处</a>。</p>
<p>在连接的虚拟机上，您会在桌面上找到 Autopsy 的图标。双击它即可运行 Autopsy。您将看到以下屏幕：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/1efa320c87b2f2d564e60bf4c6ec6dc5.png" alt="img"></p>
<p>点击“新案例”选项。您将看到类似以下的窗口：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/1411fbe2ad57d4cd474be027c72b3968.png" alt="img"></p>
<p>输入保存案例的名称，然后单击“下一步”。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/a60c87484f00a38ce9e5250cb3b85055.png" alt="img"></p>
<p>您可以在此处添加所需的详细信息。现在，我们可以单击“完成”继续。Autopsy 将执行一些处理，然后显示以下屏幕。单击“下一步”继续。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/77d222f83d80c4682301a809fb98999f.png" alt="img"></p>
<p>您将看到此屏幕。由于我们将对磁盘映像进行分析，因此请选择最上面的选项“磁盘映像”或“VM 文件”。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/83d738a83fc1dd47e49106508087fab7.png" alt="img"></p>
<p>它会询问您数据源的位置。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/deb3837cf6fd3766b084cc4ecb006650.png" alt="img"></p>
<p>提供数据源的位置。您将在桌面上找到一个名为“usb.001”的磁盘映像。在上面的窗口中提供该文件的路径，然后单击下一步。您将看到以下窗口：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/99a0874ffec490f0468910cc2990ec2f.png" alt="img"></p>
<p>在这里，单击“取消全选”。这些是 Autopsy 对数据运行以进行处理的不同模块。对于此任务，我们不需要任何这些。如果启用，它们将需要大量时间来运行。单击“取消全选”后，单击“下一步”。Autopsy 将加载磁盘映像。您将在左侧面板中看到以下内容。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/6aa98fadbab058ee3d760e520198d2f1.png" alt="img"></p>
<p>数据源显示我们已添加到 Autopsy 的数据源。我们也可以添加更多来源。文件视图和标签菜单显示 Autopsy 在处理数据后发现的内容。展开数据源，然后单击 usb.001 设备。Autopsy 将以以下方式显示磁盘映像的内容：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/905832f92232c0e982fb84588d5fea1f.png" alt="img"></p>
<p>磁盘的内容显示在右侧。磁盘中存在的所有文件和文件夹都列在上方选项卡中。下方选项卡中显示所选文件的详细信息。这里有不同的选项可以查看详细信息。您可以查看它们以查找有趣的信息。</p>
<p>请注意上面屏幕截图中最后一个文件上的 X 标记，名为 New Microsoft Excel Worksheet.xlsx~RFcd07702.TMP。这表示这是一个已删除的文件。已删除的文件上会有这个 X 标记。要恢复已删除的文件，请右键单击它，然后选择“提取文件”选项。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/14acd357e9c89b8ce8297b076ed43c02.png" alt="img"></p>
<p>提供保存解压文件的路径，您将恢复已删除的文件。现在让我们看看您可以在此磁盘映像上找到哪些其他已删除的文件，并回答以下问题。</p>
<h1 id="Evidence-of-Execution"><a href="#Evidence-of-Execution" class="headerlink" title="Evidence of Execution"></a>Evidence of Execution</h1><p>现在我们已经了解了文件系统，让我们来了解一下在文件系统中哪里可以找到用于执行取证分析的工件。在此任务中，我们将研究为我们提供执行证据的工件：</p>
<p>Windows 预取文件<br>当程序在 Windows 中运行时，它会存储其信息以供将来使用。此存储的信息用于在频繁使用的情况下快速加载程序。此信息存储在位于C:\Windows\Prefetch 目录中的预取文件中。</p>
<p>预取文件的扩展名为 .pf。预取文件包含应用程序的上次运行时间、应用程序运行的次数以及文件使用的任何文件和设备句柄。因此，它构成了有关上次执行的程序和文件的极好信息来源。</p>
<p>我们可以使用 Eric Zimmerman 工具中的预取解析器 (PECmd.exe) 来解析预取文件并提取数据。当我们在提升的命令提示符中运行 PECmd.exe 时，我们会得到以下输出：</p>
<pre><code>user@machine$ PECmd.exe

PECmd version 1.4.0.0

Author: Eric Zimmerman (saericzimmerman@gmail.com)
https://github.com/EricZimmerman/PECmd

    d               Directory to recursively process. Either this or -f is required
    f               File to process. Either this or -d is required
    k               Comma separated list of keywords to highlight in output. By default, 'temp' and 'tmp' are highlighted. Any additional keywords will be added to these.
    o               When specified, save prefetch file bytes to the given path. Useful to look at decompressed Win10 files
    q               Do not dump full details about each file processed. Speeds up processing when using --json or --csv. Default is FALSE

    json            Directory to save json representation to.
    jsonf           File name to save JSON formatted results to. When present, overrides default name
    csv             Directory to save CSV results to. Be sure to include the full path in double quotes
    csvf            File name to save CSV formatted results to. When present, overrides default name
    html            Directory to save xhtml formatted results to. Be sure to include the full path in double quotes
    dt              The custom date/time format to use when displaying timestamps. See https://goo.gl/CNVq0k for options. Default is: yyyy-MM-dd HH:mm:ss
    mp              When true, display higher precision for timestamps. Default is FALSE

    vss             Process all Volume Shadow Copies that exist on drive specified by -f or -d . Default is FALSE
    dedupe          Deduplicate -f or -d &amp; VSCs based on SHA-1. First file found wins. Default is TRUE

    debug           Show debug information during processing
    trace           Show trace information during processing
 Examples: PECmd.exe -f "C:\Temp\CALC.EXE-3FBEF7FD.pf"
          PECmd.exe -f "C:\Temp\CALC.EXE-3FBEF7FD.pf" --json "D:\jsonOutput" --jsonpretty
          PECmd.exe -d "C:\Temp" -k "system32, fonts"
          PECmd.exe -d "C:\Temp" --csv "c:\temp" --csvf foo.csv --json c:\temp\json
          PECmd.exe -d "C:\Windows\Prefetch"
      Short options (single letter) are prefixed with a single dash. Long commands are prefixed with two dashes
Either -f or -d is required. Exiting
</code></pre>
<p>要在文件上运行 Prefetch Parser 并将结果保存为 CSV，我们可以使用以下命令：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">PECmd.exe -f &lt;path-to-Prefetch-files&gt; --csv &lt;path-to-save-csv&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>类似地，为了解析整个目录，我们可以使用以下命令：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">PECmd.exe -d &lt;path-to-Prefetch-directory&gt; --csv &lt;path-to-save-csv&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以利用这些信息来回答最后的问题。</p>
<h2 id="Windows-10-Timeline"><a href="#Windows-10-Timeline" class="headerlink" title="Windows 10 Timeline"></a>Windows 10 Timeline</h2><p>Windows 10 将最近使用的应用程序和文件存储在名为Windows 10 Timeline的 SQLite 数据库中。此数据可以作为有关上次执行的程序的信息来源。它包含已执行的应用程序和应用程序的焦点时间。Windows 10 时间线可在以下位置找到：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\&lt;username&gt;\AppData\Local\ConnectedDevicesPlatform\{randomfolder}\ActivitiesCache.db</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以使用 Eric Zimmerman 的 WxTCmd.exe 来解析 Windows 10 时间线。运行它时，我们得到以下选项：</p>
<pre><code>user@machine$ WxTCmd.exe

WxTCmd version 0.6.0.0

Author: Eric Zimmerman (saericzimmerman@gmail.com)
https://github.com/EricZimmerman/WxTCmd
    f               File to process. Required
    csv             Directory to save CSV formatted results to. Be sure to include the full path in double quotes
    dt              The custom date/time format to use when displaying timestamps. See https://goo.gl/CNVq0k for options. Default is: yyyy-MM-dd HH:mm:ss
 Examples: WxTCmd.exe -f "C:\Users\eric\AppData\Local\ConnectedDevicesPlatform\L.eric\ActivitiesCache.db" --csv c:\temp
       Database files are typically found at 'C:\Users\\AppData\Local\ConnectedDevicesPlatform\L.\ActivitiesCache.db'

      Short options (single letter) are prefixed with a single dash. Long commands are prefixed with two dashes
      
-f is required. Exiting
</code></pre>
<p>我们可以使用以下命令来运行WxTCmd：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">WxTCmd.exe -f &lt;path-to-timeline-file&gt; --csv &lt;path-to-save-csv&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Windows-Jump-Lists"><a href="#Windows-Jump-Lists" class="headerlink" title="Windows Jump Lists"></a>Windows Jump Lists</h2><p>Windows 引入了跳转列表，以帮助用户从任务栏直接转到最近使用的文件。我们可以通过右键单击任务栏中的应用程序图标来查看跳转列表，它将向我们显示该应用程序中最近打开的文件。此数据存储在以下目录中：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\&lt;username&gt;\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations</span><br></pre></td></tr></tbody></table></figure>

<p>跳转列表包含有关执行的应用程序、首次执行时间和最后一次针对 AppID 执行应用程序的信息。</p>
<p>我们可以使用 Eric Zimmerman 的 JLECmd.exe 来解析跳转列表。运行它时，我们得到以下选项：</p>
<pre><code>user@machine$ JLECmd.exe

JLECmd version 1.4.0.0

Author: Eric Zimmerman (saericzimmerman@gmail.com)
https://github.com/EricZimmerman/JLECmd
    d               Directory to recursively process. Either this or -f is required
    f               File to process. Either this or -d is required
    q               Only show the filename being processed vs all output. Useful to speed up exporting to json and/or csv. Default is FALSE

    all             Process all files in directory vs. only files matching *.automaticDestinations-ms or *.customDestinations-ms. Default is FALSE

    csv             Directory to save CSV formatted results to. Be sure to include the full path in double quotes
    csvf            File name to save CSV formatted results to. When present, overrides default name

    html            Directory to save xhtml formatted results to. Be sure to include the full path in double quotes
    json            Directory to save json representation to. Use --pretty for a more human readable layout
    pretty          When exporting to json, use a more human readable layout. Default is FALSE

    ld              Include more information about lnk files. Default is FALSE
    fd              Include full information about lnk files (Alternatively, dump lnk files using --dumpTo and process with LECmd). Default is FALSE

    appIds          Path to file containing AppIDs and descriptions (appid|description format). New appIds are added to the built-in list, existing appIds will have their descriptions updated
    dumpTo          Directory to save exported lnk files
    withDir         When true, show contents of Directory not accounted for in DestList entries
    Debug           Debug mode

    dt              The custom date/time format to use when displaying timestamps. See https://goo.gl/CNVq0k for options. Default is: yyyy-MM-dd HH:mm:ss
    mp              Display higher precision for timestamps. Default is FALSE
Examples: JLECmd.exe -f "C:\Temp\f01b4d95cf55d32a.customDestinations-ms" --mp
          JLECmd.exe -f "C:\Temp\f01b4d95cf55d32a.automaticDestinations-ms" --json "D:\jsonOutput" --jsonpretty
          JLECmd.exe -d "C:\CustomDestinations" --csv "c:\temp" --html "c:\temp" -q
          JLECmd.exe -d "C:\Users\e\AppData\Roaming\Microsoft\Windows\Recent" --dt "ddd yyyy MM dd HH:mm:ss.fff"
      Short options (single letter) are prefixed with a single dash. Long commands are prefixed with two dashes
Either -f or -d is required. Exiting
</code></pre>
<p>我们可以使用以下命令通过 JLECmd.exe 解析跳转列表：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">JLECmd.exe -f &lt;path-to-Jumplist-file&gt; --csv &lt;path-to-save-csv&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在附加计算机桌面上的 triage 文件夹中，我们提取了要调查的系统的 Windows 目录。它保留了原始 Windows 目录的目录结构，即系统中的 C:\Windows 目录映射到 C:\users\thm-4n6\Desktop\triage\C\Windows。现在，让我们使用我们学到的信息对附加 VM 桌面上 triage 文件夹中保存的数据进行分析，并回答以下问题。</p>
<p>如果您在查看 CSV 文件时遇到问题，可以使用 EZtools 文件夹中的 EZviewer。</p>
<h1 id="File-x2F-folder-knowledge"><a href="#File-x2F-folder-knowledge" class="headerlink" title="File/folder knowledge"></a>File/folder knowledge</h1><h2 id="Shortcut-Files"><a href="#Shortcut-Files" class="headerlink" title="Shortcut Files"></a>Shortcut Files</h2><p>Windows 会为本地或远程打开的每个文件创建一个快捷方式文件。快捷方式文件包含有关文件首次打开和最后打开时间的信息以及打开文件的路径，以及其他一些数据。快捷方式文件可以在以下位置找到：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\&lt;username&gt;\AppData\Roaming\Microsoft\Windows\Recent\</span><br><span class="line">C:\Users\&lt;username&gt;\AppData\Roaming\Microsoft\Office\Recent\</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以使用 Eric Zimmerman 的 LECmd.exe（Lnk Explorer）来解析快捷方式文件。当我们运行 LECmd.exe 时，我们会看到以下选项：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ LECmd.exe</span><br><span class="line"></span><br><span class="line">LECmd version 1.4.0.0</span><br><span class="line"></span><br><span class="line">Author: Eric Zimmerman (saericzimmerman@gmail.com)</span><br><span class="line">https://github.com/EricZimmerman/LECmd</span><br><span class="line"></span><br><span class="line">        d               Directory to recursively process. Either this or -f is required</span><br><span class="line">        f               File to process. Either this or -d is required</span><br><span class="line">        q               Only show the filename being processed vs all output. Useful to speed up exporting to json and/or csv. Default is FALSE</span><br><span class="line"></span><br><span class="line">        r               Only process lnk files pointing to removable drives. Default is FALSE</span><br><span class="line">        all             Process all files in directory vs. only files matching *.lnk. Default is FALSE</span><br><span class="line"></span><br><span class="line">        csv             Directory to save CSV formatted results to. Be sure to include the full path in double quotes</span><br><span class="line">        csvf            File name to save CSV formatted results to. When present, overrides default name</span><br><span class="line"></span><br><span class="line">        xml             Directory to save XML formatted results to. Be sure to include the full path in double quotes</span><br><span class="line">        html            Directory to save xhtml formatted results to. Be sure to include the full path in double quotes</span><br><span class="line">        json            Directory to save json representation to. Use --pretty for a more human readable layout</span><br><span class="line">        pretty          When exporting to json, use a more human readable layout. Default is FALSE</span><br><span class="line"></span><br><span class="line">        nid             Suppress Target ID list details from being displayed. Default is FALSE</span><br><span class="line">        neb             Suppress Extra blocks information from being displayed. Default is FALSE</span><br><span class="line"></span><br><span class="line">        dt              The custom date/time format to use when displaying time stamps. See https://goo.gl/CNVq0k for options. Default is: yyyy-MM-dd HH:mm:ss</span><br><span class="line">        mp              Display higher precision for time stamps. Default is FALSE</span><br><span class="line"></span><br><span class="line">Examples: LECmd.exe -f "C:\Temp\foobar.lnk"</span><br><span class="line">          LECmd.exe -f "C:\Temp\somelink.lnk" --json "D:\jsonOutput" --jsonpretty</span><br><span class="line">          LECmd.exe -d "C:\Temp" --csv "c:\temp" --html c:\temp --xml c:\temp\xml -q</span><br><span class="line">          LECmd.exe -f "C:\Temp\some other link.lnk" --nid --neb</span><br><span class="line">          LECmd.exe -d "C:\Temp" --all</span><br><span class="line"></span><br><span class="line">          Short options (single letter) are prefixed with a single dash. Long commands are prefixed with two dashes</span><br><span class="line"></span><br><span class="line">Either -f or -d is required. Exiting</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以使用以下命令通过 LECmd.exe 解析快捷方式文件：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">LECmd.exe -f &lt;path-to-shortcut-files&gt; --csv &lt;path-to-save-csv&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>快捷方式文件的创建日期指向该文件首次打开的日期/时间。快捷方式文件的修改日期/时间指向该文件最后一次被访问的时间。</p>
<h2 id="IE-x2F-Edge-history"><a href="#IE-x2F-Edge-history" class="headerlink" title="IE/Edge history"></a>IE/Edge history</h2><p>IE/Edge 浏览历史记录的一个有趣之处在于，它还包括系统中打开的文件，无论这些文件是否使用浏览器打开。因此，IE/Edge 历史记录是系统中打开文件的宝贵信息来源。我们可以在以下位置访问历史记录：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Windows\WebCache\WebCacheV*.dat</span><br></pre></td></tr></tbody></table></figure>

<p>访问的文件/文件夹在 IE/Edge 历史记录中以 <code>file:///*</code> 前缀显示。虽然可以使用多种工具来分析 Web 缓存数据，但您可以在附加的 VM 中使用 Autopsy 来执行此操作。为此，请选择逻辑文件作为数据源。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/8da15f822b9a82b094d1cd4b80aed83c.png" alt="img"></p>
<p>然后它会要求您选择要分析文件的路径。您可以提供分类文件夹的路径。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/c5d0b8ea02333e7609edf0a727e037dd.png" alt="img"></p>
<p>在 Autopsy 询问提取模块以处理数据的窗口中，选中“最近活动”前面的框并取消选中其他所有框。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/413c734d28f51bfdba616f9c6c8a9ed8.png" alt="img"></p>
<p>您将能够在左侧面板的 Web 历史记录选项中查看访问的本地文件。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/2ff14f1bd6b4e92c5e700054e7f68e5c.png" alt="img"></p>
<p>这是其在右侧面板中的样子。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/4169c85581f1f227a44c12a5da776617.png" alt="img"></p>
<p>如上所示，“数据工件”选项卡显示有关访问的文件的信息。</p>
<h2 id="Jump-Lists"><a href="#Jump-Lists" class="headerlink" title="Jump Lists"></a>Jump Lists</h2><p>正如我们在上一个任务中已经了解到的，跳转列表会创建最后打开的文件列表。此信息可用于识别系统中最后执行的程序和最后打开的文件。回想一下上一个任务，跳转列表位于以下位置：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\&lt;username&gt;\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations</span><br></pre></td></tr></tbody></table></figure>

<h1 id="External-Devices-x2F-USB-device-forensics"><a href="#External-Devices-x2F-USB-device-forensics" class="headerlink" title="External Devices/USB device forensics"></a>External Devices/USB device forensics</h1><h2 id="USB-设备的-Setupapi-dev-日志"><a href="#USB-设备的-Setupapi-dev-日志" class="headerlink" title="USB 设备的 Setupapi dev 日志"></a>USB 设备的 Setupapi dev 日志</h2><p>当任何新设备连接到系统时，与该设备设置相关的信息将存储在 <code>setupapi.dev.log</code> 中。此日志位于以下位置：</p>
<p><code>C:\Windows\inf\setupapi.dev.log</code></p>
<p>此日志包含设备序列号以及设备首次/最后一次连接的时间。</p>
<p>这是在 Notepad.exe 中打开时的样子。请注意第一行，我们可以看到设备 ID 和序列号。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/da93720ac86a73115f4eeabd6581a5a7.png"></p>
<h2 id="快捷方式文件"><a href="#快捷方式文件" class="headerlink" title="快捷方式文件"></a>快捷方式文件</h2><p>正如我们在上一个任务中了解到的那样，Windows 会自动为本地或远程打开的文件创建快捷方式文件。这些快捷方式文件有时可以为我们提供有关连接的 USB 设备的信息。它可以为我们提供有关卷名称、类型和序列号的信息。回顾上一个任务，此信息可在以下位置找到：</p>
<p><code>C:\Users\&lt;用户名&gt;\AppData\Roaming\Microsoft\Windows\Recent\</code></p>
<p><code>C:\Users\&lt;用户名&gt;\AppData\Roaming\Microsoft\Office\Recent\</code></p>
<p>由于我们已经在上一个任务中了解了如何使用 Eric Zimmerman 的 LECmd.exe 解析快捷方式文件，因此我们不再赘述。</p>
<h1 id="Conclusion-and-Further-material"><a href="#Conclusion-and-Further-material" class="headerlink" title="Conclusion and Further material"></a>Conclusion and Further material</h1><p>这就是我们的 Windows Forensics 2 房间。了解 Microsoft Windows 如何记录系统上执行的所有操作非常有趣。</p>
<p>如果您还没有，请查看 Windows Forensics 1 房间，了解 Windows 注册表及其为我们提供的所有不同工件。如果您认为所有这些工作有点太多，并且您希望其中一些工作自动化，您可以查看 KAPE 房间。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://mikannse.space">Mikannse</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://mikannse.space/2024/10/22/WindowsForensics2THM/">http://mikannse.space/2024/10/22/WindowsForensics2THM/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://mikannse.space" target="_blank">MikannseのSekai</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/%E6%BA%AF%E6%BA%90%E5%8F%96%E8%AF%81/">溯源取证</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/22/VolatilityTHM/" title="VolatilityTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">VolatilityTHM</div></div></a></div><div class="next-post pull-right"><a href="/2024/10/21/WindowsForensics1THM/" title="WindowsForensics1THM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WindowsForensics1THM</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/06/15/AdvancedSQLInjectionTHM/" title="AdvancedSQLInjectionTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-15</div><div class="title">AdvancedSQLInjectionTHM</div></div></a></div><div><a href="/2024/05/27/IntrotoLogAnalysisTHM/" title="IntrotoLogAnalysisTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-27</div><div class="title">IntrotoLogAnalysisTHM</div></div></a></div><div><a href="/2024/03/21/IntrotoLogsTHM/" title="IntrotoLogsTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-21</div><div class="title">IntrotoLogsTHM</div></div></a></div><div><a href="/2024/10/17/THMAutopsy/" title="THMAutopsy"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-17</div><div class="title">THMAutopsy</div></div></a></div><div><a href="/2024/10/18/THMWireshark101/" title="THMWireshark101THM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-18</div><div class="title">THMWireshark101THM</div></div></a></div><div><a href="/2024/06/18/TSharkTheBasicsTHM/" title="TSharkTheBasicsTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-18</div><div class="title">TSharkTheBasicsTHM</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mikannse</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">309</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mikannse/mikannse.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">暂时没有公告QAQ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-FAT-file-systems"><span class="toc-number">2.</span> <span class="toc-text">The FAT file systems</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-NTFS-File-System"><span class="toc-number">3.</span> <span class="toc-text">The NTFS File System</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#The-NTFS-file-system"><span class="toc-number">3.1.</span> <span class="toc-text">The NTFS file system</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">3.2.</span> <span class="toc-text">日志记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">3.3.</span> <span class="toc-text">访问控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B7%E5%BD%B1%E5%A4%8D%E5%88%B6"><span class="toc-number">3.4.</span> <span class="toc-text">卷影复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E7%94%A8%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">3.5.</span> <span class="toc-text">备用数据流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%96%87%E4%BB%B6%E8%A1%A8"><span class="toc-number">3.6.</span> <span class="toc-text">主文件表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MFT"><span class="toc-number">3.7.</span> <span class="toc-text">$MFT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LOGFILE"><span class="toc-number">3.8.</span> <span class="toc-text">$LOGFILE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UsnJrnl"><span class="toc-number">3.9.</span> <span class="toc-text">$UsnJrnl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MFT-Explorer"><span class="toc-number">3.10.</span> <span class="toc-text">MFT Explorer</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Recovering-deleted-files"><span class="toc-number">4.</span> <span class="toc-text">Recovering deleted files</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%B2%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E5%92%8C%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">已删除文件和数据恢复：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E6%98%A0%E5%83%8F%EF%BC%9A"><span class="toc-number">4.1.1.</span> <span class="toc-text">磁盘映像：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Autopsy-%E6%81%A2%E5%A4%8D%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.2.</span> <span class="toc-text">使用 Autopsy 恢复文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Evidence-of-Execution"><span class="toc-number">5.</span> <span class="toc-text">Evidence of Execution</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-10-Timeline"><span class="toc-number">5.1.</span> <span class="toc-text">Windows 10 Timeline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Jump-Lists"><span class="toc-number">5.2.</span> <span class="toc-text">Windows Jump Lists</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#File-x2F-folder-knowledge"><span class="toc-number">6.</span> <span class="toc-text">File&#x2F;folder knowledge</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Shortcut-Files"><span class="toc-number">6.1.</span> <span class="toc-text">Shortcut Files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IE-x2F-Edge-history"><span class="toc-number">6.2.</span> <span class="toc-text">IE&#x2F;Edge history</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jump-Lists"><span class="toc-number">6.3.</span> <span class="toc-text">Jump Lists</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#External-Devices-x2F-USB-device-forensics"><span class="toc-number">7.</span> <span class="toc-text">External Devices&#x2F;USB device forensics</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#USB-%E8%AE%BE%E5%A4%87%E7%9A%84-Setupapi-dev-%E6%97%A5%E5%BF%97"><span class="toc-number">7.1.</span> <span class="toc-text">USB 设备的 Setupapi dev 日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.</span> <span class="toc-text">快捷方式文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Conclusion-and-Further-material"><span class="toc-number">8.</span> <span class="toc-text">Conclusion and Further material</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/06/2024%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" title="2024年度总结">2024年度总结</a><time datetime="2025-01-05T16:23:47.000Z" title="发表于 2025-01-06 00:23:47">2025-01-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/06/24-12%E6%9D%82%E8%B0%88/" title="24-12杂谈">24-12杂谈</a><time datetime="2025-01-05T16:22:01.000Z" title="发表于 2025-01-06 00:22:01">2025-01-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/25/Python3%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0%E7%AC%AC%E5%85%AD%E7%AB%A0%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2%E6%8A%93%E5%8F%96/" title="Python3爬虫开发笔记第六章动态渲染页面抓取">Python3爬虫开发笔记第六章动态渲染页面抓取</a><time datetime="2024-12-25T15:31:25.000Z" title="发表于 2024-12-25 23:31:25">2024-12-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/21/Wiki.js%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%8F%8Anginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/" title="Wiki.js云服务器部署及nginx反向代理配置">Wiki.js云服务器部署及nginx反向代理配置</a><time datetime="2024-12-21T03:20:41.000Z" title="发表于 2024-12-21 11:20:41">2024-12-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/17/Python3%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0%E7%AC%AC%E4%BA%94%E7%AB%A0Ajax%E6%95%B0%E6%8D%AE%E7%88%AC%E5%8F%96/" title="Python3爬虫开发笔记第五章Ajax数据爬取">Python3爬虫开发笔记第五章Ajax数据爬取</a><time datetime="2024-12-17T13:56:19.000Z" title="发表于 2024-12-17 21:56:19">2024-12-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By Mikannse</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  const disqus_config = function () {
    this.page.url = 'http://mikannse.space/2024/10/22/WindowsForensics2THM/'
    this.page.identifier = '/2024/10/22/WindowsForensics2THM/'
    this.page.title = 'WindowsForensics2THM'
  }

  const disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addModeChange('disqus', disqusReset)

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>