<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>THMIntrotoMalwareAnalysis | MikannseのSekai</title><meta name="author" content="Mikannse"><meta name="copyright" content="Mikannse"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Introduction偶尔，当您担任 SOC 分析师时，您会遇到看似可疑的内容（文件或流量），并且您必须确定该内容是否是恶意的。对此类内容提供的所有混杂信号感到困惑是正常的。对于刚开始从事网络安全工作的人来说，这有点不知所措，并且开始自我猜测是很常见的。知道采取什么步骤来解决这种情况很有帮助。这个房间将列出一些步骤，以帮助您就特定可疑文件做出初步结论。 值得注意的是，在这个房间里，您将了解：">
<meta property="og:type" content="article">
<meta property="og:title" content="THMIntrotoMalwareAnalysis">
<meta property="og:url" content="http://mikannse.space/2024/11/02/THMIntrotoMalwareAnalysis/index.html">
<meta property="og:site_name" content="MikannseのSekai">
<meta property="og:description" content="Introduction偶尔，当您担任 SOC 分析师时，您会遇到看似可疑的内容（文件或流量），并且您必须确定该内容是否是恶意的。对此类内容提供的所有混杂信号感到困惑是正常的。对于刚开始从事网络安全工作的人来说，这有点不知所措，并且开始自我猜测是很常见的。知道采取什么步骤来解决这种情况很有帮助。这个房间将列出一些步骤，以帮助您就特定可疑文件做出初步结论。 值得注意的是，在这个房间里，您将了解：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg">
<meta property="article:published_time" content="2024-11-02T04:24:01.000Z">
<meta property="article:modified_time" content="2024-11-04T07:30:46.647Z">
<meta property="article:author" content="Mikannse">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="恶意软件分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg"><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="http://mikannse.space/2024/11/02/THMIntrotoMalwareAnalysis/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Mikannse","link":"链接: ","source":"来源: MikannseのSekai","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'THMIntrotoMalwareAnalysis',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-11-04 15:30:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">311</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">73</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="MikannseのSekai"><span class="site-name">MikannseのSekai</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">THMIntrotoMalwareAnalysis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-02T04:24:01.000Z" title="发表于 2024-11-02 12:24:01">2024-11-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-04T07:30:46.647Z" title="更新于 2024-11-04 15:30:46">2024-11-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E5%AE%89/">网安</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>26分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="THMIntrotoMalwareAnalysis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>偶尔，当您担任 SOC 分析师时，您会遇到看似可疑的内容（文件或流量），并且您必须确定该内容是否是恶意的。对此类内容提供的所有混杂信号感到困惑是正常的。对于刚开始从事网络安全工作的人来说，这有点不知所措，并且开始自我猜测是很常见的。知道采取什么步骤来解决这种情况很有帮助。这个房间将列出一些步骤，以帮助您就特定可疑文件做出初步结论。</p>
<p>值得注意的是，在这个房间里，您将了解：</p>
<ul>
<li>什么是恶意软件？</li>
<li>如何开始分析恶意软件</li>
<li>静态和动态恶意软件分析</li>
<li>帮助您分析恶意软件的资源</li>
</ul>
<p>让我们开始吧！</p>
<h1 id="Malware-Analysis"><a href="#Malware-Analysis" class="headerlink" title="Malware Analysis"></a>Malware Analysis</h1><h2 id="恶意软件"><a href="#恶意软件" class="headerlink" title="恶意软件"></a>恶意软件</h2><p>恶意软件一词源于“恶意软件”一词。因此，任何具有恶意目的的软件都可以被视为恶意软件。恶意软件根据其行为进一步分为不同的类别。但是，我们不会详细介绍这个房间里的恶意软件。在这里，我们将思考如果我们怀疑在机器中发现恶意软件，我们将采取哪些步骤。那么，让我们开始吧。</p>
<h2 id="恶意软件分析背后的目的"><a href="#恶意软件分析背后的目的" class="headerlink" title="恶意软件分析背后的目的"></a>恶意软件分析背后的目的</h2><p>恶意软件分析是一项重要的技能。简要概述一下，恶意软件分析由安全行业的以下人员执行：</p>
<ul>
<li><strong>安全运营</strong>团队分析恶意软件以编写针对其网络中恶意活动的检测。</li>
<li><strong>事件响应</strong>团队分析恶意软件以确定对环境造成的损害，以修复和恢复该损害。</li>
<li><strong>威胁搜寻</strong>团队分析恶意软件以识别 IOC，他们使用 IOC 在网络中搜寻恶意软件。</li>
<li>安全产品供应商团队中的<strong>恶意软件研究人员</strong>会分析恶意软件，以便在其安全产品中添加检测功能。</li>
<li>微软和谷歌等操作系统供应商中的<strong>威胁研究</strong>团队会分析恶意软件，以发现被利用的漏洞，并为操作系统/应用程序添加更多安全功能。</li>
</ul>
<p>总体而言，似乎有很多不同的人出于许多令人信服的理由进行恶意软件分析。让我们看看如何开始吧！</p>
<h2 id="开始之前！"><a href="#开始之前！" class="headerlink" title="开始之前！"></a>开始之前！</h2><p>请注意，恶意软件就像武器一样，如果处理不当，可能会造成巨大伤害。因此，在分析恶意软件时，请务必采取以下预防措施：</p>
<ul>
<li>切勿在非专门用于分析恶意软件的机器上分析恶意软件或疑似恶意软件。</li>
<li>不分析或将恶意软件样本移动到不同位置时，请始终将其保存在受密码保护的 zip/rar 或其他存档中，以免意外引爆。</li>
<li>仅在隔离环境内从受密码保护的存档中提取恶意软件，并且仅在分析时提取。</li>
<li>专门为恶意软件分析创建一个独立的虚拟机，分析完成后可以恢复到干净的状态。</li>
<li>确保所有互联网连接都已关闭或至少受到监控。</li>
<li>完成恶意软件分析后，将虚拟机恢复到干净的状态，以便进行下一次恶意软件分析，避免上一次恶意软件执行的残留物破坏下一次恶意软件分析。</li>
</ul>
<h1 id="Techniques-of-malware-analysis"><a href="#Techniques-of-malware-analysis" class="headerlink" title="Techniques of malware analysis"></a>Techniques of malware analysis</h1><p>恶意软件分析就像解谜一样。我们使用不同的工具和技术来找到这个谜题的碎片，将这些碎片拼凑起来，我们就能全面了解恶意软件想要做什么。大多数情况下，您会得到一个可执行文件（也称为二进制文件或 PE 文件。PE 代表可移植可执行文件）、一个恶意文档文件或一个网络数据包捕获 (Pcap)。可移植可执行文件是执行恶意软件分析时分析的最普遍的文件类型。</p>
<p>为了找到不同的拼图碎片，您通常会使用各种工具、技巧和捷径。这些技术可以分为以下两类：</p>
<ul>
<li>静态分析</li>
<li>动态分析</li>
</ul>
<h2 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h2><p>分析恶意软件而不执行时，称为静态分析。在这种情况下，分析 PE 文件的不同属性而不运行它。同样，对于恶意文档，探索文档的属性而不分析它，将被视为静态分析。静态分析的示例包括检查恶意软件中的字符串、检查 PE 标头以获取与不同部分相关的信息，或使用反汇编查看代码。稍后我们将在讨论室中介绍其中一些技术。</p>
<p>恶意软件经常使用技术来避免静态分析。其中一些技术使用混淆、打包或其他方式来隐藏其属性。为了规避这些技术，我们经常使用动态分析。</p>
<h2 id="动态分析"><a href="#动态分析" class="headerlink" title="动态分析"></a>动态分析</h2><p>恶意软件面临一个困境。它必须执行才能实现其目的，无论在代码中添加多少混淆，一旦运行，它就会成为易于检测的目标。</p>
<p>静态分析可能会为我们提供有关恶意软件的关键信息，但有时这还不够。我们可能需要在受控环境中运行恶意软件，以观察它在这些情况下会做什么。恶意软件通常可以隐藏其属性以阻止静态分析。但是，在大多数情况下，动态分析可以证明是有效的。动态分析技术包括在虚拟机中运行恶意软件，要么以手动方式安装工具来监控恶意软件的活动，要么以沙箱的形式自动执行此任务。我们将在本室后面学习其中一些技术。一旦我们在受控环境中运行恶意软件，我们就可以利用我们在 Windows 取证室中学到的知识来确定它在我们的环境中做了什么。这样做的好处是，由于我们控制环境，我们可以对其进行配置以避免噪音，例如来自合法用户或 Windows 服务的活动。因此，我们在这样的环境中观察到的一切都指向恶意软件活动，这使得识别恶意软件在这种情况下做了什么变得更容易。</p>
<p>然而，恶意软件经常使用技术来阻止分析师执行动态分析。由于大多数动态分析是在受控环境中执行的，因此大多数绕过动态分析的方法都包括检测其运行的环境。因此，在这些情况下，如果恶意软件识别出它是在受控环境中运行的，它就会使用不同的良性代码路径。</p>
<h2 id="高级恶意软件分析"><a href="#高级恶意软件分析" class="headerlink" title="高级恶意软件分析"></a>高级恶意软件分析</h2><p>高级恶意软件分析技术用于分析逃避基本静态和动态分析的恶意软件。为了执行高级恶意软件分析，使用反汇编程序和调试器。反汇编程序将恶意软件的代码从二进制转换为汇编，以便分析师可以静态查看恶意软件的指令。调试器附加到程序上，并允许分析师在恶意软件运行时监视其中的指令。调试器允许分析师在不同点停止和运行恶意软件以识别有趣的信息，同时还提供系统内存和 CPU 的概述。我们不会在这个房间中介绍高级恶意软件分析。但是，它将在针对恶意软件分析的未来模块中介绍。</p>
<h1 id="Basic-Static-Analysis"><a href="#Basic-Static-Analysis" class="headerlink" title="Basic Static Analysis"></a>Basic Static Analysis</h1><p>在分析新的恶意软件时，第一步通常是执行基本的静态分析。基本静态分析可以被视为对恶意软件进行评估，在深入分析之前尝试找到其属性。它为我们提供了正在处理的内容的概述。有时它可能会为我们提供一些关键信息，例如恶意软件正在进行的 API 调用或是否已打包。但是，其他时候，它可能只会为我们提供信息来帮助我们评估恶意软件并让我们了解分析它所需的工作量。</p>
<p>事不宜迟，让我们看看我们可以用来执行基本静态分析的一些技术。</p>
<h2 id="警告！"><a href="#警告！" class="headerlink" title="警告！"></a>警告！</h2><p>虽然静态分析是在不运行恶意软件的情况下执行的，但强烈建议您在隔离的虚拟机中执行恶意软件分析。您可以在执行任何恶意软件分析之前创建虚拟机的干净快照，并在每次分析后将其恢复为从干净状态开始。不要在不是专门为恶意软件分析而构建的实时机器上执行恶意软件分析。对于这个房间，我们将使用附加的 <a target="_blank" rel="noopener" href="https://docs.remnux.org/">Remnux VM</a>。Remnux (<strong>R</strong>everse <strong>E</strong>ngineering <strong>M</strong>alware Li<strong>nux</strong>) 是一个专为恶意软件分析而构建的 Linux 发行版。它已经安装了恶意软件分析所需的许多工具。</p>
<h2 id="检查文件类型"><a href="#检查文件类型" class="headerlink" title="检查文件类型"></a>检查文件类型</h2><p>虽然恶意软件的文件类型通常在文件扩展名中可见并且很明显，但有时恶意软件作者会尝试通过使用误导性文件扩展名来欺骗用户。在这种情况下，知道如何在不依赖文件扩展名的情况下找到文件的实际文件类型会很有帮助。在 Linux 中，我们可以使用 <code>file</code> 命令查找文件的文件类型。要了解 file 命令的作用，我们可以阅读其 <code>man page</code> 或使用 <code>--help</code> 选项：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">man file` or `file --help</span><br></pre></td></tr></tbody></table></figure>

<p>我们会发现这是一个很简单的命令。我们可以使用以下命令来查找文件的文件类型：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">file &lt;filename&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ file wannacry </span><br><span class="line">wannacry: PE32 executable (GUI) Intel 80386, for MS Windows</span><br><span class="line">user@machine$</span><br></pre></td></tr></tbody></table></figure>

<p>附加虚拟机的桌面上有一个名为“Samples”的文件夹。我们将使用该文件夹中的样本进行分析。上面的终端显示在“wannacry”样本上运行的“file”命令。输出显示一个带有图形用户界面的 PE32 可执行文件，该文件是为运行 Microsoft Windows 的系统编译的，该系统带有基于 Intel 80386 的处理器。Intel 80386 处理器是有史以来最早的 32 位处理器之一，为 80386 设计的指令集仍用于 32 位 Intel 处理器，这就是您看到“x86”处理器和代码的原因。这意味着上面输出中的“80386”告诉我们这个应用程序是为 32 位 Intel 处理器设计的。</p>
<h2 id="Examining-Strings"><a href="#Examining-Strings" class="headerlink" title="Examining Strings"></a>Examining Strings</h2><p>另一个为我们提供有关文件的有用信息的重要命令是“strings”命令。此命令列出文件中存在的字符串。要了解 string 命令的作用，我们可以阅读其“手册页”或使用“–help”选项：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">man strings` or `strings --help</span><br></pre></td></tr></tbody></table></figure>

<p>我们会发现这也是一个简单的命令。我们可以使用以下命令来查找文件中的字符串：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">strings &lt;filename&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>查看文件中的字符串通常可以提供与恶意软件行为相关的线索。例如，如果我们在 strings 命令的输出中看到 URLDownloadToFile，我们就会知道该恶意软件正在使用 URLDownloadToFile Windows API 执行某些操作。最有可能的是，它正在从互联网上下载文件并将其保存在磁盘上。同样，字符串也可能提供上下文信息，帮助我们在以后进行恶意软件分析。</p>
<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ strings wannacry</span><br><span class="line">!This program cannot be run in DOS mode.</span><br><span class="line">Rich</span><br><span class="line">.text</span><br><span class="line">`.rdata</span><br><span class="line">@.data</span><br><span class="line">.rsrc</span><br><span class="line">49t$</span><br><span class="line">TVWj</span><br><span class="line">PVVh</span><br><span class="line">tE9u</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"> inflate 1.1.3 Copyright 1995-1998 Mark Adler</span><br><span class="line"> n;^</span><br><span class="line">Qkkbal</span><br><span class="line">i]Wb</span><br><span class="line">9a&amp;g</span><br><span class="line">MGiI</span><br><span class="line">wn&gt;Jj</span><br><span class="line">#.zf</span><br><span class="line">+o*7</span><br><span class="line">- unzip 0.15 Copyright 1998 Gilles Vollant</span><br><span class="line">CloseHandle</span><br><span class="line">GetExitCodeProcess</span><br><span class="line">TerminateProcess</span><br><span class="line">WaitForSingleObject</span><br><span class="line">CreateProcessA</span><br><span class="line">GlobalFree</span><br><span class="line">GetProcAddress</span><br><span class="line">LoadLibraryA</span><br><span class="line">GlobalAlloc</span><br><span class="line">SetCurrentDirectoryA</span><br><span class="line">GetCurrentDirectoryA</span><br><span class="line">GetComputerNameW</span><br><span class="line">SetFileTime</span><br><span class="line">SetFilePointer</span><br><span class="line">MultiByteToWideChar</span><br><span class="line">GetFileAttributesW</span><br><span class="line">GetFileSizeEx</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">user@machine$</span><br></pre></td></tr></tbody></table></figure>

<p>这里我们可以看到针对“wannacry”样本运行的“strings”命令。我们将看到输出以“DOS Stub”开头，即“！此程序无法在 DOS 模式下运行”的文本。有些值没有多大意义，看起来像垃圾，但您也会看到有用的输出。例如，我们可以在上面看到一些字符串看起来像 Windows API。例如，“CloseHandle”、“GetExitCodeProcess”、“TerminateProcess”等等。同样，我们可以看到文本“inflate 1.1.3 Copyright 1995-1998 Mark Adler”。快速搜索显示它是 <a target="_blank" rel="noopener" href="http://zlib.net/">zlib 数据压缩</a>库的一部分，这告诉我们该样本可能正在使用这个库。</p>
<p><strong>提示：</strong>有时，strings 命令的输出太大，无法完全显示在终端上。我们可以重定向它，将其写入文件，然后使用 vim 或任何其他工具读取它。下面的终端显示输出被重定向到名为 str 的文件：</p>
<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ strings wannacry&gt;str</span><br><span class="line">user@machine$</span><br></pre></td></tr></tbody></table></figure>

<p>或者，您可以使用 <code>more</code> 或 <code>less</code> 命令以更明显的方式解析输出：</p>
<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ strings wannacry |more</span><br><span class="line">!This program cannot be run in DOS mode.</span><br><span class="line">Rich</span><br><span class="line">.text</span><br><span class="line">`.rdata</span><br><span class="line">@.data</span><br><span class="line">.rsrc</span><br><span class="line">49t$</span><br><span class="line">TVWj</span><br><span class="line">PVVh</span><br><span class="line">tE9u</span><br><span class="line">PVVW</span><br><span class="line">SVWjcf</span><br><span class="line">X_^[</span><br><span class="line">X_^[</span><br><span class="line">^t19</span><br><span class="line">QPPh</span><br><span class="line">tXVP</span><br><span class="line">X_^]</span><br><span class="line">^t)9</span><br><span class="line">X_^[]</span><br><span class="line">WWWWWPj</span><br><span class="line">SjJ3</span><br><span class="line">X[_^</span><br><span class="line">Yu#j</span><br><span class="line">uSh8</span><br><span class="line">Yu8S</span><br><span class="line">SSh </span><br><span class="line">hn!@</span><br><span class="line">SVWj@</span><br><span class="line">--more--</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以使用空格键向下滚动此处的字符串列表。如果你有兴趣，<a target="_blank" rel="noopener" href="https://tryhackme.com/room/malstrings">这个房间</a> 包含有关字符串的更多信息。</p>
<h2 id="Calculating-Hashes"><a href="#Calculating-Hashes" class="headerlink" title="Calculating Hashes"></a>Calculating Hashes</h2><p>文件哈希为我们提供了一个固定大小的唯一数字来标识文件。因此，文件哈希可以被视为文件的唯一标识符，类似于一个国家公民使用的社会安全号码或国家身份证号码。哈希是恶意软件分析中的一个重要概念。它可以用作特定恶意软件的标识符。正如我们将在本任务后面看到的那样，这个标识符可以与其他分析师共享或在线搜索以用于信息共享目的。请注意，两个文件中的单个位差异会导致不同的哈希值，因此更改文件的哈希值就像更改其中的一个位一样简单。</p>
<p>通常，<code>md5sum</code>，<code>sha1sum</code>和<code>sha256sum</code>哈希用于文件哈希。我们可以在Linux中使用一个简单的命令来计算文件哈希值，如下所示为md5sum哈希值：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">md5sum &lt;filename&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ md5sum wannacry </span><br><span class="line">84c82835a5d21bbcf75a61706d8ab549  wannacry</span><br><span class="line">user@machine$</span><br></pre></td></tr></tbody></table></figure>

<p>上面，我们可以看到为名为“wannacry”的文件计算了 md5sum 哈希值。</p>
<p>同样，<code>sha1sum</code> 和 <code>sha256sum</code> 命令可用于计算文件的 <code>sha1sum</code> 或 <code>sha256sum</code>（哈希值通常在末尾不带 <code>sum</code>，例如 <code>md5</code> 而不是 <code>md5sum</code> 等等。）</p>
<p>如果您有兴趣了解有关哈希值的更多信息，可以查看[此房间]（<a target="_blank" rel="noopener" href="https://tryhackme.com/room/malresearching%EF%BC%89%E3%80%82">https://tryhackme.com/room/malresearching）。</a></p>
<h2 id="AV-scans-and-VirusTotal"><a href="#AV-scans-and-VirusTotal" class="headerlink" title="AV scans and VirusTotal"></a>AV scans and VirusTotal</h2><p>使用 AV 扫描文件或在 <a target="_blank" rel="noopener" href="https://www.virustotal.com/gui/home/upload">VirusTotal</a> 上搜索哈希值也可以为安全研究人员提供恶意软件分类的有用信息。但是，在使用在线扫描器时，建议搜索恶意软件的哈希值，而不是在线上传，以避免在线泄露敏感信息。只有当您确定自己在做什么时才上传样本。</p>
<p>让我们看看上面我们计算哈希值的样本是怎么说的。我们可以在 VirusTotal 主页上搜索我们为 wannacry 样本计算的 md5sum：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/4fa91c3c465940314f55bce4427a6a4a.png" alt="img"></p>
<p>VirusTotal 拥有多种实用功能。它提供来自 60 多家 AV 供应商的扫描结果以及每个 AV 供应商对样本的分类。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/60903062574c8a2c9083100f096465b6.png" alt="img"></p>
<p>详细信息选项卡列出了样本的历史记录、第一次提交、最后一次提交以及样本的元数据。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/88d7d3ed42be6f54b17a863fd8c9d308.png" alt="img"></p>
<p>有时它还提供有关样本行为及其关系的信息，如在线上不同环境中所见。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/83c4544bf2865f4561b74645b1856793.png" alt="img"></p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/99f474d91d736cf063978fbeb82dfd9c.png" alt="img"></p>
<p>我们还可以在 VirusTotal 上找到社区对该样本的评论，这些评论有时可以提供有关该样本的更多背景信息。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/d35a057fa8b2394174a1e4c6d12a6992.png" alt="img"></p>
<p>也许从上面的截图中可以很清楚地看出，我们正在查看一个 wannacry 勒索软件的样本。</p>
<h1 id="The-PE-file-Header"><a href="#The-PE-file-Header" class="headerlink" title="The PE file Header"></a>The PE file Header</h1><h2 id="PE-Header"><a href="#PE-Header" class="headerlink" title="PE Header"></a>PE Header</h2><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/180bb73415dd511f9399ce6cfff9db9a.png" alt="img"></p>
<p>PE 文件头包含有关可移植可执行文件的元数据。这些数据可以帮助我们找到很多有用的信息，以帮助我们进行分析。我们将在即将到来的高级路径恶意软件分析模块中详细介绍 PE 头及其包含的信息。但是，下面将解释 PE 头中的一些重要信息：</p>
<h3 id="Imports-x2F-Exports"><a href="#Imports-x2F-Exports" class="headerlink" title="Imports/Exports"></a>Imports/Exports</h3><p>PE 文件很少包含在系统上运行所需的所有代码。大多数情况下，它会重复使用操作系统提供的代码。这样做是为了使用更少的空间并利用操作系统已建立的框架来执行任务，而不是重新发明轮子。导入是 PE 文件从外部导入以执行不同任务的函数。</p>
<p>例如，如果开发人员想要查询 Windows 注册表值，他们将导入 Microsoft 提供的 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryvaluew">RegQueryValue</a> 函数，而不是自己编写代码。可以理解的是，此函数将存在于开发人员代码将要运行的任何 Windows 计算机上，因此它不需要包含在 PE 文件本身中。同样，任何 PE 文件导出函数都会暴露给可以使用该函数的其他二进制文件，而不是自己实现它。导出通常与动态链接库（DLL 文件）相关联，非 DLL PE 文件通常不会有大量导出。</p>
<p>由于大多数 PE 文件使用 Windows API 执行大部分工作，因此 PE 文件的导入为我们提供了有关该 PE 文件将执行的操作的重要信息。很明显，导入 InternetOpen 函数的 PE 文件将与互联网通信，URLDownloadToFile 函数显示 PE 文件将从互联网下载某些内容，等等。Windows API 的名称通常直观且不言自明。但是，我们始终可以查阅 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/_winprog/">Microsoft 文档</a> 来验证特定 Windows 函数的用途。</p>
<h3 id="Sections"><a href="#Sections" class="headerlink" title="Sections:"></a>Sections:</h3><p>PE 文件头中提供的另一条有用信息是有关 PE 文件中节的信息。PE 文件分为不同的节，这些节具有不同的用途。尽管 PE 文件中的节取决于用于编译或打包二进制文件的编译器或打包器，但以下是 PE 文件中最常见的节。</p>
<ul>
<li>.<strong>text：</strong>此节通常包含运行 PE 文件时执行的 CPU 指令。此节被标记为可执行。</li>
<li><strong>.data：</strong>此节包含 PE 文件使用的全局变量和其他全局数据。</li>
<li><strong>.rsrc：</strong>此节包含 PE 文件使用的资源，例如图像、图标等。</li>
</ul>
<h2 id="Analyzing-PE-header-using-pecheck-utility"><a href="#Analyzing-PE-header-using-pecheck-utility" class="headerlink" title="Analyzing PE header using pecheck utility"></a>Analyzing PE header using pecheck utility</h2><p>我们可以使用房间附带的 Remnux VM 中的 pecheck 实用程序来检查 PE 头。</p>
<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ pecheck wannacry </span><br><span class="line">PE check for 'wannacry':</span><br><span class="line">Entropy: 7.995471 (Min=0.0, Max=8.0)</span><br><span class="line">MD5     hash: 84c82835a5d21bbcf75a61706d8ab549</span><br><span class="line">SHA-1   hash: 5ff465afaabcbf0150d1a3ab2c2e74f3a4426467</span><br><span class="line">SHA-256 hash: ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa</span><br><span class="line">SHA-512 hash: 90723a50c20ba3643d625595fd6be8dcf88d70ff7f4b4719a88f055d5b3149a4231018ea30d375171507a147e59f73478c0c27948590794554d031e7d54b7244</span><br><span class="line">.text entropy: 6.404235 (Min=0.0, Max=8.0)</span><br><span class="line">.rdata entropy: 6.663571 (Min=0.0, Max=8.0)</span><br><span class="line">.data entropy: 4.455750 (Min=0.0, Max=8.0)</span><br><span class="line">.rsrc entropy: 7.999868 (Min=0.0, Max=8.0)</span><br><span class="line">Dump Info:</span><br><span class="line">----------DOS_HEADER----------</span><br><span class="line"></span><br><span class="line">[IMAGE_DOS_HEADER]</span><br><span class="line">0x0        0x0   e_magic:                       0x5A4D    </span><br><span class="line">0x2        0x2   e_cblp:                        0x90      </span><br><span class="line">0x4        0x4   e_cp:                          0x3       </span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">[IMAGE_IMPORT_DESCRIPTOR]</span><br><span class="line">0xD5D0     0x0   OriginalFirstThunk:            0xD60C    </span><br><span class="line">0xD5D0     0x0   Characteristics:               0xD60C    </span><br><span class="line">0xD5D4     0x4   TimeDateStamp:                 0x0        [Thu Jan  1 00:00:00 1970 UTC]</span><br><span class="line">0xD5D8     0x8   ForwarderChain:                0x0       </span><br><span class="line">0xD5DC     0xC   Name:                          0xDC84    </span><br><span class="line">0xD5E0     0x10  FirstThunk:                    0x8000    </span><br><span class="line"></span><br><span class="line">ADVAPI32.dll.CreateServiceA Hint[100]</span><br><span class="line">ADVAPI32.dll.OpenServiceA Hint[431]</span><br><span class="line">ADVAPI32.dll.StartServiceA Hint[585]</span><br><span class="line">ADVAPI32.dll.CloseServiceHandle Hint[62]</span><br><span class="line">ADVAPI32.dll.CryptReleaseContext Hint[160]</span><br><span class="line">ADVAPI32.dll.RegCreateKeyW Hint[467]</span><br><span class="line">ADVAPI32.dll.RegSetValueExA Hint[516]</span><br><span class="line">ADVAPI32.dll.RegQueryValueExA Hint[503]</span><br><span class="line">ADVAPI32.dll.RegCloseKey Hint[459]</span><br><span class="line">ADVAPI32.dll.OpenSCManagerA Hint[429]</span><br><span class="line">. </span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br></pre></td></tr></tbody></table></figure>

<p>在这里我们可以看到 pecheck 从 wannacry 样本的 PE 头中提取的信息。我们看到样本有 4 个部分，.text、.rdata、.data 和 .rsrc，以及它们各自的熵。同样，它还向我们展示了样本的不同哈希值。Pecheck 还向我们展示了 PE 文件导入的函数。在上面的终端窗口中，我们可以看到 IMAGE_IMPORT_DESCRIPTOR，它显示了它从 ADVAPI32.dll 链接库导入的函数。我们将看到样本导入的所有其他链接库的类似描述符。</p>
<p>我们可以看到 pecheck 向我们展示了比我们在本任务中讨论的更多的信息；但是，讨论所有这些信息超出了本房间的范围。我们将在即将到来的恶意软件分析模块中深入探讨更多细节。我们将从我们看到的信息中获取我们正在寻找的内容，即样本的部分信息和导入。</p>
<h1 id="Basic-Dynamic-Analysis"><a href="#Basic-Dynamic-Analysis" class="headerlink" title="Basic Dynamic Analysis"></a>Basic Dynamic Analysis</h1><p>虽然基本的静态分析为我们提供了有关样本的有用信息，但大多数情况下，我们需要执行额外的分析才能进一步推进分析过程。找到有关恶意软件行为的更多线索的一种快速而粗略的方法是执行基本的动态分析。恶意软件样本的许多属性在不运行时可能会被隐藏。但是，当我们执行动态分析时，我们可以揭示这些属性并了解有关恶意软件样本行为的更多信息。</p>
<h2 id="Caution"><a href="#Caution" class="headerlink" title="Caution!"></a>Caution!</h2><p>动态分析需要运行可能具有破坏性的实时恶意软件样本。强烈建议您在独立的虚拟机中执行恶意软件分析。您可以在执行任何恶意软件分析之前创建虚拟机的干净快照，并在每次分析后将其恢复为从干净状态开始。请勿在非专门为恶意软件分析构建的实时机器上执行恶意软件分析。</p>
<h2 id="Introduction-to-Sandboxes"><a href="#Introduction-to-Sandboxes" class="headerlink" title="Introduction to Sandboxes"></a>Introduction to Sandboxes<img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/7c03de48312f00f8a4fa904f9666668e.png" alt="img"></h2><p>沙盒是一个从军事借用的术语。顾名思义，沙盒就是一个装满沙子的盒子，模拟了行动必须发生的地形，军事小组在其中模拟他们的场景以确定可能的结果。在恶意软件分析中，沙盒是一个模拟恶意软件实际目标环境的隔离环境，分析师可以在其中运行样本以了解更多信息。恶意软件分析沙盒严重依赖虚拟机，以及它们在需要时拍摄快照和恢复到干净状态的能力。</p>
<h2 id="Construction-of-a-sandbox"><a href="#Construction-of-a-sandbox" class="headerlink" title="Construction of a sandbox"></a>Construction of a sandbox</h2><p>对于使用沙箱的恶意软件分析，以下考虑因素可使恶意软件分析有效：</p>
<ul>
<li>虚拟机模拟恶意软件样本的实际目标环境</li>
<li>能够拍摄快照并恢复到干净状态</li>
<li>操作系统监控软件，例如 Procmon、ProcExplorer 或 Regshot 等。</li>
<li>网络监控软件，例如 Wireshark、tcpdump 等。</li>
<li>通过虚拟 DNS 服务器和 Web 服务器控制网络。</li>
<li>一种在不影响主机的情况下将分析日志和恶意软件样本移入和移出虚拟机的机制（请谨慎使用此功能。如果您的恶意软件分析 VM 有一个共享目录，在运行恶意软件时仍可访问，则可能会有恶意软件影响共享目录中的所有文件的风险）</li>
</ul>
<h2 id="Open-Source-Sandboxes"><a href="#Open-Source-Sandboxes" class="headerlink" title="Open Source Sandboxes"></a>Open Source Sandboxes</h2><p>虽然了解沙箱的组成是件好事，但从头开始构建沙箱并不总是必要的。人们总是可以设置开源沙箱。这些沙箱提供了执行基本动态分析的框架，并且在很大程度上可以自定义，以帮助那些更具冒险精神的人。</p>
<h3 id="Cuckoo’s-Sandbox"><a href="#Cuckoo’s-Sandbox" class="headerlink" title="Cuckoo’s Sandbox"></a>Cuckoo’s Sandbox</h3><p><a target="_blank" rel="noopener" href="https://cuckoosandbox.org/">Cuckoo 的沙盒</a> 是恶意软件分析社区中最广为人知的沙盒。它是 2010 年 Google Summer of Code 项目的一部分。它是一个开源项目，您经常会看到它部署在 SOC 环境和爱好者的家庭实验室中。Cuckoo 沙盒的优势包括庞大的社区支持、易于理解的文档和大量自定义。您可以将其部署到您的网络上，并让社区签名引导您识别哪些文件是恶意的，哪些是良性的，因为它附带了大量的社区签名。</p>
<p>Cuckoo 的沙盒已存档，更新正在等待中。它也不支持 Python 3，因此现在已过时。但是，一切还不算太糟，因为我们还有其他选择。</p>
<h3 id="CAPE-Sandbox"><a href="#CAPE-Sandbox" class="headerlink" title="CAPE Sandbox"></a>CAPE Sandbox</h3><p><a target="_blank" rel="noopener" href="https://github.com/kevoreilly/CAPEv2">CAPE 沙箱</a> 是 Cuckoo 沙箱的稍微高级一点的版本。它支持调试和内存转储，以支持对加壳的恶意软件进行脱壳（我们将在高级恶意软件分析模块中了解有关加壳和脱壳的更多信息）。虽然初学者可以使用这个沙箱，但要充分利用它需要高级知识。此沙箱的社区版本已在线提供，可用于在安装前进行测试运行。CAPE 沙箱目前仍在积极开发中，并支持 Python 3。</p>
<h2 id="Online-Sandboxes"><a href="#Online-Sandboxes" class="headerlink" title="Online Sandboxes:"></a>Online Sandboxes:</h2><p>设置和维护沙箱可能是一项耗时的任务。考虑到这一点，在线沙箱可以提供很大的帮助。一些最常用的在线沙箱如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cuckoo.cert.ee/">Online Cuckoo Sandbox</a></li>
<li><a target="_blank" rel="noopener" href="https://any.run/">Any.run</a></li>
<li><a target="_blank" rel="noopener" href="https://analyze.intezer.com/">Intezer</a></li>
<li><a target="_blank" rel="noopener" href="https://hybrid-analysis.com/">Hybrid Analysis</a></li>
</ul>
<p>虽然在线沙箱提供了有用的工具，但最好不要在线提交样本，除非您确定自己在做什么。更好的方法是在您使用的服务上搜索样本的哈希值，看看是否有人已经提交了它。让我们看看混合分析，看看它为我们的样本提供了哪些有趣的分析。</p>
<h3 id="Analyzing-samples-using-Hybrid-Analysis"><a href="#Analyzing-samples-using-Hybrid-Analysis" class="headerlink" title="Analyzing samples using Hybrid Analysis"></a>Analyzing samples using Hybrid Analysis</h3><p>在其主页上，我们看到了以下屏幕：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/947a74dd9d2ff42810c1a0c91079a1e8.png" alt="img"></p>
<p>正如我们提到的，我们不会提交样本。相反，我们将搜索样本的哈希值。因此，我们将从附加的 VM 中搜索 wannacry 样本的 md5sum。我们将看到它已经提交了多次，我们可以从提交的结果中进行选择。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/9d8e2a97315e6b458f583d211b4819ba.png" alt="img"></p>
<p>让我们从中打开在Windows 7 64位上提交的那个。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/cb173e0611090adc2327e7f5770d89c1.png" alt="img"></p>
<p>点击样本后，我们将看到上述界面。我们可以在右侧看到一个导航窗格，其中突出显示了报告的不同部分。我们还可以看到判定结果为恶意，威胁分数为 100/100，AV 检测率为 95%。在此之下，我们可以看到样本行为的概述。在此之下，我们将看到与 MITRE ATT&amp;CK 技术的映射。单击“查看所有详细信息”时，我们将看到以下映射：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/9e1a1a01fcf353c9a75c33ab0358a877.png" alt="img"></p>
<p>下面我们可以看到一些指标和上下文信息，以及该样本的一些静态分析信息。下面是动态分析部分：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/c817a7e0dcaa383e9d9f84bd19f527c1.png" alt="img"></p>
<p>这部分为我们提供了大量有关样本在沙箱中运行时的行为的信息。我们可以单击每个进程以查找有关它的更多详细信息。在上面的屏幕截图中，特别有趣的是 cmd.exe 的执行。我们可以看到该样本正在运行脚本文件并删除备份和卷影副本，勒索软件操作员经常这样做以阻止受害者从这些来源恢复他们的文件。</p>
<p>在本节下面，我们将看到样本的网络分析：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/77053f26e9374259ca622908bcb0fab0.png" alt="img"></p>
<p>报告中还提供了提取的字符串和提取的文件。它们可以提供有关我们在上述过程中看到的批处理脚本的信息。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/afe475fcc71679a4c07297bdcf60cd48.png" alt="img"></p>
<p>最后还有来自社区的评论。正如我们所看到的，使用讨论过的技术，我们可以找到恶意软件样本的许多谜题。然而，在某些情况下，这些技术可能不足以做出决定。让我们转到下一个任务，确定哪些场景会使分析恶意软件变得具有挑战性。</p>
<h1 id="Anti-analysis-techniques"><a href="#Anti-analysis-techniques" class="headerlink" title="Anti-analysis techniques"></a>Anti-analysis techniques</h1><p>当安全研究人员正在设计技术和工具来分析恶意软件时，恶意软件作者正在努力使这些工具和技术失效。我们在之前的任务中找到了大量有关我们分析的恶意软件的信息。但是，恶意软件作者可以通过多种方式让我们的生活变得困难。以下是恶意软件作者用来做同样事情的一些技术。</p>
<h2 id="打包和混淆："><a href="#打包和混淆：" class="headerlink" title="打包和混淆："></a>打包和混淆：</h2><p>恶意软件作者经常使用打包和混淆来让分析师的生活变得困难。打包程序会混淆、压缩或加密恶意软件的内容。这些技术使得静态分析恶意软件变得困难。具体来说，打包的恶意软件在对它进行字符串搜索时不会显示重要信息。例如，让我们对附加 VM 中 Samples 文件夹中名为“zmsuz3pinwl”的文件进行字符串搜索。</p>
<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ strings zmsuz3pinwl</span><br><span class="line">!This program cannot be run in DOS mode.</span><br><span class="line">RichH</span><br><span class="line">.rsrc</span><br><span class="line">.data</span><br><span class="line">.adata</span><br><span class="line">dApB</span><br><span class="line">Qtq5</span><br><span class="line">wn;3b:TC,n</span><br><span class="line">*tVlr</span><br><span class="line">D6j[</span><br><span class="line">^sZ"4V</span><br><span class="line">JIoL</span><br><span class="line">j~AI</span><br><span class="line">tYFu</span><br><span class="line">7^V1</span><br><span class="line">vYB09</span><br><span class="line">"PeHy</span><br><span class="line">M4AF#</span><br><span class="line">3134</span><br><span class="line">%}W\+</span><br><span class="line">3A;a5</span><br><span class="line">dLq&lt;</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br></pre></td></tr></tbody></table></figure>

<p>我们会注意到，此样本主要包含垃圾字符串，这些字符串对我们没有多大用处。让我们对样本运行 pecheck，看看还能得到什么。</p>
<p>Remnux</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user@machine$ pecheck zmsuz3pinwl </span><br><span class="line">PE check for 'zmsuz3pinwl':</span><br><span class="line">Entropy: 7.978052 (Min=0.0, Max=8.0)</span><br><span class="line">MD5     hash: 1ebb1e268a462d56a389e8e1d06b4945</span><br><span class="line">SHA-1   hash: 1ecc0b9f380896373e81ed166c34a89bded873b5</span><br><span class="line">SHA-256 hash: 98c6cf0b129438ec62a628e8431e790b114ba0d82b76e625885ceedef286d6f5</span><br><span class="line">SHA-512 hash: 6921532b4b5ed9514660eb408dfa5d28998f52aa206013546f9eb66e26861565f852ec7f04c85ae9be89e7721c4f1a5c31d2fae49b0e7fdfd20451191146614a</span><br><span class="line"> entropy: 7.999788 (Min=0.0, Max=8.0)</span><br><span class="line"> entropy: 7.961048 (Min=0.0, Max=8.0)</span><br><span class="line"> entropy: 7.554513 (Min=0.0, Max=8.0)</span><br><span class="line">.rsrc entropy: 6.938747 (Min=0.0, Max=8.0)</span><br><span class="line"> entropy: 0.000000 (Min=0.0, Max=8.0)</span><br><span class="line">.data entropy: 7.866646 (Min=0.0, Max=8.0)</span><br><span class="line">.adata entropy: 0.000000 (Min=0.0, Max=8.0)</span><br><span class="line">Dump Info:</span><br><span class="line">----------Parsing Warnings----------</span><br><span class="line"></span><br><span class="line">Suspicious flags set for section 0. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.</span><br><span class="line"></span><br><span class="line">Suspicious flags set for section 1. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.</span><br><span class="line"></span><br><span class="line">Suspicious flags set for section 2. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.</span><br><span class="line"></span><br><span class="line">Suspicious flags set for section 3. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.</span><br><span class="line"></span><br><span class="line">Suspicious flags set for section 4. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.</span><br><span class="line"></span><br><span class="line">Suspicious flags set for section 5. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.</span><br><span class="line"></span><br><span class="line">Suspicious flags set for section 6. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.</span><br><span class="line"></span><br><span class="line">Imported symbols contain entries typical of packed executables.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br></pre></td></tr></tbody></table></figure>

<p>正如怀疑的那样，根据 pecheck，我们发现可执行文件具有典型的打包可执行文件的特征。我们会注意到样本中没有 .text 部分，其他部分具有执行权限，这表明这些部分包含可执行指令或在执行期间将填充可执行指令。我们还将看到，此样本没有太多可能向我们展示其功能的导入，就像我们在上一个样本中看到的那样。</p>
<p>对于打包可执行文件的分析，第一步通常是解压样本。这是一个高级主题，将在后面的房间中介绍。</p>
<h2 id="Sandbox-evasion"><a href="#Sandbox-evasion" class="headerlink" title="Sandbox evasion:"></a>Sandbox evasion:</h2><p>正如我们之前所见，我们始终可以在沙盒中运行样本来对其进行分析。在许多情况下，这可能有助于我们分析逃避基本静态分析技术的样本。然而，恶意软件作者有一些阻碍这一努力的秘诀。其中一些技术如下：</p>
<ul>
<li><strong>长时间休眠调用</strong>：恶意软件作者知道沙盒运行的时间有限。因此，他们对恶意软件进行编程，使其在执行后很长时间内不执行任何活动。这通常是通过长时间休眠调用来实现的。此技术的目的是使沙盒超时。</li>
<li><strong>用户活动检测</strong>：一些恶意软件样本会等待用户活动，然后再执行恶意活动。此技术的前提是沙盒中没有用户。因此不会有鼠标移动或键盘打字。高级恶意软件还会检测自动沙盒中经常使用的鼠标移动模式。此技术旨在绕过自动沙盒检测。</li>
<li><strong>记录用户活动</strong>：某些恶意软件会检查用户文件或活动，例如 MS Office 历史记录或互联网浏览历史记录中是否有任何文件。如果未发现任何活动或发现很少的活动，恶意软件会将机器视为沙盒并退出。</li>
<li><strong>检测虚拟机</strong>：沙盒在虚拟机上运行。虚拟机会留下可被恶意软件识别的痕迹。例如，在 VMWare 或 Virtualbox 上运行的虚拟机中安装的一些驱动程序会泄露该机器是虚拟机的事实。恶意软件作者经常将虚拟机与沙盒关联起来，如果检测到虚拟机，就会终止恶意软件。</li>
</ul>
<p>以上列表并不详尽，但让我们大致了解了分析恶意软件时会发生什么。在未来专门用于恶意软件分析的模块中，我们将讨论这些技术以及检测使用这些技术的恶意软件的方法。</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>这是关于恶意软件分析的入门知识。然而，这只是触及皮毛。到目前为止，我们学到了：</p>
<ul>
<li>恶意软件的静态和动态分析</li>
<li>查找字符串、计算哈希值以及对恶意软件运行 AV 扫描</li>
<li>PE 标头简介以及如何在恶意软件分析中使用其中的信息</li>
<li>沙盒和我们可以使用的不同在线沙盒</li>
<li>恶意软件如何逃避我们刚刚讨论的技术。</li>
</ul>
<p>我们将开发一个恶意软件分析模块，该模块将介绍对抗刚刚讨论的反分析技术的方法。</p>
<p>在我们的 <a target="_blank" rel="noopener" href="https://discord.gg/tryhackme">Discord 频道</a> 或 <a target="_blank" rel="noopener" href="http://twitter.com/realtryhackme">Twitter 帐户</a> 上告诉我们您在这个房间里发现了什么有趣的东西。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://mikannse.space">Mikannse</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://mikannse.space/2024/11/02/THMIntrotoMalwareAnalysis/">http://mikannse.space/2024/11/02/THMIntrotoMalwareAnalysis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://mikannse.space" target="_blank">MikannseのSekai</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90/">恶意软件分析</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/11/02/THMWindowsInternals/" title="THMWindowsInternals"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">THMWindowsInternals</div></div></a></div><div class="next-post pull-right"><a href="/2024/10/31/THMYara/" title="THMYara"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">THMYara</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/11/04/THMBasicDynamicAnalysis/" title="THMBasicDynamicAnalysis"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">THMBasicDynamicAnalysis</div></div></a></div><div><a href="/2024/11/02/THMBasicStaticAnalysis/" title="THMBasicStaticAnalysis"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-02</div><div class="title">THMBasicStaticAnalysis</div></div></a></div><div><a href="/2024/11/12/THMDynamicAnalysisDebugging/" title="THMDynamicAnalysisDebugging"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-12</div><div class="title">THMDynamicAnalysisDebugging</div></div></a></div><div><a href="/2024/11/04/THMAdvancedStaticAnalysis/" title="THMAdvancedStaticAnalysis"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">THMAdvancedStaticAnalysis</div></div></a></div><div><a href="/2024/11/05/THMMalDocStaticAnalysis/" title="THMMalDocStaticAnalysis"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-05</div><div class="title">THMMalDocStaticAnalysis</div></div></a></div><div><a href="/2024/07/19/CSS%E9%9A%8F%E6%89%8B%E8%AE%B0/" title="CSS随手记"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-19</div><div class="title">CSS随手记</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mikannse</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">311</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">73</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mikannse/mikannse.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">暂时没有公告QAQ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Malware-Analysis"><span class="toc-number">2.</span> <span class="toc-text">Malware Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">恶意软件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90%E8%83%8C%E5%90%8E%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">2.2.</span> <span class="toc-text">恶意软件分析背后的目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E4%B9%8B%E5%89%8D%EF%BC%81"><span class="toc-number">2.3.</span> <span class="toc-text">开始之前！</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Techniques-of-malware-analysis"><span class="toc-number">3.</span> <span class="toc-text">Techniques of malware analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">静态分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text">动态分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">3.3.</span> <span class="toc-text">高级恶意软件分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Basic-Static-Analysis"><span class="toc-number">4.</span> <span class="toc-text">Basic Static Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AD%A6%E5%91%8A%EF%BC%81"><span class="toc-number">4.1.</span> <span class="toc-text">警告！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">检查文件类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Examining-Strings"><span class="toc-number">4.3.</span> <span class="toc-text">Examining Strings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Calculating-Hashes"><span class="toc-number">4.4.</span> <span class="toc-text">Calculating Hashes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AV-scans-and-VirusTotal"><span class="toc-number">4.5.</span> <span class="toc-text">AV scans and VirusTotal</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-PE-file-Header"><span class="toc-number">5.</span> <span class="toc-text">The PE file Header</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PE-Header"><span class="toc-number">5.1.</span> <span class="toc-text">PE Header</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Imports-x2F-Exports"><span class="toc-number">5.1.1.</span> <span class="toc-text">Imports&#x2F;Exports</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sections"><span class="toc-number">5.1.2.</span> <span class="toc-text">Sections:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analyzing-PE-header-using-pecheck-utility"><span class="toc-number">5.2.</span> <span class="toc-text">Analyzing PE header using pecheck utility</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Basic-Dynamic-Analysis"><span class="toc-number">6.</span> <span class="toc-text">Basic Dynamic Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Caution"><span class="toc-number">6.1.</span> <span class="toc-text">Caution!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction-to-Sandboxes"><span class="toc-number">6.2.</span> <span class="toc-text">Introduction to Sandboxes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Construction-of-a-sandbox"><span class="toc-number">6.3.</span> <span class="toc-text">Construction of a sandbox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Open-Source-Sandboxes"><span class="toc-number">6.4.</span> <span class="toc-text">Open Source Sandboxes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cuckoo%E2%80%99s-Sandbox"><span class="toc-number">6.4.1.</span> <span class="toc-text">Cuckoo’s Sandbox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAPE-Sandbox"><span class="toc-number">6.4.2.</span> <span class="toc-text">CAPE Sandbox</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Online-Sandboxes"><span class="toc-number">6.5.</span> <span class="toc-text">Online Sandboxes:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Analyzing-samples-using-Hybrid-Analysis"><span class="toc-number">6.5.1.</span> <span class="toc-text">Analyzing samples using Hybrid Analysis</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Anti-analysis-techniques"><span class="toc-number">7.</span> <span class="toc-text">Anti-analysis techniques</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%92%8C%E6%B7%B7%E6%B7%86%EF%BC%9A"><span class="toc-number">7.1.</span> <span class="toc-text">打包和混淆：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sandbox-evasion"><span class="toc-number">7.2.</span> <span class="toc-text">Sandbox evasion:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Conclusion"><span class="toc-number">8.</span> <span class="toc-text">Conclusion</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/15/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E4%B9%9D)%E4%B9%8BVulnHubSNAKEOIL/" title="打靶记录(一六九)之VulnHubSNAKEOIL">打靶记录(一六九)之VulnHubSNAKEOIL</a><time datetime="2025-01-15T08:34:34.000Z" title="发表于 2025-01-15 16:34:34">2025-01-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/15/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B8%80%E5%85%AD%E5%85%AB)%E4%B9%8BVulnHubEvilbox/" title="打靶记录(一六八)之VulnHubEvilbox">打靶记录(一六八)之VulnHubEvilbox</a><time datetime="2025-01-15T06:41:28.000Z" title="发表于 2025-01-15 14:41:28">2025-01-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/06/2024%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" title="2024年度总结">2024年度总结</a><time datetime="2025-01-05T16:23:47.000Z" title="发表于 2025-01-06 00:23:47">2025-01-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/06/24-12%E6%9D%82%E8%B0%88/" title="24-12杂谈">24-12杂谈</a><time datetime="2025-01-05T16:22:01.000Z" title="发表于 2025-01-06 00:22:01">2025-01-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/25/Python3%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0%E7%AC%AC%E5%85%AD%E7%AB%A0%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2%E6%8A%93%E5%8F%96/" title="Python3爬虫开发笔记第六章动态渲染页面抓取">Python3爬虫开发笔记第六章动态渲染页面抓取</a><time datetime="2024-12-25T15:31:25.000Z" title="发表于 2024-12-25 23:31:25">2024-12-25</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By Mikannse</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  const disqus_config = function () {
    this.page.url = 'http://mikannse.space/2024/11/02/THMIntrotoMalwareAnalysis/'
    this.page.identifier = '/2024/11/02/THMIntrotoMalwareAnalysis/'
    this.page.title = 'THMIntrotoMalwareAnalysis'
  }

  const disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addModeChange('disqus', disqusReset)

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>