<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>IntrotoLogAnalysisTHM | MikannseのSekai</title><meta name="author" content="Mikannse"><meta name="copyright" content="Mikannse"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Introduction日志分析是网络安全和系统监控的重要方面。在较高层面上，日志分析检查并解释各种来源（设备、应用程序和系统）生成的日志事件数据，以监控指标并识别安全事件。它涉及收集、解析和处理日志文件，以将数据转化为可操作的目标。通过采用有效的日志分析策略，安全团队可以更准确地响应安全事件并主动洞察潜在威胁。 在这个房间中，我们将探讨与日志分析方法、有效日志记录实践以及帮助检测和响应的常用工具">
<meta property="og:type" content="article">
<meta property="og:title" content="IntrotoLogAnalysisTHM">
<meta property="og:url" content="http://mikannse.space/2024/05/27/IntrotoLogAnalysisTHM/index.html">
<meta property="og:site_name" content="MikannseのSekai">
<meta property="og:description" content="Introduction日志分析是网络安全和系统监控的重要方面。在较高层面上，日志分析检查并解释各种来源（设备、应用程序和系统）生成的日志事件数据，以监控指标并识别安全事件。它涉及收集、解析和处理日志文件，以将数据转化为可操作的目标。通过采用有效的日志分析策略，安全团队可以更准确地响应安全事件并主动洞察潜在威胁。 在这个房间中，我们将探讨与日志分析方法、有效日志记录实践以及帮助检测和响应的常用工具">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg">
<meta property="article:published_time" content="2024-05-27T11:02:16.000Z">
<meta property="article:modified_time" content="2024-10-21T09:08:14.212Z">
<meta property="article:author" content="Mikannse">
<meta property="article:tag" content="渗透测试">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="运维">
<meta property="article:tag" content="Log">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg"><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="http://mikannse.space/2024/05/27/IntrotoLogAnalysisTHM/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Mikannse","link":"链接: ","source":"来源: MikannseのSekai","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'IntrotoLogAnalysisTHM',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-10-21 17:08:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">295</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="MikannseのSekai"><span class="site-name">MikannseのSekai</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">IntrotoLogAnalysisTHM</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-27T11:02:16.000Z" title="发表于 2024-05-27 19:02:16">2024-05-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-21T09:08:14.212Z" title="更新于 2024-10-21 17:08:14">2024-10-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E5%AE%89/">网安</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="IntrotoLogAnalysisTHM"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>日志分析是网络安全和系统监控的重要方面。在较高层面上，日志分析检查并解释各种来源（设备、应用程序和系统）生成的日志事件数据，以监控指标并识别安全事件。它涉及收集、解析和处理日志文件，以将数据转化为可操作的目标。通过采用有效的日志分析策略，安全团队可以更准确地响应安全事件并主动洞察潜在威胁。</p>
<p>在这个房间中，我们将探讨与日志分析方法、有效日志记录实践以及帮助检测和响应的常用工具相关的概念。</p>
<p>学习目标</p>
<ul>
<li>学习日志分析最佳实践。</li>
<li>发现日志分析的基本工具。</li>
<li>通过使用多种工具和技术获得分析日志的实践经验。</li>
</ul>
<p>房间先决条件</p>
<p>建议对日志及其收集方式有一个大致的了解。日志分析模块中的前面的房间是该主题的很好的入门读物：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://tryhackme.com/jr/introtologs">Intro to Logs</a></li>
<li><a target="_blank" rel="noopener" href="https://tryhackme.com/jr/logoperations">Log Operations</a></li>
</ul>
<h1 id="Log-Analysis-Basics"><a href="#Log-Analysis-Basics" class="headerlink" title="Log Analysis Basics"></a>Log Analysis Basics</h1><p>在基础设施系统收集和利用的各种数据源中，日志对于提供有关这些系统的内部工作和网络交互的宝贵见解至关重要。日志是记录发生的事件的按时间顺序的消息流。日志分析是理解日志中捕获的事件的过程，以清晰地描绘整个基础设施中发生的情况。</p>
<p>什么是日志？</p>
<p>日志是系统、设备或应用程序内记录的事件或事务。具体来说，这些事件可能与应用程序错误、系统故障、审核的用户操作、资源使用、网络连接等相关。每个日志条目都包含事件上下文相关的详细信息，例如时间戳（发生的日期和时间）、源（生成日志的系统）以及有关特定日志事件的其他信息。</p>
<p>sample.log</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Jul 28 17:45:02 10.10.0.4 FW-1: %WARNING% general: Unusual network activity detected from IP 10.10.0.15 to IP 203.0.113.25. Source Zone: Internal, Destination Zone: External, Application: web-browsing, Action: Alert.</span><br></pre></td></tr></tbody></table></figure>

<p>在上面的示例中，此日志条目表示防火墙检测到的有关内部系统异常网络活动的事件，表明存在潜在的安全问题。此示例中要考虑的相关字段是：</p>
<p><code>Jul 28 17:45:02</code> - 此时间戳显示事件的日期和时间。</p>
<p><code>10.10.0.4</code> - 这是指生成日志的系统的 IP 地址（源）。</p>
<p><code>%WARNING%</code> - 这表示日志的严重性，在本例中为 <strong>警告</strong>。日志条目通常被赋予严重性级别来分类和传达其相对重要性或影响。这些严重性级别有助于根据事件的严重性确定响应、调查和行动的优先级。不同的系统使用的严重性级别可能略有不同，但通常您会发现以下逐渐增加的严重性级别：信息、警告、错误和严重。</p>
<p> <code>Action: Alert </code>- 在这种情况下，防火墙的策略配置为在发生此类异常活动时发出通知。</p>
<p>其余字段为我们提供与记录的事件相关的特定信息。具体来说，从 IP 10.10.0.15 到 IP 203.0.113.25 检测到异常网络活动。根据“源区域”字段，流量显示目的地为互联网（<strong>外部</strong>），并且<strong>应用程序</strong>被分类为<strong>网络浏览</strong>。</p>
<p>为什么日志很重要？</p>
<p>收集日志并采用有效的日志分析策略对于组织的持续运营至关重要有几个原因。一些最常见的活动包括：</p>
<ul>
<li><strong>系统故障排除</strong>：分析系统错误和警告日志有助于IT团队了解并快速响应系统故障，最大限度地减少停机时间并提高整体系统可靠性。</li>
<li><strong>网络安全事件：</strong> 在安全环境中，日志对于检测和响应安全事件至关重要。例如，防火墙日志、入侵检测系统 (IDS) 日志和系统身份验证日志包含有关潜在威胁和可疑活动的重要信息。执行日志分析可帮助 SOC 团队和安全分析师识别并快速响应未经授权的访问尝试、恶意软件、数据泄露和其他恶意活动。</li>
<li><strong>威胁狩猎：</strong> 在主动方面，网络安全团队可以使用收集的日志来主动搜索可能逃避传统安全措施的高级威胁。安全分析师和威胁猎人可以分析日志，以查找可能表明存在威胁行为者的异常模式、异常情况和妥协指标 (IOC)。</li>
<li><strong>合规性：</strong> 出于监管和合规性目的，组织必须经常维护其系统活动的详细记录。定期日志分析可确保组织能够提供准确的报告并证明遵守 GDPR、HIPAA 或 PCI DSS 等法规。</li>
</ul>
<p>日志类型</p>
<p>正如<a target="_blank" rel="noopener" href="https://tryhackme.com/room/introtologs">日志简介</a> 室中所讨论的，计算环境中的不同组件会生成各种类型的日志，每种日志都有不同的用途。这些日志类型包括但不限于：</p>
<ul>
<li><strong>应用程序日志：</strong> 来自特定应用程序的消息，提供对其状态、错误、警告和其他操作详细信息的见解。</li>
<li><strong>审核日志：</strong> 系统或应用程序内发生的事件、操作和更改，提供用户活动和系统行为的历史记录。</li>
<li><strong>安全日志：</strong> 与安全相关的事件，例如登录、权限更改、防火墙活动以及影响系统安全的其他操作。</li>
<li><strong>服务器日志：</strong> 系统日志、事件日志、错误日志和访问日志，每个日志都提供有关服务器操作的不同信息。</li>
<li><strong>系统日志：</strong> 内核活动、系统错误、启动顺序和硬件状态，有助于诊断系统问题。</li>
<li><strong>网络日志：</strong> 网络内的通信和活动，捕获有关事件、连接和数据传输的信息。</li>
<li><strong>数据库日志：</strong> 数据库系统内的活动，例如执行的查询、操作和更新。</li>
<li><strong>Web 服务器日志：</strong> Web 服务器处理的请求，包括 URL、源 IP 地址、请求类型、响应代码等。</li>
</ul>
<p>每种日志类型都对环境中的活动提供了独特的视角，并且在上下文中分析这些日志对于有效的网络安全调查和威胁检测至关重要。</p>
<h1 id="Investigation-Theory"><a href="#Investigation-Theory" class="headerlink" title="Investigation Theory"></a>Investigation Theory</h1><p>采用多种方法、最佳实践和基本技术来创建连贯的时间表并进行有效的日志分析调查。</p>
<p>时间线</p>
<p>进行日志分析时，创建时间线是理解系统、设备和应用程序内事件顺序的一个基本方面。从较高层次来看，时间线是所记录事件的时间顺序表示，根据事件的发生进行排序。 可视化时间线的能力是了解和理解特定时期内发生的事件的强大工具。</p>
<p>在事件响应场景中，时间线在重建安全事件中发挥着至关重要的作用。通过有效的时间表，安全分析师可以追踪导致事件发生的事件顺序，从而使他们能够识别最初的危害点并了解攻击者的策略、技术和程序 (TTP)。</p>
<p>时间戳</p>
<p>在大多数情况下，日志通常包含记录事件发生时间的时间戳。由于许多分布式设备、应用程序和系统可能在不同区域生成单独的日志事件，因此考虑每个日志的时区和格式至关重要。将时间戳转换为一致的时区对于跨不同日志源进行准确的日志分析和关联是必要的。</p>
<p>许多日志监控解决方案通过时区检测和自动配置来解决这个问题。例如，<a target="_blank" rel="noopener" href="https://docs.splunk.com/Documentation/Splunk/9.1.0/Search/Abouttimezones">Splunk</a> 在对数据进行索引和搜索时自动检测和处理时区。无论在各个日志事件中如何指定时间，时间戳都会转换为 UNIX 时间并在索引时存储在“_time”字段中。</p>
<p>然后可以在可视化过程中将这种一致的时间戳转换为本地时区，从而使报告和分析更加高效。该策略确保分析师可以进行准确的调查并从日志数据中获得有价值的见解，而无需人工干预。</p>
<p>超级时间线</p>
<p>超级时间线，也称为综合时间线，是日志分析和数字取证中的一个强大概念。超级时间线提供了跨不同系统、设备和应用程序的事件的全面视图，使分析人员能够全面了解事件的顺序。这对于调查涉及多个组件或系统的安全事件特别有用。</p>
<p>超级时间线通常包括来自前面讨论的日志源的数据，例如系统日志、应用程序日志、网络流量日志、防火墙日志等。通过将这些不同的来源组合到一个时间线中，分析师可以识别单独分析日志时需要显而易见的相关性和模式。</p>
<p>手动创建包含所有这些信息的综合时间表需要时间和精力。您不仅需要记录系统上每个文件的时间戳，还需要了解每个应用程序的数据存储方法。幸运的是，<a target="_blank" rel="noopener" href="https://github.com/log2timeline/plaso">Plaso (Python Log2Timeline)</a> 是一个由 Kristinn Gudjonsson 和许多贡献者创建的开源工具，可以自动从各种日志源创建时间线。它专为数字取证和日志分析而设计，可以解析和处理来自各种来源的日志数据，以创建统一的、按时间顺序排列的时间线。</p>
<p>要了解有关 Plaso 及其功能的更多信息，请访问此处的<a target="_blank" rel="noopener" href="https://plaso.readthedocs.io/en/latest/">官方文档页面</a>。</p>
<p>数据可视化</p>
<p>数据可视化工具，例如 Kibana（Elastic Stack 的）和 Splunk，有助于通过用户界面将原始日志数据转换为交互式且富有洞察力的视觉表示。此类工具使安全分析师能够通过可视化模式和异常（通常以图形视图的形式）来理解索引数据。可以将多个可视化、指标和图形元素构建到定制的仪表板视图中，从而为日志分析操作提供全面的“单一管理平台”视图。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/caeace06b70e4c6920d32ae0bf22e8f4.png" alt="An example of a tailored Splunk dashboard for monitoring and performance"></p>
<p>要创建有效的日志可视化，首先必须了解正在收集的数据（和来源）并定义明确的可视化目标。</p>
<p>例如，假设目标是监视和检测失败登录尝试增加的模式。在这种情况下，我们应该查看可视化日志，以审核来自身份验证服务器或用户设备的登录尝试。一个好的解决方案是创建一个折线图，显示一段时间内登录尝试失败的趋势。为了管理捕获数据的密度，我们可以过滤可视化以显示过去 7 天。这将为我们提供一个良好的起点来可视化增加的失败尝试并发现异常情况。</p>
<p>日志监控与报警</p>
<p>除了可视化之外，实施有效的日志监控和警报还可以让安全团队“主动”识别威胁并在生成警报时立即做出响应。</p>
<p>许多 SIEM 解决方案（例如 Splunk 和 Elastic Stack）允许根据日志事件中获取的指标创建自定义警报。值得创建警报的事件可能包括多次失败的登录尝试、权限升级、访问敏感文件或其他潜在安全漏洞的指标。 警报可确保安全团队及时收到需要立即关注的可疑活动通知。</p>
<p>应定义事件响应过程各个阶段的升级和通知程序的角色和职责。升级程序可确保事件得到及时处理，并确保每个严重级别的相关人员都得到通知。</p>
<p>如需在 Splunk 中实际操作仪表板和警报，建议查看 <a target="_blank" rel="noopener" href="https://tryhackme.com/jr/splunkdashboardsandreports">Splunk：仪表板和报告</a> 室！</p>
<p>外部研究和威胁英特尔</p>
<p>确定我们在日志分析中可能感兴趣的内容至关重要。如果我们不完全确定我们要寻找什么，那么分析日志就很困难。</p>
<p>首先，我们来了解一下什么是威胁情报。总之，威胁情报是可归因于恶意行为者的信息片段。威胁情报的示例包括：</p>
<ul>
<li>IP 地址</li>
<li>文件哈希</li>
<li>域名</li>
</ul>
<p>在分析日志文件时，我们可以搜索是否存在威胁情报。例如，采用下面的 Apache2 Web 服务器条目。我们可以看到一个IP地址试图访问我们网站的管理面板。</p>
<p> 输出Apache2访问日志</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           cmnatic@thm cat access.log</span><br><span class="line">54.36.149.64 - - [25/Aug/2023:00:05:36 +0000] "GET /admin HTTP/1.1" 200 8260 "-" "Mozilla/5.0 (compatible; AhrefsBot/7.0; +http://ahrefs.com/robot/)"</span><br><span class="line">191.96.106.80 - - [25/Aug/2023:00:33:11 +0000] "GET /TryHackMe/rooms/docker-rodeo/dockerregistry/catalog1.png HTTP/1.1" 200 19594 "https://tryhackme.com/" "Mozi&gt;</span><br><span class="line">54.36.148.244 - - [25/Aug/2023:00:34:46 +0000] "GET /TryHackMe/?C=D;O=D HTTP/1.1" 200 5879 "-" "Mozilla/5.0 (compatible; AhrefsBot/7.0; +http://ahrefs.com/robot&gt;</span><br><span class="line">66.249.66.68 - - [25/Aug/2023:00:35:53 +0000] "GET /TryHackMe%20Designs/ HTTP/1.1" 200 5973 "-" "Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) 200 19594 "https://tryhackme.com/" "Mozi&gt;    </span><br></pre></td></tr></tbody></table></figure>

<p>使用 <a target="_blank" rel="noopener" href="https://threatfox.abuse.ch/">ThreatFox</a> 等威胁情报源，我们可以搜索日志文件以查找已知恶意行为者的存在。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/c3ad6571c689577d907026d8a75d73c7.png" alt="Threatfox output, highlighting several indicators of compromise in our log file"></p>
<p>使用 GREP 在日志文件中搜索 IP 地址   </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           cmnatic@thm grep "54.36.149.64" logfile.txt</span><br><span class="line">54.36.149.64</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Detection-Engineering"><a href="#Detection-Engineering" class="headerlink" title="Detection Engineering"></a>Detection Engineering</h1><p>常见日志文件位置</p>
<p>日志分析的一个重要方面是了解在哪里可以找到各种应用程序和系统生成的日志文件。虽然日志文件路径可能因系统配置、软件版本和自定义设置而异，但了解常见日志文件位置对于高效调查和威胁检测至关重要。</p>
<ul>
<li>网络服务器：</li>
<li>nginx：</li>
<li>访问日志：<code>/var/log/nginx/access.log</code></li>
<li>错误日志：<code>/var/log/nginx/error.log</code></li>
<li>阿帕奇：</li>
<li>访问日志：<code>/var/log/apache2/access.log</code></li>
<li>错误日志：<code>/var/log/apache2/error.log</code></li>
<li>数据库：</li>
<li>MySQL：</li>
<li>错误日志：<code>/var/log/mysql/error.log</code></li>
<li>PostgreSQL：</li>
<li>错误和活动日志：<code>/var/log/postgresql/postgresql-{version}-main.log</code></li>
<li>网络应用程序：</li>
<li>PHP：</li>
<li>错误日志：<code>/var/log/php/error.log</code></li>
<li>操作系统：</li>
<li>Linux：</li>
<li>常规系统日志：<code>/var/log/syslog</code></li>
<li>身份验证日志：<code>/var/log/auth.log</code></li>
<li>防火墙和 IDS/IPS：</li>
<li>iptables：</li>
<li>防火墙日志：<code>/var/log/iptables.log</code></li>
<li>snort ：</li>
<li>Snort 日志：<code>/var/log/snort/</code></li>
</ul>
<p>虽然这些是常见的日志文件路径，但请务必注意，实际路径可能会因系统配置、软件版本和自定义设置而异。建议查阅官方文档或配置文件来验证日志文件路径是否正确，以确保分析和调查的准确性。</p>
<p>常见模式</p>
<p>在安全环境中，识别日志数据中的常见模式和趋势对于识别潜在的安全威胁至关重要。这些“模式”是指威胁行为者或网络安全事件在日志中留下的可识别工件。幸运的是，有一些常见的模式，如果学习了这些模式，将提高您的检测能力，并使您能够有效地响应事件。</p>
<p><strong>异常用户行为</strong></p>
<p>可以识别的主要模式之一与不寻常或异常的用户行为有关。这是指用户进行的任何偏离其典型或预期行为的行为或活动。</p>
<p>为了有效检测异常用户行为，组织可以采用结合检测引擎和机器学习算法的日志分析解决方案来建立正常行为模式。 与这些模式或基线的偏差可以作为潜在的安全事件发出警报。这些解决方案的一些示例包括 <a target="_blank" rel="noopener" href="https://www.splunk.com/en_us/products/user-behavior-analytics.html"><em>Splunk 用户行为分析 (UBA)</em></a>、*[IBM QRadar UBA](https: //<a target="_blank" rel="noopener" href="http://www.ibm.com/docs/en/qradar-common?topic=app-qradar-user-behavior-analytics">www.ibm.com/docs/en/qradar-common?topic=app-qradar-user-behavior-analytics</a>)*, 和 <em>[Azure AD 身份保护](<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en">https://learn.microsoft.com/en</a> -us/azure/active-directory/身份保护/概述身份保护）</em>。</p>
<p>具体指标可能因来源而异，但可以在日志文件中找到的一些示例包括：</p>
<ul>
<li>多次登录尝试失败</li>
<li>短时间内登录失败次数异常多，可能表明存在暴力攻击。</li>
<li>异常登录时间</li>
<li>用户典型访问时间或模式之外的登录事件可能表明未经授权的访问或帐户受到威胁。</li>
<li>地理异常</li>
<li>来自用户通常不访问的国家/地区的 IP 地址的登录事件可能表明潜在的帐户泄露或可疑活动。</li>
<li>此外，从不同地理位置同时登录（或不可能旅行的迹象）可能表明帐户共享或未经授权的访问。</li>
<li>频繁更改密码</li>
<li>表明用户密码在短时间内频繁更改的日志事件可能表明有人试图隐藏未经授权的访问或接管帐户。</li>
<li>不寻常的用户代理字符串</li>
<li>在 HTTP 流量日志的上下文中，来自具有与其典型浏览器不同的不常见用户代理字符串的用户的请求可能表明自动攻击或恶意活动。</li>
<li>例如，默认情况下，<a target="_blank" rel="noopener" href="https://tryhackme.com/room/furthernmap">Nmap 扫描仪</a> 将记录包含“Nmap 脚本引擎”的用户代理。默认情况下，<a target="_blank" rel="noopener" href="https://tryhackme.com/room/Hydra">Hydra 暴力破解工具</a> 将在其用户代理中包含“(Hydra)”。这些指示器在日志文件中可用于检测潜在的恶意活动。</li>
</ul>
<p>这些异常的重要性可能因具体环境和现有系统的不同而有很大差异，因此有必要微调任何自动异常检测机制以最大限度地减少误报。</p>
<p>常见的攻击特征</p>
<p>识别日志数据中的常见攻击特征是检测和快速响应威胁的有效方法。攻击签名包含威胁行为者留下的特定模式或特征。它们可能包括恶意软件感染、基于 Web 的攻击（SQL 注入、跨站点脚本、目录遍历）等等。由于这完全取决于攻击面，因此一些高级示例包括：</p>
<p>SQL注入</p>
<p>SQL注入尝试利用与数据库交互的 Web 应用程序中的漏洞。在应用程序或数据库日志中查找异常或格式错误的 SQL 查询，以识别常见的 SQL 注入攻击模式。</p>
<p>可疑的 SQL 查询可能包含意外字符，例如单引号 (<code>'</code>)、注释 (<code>--</code>、<code>#</code>)、联合语句 (<code>UNION</code>) 或基于时间的攻击 (<code>WAITFOR DELAY</code>、<code>sleep()</code>）。可以在[此处](<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL</a> Injection)找到可供参考的有用的 SQLi 负载列表。</p>
<p>在下面的示例中，可以通过“q=”查询参数的“UNION SELECT”部分来识别 SQL 注入尝试。攻击者似乎已经使用单引号转义了 SQL 查询，并注入了 union select 语句以从数据库中的“users”表中检索信息。通常，此有效负载可能是 URL 编码的，需要额外的处理步骤才能有效地识别它。</p>
<p>sqli.log        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">10.10.61.21 - - [2023-08-02 15:27:42] "GET /products.php?q=books' UNION SELECT null, null, username, password, null FROM users-- HTTP/1.1" 200 3122</span><br></pre></td></tr></tbody></table></figure>

<p>跨站脚本 (XSS)</p>
<p>利用跨站脚本（XSS）漏洞，攻击者可以将恶意脚本注入网页。为了识别常见的 XSS 攻击模式，查找具有意外或异常输入的日志条目通常很有帮助，其中包括脚本标记 (<code>&lt;script&gt;</code>) 和事件处理程序 (<code>onmouseover</code>、<code>onclick</code>、<code>onerror</code>)。可以在<a target="_blank" rel="noopener" href="https://github.com/payloadbox/xss-payload-list">此处</a>找到可供参考的有用的 XSS 有效负载列表。</p>
<p>在下面的示例中，可以通过插入到“search”参数中的“<script>alert(1);</script>”负载来识别跨站脚本攻击，这是 XSS 漏洞的常见测试方法。</p>
<p>xss.log        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">10.10.19.31 - - [2023-08-04 16:12:11] "GET /products.php?search=\&lt;script&gt;alert(1);&lt;/script&gt; HTTP/1.1" 200 5153</span><br></pre></td></tr></tbody></table></figure>

<p>路径遍历</p>
<p>利用路径遍历漏洞，攻击者可以访问 Web 应用程序预期目录结构之外的文件和目录，从而导致对敏感文件或代码的未经授权的访问。要识别常见的遍历攻击模式，请查找遍历序列字符（<code>../</code> 和 <code>../../</code>）以及对敏感文件的访问指示（<code>/etc/passwd</code>、<code>/etc/shadow</code>） 。可以在[此处](<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Directory">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Directory</a> Traversal/README.md)找到可供参考的有用目录遍历有效负载列表。</p>
<p>需要注意的是，与上面的示例一样，目录遍历通常是 URL 编码（或双 URL 编码），以避免被防火墙或监控工具检测到。因此，“%2E”和“%2F”是有用的 URL 编码字符，因为它们分别引用“.”和“/”。</p>
<p>在下面的示例中，可以通过重复的“../”字符序列来识别目录遍历尝试，表明攻击者正在尝试“退出”Web目录并访问敏感的“/etc/passwd”文件在服务器上。</p>
<p>​            path-traversal.log        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">10.10.113.45 - - [2023-08-05 18:17:25] "GET /../../../../../etc/passwd HTTP/1.1" 200 505</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Automated-vs-Manual-Analysis"><a href="#Automated-vs-Manual-Analysis" class="headerlink" title="Automated vs. Manual Analysis"></a>Automated vs. Manual Analysis</h1><p>自动分析</p>
<p>自动化分析涉及工具的使用。例如，这些通常包括 XPLG 或 SolarWinds Loggly 等商业工具。 自动分析工具允许对日志进行处理和数据分析。这些工具通常利用人工智能/机器学习来分析模式和趋势。随着人工智能领域的发展，我们期望看到更有效的自动化分析解决方案。</p>
<table>
<thead>
<tr>
<th><strong>Advantages</strong></th>
<th><strong>Disadvantages</strong></th>
</tr>
</thead>
<tbody><tr>
<td>通过执行手动分析所需的大量手动工作来节省时间</td>
<td>自动分析工具通常仅供商业使用，因此价格昂贵。</td>
</tr>
<tr>
<td>人工智能的使用可以有效地识别模式和趋势。</td>
<td>人工智能的有效性取决于模型的能力。例如，误报的风险增加，或者可能会错过更新的或从未见过的事件，因为人工智能没有经过训练来识别这些事件。</td>
</tr>
</tbody></table>
<p>手动分析</p>
<p>手动分析是在不使用自动化工具的情况下检查数据和工件的过程。例如，分析师滚动浏览 Web 服务器日志将被视为手动分析。手动分析对于分析师来说至关重要，因为不能依赖自动化工具。</p>
<table>
<thead>
<tr>
<th><strong>Advantages</strong></th>
<th><strong>Disadvantages</strong></th>
</tr>
</thead>
<tbody><tr>
<td>它很便宜并且不需要昂贵的工具。例如，简单的 Linux 命令就可以实现这一目的。</td>
<td>这是非常耗时的，因为分析人员必须完成所有工作，包括重新格式化日志文件。</td>
</tr>
<tr>
<td>允许进行彻底调查。</td>
<td>N/A</td>
</tr>
<tr>
<td>降低自动化工具警报过度拟合或误报的风险。</td>
<td>事件或警报可能会被错过！尤其是当有大量数据需要梳理时。</td>
</tr>
<tr>
<td>允许进行上下文分析。分析师对组织和网络安全形势有更广泛的了解。</td>
<td>N/A</td>
</tr>
</tbody></table>
<h1 id="Log-Analysis-Tools-Command-Line"><a href="#Log-Analysis-Tools-Command-Line" class="headerlink" title="Log Analysis Tools: Command Line"></a>Log Analysis Tools: Command Line</h1><p>在分析收集的日志时，有时我们最容易使用的工具就是命令行本身。通过命令行分析日志提供了一种快速而强大的方法来深入了解系统活动、解决问题和检测安全事件，即使我们没有配置 SIEM 系统也是如此。</p>
<p>许多内置的Linux命令可以让我们快速解析和过滤相关信息。 使用命令行查看日志文件是进行日志分析的最基本但最重要的任务之一。几种常见的内置工具用于此目的，提供不同的功能来有效地读取和浏览日志文件。</p>
<p>您可以在 AttackBox 上的“/root/Rooms/introloganalysis/task6”下找到“apache.log”文件来执行此任务。但是，它也附加到此任务并可供下载。</p>
<p>猫</p>
<p>“cat”命令（“concatenate”的缩写）是一种简单的实用程序，它读取一个或多个文件并在终端中显示其内容。当用于日志文件时，它将整个日志内容打印到屏幕上。</p>
<p>例如，要查看名为“apache.log”的日志文件的内容，可以使用以下命令：</p>
<p>​            cat Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ cat apache.log        </span><br><span class="line">203.0.113.42 - - [31/Jul/2023:12:34:56 +0000] "GET /index.php HTTP/1.1" 200 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36"</span><br><span class="line">120.54.86.23 - - [31/Jul/2023:12:34:57 +0000] "GET /contact.php HTTP/1.1" 404 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36"</span><br><span class="line">185.76.230.45 - - [31/Jul/2023:12:34:58 +0000] "GET /about.php HTTP/1.1" 200 9876 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.164 Safari/537.36"</span><br><span class="line">201.39.104.77 - - [31/Jul/2023:12:34:59 +0000] "GET /login.php HTTP/1.1" 200 4321 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.54 Safari/537.36"</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>由于其输出较大，它通常不是处理长日志文件的最佳方法。</p>
<p>较少的</p>
<p>在处理较大文件时，“less”命令是对“cat”命令的改进。它允许您逐页查看文件的数据，提供更方便的方式来阅读冗长的日志。使用 less 打开文件时，默认显示第一页，您可以使用箭头键或使用 <em>Page Up</em> 和 <em>Page Down</em> 向下滚动。</p>
<p>例如，要使用“less”查看同一日志文件，请使用以下命令：</p>
<p>​            less Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ less apache.log       </span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">HTTP/1.1" 200 7890 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.350 Safari/5&gt;</span><br><span class="line">P/1.1" 404 4321 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.3&gt;</span><br><span class="line">TTP/1.1" 200 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.90 Safari/537&gt;</span><br><span class="line">P/1.1" 200 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.3&gt;</span><br><span class="line">TTP/1.1" 404 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.54 Safari/537&gt;</span><br><span class="line">P/1.1" 200 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.85 Safari/537.3&gt;</span><br><span class="line">TP/1.1" 200 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.90 Safari/537.&gt;</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">(END)</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>您可以通过“q”键退出命令的输出。</p>
<p>tail</p>
<p>“tail”命令是专门为查看文件末尾而设计的，对于查看日志文件中最近生成的事件的摘要非常有用。 <code>tail</code> 最常见的用法是与 <code>-f</code> 选项结合使用，它允许您实时“跟踪”日志文件，因为它会在生成和写入新日志条目时不断更新终端。这在监视实时事件或实时系统行为日志时非常有用。</p>
<p>默认情况下，“tail”仅显示文件的最后十行。但是，我们可以使用“-n”选项更改此设置并指定要查看的行数。</p>
<p>例如，如果我们只想打印<code>apache.log</code>文件的最后五行并实时“跟踪”日志，我们可以使用以下命令：</p>
<p>​            tail Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ tail -f -n 5 apache.log</span><br><span class="line">176.145.201.99 - - [31/Jul/2023:12:34:24 +0000] "GET /login.php HTTP/1.1" 200 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.90 Safari/537.36"</span><br><span class="line">104.76.29.88 - - [31/Jul/2023:12:34:23 +0000] "GET /index.php HTTP/1.1" 200 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36"</span><br><span class="line">128.45.76.66 - - [31/Jul/2023:12:34:22 +0000] "GET /contact.php HTTP/1.1" 404 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.54 Safari/537.36"</span><br><span class="line">76.89.54.221 - - [31/Jul/2023:12:34:21 +0000] "GET /about.php HTTP/1.1" 200 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.85 Safari/537.36"</span><br><span class="line">145.76.33.201 - - [31/Jul/2023:12:34:20 +0000] "GET /login.php HTTP/1.1" 200 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.90 Safari/537.36"</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>能够从命令行对日志文件进行排序、过滤和操作是执行有效日志分析的一个重要方面。分析师通常需要提取特定信息、过滤相关数据、汇总结果并转换日志，以发现见解并识别异常情况。</p>
<p><strong>注意：</strong> <code>tail</code> 命令的相反是 <code>head</code>，它允许您默认查看文件的<em>前</em>十行，并接受相同的参数。也请随意尝试一下！</p>
<p>wc</p>
<p>“wc”（字数统计）命令是一个简单但功能强大的实用程序，对于快速分析和统计数据收集非常有用。 <code>wc</code> 的输出提供有关日志文件中的行数、单词数和字符数的信息。这可以帮助安全分析师在进行更详细的分析之前了解他们正在处理的日志数据的大小和数量。</p>
<p>​            wc Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">        user@tryhackme$ wc apache.log     </span><br><span class="line">70  1562 14305 apache.log</span><br></pre></td></tr></tbody></table></figure>

<p>在“apache.log”上运行“wc”后，我们可以确定该文件包含<strong>70</strong>行、<strong>1562</strong>个单词（以空格分隔）和<strong>14305</strong>个字符。</p>
<p>cut</p>
<p>“cut”命令根据指定的分隔符从文件中提取特定的列（字段）。这是一个方便的命令，用于处理具有结构化或制表符分隔数据的日志文件。</p>
<p>如果我们想要提取文件中的所有IP地址，我们可以使用“cut”命令指定“空格”字符分隔符，并只选择返回的第一个字段。</p>
<p>​            cut Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ cut -d ' ' -f 1 apache.log</span><br><span class="line">203.0.113.42</span><br><span class="line">120.54.86.23</span><br><span class="line">185.76.230.45</span><br><span class="line">201.39.104.77</span><br><span class="line">112.76.89.56</span><br><span class="line">211.87.186.35</span><br><span class="line">156.98.34.12</span><br><span class="line">202.176.73.99</span><br><span class="line">122.65.187.55</span><br><span class="line">77.188.103.244</span><br><span class="line">189.76.230.44</span><br><span class="line">153.47.106.221</span><br><span class="line">200.89.134.22</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>上述命令将返回日志文件中每个 IP 地址的列表。在此基础上进行扩展，我们可以将字段编号更改为“-f 7”以提取 URL，将字段编号更改为“-f 9”以提取 HTTP 状态代码。</p>
<p>sort</p>
<p>有时，按时间顺序或字母顺序对返回的条目进行排序会很有帮助。 “sort”命令根据特定标准按升序或降序排列文件中的数据。这对于识别日志数据中的模式、趋势或异常值至关重要。通常还可以将另一个命令（例如 cut）的<em>输出</em>组合起来，并使用管道 <code>|</code> 重定向字符将其用作排序命令的<em>输入</em>。</p>
<p>例如，要对上述“cut”命令返回的 IP 地址列表进行排序，我们可以运行：</p>
<p>​            sort Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ cut -d ' ' -f 1 apache.log | sort -n</span><br><span class="line">76.89.54.221</span><br><span class="line">76.89.54.221</span><br><span class="line">76.89.54.221</span><br><span class="line">76.89.54.221</span><br><span class="line">76.89.54.221</span><br><span class="line">76.89.54.221</span><br><span class="line">77.188.103.244</span><br><span class="line">99.76.122.65</span><br><span class="line">104.76.29.88</span><br><span class="line">104.76.29.88</span><br><span class="line">104.76.29.88</span><br><span class="line">104.76.29.88</span><br><span class="line">104.76.29.88</span><br><span class="line">104.76.29.88</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>在上面的命令中，我们将“cut”的输出通过管道传输到“sort”命令中，并添加“-n”选项以<em>数字</em>排序。这会将输出更改为按升序列出 IP 地址。</p>
<p>如果我们想颠倒顺序，我们可以添加 <code>-r</code> 选项：</p>
<p>​            sort Example (Reversed)        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ cut -d ' ' -f 1 apache.log | sort -n -r</span><br><span class="line">221.90.64.76</span><br><span class="line">211.87.186.35</span><br><span class="line">203.78.122.88</span><br><span class="line">203.64.78.90</span><br><span class="line">203.64.78.90</span><br><span class="line">203.64.78.90</span><br><span class="line">203.64.78.90</span><br><span class="line">203.64.78.90</span><br><span class="line">203.64.78.90</span><br><span class="line">203.0.113.42</span><br><span class="line">202.176.73.99</span><br><span class="line">201.39.104.77</span><br><span class="line">200.89.134.22</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>uniq</p>
<p>“uniq”命令从排序的输入中识别并删除相邻的重复行。在日志分析中，这可能是简化数据列表（如收集的 IP 地址）的有用工具，特别是当日志条目可能包含重复或冗余信息时。 “uniq”命令通常与“sort”命令结合使用，在删除重复条目之前对数据进行“排序”。</p>
<p>例如，我们上面运行的“sort”命令的输出包含一些重复的 IP 地址，当数据按数字排序时更容易发现。要从列表中删除这些重复提取的 IP，我们可以运行：</p>
<p>​            uniq Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ cut -d ' ' -f 1 apache.log | sort -n -r | uniq</span><br><span class="line">221.90.64.76</span><br><span class="line">211.87.186.35</span><br><span class="line">203.78.122.88</span><br><span class="line">203.64.78.90</span><br><span class="line">203.0.113.42</span><br><span class="line">202.176.73.99</span><br><span class="line">201.39.104.77</span><br><span class="line">200.89.134.22</span><br><span class="line">192.168.45.99</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>我们还可以附加“-c”选项来输出唯一的行，并在每行前面添加出现次数。这对于快速确定流量异常高的 IP 地址非常有用。</p>
<p>​            uniq Example (with count)        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ cut -d ' ' -f 1 apache.log | sort -n -r | uniq -c</span><br><span class="line">      1 221.90.64.76</span><br><span class="line">      1 211.87.186.35</span><br><span class="line">      1 203.78.122.88</span><br><span class="line">      6 203.64.78.90</span><br><span class="line">      1 203.0.113.42</span><br><span class="line">      1 202.176.73.99</span><br><span class="line">      1 201.39.104.77</span><br><span class="line">      1 200.89.134.22</span><br><span class="line">      1 192.168.45.99</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>sed</p>
<p><code>sed</code> 和 <code>awk</code> 都是强大的文本处理工具，通常用于日志分析。它们有时可以互换使用，但这两个命令都有其用例，并且可以允许安全分析师有效地操作、提取和转换日志数据。</p>
<p>使用替换语法，“sed”可以将特定模式或字符串替换为日志条目。例如，要将 <code>apache.log</code> 文件中所有出现的“<strong>31/Jul/2023</strong>”替换为“<strong>July 31, 2023</strong>”，我们可以使用：</p>
<p>​            sed Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ sed 's/31\/Jul\/2023/July 31, 2023/g' apache.log</span><br><span class="line">203.0.113.42 - - [July 31, 2023:12:34:56 +0000] "GET /index.php HTTP/1.1" 200 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36"</span><br><span class="line">120.54.86.23 - - [July 31, 2023:12:34:57 +0000] "GET /contact.php HTTP/1.1" 404 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36"</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>请注意，需要反斜杠字符“\”来“转义”我们模式中的正斜杠，并告诉“sed”将正斜杠视为文字字符。另请注意，“sed”命令<em>不会</em>直接更改“apache.log”文件；它会直接更改“apache.log”文件。相反，它仅将文件的修改版本输出到命令行中的标准输出。如果要覆盖文件，可以添加“-i”选项来就地编辑文件，或使用重定向运算符“&gt;”将输出保存到原始文件或另一个文件。</p>
<p><strong>警告：</strong> 如果将“-i”选项与“sed”一起使用，则可能会覆盖原始文件并丢失有价值的数据。确保保留备份副本！</p>
<p>awk</p>
<p>对于“awk”命令，一个常见的用例是基于特定字段值的条件操作。例如，要打印 HTTP 响应代码大于或等于“400”（这将指示 HTTP 错误状态）的日志条目，我们可以使用以下命令：</p>
<p>​            awk Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ awk '$9 &gt;= 400' apache.log</span><br><span class="line">120.54.86.23 - - [31/Jul/2023:12:34:57 +0000] "GET /contact.php HTTP/1.1" 404 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36"</span><br><span class="line">156.98.34.12 - - [31/Jul/2023:12:35:02 +0000] "GET /about.php HTTP/1.1" 404 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.85 Safari/537.36"</span><br><span class="line">189.76.230.44 - - [31/Jul/2023:12:35:06 +0000] "GET /about.php HTTP/1.1" 404 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.170 Safari/537.36"</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>在本例中，我们使用“$9”字段（在此日志示例中指的是 HTTP 状态代码），要求它大于或等于“400”。</p>
<p>这仅触及了这些命令功能的表面，强烈建议您在<a target="_blank" rel="noopener" href="https://www.theunixschool.com/p/awk-sed.html">此处</a>阅读有关其选项和用例的更多信息。</p>
<p>grep</p>
<p>“grep”命令是一种功能强大的文本搜索工具，广泛用于 UNIX 系统，并在日志分析中提供了特殊的用例。它允许您在文件或文本流中搜索特定模式或正则表达式。使用“grep”可以帮助分析人员快速识别与特定条件、特定资源或关键字或与安全事件相关的模式匹配的相关日志条目。</p>
<p><code>grep</code> 最基本的用法是在日志文件中搜索特定字符串。例如，如果我们对服务器上“/admin.php”网页的任何日志条目感到怀疑，我们可以“grep”“admin”以返回任何相关结果：</p>
<p>​            grep Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ grep "admin" apache.log</span><br><span class="line">145.76.33.201 - - [31/Jul/2023:12:34:54 +0000] "GET /admin.php HTTP/1.1" 200 4321 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.330 Safari/537.36"</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>与“uniq -c”命令一样，我们可以将“-c”选项附加到“grep”来计算与搜索条件匹配的条目。例如，由于上述命令仅返回一行，因此附加“-c”将返回“1”。</p>
<p>​            grep Example (with count)        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ grep -c "admin" apache.log</span><br><span class="line">1        </span><br></pre></td></tr></tbody></table></figure>

<p>如果我们想知道日志文件中的哪个<strong>行号</strong>与匹配的条目相关，我们可以添加“-n”选项来帮助快速定位特定的事件：</p>
<p>​            grep Example (line number)        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ grep -n "admin" apache.log                           </span><br><span class="line">37:145.76.33.201 - - [31/Jul/2023:12:34:54 +0000] "GET /admin.php HTTP/1.1" 200 4321 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.330 Safari/537.36"</span><br></pre></td></tr></tbody></table></figure>

<p>在这种情况下，行号<strong>“37”</strong>被添加到日志条目输出之前。</p>
<p>最后，我们可以使用“-v”选项<strong>反转</strong>我们的命令，仅选择<strong>不</strong>包含指定模式或关键字的行。这对于从日志文件中快速过滤掉不需要的或不相关的行非常有用。例如，如果我们对访问“/index.php”页面的任何日志条目不感兴趣，我们可以运行以下命令将其过滤掉：</p>
<p>​            grep Example (inverted)        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ grep -v "/index.php" apache.log | grep "203.64.78.90"</span><br><span class="line">203.64.78.90 - - [31/Jul/2023:12:35:01 +0000] "GET /about.php HTTP/1.1" 404 4321 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.170 Safari/537.36"</span><br><span class="line">203.64.78.90 - - [31/Jul/2023:12:34:53 +0000] "GET /about.php HTTP/1.1" 200 1234 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.210 Safari/537.36"</span><br><span class="line">203.64.78.90 - - [31/Jul/2023:12:34:46 +0000] "GET /contact.php HTTP/1.1" 200 4321 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.100 Safari/537.36"</span><br><span class="line">203.64.78.90 - - [31/Jul/2023:12:34:32 +0000] "GET /login.php HTTP/1.1" 404 5678 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.330 Safari/537.36"</span><br><span class="line">203.64.78.90 - - [31/Jul/2023:12:34:25 +0000] "GET /about.php HTTP/1.1" 404 4321 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36"</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>请注意，在上面的命令中，我们过滤掉了“index.php”页面，并将输出通过管道传输到另一个 grep 命令，该命令仅提取包含 IP 地址“203.64.78.90”的日志条目。</p>
<p>与“awk”和“sed”一样，“grep”是一个非常强大的工具，无法在单个任务中完全涵盖。强烈建议您在官方 GNU 手册页 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/grep/manual/grep.html">此处</a> 上阅读更多相关信息。</p>
<p>虽然命令行日志分析提供了强大的功能，但它可能只适合某些场景，尤其是在处理庞大而复杂的日志数据集时。 Elastic (ELK) Stack 或 Splunk 等专用日志分析解决方案可以提高效率，并提供额外的日志分析和可视化功能。然而，命令行对于快速、简单的日志分析任务仍然至关重要。</p>
<h1 id="Log-Analysis-Tools-Regular-Expressions"><a href="#Log-Analysis-Tools-Regular-Expressions" class="headerlink" title="Log Analysis Tools: Regular Expressions"></a>Log Analysis Tools: Regular Expressions</h1><p>正则表达式（缩写为 <em>regex</em>）是定义搜索、匹配和操作文本数据模式的宝贵方法。正则表达式模式是使用表示匹配规则的特殊字符的组合来构造的，并且在许多编程语言、文本编辑器和软件中都支持。</p>
<p>本房间不会涵盖构建正则表达式模式的深入使用。然而，<a target="_blank" rel="noopener" href="https://tryhackme.com/room/catregex">正则表达式</a> 室是学习和练习正则表达式的绝佳资源。</p>
<p>正则表达式广泛用于日志分析，以在将日志转发到集中式 SIEM 系统之前提取相关信息、过滤数据、识别模式和处理日志。甚至可以将正则表达式与“grep”命令一起使用，因为它是在日志文件中搜索模式的极其强大的方法。</p>
<p>grep 的正则表达式</p>
<p>作为一个简单的示例，请参阅附加到此任务的 ZIP 文件中的“apache-ex2.log”文件。您可以在 AttackBox 上的“/root/Rooms/introloganalysis/task7”下找到任务文件。确保首先运行“unzip regex.zip”，然后运行“cd regex”来“解压缩”文件。</p>
<p>该日志文件包含来自博客站点的日志条目。该网站的结构使得每篇博客文章都有其唯一的 ID，通过“post” URL 参数从数据库动态获取。如果我们只对 ID 在 10-19 之间的特定博客文章感兴趣，我们可以在日志文件上运行以下“grep”正则表达式模式：</p>
<p>​            grep Regex Example        </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           user@tryhackme$ grep -E 'post=1[0-9]' apache-ex2.log</span><br><span class="line">203.0.113.1 - - [02/Aug/2023:10:15:23 +0000] "GET /blog.php?post=12 HTTP/1.1" 200 - "Mozilla/5.0"</span><br><span class="line">100.22.189.54 - - [03/Aug/2023:12:48:43 +0000] "GET /blog.php?post=14 HTTP/1.1" 200 - "Mozilla/5.0"</span><br><span class="line">34.210.98.12 - - [03/Aug/2023:15:30:56 +0000] "GET /blog.php?post=11 HTTP/1.1" 200 - "Mozilla/5.0"</span><br><span class="line">102.210.76.44 - - [04/Aug/2023:19:26:29 +0000] "GET /blog.php?post=16 HTTP/1.1" 200 - "Mozilla/5.0"</span><br><span class="line">98.88.76.103 - - [05/Aug/2023:17:56:33 +0000] "GET /blog.php?post=13 HTTP/1.1" 200 - "Mozilla/5.0"</span><br><span class="line">76.88.44.90 - - [06/Aug/2023:12:58:22 +0000] "GET /blog.php?post=17 HTTP/1.1" 200 - "Mozilla/5.0"</span><br><span class="line">98.76.102.33 - - [07/Aug/2023:15:24:30 +0000] "GET /blog.php?post=19 HTTP/1.1" 200 - "Mozilla/5.0"</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>请注意，我们添加了“-E”选项来表示我们正在搜索模式而不仅仅是字符串，这使得我们可以使用正则表达式。对于模式本身，我们匹配文字字符“post=”。之后，我们添加数字“1”，然后使用“[0-9]”动态插入字符 0-9。将其放在一起，“1[0-9]”将匹配任何以“1”开头的两位数字，例如 10、11、12 及以后。</p>
<p>日志解析的正则表达式</p>
<p>正则表达式在日志解析中也发挥着至关重要的作用，日志解析是将日志条目分解为结构化组件并从中提取相关信息的过程。来自不同来源的日志文件可能具有不同的格式和字段，有时需要额外的处理才能将原始日志数据转换为结构化的、可操作的信息。</p>
<p>此外，工程师可以创建针对特定日志定制的自定义正则表达式模式，以将日志条目的特定部分映射到 SIEM 系统的命名字段。总的来说，这个过程使得以后查询和分析提取的数据变得更加容易。</p>
<p>考虑以下原始的、非结构化的日志条目：</p>
<p> 日志条目示例</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">126.47.40.189 - - [28/Jul/2023:15:30:45 +0000] "GET /admin.php HTTP/1.1" 200 1275 "" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.9999.999 Safari/537.36"</span><br></pre></td></tr></tbody></table></figure>

<p>从安全角度来看，这里的几个字段有利于提取到 SIEM 中进行可视化。其中一些包括：</p>
<ul>
<li>IP地址</li>
<li>时间戳</li>
<li>HTTP 方法（例如 POST、GET 或 PUT）</li>
<li>网址</li>
<li>用户代理</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://regexr.com/">RegExr</a> 是一个在线工具，可帮助教授、构建和测试正则表达式模式。要继续操作，请复制上述日志条目并将其粘贴到工具的“<strong>文本</strong>”部分。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/740e3dbe4c3670c6d0deeb879709afd9.png" alt="The Regexr.com GUI after pasting in the unstructured log entry"></p>
<p>作为一个基本示例，如果我们只想从该日志中提取远程 IP 地址，我们可以从逻辑上考虑 IP 地址的结构。 IP 地址是日志条目的第一部分，由四个用句点分隔的八位字节组成。我们可以使用以下模式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">\b([0-9]{1,3}\.){3}[0-9]{1,3}\b</span><br></pre></td></tr></tbody></table></figure>

<p>将此模式粘贴到 RegExr 中的“<strong>表达式</strong>”字段中，您将注意到日志中的 IP 地址已成功提取并突出显示。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/bb98e758d1811b18fe940019aa07a6b5.png" alt="The Regexr.com GUI after pasting in the Regex pattern"></p>
<p>分解这个模式，它以字边界锚“\b”开始和结束，以确保我们匹配完整的 IP 地址。在两者之间，我们定义以下内容：</p>
<ul>
<li><code>[0-9]{1,3}</code> - 匹配一到三位数字以匹配从 0 到 999 的数字。虽然 IPv4 地址八位字节不能超过 255，但这种简化的模式适用于我们的用例。</li>
<li><code>\.</code> - 转义并匹配 IP 地址中的文字 <code>.</code> 字符。</li>
<li><code>{3}</code> - 指定前一个捕获组 <code>([0-9]{1,3}\.)</code> 应重复 3 次。</li>
<li><code>[0-9]{1,3}</code> - 同样，这匹配从 0 到 999 的数字，完成 IP 地址的第四个八位字节。</li>
</ul>
<p>示例：Logstash 和 Grok</p>
<p>Grok 是一个功能强大的 Logstash 插件，使您能够将非结构化日志数据解析为结构化且可搜索的数据。它通常用于为人类阅读而非计算机使用而编写的任何日志格式。它的工作原理是将文本模式与“%{SYNTAX:SEMANTIC}”模式语法相结合。然而，有时，Logstash 缺乏我们需要的内置模式。在这些情况下，我们可以使用 <strong>Oniguruma 语法</strong> 定义自定义模式并利用正则表达式。有关 Grok 及其在 Elastic Stack 中的使用的更多信息，请参阅 Elastic 文档 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok.html">此处</a>。</p>
<p>我们可以使用之前创建的模式从日志文件中成功提取 IPv4 地址，并将其处理到自定义字段中，然后再将其发送到 SIEM。在 Elastic Stack 场景中，我们可以使用 Logstash 配置文件中的“Grok”插件添加过滤器来实现此目的。</p>
<p>​            logstash.conf        </p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line">           <span class="string">input</span> {</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="string">filter</span> {</span><br><span class="line">  <span class="string">grok</span> {</span><br><span class="line">    <span class="string">match</span> <span class="string">=&gt;</span> { <span class="string">"message"</span> <span class="string">=&gt;</span> <span class="string">"(?&lt;ipv4_address&gt;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b)"</span> }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="string">output</span> {</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">}</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure>

<p>在上面的配置中，我们使用之前定义的正则表达式模式从传入日志事件的“消息”字段中提取 IPv4 地址。提取的值将添加到我们定义的自定义“ipv4_addresses”字段名称下。通常，默认配置会自动提取 IP 地址。但这个简单的示例显示了正则表达式模式在处理复杂日志文件和自定义字段要求时的强大功能。</p>
<p><a target="_blank" rel="noopener" href="https://tryhackme.com/jr/logstash">Logstash 房间</a> 和 [Grok 官方文档](<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok">https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok</a>. html）是进一步探索 Logstash 输入和过滤器配置的绝佳资源！</p>
<h1 id="Log-Analysis-Tools-CyberChef"><a href="#Log-Analysis-Tools-CyberChef" class="headerlink" title="Log Analysis Tools: CyberChef"></a>Log Analysis Tools: CyberChef</h1><p>CyberChef 是分析师工具包中的一个强大工具。 CyberChef 由 <a target="_blank" rel="noopener" href="https://github.com/gchq/CyberChef">GCHQ</a> 创建，长期以来一直被视为“网络瑞士军刀”。该应用程序拥有超过 300 个操作，这些操作组合在一起形成了一个配方，使处理数据变得轻而易举。一些主要功能包括：</p>
<ul>
<li>编码和解码数据</li>
<li>加密和散列算法</li>
<li>数据分析，例如解析日志文件和提取数据</li>
<li>还有很多！</li>
</ul>
<p>此任务将演示如何使用 CyberChef 来解析日志文件以及使用配方进行分析。在开始之前，让我们先熟悉一下 CyberChef 界面。首先，让我们通过访问 <a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/">CyberChef</a> 在浏览器中启动 CyberChef。请注意，如果您是 AttackBox 的免费用户，则会安装 CyberChef 的本地副本，并且可以通过单击 Firefox 中的“离线 CyberChef”书签进行访问。</p>
<p>了解 CyberChef</p>
<p>我们来分解一下界面：</p>
<ol>
<li>**The “Operations”**选项卡 - 此选项卡允许我们选择我们希望对输入执行的操作</li>
<li><strong>Recipe</strong> - 此选项卡是操作的集合</li>
<li><strong>input</strong> - 此选项卡是我们输入要分析的数据或来源的地方</li>
<li><strong>output</strong> - 此选项卡是应用操作后输入的最终输出</li>
</ol>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/41d51880de56feac2881a18b416cdf2b.png" alt="CyberChef default interface"></p>
<p>让我们演示一下 CyberChef 的使用情况。在此示例中，我提供了一个输入<strong>“dHJ5aGFja21l”</strong>，它是base64 中的<strong>“tryhackme”</strong>。选择<strong>“From Base64”</strong>操作后，我们可以看到<strong>“tryhackme”</strong>的输出：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/1756db1f18824fbe9a641502d0853f3a.png" alt="The tryhackme base-64 decoded output"></p>
<p>请注意，如果您不确定输入的编码是什么，您可以使用 CyberChef 的 <strong>“Magic”</strong> 操作来最好地猜测输入是什么以及此处可能使用哪些操作。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/11ddc8ccdca739d2bfc2dba6bade8b6c.png" alt="CyberChef's magic operation"></p>
<p>CyberChef 的正则表达式</p>
<p>回想一下，正则表达式是搜索和匹配数据的好方法。在此示例中，我们使用捕获了 SSH 身份验证尝试的日志文件，并使用正则表达式输出所有尝试进行身份验证的 IP 地址。</p>
<p>此外，我们使用正则表达式模式 <code>\b([0-9]{1,3}\.){3}[0-9]{1,3}\b</code> 来搜索 IP 地址值：</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/37c9f3211c4f40a7f92fc7aeee4e852b.png" alt="Using regular expressions with CyberChef"></p>
<p>通过在操作的<strong>“输出格式”</strong>上选择<strong>“列表匹配”</strong>过滤器，我们可以消除日志中的所有噪音并仅输出 IP 地址。当然，这只是一个小例子。日志文件通常可以长达数百行。</p>
<p>在 CyberChef 中上传文件</p>
<p>文件和文件夹可以上传到 CyberChef。这提供了一种将日志文件上传到 CyberChef 的便捷方法。为此，请单击带有指向内部的箭头的框。此外，CyberChef 具有允许您解压缩压缩文件的运算符，例如 <em>.tar.gz</em> 或 <em>.zip</em>。</p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/8f854c952a4c03580e93476214edea9f.png" alt="img"></p>
<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6490641ea027b100564fe00a/room-content/6a7ab19da19fe2d63dc138800edec8d2.png" alt="img"></p>
<h1 id="Log-Analysis-Tools-Yara-and-Sigma"><a href="#Log-Analysis-Tools-Yara-and-Sigma" class="headerlink" title="Log Analysis Tools: Yara and Sigma"></a>Log Analysis Tools: Yara and Sigma</h1><p>Sigma</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SigmaHQ/sigma">Sigma</a> 是一个高度灵活的开源工具，以结构化格式描述日志事件。 Sigma 可用于使用模式匹配来查找日志文件中的条目。西格玛用于：</p>
<ol>
<li>检测日志文件中的事件</li>
<li>创建 SIEM 搜索</li>
<li>识别威胁</li>
</ol>
<p>Sigma 使用 YAML 语法作为其规则。此任务将演示 Sigma 用于检测 SSH 中的失败登录事件。请注意，编写 Sigma 规则超出了本会议室的范围。但是，让我们针对上面列出的场景分解一个 Sigma 规则示例：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">Failed</span> <span class="string">SSH</span> <span class="string">Logins</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">Searches</span> <span class="string">sshd</span> <span class="string">logs</span> <span class="string">for</span> <span class="string">failed</span> <span class="string">SSH</span> <span class="string">login</span> <span class="string">attempts</span></span><br><span class="line"><span class="attr">status:</span> <span class="string">experimental</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">CMNatic</span></span><br><span class="line"><span class="attr">logsource:</span> </span><br><span class="line">    <span class="attr">product:</span> <span class="string">linux</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">sshd</span></span><br><span class="line"></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">'sshd'</span></span><br><span class="line">        <span class="string">a0|contains:</span> <span class="string">'Failed'</span></span><br><span class="line">        <span class="string">a1|contains:</span> <span class="string">'Illegal'</span></span><br><span class="line">    <span class="attr">condition:</span> <span class="string">selection</span></span><br><span class="line"><span class="attr">falsepositives:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Users</span> <span class="string">forgetting</span> <span class="string">or</span> <span class="string">mistyping</span> <span class="string">their</span> <span class="string">credentials</span></span><br><span class="line"><span class="attr">level:</span> <span class="string">medium</span></span><br></pre></td></tr></tbody></table></figure>

<p>在这个 Sigma 规则中：</p>
<table>
<thead>
<tr>
<th><strong>Key</strong></th>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>title</td>
<td>失败的 SSH 登录尝试</td>
<td>本标题概述了西格玛规则的目的。</td>
</tr>
<tr>
<td>description</td>
<td>在 sshd 日志中搜索失败的 SSH 登录尝试</td>
<td>该键提供了对标题进行扩展的描述。</td>
</tr>
<tr>
<td>status</td>
<td>experimental</td>
<td>该键解释了规则的状态。例如，“experimental”意味着必须进行进一步的测试或改进。</td>
</tr>
<tr>
<td>author</td>
<td>CMNatic</td>
<td>制定规则的人。</td>
</tr>
<tr>
<td>logsource</td>
<td>product: linux  service: sshd</td>
<td>在哪里可以找到包含我们要查找的数据的日志文件？</td>
</tr>
<tr>
<td>detection</td>
<td>sshd</td>
<td>该键列出了 Sigma 规则想要查找的内容。</td>
</tr>
<tr>
<td>a0|contains</td>
<td>a0|contains: ‘Failed’</td>
<td>在这种情况下，查找所有带有“failed”的条目。</td>
</tr>
<tr>
<td>a1|contains</td>
<td>a1|contains: ‘Illegal’</td>
<td>在这种情况下，查找所有带有“lllegal”的条目。</td>
</tr>
<tr>
<td>falsepositives</td>
<td>用户忘记或错误输入凭据</td>
<td>列出可能存在此条目但不一定表示恶意行为的情况。</td>
</tr>
</tbody></table>
<p>现在可以在 SIEM 平台中使用此规则来识别已处理日志中的事件。如果您想了解有关 Sigma 的更多信息，我建议您查看 TryHackMe 上的 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/sigma">Sigma</a> 房间。</p>
<p>Yara</p>
<p><a target="_blank" rel="noopener" href="https://github.com/VirusTotal/yara">Yara</a> 是另一种模式匹配工具，在分析师的工具库中占有一席之地。 Yara 是一种 YAML 格式的工具，可根据二进制和文本模式（例如十六进制和字符串）识别信息。虽然 Yara 通常用于恶意软件分析，但它在日志分析方面非常有效。</p>
<p>让我们看一下名为“IPFinder”的 Yara 规则示例。此 YARA 规则使用正则表达式来搜索任何 IPV4 地址。如果我们正在分析的日志文件包含 IP 地址，YARA 会对其进行标记：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">rule</span> <span class="string">IPFinder</span> {</span><br><span class="line">    <span class="attr">meta:</span></span><br><span class="line">        <span class="string">author</span> <span class="string">=</span> <span class="string">"CMNatic"</span></span><br><span class="line">    <span class="attr">strings:</span></span><br><span class="line">        <span class="string">$ip</span> <span class="string">=</span> <span class="string">/(</span>[<span class="number">0</span><span class="number">-9</span>]{<span class="number">1</span>,<span class="number">3</span>}<span class="string">\.)</span>{<span class="number">3</span>}[<span class="number">0</span><span class="number">-9</span>]{<span class="number">1</span>,<span class="number">3</span>}<span class="string">/</span> <span class="string">wide</span> <span class="string">ascii</span></span><br><span class="line"> </span><br><span class="line">    <span class="attr">condition:</span></span><br><span class="line">        <span class="string">$ip</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>让我们看看组成这个 Yara 规则的键：</p>
<table>
<thead>
<tr>
<th><strong>Key</strong></th>
<th><strong>Example</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>rule</td>
<td>IPFinder</td>
<td>该键命名规则。</td>
</tr>
<tr>
<td>meta</td>
<td>author</td>
<td>该密钥包含元数据。例如，在本例中，它是规则作者的姓名。</td>
</tr>
<tr>
<td>strings</td>
<td>$ip = /([0-9]{1,3}.){3}[0-9]{1,3}/ wide ascii</td>
<td>该键包含 YARA 应查找的值。在本例中，它使用 REGEX 来查找 IPV4 地址。</td>
</tr>
<tr>
<td>condition</td>
<td>$ip</td>
<td>如果检测到变量 $ip，则应触发该规则。</td>
</tr>
</tbody></table>
<p>使用YARA检测特定IP地址</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">           cmnatic@thm:~$ yara ipfinder.yar apache2.txt</span><br><span class="line">IPFinder apache2  </span><br></pre></td></tr></tbody></table></figure>

<p>此 YARA 规则可以扩展为查找：</p>
<ul>
<li>多个IP地址</li>
<li>基于范围的 IP 地址（例如 ASN 或子网）</li>
<li>十六进制 IP 地址</li>
<li>如果列出的 IP 地址超过一定数量（即，如果发现 IP 地址五次，则发出警报）</li>
<li>并与其他规则相结合。例如，如果某个 IP 地址访问特定页面或执行特定操作</li>
</ul>
<p>如果您想了解有关 Yara 的更多信息，请查看 TryHackMe 上的 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/yara">Yara</a> 房间。</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>在这个房间中，我们介绍了采用有效日志分析策略背后的基本方法。我们探讨了日志数据收集、常见攻击模式以及调查和响应过程的有用工具的重要性。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://mikannse.space">Mikannse</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://mikannse.space/2024/05/27/IntrotoLogAnalysisTHM/">http://mikannse.space/2024/05/27/IntrotoLogAnalysisTHM/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://mikannse.space" target="_blank">MikannseのSekai</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/%E8%BF%90%E7%BB%B4/">运维</a><a class="post-meta__tags" href="/tags/Log/">Log</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/05/30/IntrotoKubernetesTHM/" title="IntrotoKubernetesTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">IntrotoKubernetesTHM</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/26/PhishingPreventionTHM/" title="PhishingPreventionTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">PhishingPreventionTHM</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/30/IntrotoKubernetesTHM/" title="IntrotoKubernetesTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">IntrotoKubernetesTHM</div></div></a></div><div><a href="/2024/03/21/IntrotoLogsTHM/" title="IntrotoLogsTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-21</div><div class="title">IntrotoLogsTHM</div></div></a></div><div><a href="/2024/06/15/AdvancedSQLInjectionTHM/" title="AdvancedSQLInjectionTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-15</div><div class="title">AdvancedSQLInjectionTHM</div></div></a></div><div><a href="/2024/03/14/ContainerVulnerabilitiesTHM/" title="ContainerVulnerabilitiesTHM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">ContainerVulnerabilitiesTHM</div></div></a></div><div><a href="/2023/11/17/Cross-Site%20Scripting%20(XSS)HTB/" title="Cross-Site Scripting (XSS)HTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-17</div><div class="title">Cross-Site Scripting (XSS)HTB</div></div></a></div><div><a href="/2023/10/24/HackingWordPressHTB/" title="HackingWordPressHTB"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="title">HackingWordPressHTB</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/06/22/PMAjL6lORKa5CGy.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mikannse</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">295</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mikannse/mikannse.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">暂时没有公告QAQ</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log-Analysis-Basics"><span class="toc-number">2.</span> <span class="toc-text">Log Analysis Basics</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Investigation-Theory"><span class="toc-number">3.</span> <span class="toc-text">Investigation Theory</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Detection-Engineering"><span class="toc-number">4.</span> <span class="toc-text">Detection Engineering</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Automated-vs-Manual-Analysis"><span class="toc-number">5.</span> <span class="toc-text">Automated vs. Manual Analysis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log-Analysis-Tools-Command-Line"><span class="toc-number">6.</span> <span class="toc-text">Log Analysis Tools: Command Line</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log-Analysis-Tools-Regular-Expressions"><span class="toc-number">7.</span> <span class="toc-text">Log Analysis Tools: Regular Expressions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log-Analysis-Tools-CyberChef"><span class="toc-number">8.</span> <span class="toc-text">Log Analysis Tools: CyberChef</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log-Analysis-Tools-Yara-and-Sigma"><span class="toc-number">9.</span> <span class="toc-text">Log Analysis Tools: Yara and Sigma</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Conclusion"><span class="toc-number">10.</span> <span class="toc-text">Conclusion</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/04/THMAdvancedStaticAnalysis/" title="THMAdvancedStaticAnalysis">THMAdvancedStaticAnalysis</a><time datetime="2024-11-04T01:28:47.000Z" title="发表于 2024-11-04 09:28:47">2024-11-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/02/THMBasicStaticAnalysis/" title="THMBasicStaticAnalysis">THMBasicStaticAnalysis</a><time datetime="2024-11-02T15:39:05.000Z" title="发表于 2024-11-02 23:39:05">2024-11-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/02/THMWindowsInternals/" title="THMWindowsInternals">THMWindowsInternals</a><time datetime="2024-11-02T14:08:53.000Z" title="发表于 2024-11-02 22:08:53">2024-11-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/02/THMIntrotoMalwareAnalysis/" title="THMIntrotoMalwareAnalysis">THMIntrotoMalwareAnalysis</a><time datetime="2024-11-02T04:24:01.000Z" title="发表于 2024-11-02 12:24:01">2024-11-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/31/THMYara/" title="THMYara">THMYara</a><time datetime="2024-10-31T15:46:38.000Z" title="发表于 2024-10-31 23:46:38">2024-10-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/yjr-1100/Photobag/githubioimg/background_4k.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Mikannse</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  const disqus_config = function () {
    this.page.url = 'http://mikannse.space/2024/05/27/IntrotoLogAnalysisTHM/'
    this.page.identifier = '/2024/05/27/IntrotoLogAnalysisTHM/'
    this.page.title = 'IntrotoLogAnalysisTHM'
  }

  const disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addModeChange('disqus', disqusReset)

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>